"use strict";(self.webpackChunk_planyway_planyway=self.webpackChunk_planyway_planyway||[]).push([[717],{84571:(e,t,r)=>{r.d(t,{Y:()=>PwBoardSettingsMigratorDialogContainer});var i=r(67294),a=r(67558),s=r(6327),n=r(8937);let o=function(e){return e.Confirm="Confirm",e.Migrate="Migrate",e}({});var l=r(59708),d=r(23972),c=r(91894),h=r(69397),u=r(2734),p=r(71508),m=r(88441),C=r(61252),v=r(50460),f=r(85893);const PwMigrationIcon=e=>{let{animate:t}=e;const r={width:56,height:56,"svg path":{fill:"#26d37c"}};return t&&(r["svg .left-arrow"]={animationName:"left-arrow",animationDuration:"2s",animationIterationCount:"infinite","@keyframes left-arrow":{"0%":{transform:"translateX(-2px)"},"50%":{transform:"translateX(3px)"},"100%":{transform:"translateX(-2px)"}}},r["svg .right-arrow"]={animationName:"right-arrow",animationDuration:"2s",animationIterationCount:"infinite","@keyframes right-arrow":{"0%":{transform:"translateX(2px)"},"50%":{transform:"translateX(-3px)"},"100%":{transform:"translateX(2px)"}}}),(0,f.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",height:149},children:[(0,f.jsx)(p.Z,{sx:{width:147,height:147,display:"block",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",border:"1px solid rgba(0, 203, 130, 0.1)",borderRadius:"50%","&::before":{content:'""',width:130,height:130,display:"block",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 203, 130, 0.05)",borderRadius:"50%"},"&::after":{content:'""',width:95,height:95,display:"block",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 203, 130, 0.1)",borderRadius:"50%"}}}),(0,f.jsx)(p.Z,{sx:r,children:(0,f.jsx)(v.r,{})})]})},ConfirmMigrationContent=e=>{let{closeDialog:t,onStartMigrating:r}=e;const{t:i}=(0,a.$)();return(0,f.jsxs)(l.Z,{alignItems:"center",gap:1,children:[(0,f.jsx)(PwMigrationIcon,{}),(0,f.jsx)(d.Z,{variant:"h6",children:i("DIALOGS.MIGRATE_BOARD_SETTINGS_HEADER")}),(0,f.jsx)(d.Z,{align:"center",variant:"body2",children:i("DIALOGS.MIGRATE_BOARD_SETTINGS_DESCRIPTION")}),(0,f.jsxs)(c.Z,{sx:{width:"100%",marginTop:3,padding:0},children:[(0,f.jsx)(h.Z,{color:"neutral",size:"medium",variant:"text",onClick:t,children:i("BUTTONS.NO_THANKS")}),(0,f.jsx)(h.Z,{color:"primary",size:"medium",variant:"contained",onClick:r,children:i("BUTTONS.YES_PLEASE")})]})]})},MigrateContent=e=>{let{migrationProgress:t}=e;const{t:r}=(0,a.$)(),{spacing:i}=(0,u.Z)();return(0,f.jsxs)(l.Z,{alignItems:"center",children:[(0,f.jsx)(PwMigrationIcon,{animate:!0}),(0,f.jsx)(p.Z,{sx:{width:"100%",marginTop:i(4),boxSizing:"border-box",padding:i(0,4)},children:(0,f.jsx)(m.Z,{color:"success",sx:{height:8,borderRadius:4},value:t,variant:t>0?"determinate":"indeterminate"})}),(0,f.jsx)(d.Z,{sx:{margin:i(3,0)},children:r("DIALOGS.MIGRATE_BOARD_SETTINGS_WAITING")})]})},PwBoardSettingsMigratorDialog=e=>{let{dialogState:t,onClose:r,onStartMigrating:i,migrationProgress:a,open:s}=e;const n={[o.Migrate]:(0,f.jsx)(MigrateContent,{migrationProgress:a}),[o.Confirm]:(0,f.jsx)(ConfirmMigrationContent,{closeDialog:r,onStartMigrating:i})};return(0,f.jsx)(C.X,{fullWidth:!0,maxWidth:"xs",open:s,sx:{zIndex:1999},onClose:r,children:n[t]})},PwBoardSettingsMigratorDialogContainer=e=>{let{$log:t,accountId:r,boardId:l,notificationSrv:d,onClose:c,onConfirm:h,open:u,trelloIntegrationSrv:p}=e;const[m,C]=(0,i.useState)((()=>{const e=p.getTrelloBoardById(r,l);if(!e)throw h(null),new Error("Trello board not found");return null!==e.migrationProgress?(h(null),o.Migrate):o.Confirm})),{t:v}=(0,a.$)(),{logError:y}=(0,s.f)(),g=(0,i.useCallback)((()=>{h(!1),c()}),[c,h]),[_,k]=(0,i.useState)((()=>{const e=p.getTrelloBoardById(r,l);return(null==e?void 0:e.migrationProgress)||0}));(0,i.useEffect)((()=>{const boardUpdateHandler=e=>{if(e.id===l)switch(m){case o.Confirm:null!==e.migrationProgress&&(h(null),C(o.Migrate));break;case o.Migrate:null!==e.migrationProgress?k(e.migrationProgress):g()}};return p.addTrelloBoardEventListener("updated",boardUpdateHandler),()=>{p.removeTrelloBoardEventListener("updated",boardUpdateHandler)}}),[l,g,m,h,p]);const handleStartMigrating=()=>{(async()=>{try{await p.migrateBoardSettingsAsync(r,l)}catch(e){t.error("Planyway migrate board settings error:"),t.error(e),y("Planyway migrate board settings error",e,{class:PwBoardSettingsMigratorDialogContainer.name,method:handleStartMigrating.name}),d.showNotification(v("NOTIFICATIONS.MIGRATE_BOARD_SETTINGS_ERROR"),n.k$.Error),g()}})(),h(!0),C(o.Migrate)};return(0,f.jsx)(PwBoardSettingsMigratorDialog,{dialogState:m,migrationProgress:_,open:u,onClose:g,onStartMigrating:handleStartMigrating})};PwBoardSettingsMigratorDialogContainer.injections=["$log","notificationSrv","trelloIntegrationSrv"]},92211:(e,t,r)=>{r.d(t,{Z:()=>ue});var i=r(27525),a=r.n(i),s=r(73324),n=r.n(s),o=r(89221),l=r.n(o),d=r(67294),c=r(67558),h=r(22233),u=r(45063),p=r(71508),m=r(99246),C=r(8937);const v=(0,d.createContext)({});var f=r(62079),y=r.n(f),g=r(52020),_=r.n(g),k=r(88546),b=r.n(k),T=r(99595),S=r.n(T),I=r(66775),w=r.n(I),D=r(2201),E=r.n(D),A=r(57445),L=r.n(A),R=r(26171),x=r(41266),P=r(88946),M=r.n(P),B=r(14723),O=r(52072),$=r(73718),N=r(47036),F=r(40405),j=r.n(F),z=r(40239),U=r(85893);const G=["InputProps","inputProps"];function ownKeys(e,t){var r=y()(e);if(_()){var i=_()(e);t&&(i=n()(i).call(i,(function(t){return b()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?S()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,R.Z)(e,t,a[t])})):w()?E()(e,w()(a)):S()(i=ownKeys(Object(a))).call(i,(function(t){L()(e,t,b()(a,t))}))}return e}const renderOption=(e,t)=>(0,d.createElement)("li",_objectSpread(_objectSpread({},e),{},{key:t.id}),(0,U.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",padding:"4px 0"},children:[(0,U.jsx)(m.zW,{alt:t.userName,src:t.avatarUrlSmall,sx:{width:24,height:24,marginRight:"8px"}}),(0,U.jsx)(p.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"left"},children:(0,U.jsx)(m.zM,{color:"text.primary",sx:{fontSize:"14px"},variant:"body3",children:t.fullName})})]})),renderTags=(e,t)=>M()(e).call(e,((e,r)=>(0,d.createElement)(B.Z,_objectSpread(_objectSpread({},t({index:r})),{},{key:e.id,deleteIcon:(0,U.jsx)(z.r,{}),label:e.email||e.fullName,sx:{backgroundColor:N.Z[100],"&:hover":{backgroundColor:N.Z[200]},[`& .${O.Z.deleteIcon}`]:{width:"16px",height:"16px",borderRadius:"50%",padding:"2px","&:hover":{backgroundColor:N.Z[300]}}}}))));const V=function PwInviteAutocomplete(e){const{canInviteMember:t,canInviteMembers:r,inviteMemberToBoardAsync:i,accountId:a}=e,[s,n]=(0,d.useState)(null),[o,l]=(0,d.useState)(!1),[h,u]=(0,d.useState)([]),[f,y]=(0,d.useState)([]),{getters:{isBusy:g},dispatchers:{setIsAutocompleteBusy:_},services:{$log:k,notificationSrv:b,trelloIntegrationSrv:T,telemetrySrv:S}}=(0,d.useContext)(v),{t:I}=(0,c.$)(),inviteMembersToBoardAsync=async e=>{if(!g&&e)try{_(!0);for(let t of e)await i(t);b.showNotification(I("NOTIFICATIONS.BOARD_SHARE_ALL_MEMBERS_ADDED"),C.k$.Success)}catch(e){k.error("Trello add board member error:"),k.error(e),S.logError("Trello add board member error",e,{class:ue.name,method:inviteMembersToBoardAsync.name}),b.showNotification(I("NOTIFICATIONS.BOARD_SHARE_ADD_MEMBER_ERROR"),C.k$.Error)}finally{_(!1),n(null),u([]),y([])}},w=(0,d.useMemo)((()=>j()((async e=>{try{l(!0),u(await T.searchMembersAsync(a,e.replace(/^@?/,"")))}catch(e){k.error("Planyway search members error:"),k.error(e),S.logError("Planyway search members error",e,{class:PwInviteAutocomplete.name,method:w.name})}finally{l(!1)}}),250)),[]);return(0,d.useEffect)((()=>{s&&"@"!==s&&w(s)}),[s]),(0,U.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",columnGap:"20px"},children:[(0,U.jsx)(m.ip,{PopperComponent:e=>h.length?(0,U.jsx)($.Z,_objectSpread({},e)):null,autoSelect:!0,clearOnBlur:!1,disabled:g||!r,filterOptions:e=>e,forcePopupIcon:!1,freeSolo:!1,fullWidth:!0,getOptionDisabled:e=>!t(e),getOptionLabel:e=>e.email||e.fullName,isOptionEqualToValue:(e,t)=>e.id===t.id,multiple:!0,options:h,renderInput:e=>((e,t,r)=>{const{InputProps:i,inputProps:a}=e,s=(0,x.Z)(e,G),{t:n}=(0,c.$)();return(0,U.jsx)(m.Vf,_objectSpread(_objectSpread({},s),{},{InputProps:_objectSpread(_objectSpread({},i),{},{endAdornment:(0,U.jsx)(U.Fragment,{children:t&&(0,U.jsx)(m.MX,{size:20,sx:{position:"absolute",right:"9px",top:"calc(50% - 10px)"},variant:"indeterminate"})})}),inputProps:_objectSpread(_objectSpread({},a),{},{type:"email",autoComplete:"new-password"}),margin:"none",placeholder:r?n("DIALOGS.BOARD_SHARE_INVITE_PLACEHOLDER"):"",size:"small",variant:"outlined"}))})(e,o,!(null!=f&&f.length)),renderOption,renderTags,selectOnFocus:!1,value:f,onChange:(e,t)=>y(t),onInputChange:(e,t,r)=>{const clear=()=>{n(null),u([])};switch(r){case"input":t?n(t):clear();break;case"reset":case"clear":clear()}}}),(0,U.jsx)(m.uE,{disabled:g||!(null!=f&&f.length),sx:{minWidth:"auto",maxHeight:"36px",whiteSpace:"nowrap"},variant:"contained",onClick:()=>inviteMembersToBoardAsync(f),children:I("BUTTONS.ADD_TO_BOARD")})]})};var K=r(65824);const H=function PwRemoveMemberAlertDialog(e){const{onClose:t,onRemove:r,open:i}=e,{t:a}=(0,c.$)(),closeDialog=()=>t();return(0,U.jsx)(h.Z,{theme:m.rS,children:(0,U.jsxs)(m.X8,{disableRestoreFocus:!0,fullWidth:!0,maxWidth:"xs",open:i,onClose:closeDialog,children:[(0,U.jsx)(m.Fm,{enableCross:!0,sx:{padding:"20px 24px"},onCrossClick:closeDialog}),(0,U.jsxs)(m.Ly,{sx:{overflow:"unset",padding:"0 24px",textAlign:"center"},children:[(0,U.jsx)(m.WX,{component:K.r,inheritViewBox:!0,sx:{height:"112px",width:"112px",marginBottom:"10px",alignSelf:"center",fill:"transparent"}}),(0,U.jsx)(m.zM,{sx:{textAlign:"center",marginBottom:"10px"},variant:"h6",children:a("DIALOGS.BOARD_SHARE_REMOVE_MEMBER_TITLE")}),(0,U.jsx)(m.zM,{sx:{textAlign:"center",marginBottom:"10px"},variant:"body2",children:a("DIALOGS.BOARD_SHARE_REMOVE_MEMBER_DESCRIPTION")})]}),(0,U.jsx)(m.I,{sx:{padding:"24px"},children:(0,U.jsxs)(p.Z,{children:[(0,U.jsx)(m.uE,{color:"neutral",sx:{marginRight:"16px"},variant:"text",onClick:closeDialog,children:a("BUTTONS.CANCEL")}),(0,U.jsx)(m.uE,{color:"error",variant:"contained",onClick:()=>r(),children:a("BUTTONS.REMOVE")})]})})]})})};var Z=r(53886),W=r(23926),Y=r(16628),q=r(67720),X=r(59905);function PwMemberActionsMenu_ownKeys(e,t){var r=y()(e);if(_()){var i=_()(e);t&&(i=n()(i).call(i,(function(t){return b()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwMemberActionsMenu_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?S()(r=PwMemberActionsMenu_ownKeys(Object(a),!0)).call(r,(function(t){(0,R.Z)(e,t,a[t])})):w()?E()(e,w()(a)):S()(i=PwMemberActionsMenu_ownKeys(Object(a))).call(i,(function(t){L()(e,t,b()(a,t))}))}return e}const Q=(0,Z.Pi)((e=>{const{ButtonComponent:t,buttonComponentProps:r,canDeleteMember:i,canLeaveBoard:a,currentMembershipSingleAdmin:s,deleteUser:n,getItemKey:o=(e=>e),items:l,itemTextFormatter:h,leaveBoard:u,onSelectedItemChange:p,selectedItem:C}=e,v=(0,X.o_)({variant:"popper",popupId:"pwMemberActionsMenu"}),{t:f}=(0,c.$)(),handleClose=()=>{v.close()},handleDelete=()=>{n(),v.close()},y=(0,d.useMemo)((()=>{var e;return null===(e=v.anchorEl)||void 0===e?void 0:e.getBoundingClientRect().width}),[v.anchorEl]);return(0,U.jsx)(W.d,{onClickAway:handleClose,children:(0,U.jsxs)(m.EB,{children:[(0,U.jsx)(m.EB,PwMemberActionsMenu_objectSpread(PwMemberActionsMenu_objectSpread({},(0,X.LI)(v)),{},{children:(0,U.jsx)(t,PwMemberActionsMenu_objectSpread({open:v.isOpen,selectedItem:C},r))})),(0,U.jsx)($.Z,PwMemberActionsMenu_objectSpread(PwMemberActionsMenu_objectSpread({},(0,X.Rg)(v)),{},{placement:"bottom-start",sx:{minWidth:null!=y?y:"auto",zIndex:1500},transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,U.jsx)(Y.Z,PwMemberActionsMenu_objectSpread(PwMemberActionsMenu_objectSpread({},t),{},{timeout:350,children:(0,U.jsxs)(m.Nk,{sx:{borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.25)",minWidth:"156px"},children:[M()(l).call(l,((e,t)=>(0,U.jsx)(m.w9,{sx:{margin:"0 8px",paddingLeft:"8px",paddingRight:"8px",fontSize:"13px",borderRadius:"4px",backgroundColor:o(C)===o(e)?"grey.200":"transparent",transition:"background-color 0.25s"},onClick:()=>(e=>{p&&(p(e),handleClose())})(e),children:h?h(e):String(e)},t))),i&&(0,U.jsx)(q.Z,{sx:{marginBottom:"8px"}}),i&&(0,U.jsx)(m.uE,{color:"error",size:"small",sx:{justifyContent:"flex-start",margin:"0 8px",padding:"6px 8px",minWidth:"calc(100% - 16px)"},onClick:handleDelete,children:f("BUTTONS.REMOVE")}),a&&(0,U.jsx)(q.Z,{sx:{marginBottom:"8px"}}),a&&(0,U.jsx)(m.uE,{color:"error",disabled:s,size:"small",sx:{justifyContent:"flex-start",margin:"0 8px",padding:"6px 8px",minWidth:"calc(100% - 16px)"},onClick:()=>u(),children:f("BUTTONS.LEAVE_BOARD")})]})}))}}))]})})}));var J=r(76555),ee=r.n(J),te=r(91829),re=r.n(te),ie=r(97933),ae=r(42052),se=r(41288),ne=r(29704),oe=r(21223),le=r(58031);const de=["open","selectedItem"];function PwMembersList_ownKeys(e,t){var r=y()(e);if(_()){var i=_()(e);t&&(i=n()(i).call(i,(function(t){return b()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwMembersList_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?S()(r=PwMembersList_ownKeys(Object(a),!0)).call(r,(function(t){(0,R.Z)(e,t,a[t])})):w()?E()(e,w()(a)):S()(i=PwMembersList_ownKeys(Object(a))).call(i,(function(t){L()(e,t,b()(a,t))}))}return e}const ce=[{name:C.Pr[C.IM.Admin],value:C.IM.Admin},{name:C.Pr[C.IM.Normal],value:C.IM.Normal},{name:C.Pr[C.IM.Observer],value:C.IM.Observer}],ButtonComponent=e=>{var t;const{open:r,selectedItem:i}=e,a=(0,x.Z)(e,de),{getters:{isBusy:s}}=(0,d.useContext)(v);return(0,U.jsx)(m.uE,PwMembersList_objectSpread(PwMembersList_objectSpread({color:"neutral",disabled:s,endIcon:(0,U.jsx)(m.WX,{component:le.r,inheritViewBox:!0,sx:{transition:"transform 0.25s",transform:`rotate(${r?0:180}deg)`,[`.${u.Z.disabled} &`]:{opacity:"0.3"},path:{fill:N.Z[900]}}}),size:"small",sx:{[`& .${u.Z.disabled}`]:{pointerEvents:"none",opacity:"0.5"}}},a),{},{children:null!==(t=null==i?void 0:i.name)&&void 0!==t?t:""}))};const he=function PwMembersList(e){const{accountId:t,board:r,canDeleteMembers:i,canUpdateMembers:a,closeDialog:s,currentMemberId:o,currentMembershipSingleAdmin:l,currentMemberType:h,titleLocalizationString:u,updateBoardMembers:p,where:f}=e,{getters:{isBusy:y},dispatchers:{setIsMembersListBusy:g},services:{$log:_,notificationSrv:k,telemetrySrv:b,trelloIntegrationSrv:T}}=(0,d.useContext)(v),{t:S}=(0,c.$)(),[I,w]=(0,d.useState)(null),canLeaveBoard=e=>o===e.id,updateMemberTypeInBoardAsync=async(e,i)=>{if(!y&&a&&e.membershipId&&i!==e.type)try{g(!0),await T.updateBoardMembershipAsync(t,r.id,e.membershipId,i),b.logSessionEvent(C.cN.CalendarEvents.MemberTypeChanged,{memberType:i,where:f}),p()}catch(e){_.error("Planyway update member type error:"),_.error(e),b.logError("Planyway update member type error",e,{class:ue.name,method:updateMemberTypeInBoardAsync.name})}finally{g(!1)}},canRemoveMember=e=>i&&e.id!==o&&(h===C.IM.Admin||h===C.IM.Normal&&e.type!==C.IM.Admin),removeMemberFromBoardAsync=async e=>{if(!y&&e&&canRemoveMember(e))try{g(!0),await T.removeMemberFromBoardAsync(t,r.id,e.id),b.logSessionEvent(C.cN.CalendarEvents.MemberRemoved,{memberType:e.type,where:f}),p()}catch(e){_.error("Trello remove board member error:"),_.error(e),b.logError("Trello remove board member error",e,{class:ue.name,method:removeMemberFromBoardAsync.name}),k.showNotification(S("NOTIFICATIONS.BOARD_SHARE_REMOVE_MEMBER_ERROR"),C.k$.Error)}finally{g(!1)}},leaveBoardAsync=async e=>{if(!y&&canLeaveBoard(e))try{g(!0),await T.leaveBoardAsync(t,r.id),b.logSessionEvent(C.cN.CalendarEvents.MemberLeaved,{where:f}),s()}catch(e){_.error("Trello remove board member error:"),_.error(e),b.logError("Trello remove board member error",e,{class:ue.name,method:leaveBoardAsync.name}),k.showNotification(S("NOTIFICATIONS.BOARD_SHARE_LEAVE_ERROR"),C.k$.Error)}finally{g(!1)}},D=(0,d.useMemo)((()=>{var e,t;return ee()(e=M()(t=r.members).call(t,(e=>{var t,i;return PwMembersList_objectSpread(PwMembersList_objectSpread({},e),{},{type:null===(t=r.memberships.get(e.id))||void 0===t?void 0:t.memberType,membershipId:null===(i=r.memberships.get(e.id))||void 0===i?void 0:i.membershipId})}))).call(e,((e,t)=>e.id===o?-1:t.id===o?1:e.type===C.IM.Admin&&t.type!==C.IM.Admin?-1:t.type===C.IM.Admin&&e.type!==C.IM.Admin?1:e.type===C.IM.Normal&&t.type!==C.IM.Normal?-1:t.type===C.IM.Normal&&e.type!==C.IM.Normal?1:(0,ne.A5)(e.userName||"",t.userName||"")))}),[r.members]),getSecondaryActionForMember=e=>{var t;let i=ce;if(null!==(t=r.premiumFeatures)&&void 0!==t&&re()(t).call(t,C.GC.Observers)||(i=n()(i).call(i,(e=>e.value!==C.IM.Observer))),a)switch(e.type){case C.IM.Admin:l&&(i=n()(i).call(i,(e=>e.value===C.IM.Admin)));break;case C.IM.Normal:e.confirmed||(i=n()(i).call(i,(e=>e.value!==C.IM.Admin)))}else i=n()(i).call(i,(t=>t.value===e.type));switch(e.type){case C.IM.Admin:case C.IM.Normal:case C.IM.Observer:return canLeaveBoard(e)||canRemoveMember(e)?(0,U.jsx)(Q,{ButtonComponent,buttonComponentProps:{sx:{fontSize:"13px",fontWeight:"400",color:"text.primary",whiteSpace:"noWrap",[`& .${ie.Z.endIcon}`]:{marginLeft:"6px","& > *:nth-of-type(1)":{fontSize:"initial"}}}},canDeleteMember:canRemoveMember(e),canLeaveBoard:canLeaveBoard(e),currentMembershipSingleAdmin:e.type===C.IM.Admin&&l,deleteUser:()=>(e=>{!y&&canRemoveMember(e)&&w(e)})(e),getItemKey:e=>e.value,itemTextFormatter:e=>S(e.name),items:i,leaveBoard:()=>leaveBoardAsync(e),selectedItem:{name:S(C.Pr[e.type||C.IM.Admin]),value:e.type||C.IM.Admin},onSelectedItemChange:t=>updateMemberTypeInBoardAsync(e,t.value)}):(0,U.jsx)(m.zM,{color:"text.primary",sx:{margin:"5px 26px 5px 5px"},variant:"body4",children:S(C.Pr[e.type||C.IM.Admin])})}};return D.length?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(m.zM,{color:"text.primary",sx:{margin:"16px 24px 4px"},variant:"body1",children:S(u,{userCount:D.length})}),(0,U.jsxs)(m.Ly,{sx:{padding:"0 8px",minHeight:"80px"},children:[(0,U.jsx)(m.z1,{dense:!0,children:M()(D).call(D,(e=>(0,U.jsx)(m.dQ,{disablePadding:!0,secondaryAction:getSecondaryActionForMember(e),sx:{".MuiListItemSecondaryAction-root":{pointerEvents:"all",opacity:"1",transition:"opacity 0.25s"},"&:hover":{".MuiListItemButton-root":{cursor:"default",backgroundColor:N.Z[100]}}},children:(0,U.jsxs)(m.LC,{disableRipple:!0,sx:{borderRadius:"4px",paddingTop:"5px",paddingBottom:"5px",paddingRight:"88px"},children:[(0,U.jsx)(m.YH,{sx:{minWidth:"40px"},children:(0,U.jsx)(ae.Z,{anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:e.type===C.IM.Admin&&(0,U.jsx)(m.WX,{component:oe.r,inheritViewBox:!0,sx:{width:"12px",height:"12px"}}),sx:{[`& .${se.Z.badge}`]:{right:"4px",bottom:"4px"}},children:(0,U.jsx)(m.zW,{alt:e.userName,src:e.avatarUrlSmall,sx:{width:24,height:24}})})}),(0,U.jsx)(m.wW,{primary:(0,U.jsx)(m.zM,{color:"text.primary",sx:{display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"text",userSelect:"text"},variant:"body3",children:o===e.id?S("DIALOGS.BOARD_SHARE_CURRENT_MEMBER_NAME",{memberName:e.fullName}):e.fullName}),secondary:(0,U.jsxs)(m.zM,{color:"text.primary",sx:{display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",color:"rgba(0, 0, 0, 0.6)",cursor:"text",userSelect:"text"},variant:"body4",children:["@",e.userName]})})]})},e.id)))}),(0,U.jsx)(H,{open:!!I,onClose:()=>{w(null)},onRemove:async()=>{w(null),await removeMemberFromBoardAsync(I)}})]}),(0,U.jsx)(q.Z,{sx:{margin:"0 24px"}})]}):(0,U.jsx)(U.Fragment,{})};function PwBoardShareDialog(e){var t;const{injections:{$log:r,notificationSrv:i,trelloIntegrationSrv:s,planywayIntegrationSrv:o,telemetrySrv:f},locals:{accountId:y,trelloBoard:g,where:_},onClose:k,open:b}=e,T=o.getConnectedAccountById(y),[S,I]=(0,d.useState)(g),[w,D]=(0,d.useState)(),[E,A]=(0,d.useState)(!0),[L,R]=(0,d.useState)(!1),[x,P]=(0,d.useState)(!1),[M,B]=(0,d.useState)(!1),[O,$]=(0,d.useState)(!1),[N,F]=(0,d.useState)(!1),j=O||N,{t:z}=(0,c.$)(),handleBoardUpdate=()=>{const e=s.getTrelloBoardById(y,g.id);I(e)},closeDialog=()=>!j&&k();return(0,d.useEffect)((()=>{var e,t,r;if(!b)return;let i=null===(e=S.memberships.get(T.trelloMemberId))||void 0===e?void 0:e.memberType;D(i),A(1===n()(t=[...l()(r=S.memberships).call(r)]).call(t,(e=>e.memberType===C.IM.Admin)).length),R(S.canShare),P(S.canShare),B(!S.isReadOnly&&i===C.IM.Admin)}),[b,S]),(0,U.jsx)(h.Z,{theme:m.rS,children:(0,U.jsx)(v.Provider,{value:{getters:{accountId:y,trelloBoard:g,isBusy:j},dispatchers:{setIsAutocompleteBusy:$,setIsMembersListBusy:F},services:{$log:r,notificationSrv:i,planywayIntegrationSrv:o,trelloIntegrationSrv:s,telemetrySrv:f}},children:(0,U.jsxs)(m.X8,{disableRestoreFocus:!0,fullWidth:!0,open:b,onClose:closeDialog,children:[(0,U.jsx)(m.Fm,{enableCross:!0,sx:{paddingTop:"24px",[`& .${u.Z.root}`]:{margin:"10px"}},onCrossClick:closeDialog,children:z("DIALOGS.BOARD_SHARE_TITLE",{boardName:null!==(t=null==S?void 0:S.name)&&void 0!==t?t:""})}),(0,U.jsx)(m.Ly,{sx:{overflow:"unset",paddingTop:0,paddingBottom:"6px"},children:(0,U.jsx)(V,{accountId:y,canInviteMember:e=>{var t;let r=s.getTrelloOrganizationById(y,S.organizationId);return!a()(t=S.members).call(t,(t=>t.id===e.id))||!!r&&!r.canInviteGuests&&!r.memberships.has(e.id)},canInviteMembers:x,inviteMemberToBoardAsync:async e=>{!j&&e&&(e.email?(f.logSessionEvent(C.cN.CalendarEvents.MemberAdded,{memberType:C.IM.Normal,by:C.e5.Email,where:_}),await s.inviteMemberToBoardAsync(y,S.id,e.email)):(f.logSessionEvent(C.cN.CalendarEvents.MemberAdded,{memberType:C.IM.Normal,by:C.e5.Name,where:_}),await s.addMemberToBoardAsync(y,S.id,e.id)),handleBoardUpdate())}})}),(0,U.jsx)(he,{accountId:y,board:S,canDeleteMembers:L,canUpdateMembers:M,closeDialog,currentMemberId:T.trelloMemberId,currentMemberType:w,currentMembershipSingleAdmin:E,titleLocalizationString:"DIALOGS.BOARD_SHARE_INVITED_MEMBERS_TITLE",updateBoardMembers:handleBoardUpdate,where:_}),j&&(0,U.jsx)(p.Z,{sx:{display:"block",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},children:(0,U.jsx)(m.MX,{variant:"indeterminate"})})]})})})}PwBoardShareDialog.injections=["trelloIntegrationSrv"];const ue=PwBoardShareDialog},48901:(e,t,r)=>{r.d(t,{Z:()=>K});var i=r(26171),a=r(41266),s=r(73324),n=r.n(s),o=r(87994),l=r.n(o),d=r(88946),c=r.n(d),h=r(62079),u=r.n(h),p=r(52020),m=r.n(p),C=r(88546),v=r.n(C),f=r(99595),y=r.n(f),g=r(66775),_=r.n(g),k=r(2201),b=r.n(k),T=r(57445),S=r.n(T),I=r(67294),w=r(67558),D=r(22233),E=r(99246),A=r(63333),L=r(56777),R=r(8937),x=r(53886),P=r(16628),M=r(71508),B=r(59766),O=r(82617),$=r(35020),N=r(96386),F=r(96928),j=r(37936),z=r(85893);const U=["board","trelloIntegrationSrv","dialogSrv","licenseSrv","telemetrySrv","sx"];function ownKeys(e,t){var r=u()(e);if(m()){var i=m()(e);t&&(i=n()(i).call(i,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,a,s=null!=arguments[t]?arguments[t]:{};t%2?y()(r=ownKeys(Object(s),!0)).call(r,(function(t){(0,i.Z)(e,t,s[t])})):_()?b()(e,_()(s)):y()(a=ownKeys(Object(s))).call(a,(function(t){S()(e,t,v()(s,t))}))}return e}const G=(0,x.Pi)((function PwBoardSyncItem(e){const{board:t,trelloIntegrationSrv:r,dialogSrv:i,licenseSrv:s,telemetrySrv:n,sx:o}=e,l=(0,a.Z)(e,U),{t:d}=(0,w.$)(),getSyncStatus=()=>r.getGoogleSyncStatus(t.accountId,t.id),isSyncBusy=()=>r.isGoogleSyncBusy(t.accountId,t.id),isSyncEnabled=()=>{let e=getSyncStatus();return e&&e!==O.wR.NotSynced},restartSyncAsync=async()=>{s.checkPaidFeatureAvailable(R.ZV.GoogleSync,!0)&&(await r.stopGoogleSyncAsync(t.accountId,t.id),await i.showGoogleSyncStartDialogAsync(t.accountId,t.id))},c=(0,x.Pi)((()=>(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(E.jz,{enterDelay:500,title:d("TOOLTIPS.SYNC_BOARD_WITH_GOOGLE_CALENDAR_ERROR"),children:(0,z.jsx)(E.uE,{color:"error",disabled:isSyncBusy(),size:"small",startIcon:(0,z.jsx)(E.WX,{component:N.r,inheritViewBox:!0}),sx:{fontWeight:400,lineHeight:1.43,padding:"4px 10px"},onClick:restartSyncAsync,children:d("BUTTONS.RESYNC")})})}))),h=(0,x.Pi)((()=>(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(P.Z,{appear:!1,in:isSyncBusy(),timeout:250,unmountOnExit:!0,children:(0,z.jsx)(M.Z,{sx:{position:"absolute",right:"5px",display:"flex",alignItems:"center",justifyContent:"center",width:"50px",height:"28px"},children:(0,z.jsx)(E.MX,{size:16,variant:"indeterminate"})})}),(0,z.jsx)(P.Z,{appear:!1,in:!isSyncBusy(),timeout:250,children:(0,z.jsx)(M.Z,{children:(0,z.jsx)(E.jz,{placement:"bottom",title:d(isSyncEnabled()?"TOOLTIPS.GOOGLE_SYNC_STOP":"TOOLTIPS.GOOGLE_SYNC_START"),children:(0,z.jsx)(E.Er,{checked:isSyncEnabled(),disableRipple:!0,disabled:isSyncBusy(),onChange:()=>isSyncEnabled()?(async()=>{await i.showConfirmAsync(d("DIALOGS.GOOGLE_SYNC_STOP_TITLE"),d("DIALOGS.GOOGLE_SYNC_STOP_CONFIRM"),{buttons:[{text:d("BUTTONS.YES"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]})&&await r.stopGoogleSyncAsync(t.accountId,t.id)})():(async()=>{s.checkPaidFeatureAvailable(R.ZV.GoogleSync,!0)&&(n.logSessionEvent(R.cN.GoogleSyncEvents.SyncWithGoogleEnableGoogleSyncClicked,{where:R.MJ.SyncWithGoogleDialog}),await i.showGoogleSyncStartDialogAsync(t.accountId,t.id))})()})})})})]})));return(0,z.jsxs)(M.Z,_objectSpread(_objectSpread({},l),{},{sx:(0,B.Z)({display:"flex",alignItems:"center",justifyContent:"space-between",border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:"4px",transition:"0.15s",padding:"16px","&:hover":{backgroundColor:"grey.50"}},o),children:[(0,z.jsxs)(M.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,z.jsx)(E.WX,{component:$.r,sx:{width:"30px",height:"30px",marginRight:"8px"},viewBox:"0 0 48 48"}),(0,z.jsx)(E.WX,{component:F.r,inheritViewBox:!0,sx:{width:"16px",height:"16px",marginRight:"8px"}}),(0,z.jsx)(j.j,{boardColor:t.boardColor,boardImageUrl:t.boardImageUrls.small,name:t.name,sx:{width:"30px",height:"30px",marginRight:"16px"}}),(0,z.jsx)(E.zM,{sx:{lineHeight:"1"},variant:"body2",children:t.name})]}),(0,z.jsxs)(M.Z,{sx:{display:"flex",alignItems:"center",position:"relative"},children:[(()=>{let e=getSyncStatus();return e&&e!==O.wR.NotSynced&&e!==O.wR.Ok})()&&(0,z.jsx)(c,{}),(0,z.jsx)(h,{})]})]}))})),V=["injections","onClose","open"];function PwBoardsGoogleSyncDialog_ownKeys(e,t){var r=u()(e);if(m()){var i=m()(e);t&&(i=n()(i).call(i,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwBoardsGoogleSyncDialog_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,a,s=null!=arguments[t]?arguments[t]:{};t%2?y()(r=PwBoardsGoogleSyncDialog_ownKeys(Object(s),!0)).call(r,(function(t){(0,i.Z)(e,t,s[t])})):_()?b()(e,_()(s)):y()(a=PwBoardsGoogleSyncDialog_ownKeys(Object(s))).call(a,(function(t){S()(e,t,v()(s,t))}))}return e}function PwBoardsGoogleSyncDialog(e){const{injections:{trelloIntegrationSrv:t,telemetrySrv:r,dialogSrv:i,licenseSrv:s},onClose:o,open:d}=e,h=(0,a.Z)(e,V);(0,A.Wg)(h);const[u,p]=(0,I.useState)([]),m=(0,L.VH)(R.lP.Trello),{t:C}=(0,w.$)();return(0,I.useEffect)((()=>{var e,r;d&&p(n()(e=l()(r=m.getCurrentCollectionConnectedAccountIds()).call(r,(e=>{var r;return c()(r=m.getCurrentCollectionConnectedCalendars(e)).call(r,(r=>PwBoardsGoogleSyncDialog_objectSpread(PwBoardsGoogleSyncDialog_objectSpread({},t.getTrelloBoardById(e,r.calendarId)),r)))}))).call(e,(e=>!e.isReadOnly)))}),[d]),(0,z.jsx)(D.Z,{theme:E.rS,children:(0,z.jsxs)(E.X8,PwBoardsGoogleSyncDialog_objectSpread(PwBoardsGoogleSyncDialog_objectSpread({},h),{},{fullWidth:!0,open:d,onClose:o,children:[(0,z.jsx)(E.Fm,{enableCross:!0,sx:{padding:"24px"},onCrossClick:o,children:C("DIALOGS.SYNC_GOOGLE_CALENDAR_TITLE")}),(0,z.jsx)(E.Ly,{sx:{display:"flex",flexDirection:"column",gap:"16px 0",padding:"0 24px 24px"},children:c()(u).call(u,(e=>(0,z.jsx)(G,{board:e,dialogSrv:i,licenseSrv:s,telemetrySrv:r,trelloIntegrationSrv:t},e.id)))})]}))})}PwBoardsGoogleSyncDialog.injections=["licenseSrv","trelloIntegrationSrv"];const K=PwBoardsGoogleSyncDialog},70598:(e,t,r)=>{r.d(t,{U:()=>PwCustomFiltersDialogContainer});var i=r(88946),a=r.n(i),s=r(23513),n=r.n(s),o=r(87994),l=r.n(o),d=r(53706),c=r.n(d),h=r(35820),u=r.n(h),p=r(67294),m=r(67558),C=r(77738),v=r.n(C),f=r(82617),y=r(6327),g=r(56777),_=r(8937),k=r(86981),b=r.n(k),T=r(53640),S=r(43106),I=r(63931),w=r(23972),D=r(71508),E=r(55827),A=r(59708),L=r(7493),R=r(61252),x=r(85893);const CustomFieldSelector=e=>{var t;let{placeholder:r,selectedCustomField:i,customFields:s,onChange:n}=e;return(0,x.jsx)(T.Z,{sx:{flexGrow:"1",flexBasis:"50%",minWidth:"0"},variant:"filled",children:(0,x.jsx)(S.Z,{disableUnderline:!0,displayEmpty:!0,renderValue:()=>{var e;return null!==(e=null==i?void 0:i.name)&&void 0!==e?e:r},value:null!==(t=null==i?void 0:i.id)&&void 0!==t?t:"",onChange:e=>{const t=b()(s).call(s,(t=>t.id===e.target.value));t&&n(t)},children:a()(s).call(s,(e=>(0,x.jsx)(I.Z,{value:e.id,children:(0,x.jsx)(w.Z,{variant:"body2",children:e.name})},e.id)))})})},Separator=e=>{let{text:t,hidden:r}=e;return(0,x.jsx)(w.Z,{sx:{visibility:r?"hidden":"visible"},variant:"body2",children:t})},OptionItem=e=>{let{option:t}=e;return(0,x.jsxs)(x.Fragment,{children:[t.color&&(0,x.jsx)(D.Z,{sx:{width:"20px",height:"20px",borderRadius:"50%",marginRight:"8px",backgroundColor:L.K.getColor(t.color).background}}),(0,x.jsx)(w.Z,{variant:"body2",children:t.text})]})},FieldOptionSelector=e=>{var t;let{hidden:r,fieldOptions:i,selectedFieldOption:s,onChange:n}=e;const o=(null==s?void 0:s.color)&&Object.hasOwn(L.K,s.color)?L.K.getColor(s.color).background:void 0;return(0,x.jsx)(T.Z,{sx:{flexGrow:"1",flexBasis:"50%",minWidth:"0",visibility:r?"hidden":"visible"},variant:"filled",children:(0,x.jsx)(S.Z,{disableUnderline:!0,renderValue:()=>null==s?void 0:s.text,sx:{backgroundColor:{backgroundColor:o},[`&.${E.Z.root}.${E.Z.focused}, &:hover`]:{backgroundColor:{backgroundColor:o}}},value:null!==(t=null==s?void 0:s.value)&&void 0!==t?t:"",onChange:e=>{const t=b()(i).call(i,(t=>t.value===e.target.value));t&&n(t)},children:a()(i).call(i,(e=>(0,x.jsx)(I.Z,{value:e.value,children:(0,x.jsx)(OptionItem,{option:e})},e.value)))})})},PwCustomFiltersDialog=e=>{var t;let{customFields:r,isBusy:i,onSaveCustomFilter:a,onClose:s,open:n}=e;const{t:o}=(0,m.$)(),[l,d]=(0,p.useState)(),[c,h]=(0,p.useState)(),u=null!==(t=null==l?void 0:l.options)&&void 0!==t?t:[],C=[{isDangerous:!1,isPrimary:!1,text:o("BUTTONS.CANCEL"),onClick:s},{isDangerous:!1,isPrimary:!0,disabled:!(l&&c),text:o("BUTTONS.SAVE"),onClick:()=>{l&&c&&a(l,c)}}];return(0,x.jsx)(R.X,{actionButtons:C,disableRestoreFocus:!0,fullWidth:!0,isBusy:i,maxWidth:"xs",open:n,title:o("DIALOGS.CUSTOM_FILTER_DIALOG_TITLE"),onClose:s,children:(0,x.jsxs)(A.Z,{alignItems:"center",direction:"row",gap:1,children:[(0,x.jsx)(CustomFieldSelector,{customFields:r,placeholder:o("DIALOGS.CUSTOM_FILTERS_CUSTOM_FIELD_PLACEHOLDER"),selectedCustomField:l,onChange:e=>{d(e),h(e.options[0])}}),(0,x.jsx)(Separator,{hidden:!l,text:o("DIALOGS.CUSTOM_FILTERS_IS")}),(0,x.jsx)(FieldOptionSelector,{fieldOptions:u,hidden:!l,selectedFieldOption:c,onChange:h})]})})},PwCustomFiltersDialogContainer=e=>{var t,r;let{$log:i,$rootScope:s,notificationSrv:o,settingsSrv:d,trelloIntegrationSrv:h,onClose:C,open:k}=e;const{t:b}=(0,m.$)(),{logSessionEvent:T}=(0,y.f)(),[S,I]=(0,p.useState)(!1),w=new(n()),D=l()(t=l()(r=(0,g.VH)(_.lP.Trello).getCurrentCollectionConnectedAccountIds()).call(r,(e=>h.getTrelloBoards(e)))).call(t,(e=>{var t;return w.has(e.id)?[]:(w.add(e.id),c()(t=e.customFields).call(t,((t,r)=>{const i=(e=>{var t;switch(e.type){case f.vK.Checkbox:return[{text:b("DIALOGS.CUSTOM_FILTERS_CHECKED"),value:"true"},{text:b("DIALOGS.CUSTOM_FILTERS_NOT_CHECKED"),value:"false"}];case f.vK.List:var r;if(null!==(t=e.options)&&void 0!==t&&t.length)return a()(r=e.options).call(r,(e=>({text:e.name,value:e.id,color:e.color})))}})(r);return i&&t.push({id:r.id,accountId:e.accountId,boardId:e.id,name:r.name,type:r.type,options:i}),t}),[]))}));return(0,x.jsx)(PwCustomFiltersDialog,{customFields:D,isBusy:S,open:k,onClose:C,onSaveCustomFilter:async(e,t)=>{try{I(!0);const r={id:v()(),targetType:_.go.CustomField,targetId:e.id,condition:"is",value:t.value},i=h.getTrelloBoardById(e.accountId,e.boardId);if(!i)throw new Error("Trello board not found");const a=[...i.customFilters,r];i.customFilters=a;const n=d.collection;n.global.settings.provider[_.lP.Trello].filters.customFilters.push(r.id),await u().all([n.global.saveAsync(),h.saveBoardSettingsAsync(i.accountId,i.id,{customFilters:a})]),s.$broadcast(_.FK.SettingsChanged),s.$broadcast(_.FK.FiltersChanged);const o={customFilterType:r.targetType};r.targetType===_.go.CustomField&&(o.customFieldType=e.type),T(_.cN.FiltersEvents.CustomFilterAdded,o)}catch(e){i.error("Planyway failed to add custom filter:"),i.error(e),o.showNotification(b("NOTIFICATIONS.ADD_CUSTOM_FILTER_ERROR"),_.k$.Error)}finally{I(!1),C()}}})};PwCustomFiltersDialogContainer.injections=["$log","$rootScope","notificationSrv","settingsSrv","trelloIntegrationSrv"]},75904:(e,t,r)=>{r.d(t,{W:()=>PwExportDialogContainer});var i=r(67294),a=r(67558),s=r(84956),n=r(78322),o=r(89048),l=r(8937);let d=function(e){return e.ICal="ICal",e.Json="Json",e.Csv="Csv",e}({});var c=r(62079),h=r.n(c),u=r(52020),p=r.n(u),m=r(73324),C=r.n(m),v=r(88546),f=r.n(v),y=r(99595),g=r.n(y),_=r(66775),k=r.n(_),b=r(2201),T=r.n(b),S=r(57445),I=r.n(S),w=r(26171),D=r(88946),E=r.n(D),A=r(99189),L=r(73891),R=r(2734),x=r(23972),P=r(29861),M=r(69397),B=r(18843),O=r(27037),$=r(42588),N=r(20115),F=r(61252),j=r(85893);function ownKeys(e,t){var r=h()(e);if(p()){var i=p()(e);t&&(i=C()(i).call(i,(function(t){return f()(e,t).enumerable}))),r.push.apply(r,i)}return r}const z=`${N.gO}/integrations/ical-integration#publish-planyway-calendar-using-url`,StyledLink=e=>(0,j.jsx)(L.Z,function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?g()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,w.Z)(e,t,a[t])})):k()?T()(e,k()(a)):g()(i=ownKeys(Object(a))).call(i,(function(t){I()(e,t,f()(a,t))}))}return e}({rel:"noopener noreferrer",sx:{cursor:"pointer"},target:"_blank",underline:"none"},e)),ActionLabel=e=>{let{children:t}=e;const{typography:r}=(0,R.Z)();return(0,j.jsx)(x.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"56px",height:"24px",backgroundColor:"grey.100",fontWeight:r.fontWeightBold,borderRadius:"33px"},variant:"body2",children:t})},ActionListItem=e=>{let{label:t,description:r,actionText:i,actionCallback:a}=e;return(0,j.jsxs)(P.ZP,{disableGutters:!0,divider:!0,sx:{display:"grid",gap:2,gridTemplateColumns:"54px 1fr 138px",height:"84px"},children:[(0,j.jsx)(ActionLabel,{children:t}),(0,j.jsx)(x.Z,{variant:"body2",children:r}),(0,j.jsx)(M.Z,{color:"primary",variant:"contained",onClick:a,children:i})]})},ActionList=e=>{let{children:t}=e;return(0,j.jsx)(B.Z,{disablePadding:!0,sx:{[`.${O.Z.root}`]:{"&:last-child":{borderColor:"transparent"}}},children:t})},DialogAlert=e=>{let{children:t}=e;const{palette:r}=(0,R.Z)();return(0,j.jsx)($.Z,{icon:!1,severity:"info",sx:{border:`1px solid ${r.info.light}`},children:(0,j.jsx)(x.Z,{color:"text.primary",variant:"body2",children:t})})},PwExportDialog=e=>{let{open:t,onClose:r,onCopyExportUrl:i,onResetExportUrls:s,isBusy:n}=e;const{t:o}=(0,a.$)(),l=[{urlType:d.ICal,label:o("DIALOGS.EXPORT_ICAL"),description:(0,j.jsx)(A.c,{components:{ExportICalLink:(0,j.jsx)(StyledLink,{href:z})},i18nKey:"DIALOGS.EXPORT_ICAL_DESCRIPTION"}),actionText:o("DIALOGS.EXPORT_ICAL_COPY")},{urlType:d.Json,label:o("DIALOGS.EXPORT_JSON"),description:o("DIALOGS.EXPORT_JSON_DESCRIPTION"),actionText:o("DIALOGS.EXPORT_JSON_COPY")},{urlType:d.Csv,label:o("DIALOGS.EXPORT_CSV"),description:o("DIALOGS.EXPORT_CSV_DESCRIPTION"),actionText:o("DIALOGS.EXPORT_CSV_COPY")}];return(0,j.jsxs)(F.X,{PaperProps:{sx:{width:"668px",maxWidth:"668px"}},isBusy:n,open:t,title:o("DIALOGS.EXPORT_TITLE"),onClose:r,children:[(0,j.jsx)(ActionList,{children:E()(l).call(l,(e=>{let{urlType:t,label:r,description:a,actionText:s}=e;return(0,j.jsx)(ActionListItem,{actionCallback:()=>i(t),actionText:s,description:a,label:r},t)}))}),(0,j.jsx)(DialogAlert,{children:(0,j.jsx)(A.c,{components:{ExportResetLink:(0,j.jsx)(StyledLink,{onClick:s})},i18nKey:"DIALOGS.EXPORT_WARNING_TEXT"})})]})},PwExportDialogContainer=e=>{let{$log:t,board:r,dialogSrv:c,exportSrv:h,notificationSrv:u,telemetrySrv:p,onClose:m,open:C}=e;const v=(0,s.Z)(),[f,y]=(0,i.useState)(!1),[g,_]=(0,i.useState)({}),[,k]=(0,n.Z)(),{t:b}=(0,a.$)();(0,o.Z)((()=>{(async()=>{try{y(!0);let e=await h.getExportUrlsAsync(r.accountId,r.id);if(!v())return;if(e||(e=await h.createExportUrlsAsync(r.accountId,r.id)),!v())return;_(e)}catch(e){t.error("Planyway get export URLs error:"),t.error(e),p.logError("Planyway get export URLs error",e,{class:PwExportDialogContainer.name,method:"initializeExportDialog"}),u.showNotification(b("NOTIFICATIONS.EXPORT_GET_ERROR"),l.k$.Error)}finally{y(!1)}})()}));const handleResetExportUrls=async()=>{try{if(await c.showConfirmAsync(b("DIALOGS.EXPORT_RESET_CONFIRM_TITLE"),b("DIALOGS.EXPORT_RESET_CONFIRM_TEXT"),{buttons:[{text:b("DIALOGS.EXPORT_RESET_CONFIRM_BUTTON_TEXT"),isPrimary:!0,dialogResult:!0}]})){if(y(!0),await h.deleteExportUrlsAsync(r.accountId,r.id),!v())return;const e=await h.createExportUrlsAsync(r.accountId,r.id);if(p.logSessionEvent(l.cN.GeneralEvents.ExportUrlsReset),u.showNotification(b("NOTIFICATIONS.EXPORT_POST_SUCCESS"),l.k$.Success),!v())return;_(e)}}catch(e){t.error("Planyway reset URLs error:"),t.error(e),p.logError("Planyway reset URLs error",e,{class:PwExportDialogContainer.name,method:handleResetExportUrls.name}),u.showNotification(b("NOTIFICATIONS.EXPORT_POST_ERROR"),l.k$.Error)}finally{y(!1)}};return(0,j.jsx)(PwExportDialog,{isBusy:f,open:C,onClose:m,onCopyExportUrl:async e=>{let t,r;switch(e){case d.ICal:t=g.ics,r=b("NOTIFICATIONS.URL_ICAL_COPIED_TO_CLIPBOARD");break;case d.Json:t=g.json,r=b("NOTIFICATIONS.URL_JSON_COPIED_TO_CLIPBOARD");break;case d.Csv:t=g.csv,r=b("NOTIFICATIONS.URL_CSV_COPIED_TO_CLIPBOARD")}t&&(p.logSessionEvent(l.cN.GeneralEvents.ExportUrlCopied,{format:e}),k(t),u.showNotification(r,l.k$.Success))},onResetExportUrls:handleResetExportUrls})};PwExportDialogContainer.injections=["$log","dialogSrv","exportSrv","notificationSrv","telemetrySrv"]},34583:(e,t,r)=>{r.d(t,{l:()=>PwOnboardingGuy});var i=r(62079),a=r.n(i),s=r(52020),n=r.n(s),o=r(73324),l=r.n(o),d=r(88546),c=r.n(d),h=r(99595),u=r.n(h),p=r(66775),m=r.n(p),C=r(2201),v=r.n(C),f=r(57445),y=r.n(f),g=r(26171),_=r(52329),k=r(25935),b=r(2734),T=r(71508),S=r(59708),I=r(23972),w=r(22233),D=r(20064),E=r(36338),A=r(72845),L=r(8109),R=r(85893);function ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=l()(i).call(i,(function(t){return c()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?u()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,g.Z)(e,t,a[t])})):m()?v()(e,m()(a)):u()(i=ownKeys(Object(a))).call(i,(function(t){y()(e,t,c()(a,t))}))}return e}const GuyContainer=e=>{let{children:t}=e;const[r]=(0,_.q_)((()=>({from:{transform:"translateY(10%)",opacity:0},to:{transform:"translateY(0)",opacity:1},loop:!1,config:{easing:_.Z5.easeInOutQuad,duration:300}}))),{breakpoints:i}=(0,b.Z)(),a=i.down("lg");return(0,R.jsx)(T.Z,{sx:{position:"fixed",bottom:0,left:0,width:"30%",zIndex:1,userSelect:"none",[a]:{width:"25%"}},children:(0,R.jsx)(_.q.div,{style:_objectSpread({},r),children:t})})},DialogBlob=e=>{let{message:t}=e;const{getPlatformUrl:r}=(0,D.F)(),{breakpoints:i}=(0,b.Z)(),a=i.down("lg");return(0,R.jsxs)(S.Z,{spacing:2,sx:{position:"relative",left:"35%",padding:"24px 28px",width:"60%",minWidth:"16em",borderRadius:"40px 40px 40px 8px",backgroundColor:"primary.main",boxSizing:"border-box"},children:[(0,R.jsx)("img",{src:r(L.Z),style:{width:"128px",height:"26px"}}),(0,R.jsx)(I.Z,{color:"primary.contrastText",sx:{[a]:{fontSize:"14px"}},variant:"subtitle1",children:(0,k.ZP)(t)})]})},GuyImage=()=>{const{getPlatformUrl:e}=(0,D.F)();return(0,R.jsx)("img",{src:e(A.Z),style:{display:"block",width:"50%"}})},PwOnboardingGuy=e=>{let{message:t}=e;const r=(0,E.g)();return(0,R.jsx)(w.Z,{theme:r,children:(0,R.jsxs)(GuyContainer,{children:[(0,R.jsx)(DialogBlob,{message:t}),(0,R.jsx)(GuyImage,{})]})})}},77109:(e,t,r)=>{r.d(t,{Z:()=>Sr});var i=r(67294),a=r(53886),s=r(99189),n=r(73891),o=r(22233),l=r(71508),d=r(47036),c=r(59766),h=r(50720),u=r(13184),p=r(99246),m=r(70404),C=r(56777),v=r(8937),f=r(85476);const y=(0,i.createContext)({}),g=(0,i.createContext)({});var _=r(89095),k=r(62079),b=r.n(k),T=r(52020),S=r.n(T),I=r(88546),w=r.n(I),D=r(99595),E=r.n(D),A=r(66775),L=r.n(A),R=r(2201),x=r.n(R),P=r(57445),M=r.n(P),B=r(26171),O=r(35820),$=r.n(O),N=r(23513),F=r.n(N),j=r(10349),z=r.n(j),U=r(73324),G=r.n(U),V=r(49804),K=r.n(V),H=r(89221),Z=r.n(H),W=r(86981),Y=r.n(W),q=r(88946),X=r.n(q),Q=r(87994),J=r.n(Q),ee=r(76555),te=r.n(ee),re=r(54847),ie=r.n(re),ae=r(90143),se=r.n(ae),ne=r(98235),oe=r.n(ne),le=r(29898),de=r.n(le),ce=r(68949),he=r(82617),ue=r(46930),pe=r(29704),me=r(20115),Ce=r(58089),ve=r(36702),fe=r(37710),ye=r(7493);const ge="||";let _e=function(e){return e[e.Day=1]="Day",e[e.Week=7]="Week",e[e.Month=30]="Month",e}({});function formatDateRangeString(e,t){let r;const i=e.split(t);return r=1===i.length?formatChartDates(i[0],i[0]):formatChartDates(i[0],i[1]),r}function formatChartDates(e,t){return e&&t?("string"==typeof e&&(e=(0,pe.oy)(e)),"string"==typeof t&&(t=(0,pe.oy)(t)),(0,pe.FT)(e,new Date)||(0,pe.FT)(t,new Date)?(0,pe.KC)(e,t)?kendo.format("{0:Dm}",e):(0,pe.xj)(e,t)?(0,pe.b)(e)&&(0,pe.h2)(t)?kendo.format("{0:MMM yyyy}",e):kendo.format("{0:Dd} – {1:Dm}",e,t):kendo.format("{0:Dm} – {1:Dm}",e,t):(0,pe.xj)(e,t)?(0,pe.KC)(e,t)?kendo.format("{0:D}",e):(0,pe.b)(e)&&(0,pe.h2)(t)?kendo.format("{0:MMM yyyy}",e):kendo.format("{0:Dd} – {1:dd MMM, yyyy}",e,t):kendo.format("{0:D} – {1:D}",e,t)):""}function getMonthRange(e){return[(0,pe.$Y)((0,pe.pW)(e)),(0,pe.h3)((0,pe.R2)(e))]}function getDateRangeString(e,t){if((0,pe.qb)(e)&&t)switch(t){case _e.Month:const[t,r]=getMonthRange(e);return`${(0,pe.tC)(t)}${ge}${(0,pe.tC)(r)}`;case _e.Week:const[i,a]=function getWeekRange(e){const t=(0,pe.OR)(),r=(0,pe.vr)();return[(0,pe.$Y)((0,pe.tE)(e,t)),(0,pe.h3)((0,pe.sD)(e,r))]}(e);return`${(0,pe.tC)(i)}${ge}${(0,pe.tC)(a)}`;case _e.Day:return(0,pe.tC)(e)}}function getDatesRange(e,t){let r=[];for(let i=0;i<e.length;){if(!(0,pe.qb)(e[i])){i+=t;continue}let a=getDateRangeString(e[i],t);switch(t){case _e.Month:const[s]=getMonthRange(e[i]);i+=s.getDate(),r.push(a);break;case _e.Day:case _e.Week:i+=t,r.push(a)}}return r}function getGroupingUnit(e){let t=_e.Day;switch(!0){case e.length>3*_e.Month:t=_e.Month;break;case e.length>=_e.Month:t=_e.Week}return t}function getBarChartData(e,t,r,i){var a;let[s,n]=r,o={data:[],keys:[],colors:new(ie()),datumMetadata:new(ie()),total:0,groupingUnit:_e.Day};if(!s||!n)return o;const l=te()(a=(0,pe.NU)(s,n)).call(a,((e,t)=>e.getTime()-t.getTime())),d=getGroupingUnit(l);return function groupData(e,t,r,i,a){var s,n,o;const{boards:l,members:d,cards:c}=a;let h=new(ie()),u=0,p=new(F()),m=new(ie()),C=new(ie())(X()(t).call(t,(e=>[e,{date:e,formattedDate:formatDateRangeString(e,ge),groupBy:r,total:0}])));if(!t||0===t.length)return{data:[],keys:[],colors:new(ie()),datumMetadata:new(ie()),total:0,groupingUnit:i};for(let t of e){var v,f,y,g,k,b;let e=(0,pe.$Y)(t.from),a=(null!==(v=(0,pe.CX)(t.from,t.to))&&void 0!==v?v:t.durationMinutes)/60;if(!e)continue;let D,E,A=getDateRangeString(e,i);if(!A)continue;let L=l.get(t.boardId),R="",x="",P=!1,M=null!==(f=C.get(A))&&void 0!==f?f:{date:A,formattedDate:formatDateRangeString(A,ge),groupBy:r,total:0};switch(r){case _.I4.Board:D=null!==(s=t.boardId)&&void 0!==s?s:me.$d,E=l.get(D),E&&(R=E.name,x=fe.Z.getColor(E.color).base);break;case _.I4.Member:D=null!==(n=t.memberId)&&void 0!==n?n:me.$d,E=d.get(D),E&&(R=E.fullName,x=ve.BN.nivo[(0,Ce.j)(D,ve.BN.nivo.length)]);break;case _.I4.Task:var T,S,I,w;D=null!==(o=t.cardId)&&void 0!==o?o:me.$d,E=c.get(D),E&&(R=E.title,P=E.providerCard.isArchived),L&&(x=ye.K.getColor(X()(T=te()(S=G()(I=X()(w=z()(E.providerCard.labelIds)).call(w,(e=>{var t;return Y()(t=L.labels).call(t,(t=>{let{id:r}=t;return r===e}))}))).call(I,(e=>Boolean(e&&L.id===e.boardId)))).call(S,pe.G4)).call(T,(e=>e.color))[0]).background)}p.add(D),M[D]=(null!==(y=M[D])&&void 0!==y?y:0)+a,M.total=(null!==(g=M.total)&&void 0!==g?g:0)+a,x&&m.set(D,x),u+=a,h.set(D,{total:(null!==(k=null===(b=h.get(D))||void 0===b?void 0:b.total)&&void 0!==k?k:0)+a,label:R,isArchived:P}),C.has(A)||C.set(A,M)}return{data:z()(Z()(C).call(C)),keys:z()(p),colors:m,datumMetadata:h,total:u,groupingUnit:i}}(e,getDatesRange(l,d),t,d,i)}var ke=r(40703),be=r.n(ke);function getPieChartData(e,t,r,i){let[a,s]=r;const n={data:[],colors:new(ie()),total:0};return a&&s?function pieChartData_groupData(e,t,r){var i,a,s,n,o,l;const{boards:d,lists:c,members:h,cards:u}=r,p=new(ie()),m=new(ie());for(const r of e){var C,v,f;const e=(0,pe.$Y)(r.from),T=null!==(C=(0,pe.CX)(r.from,r.to))&&void 0!==C?C:r.durationMinutes;if(!e)continue;let S,I="";const w=d.get(r.boardId);let D="",E="",A=!1;switch(t){case _.I4.Board:I=null!==(i=r.boardId)&&void 0!==i?i:me.$d,S=d.get(I),S&&(D=S.name,E=fe.Z.getColor(S.color).base);break;case _.I4.List:I=null!==(a=null===(s=u.get(null!==(n=r.cardId)&&void 0!==n?n:me.$d))||void 0===s?void 0:s.providerCard.listId)&&void 0!==a?a:me.$d,S=c.get(I),S&&(D=S.name,E=ve.BN.nivo[(0,Ce.j)(I,ve.BN.nivo.length)]);break;case _.I4.Member:I=null!==(o=r.memberId)&&void 0!==o?o:me.$d,S=h.get(I),S&&(D=S.fullName,E=ve.BN.nivo[(0,Ce.j)(I,ve.BN.nivo.length)]);break;case _.I4.Task:var y,g,k,b;I=null!==(l=r.cardId)&&void 0!==l?l:me.$d,S=u.get(I),S&&(D=S.title,A=S.providerCard.isArchived,w&&(E=ye.K.getColor(X()(y=te()(g=G()(k=X()(b=z()(S.providerCard.labelIds)).call(b,(e=>{var t;return Y()(t=w.labels).call(t,(t=>{let{id:r}=t;return r===e}))}))).call(k,(e=>Boolean(e&&w.id===e.boardId)))).call(g,pe.G4)).call(y,(e=>e.color))[0]).background))}E&&m.set(I,E),p.set(I,{total:(null!==(v=null===(f=p.get(I))||void 0===f?void 0:f.total)&&void 0!==v?v:0)+T,label:D,groupBy:t,isArchived:A})}const T=[];let S=0;for(const[e,t]of be()(p).call(p))S+=t.total,T.push({id:e,label:t.label,value:t.total,groupBy:t.groupBy});return{data:T,colors:m,total:S}}(e,t,i):n}function ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}function abortablePromise(e,t){return new($())(((r,i)=>{e.then((e=>r(e))).catch((e=>i(e))),t.addEventListener("abort",(()=>{i(t.reason)}),{once:!0})}))}const Te=["name","shortUrl","prefs","premiumFeatures","idOrganization","memberships","dateLastView"].join();class ReportsStore{constructor(e,t,r,i,a,s,n){var o,l;(0,B.Z)(this,"isLoading",void 0),(0,B.Z)(this,"organizations",void 0),(0,B.Z)(this,"boards",void 0),(0,B.Z)(this,"boardSettings",void 0),(0,B.Z)(this,"boardsTimeRecords",void 0),(0,B.Z)(this,"cards",void 0),(0,B.Z)(this,"members",void 0),(0,B.Z)(this,"lists",void 0),(0,B.Z)(this,"selectedMode",void 0),(0,B.Z)(this,"selectedDateRange",void 0),(0,B.Z)(this,"firstLevelGrouping",void 0),(0,B.Z)(this,"secondLevelGrouping",void 0),(0,B.Z)(this,"appCommonSrv",{}),(0,B.Z)(this,"planywayIntegrationSrv",{}),(0,B.Z)(this,"settingsSrv",{}),(0,B.Z)(this,"telemetrySrv",{}),(0,B.Z)(this,"trelloCardsSrv",{}),(0,B.Z)(this,"trelloIntegrationSrv",{}),(0,B.Z)(this,"trelloProvider",{}),(0,B.Z)(this,"setSelectedBoardIds",((e,t,r)=>{var i,a,s,n;if(!e||!r)return;let o=this.selectedBoardIds;switch(r){case _.vV.Add:const r=new(F())([...null!==(i=this.selectedBoardIds.get(e))&&void 0!==i?i:[],...t]);o.set(e,z()(r));break;case _.vV.Remove:o.set(e,null!==(a=null===(s=this.selectedBoardIds.get(e))||void 0===s?void 0:G()(s).call(s,(e=>e!==t[0])))&&void 0!==a?a:[])}this._globalReportsSettings.selectedBoardIds=K()(n=z()(Z()(o).call(o))).call(n),this._globalCollectionSettings.saveAsync()})),(0,B.Z)(this,"clearSelectedBoardIds",(()=>{this._globalReportsSettings.selectedBoardIds=[],this._globalCollectionSettings.saveAsync()})),(0,B.Z)(this,"setSelectedMemberIds",((e,t)=>{var r,i;if(0===e.length||!t)return;let a=new(F());switch(t){case _.vV.Add:const t=[...null!==(r=this.selectedMemberIds)&&void 0!==r?r:[],...e];a=new(F())(t);break;case _.vV.Remove:a=new(F())(G()(i=z()(this.selectedMemberIds)).call(i,(t=>!Y()(e).call(e,(e=>e===t)))))}this._globalReportsSettings.selectedMemberIds=z()(a),this._globalCollectionSettings.saveAsync()})),(0,B.Z)(this,"clearSelectedMemberIds",(()=>{this._globalReportsSettings.selectedMemberIds=[],this._globalCollectionSettings.saveAsync()})),(0,B.Z)(this,"setSelectedDateRange",(e=>{let[t,r]=e;t&&(r||(r=t),this.selectedDateRange=[(0,pe.$Y)(t),(0,pe.h3)(r)],this.telemetrySrv.logSessionEvent(v.cN.CalendarEvents.ReportsSelectedDatesChanged),this._globalReportsSettings.selectedDateRange=this.selectedDateRange,this._globalCollectionSettings.saveAsync())})),(0,B.Z)(this,"setFirstLevelGrouping",(e=>{var t;e&&(this.firstLevelGrouping=e,Y()(t=_.v4[e]).call(t,(e=>e===this.secondLevelGrouping))||(this.secondLevelGrouping=_.v4[e][0]),this.telemetrySrv.logSessionEvent(v.cN.CalendarEvents.ReportsGroupingChanged,{firstLevel:this.firstLevelGrouping,secondLevel:this.secondLevelGrouping}),this._globalReportsSettings.selectedGrouping=[this.firstLevelGrouping,this.secondLevelGrouping],this._globalCollectionSettings.saveAsync())})),(0,B.Z)(this,"setSecondLevelGrouping",(e=>{e&&(this.secondLevelGrouping=e,this.telemetrySrv.logSessionEvent(v.cN.CalendarEvents.ReportsGroupingChanged,{firstLevel:this.firstLevelGrouping,secondLevel:this.secondLevelGrouping}),this._globalReportsSettings.selectedGrouping=[this.firstLevelGrouping,this.secondLevelGrouping],this._globalCollectionSettings.saveAsync())})),(0,B.Z)(this,"setSelectedMode",(e=>{this.selectedMode=e,this._globalReportsSettings.selectedMode=e,this._globalCollectionSettings.saveAsync(),this.telemetrySrv.logSessionEvent(v.cN.CalendarEvents.ReportsViewModeChanged,{mode:e})})),this.appCommonSrv=e,this.planywayIntegrationSrv=t,this.settingsSrv=r,this.telemetrySrv=i,this.trelloIntegrationSrv=s,this.trelloCardsSrv=a,this.trelloProvider=n,this.isLoading=!1,this.organizations=X()(ce.LO).call(ce.LO),this.boards=X()(ce.LO).call(ce.LO),this.boardSettings=X()(ce.LO).call(ce.LO),this.cards=X()(ce.LO).call(ce.LO),this.boardsTimeRecords=X()(ce.LO).call(ce.LO),this.members=X()(ce.LO).call(ce.LO),this.lists=X()(ce.LO).call(ce.LO),this.selectedMode=this._globalReportsSettings.selectedMode,this.selectedDateRange=X()(o=null!==(l=this._globalReportsSettings.selectedDateRange)&&void 0!==l?l:this._defaultDateRange).call(o,(e=>"string"==typeof e?(0,he.oy)(e):e)),this.firstLevelGrouping=this._globalReportsSettings.selectedGrouping[0],this.secondLevelGrouping=this._globalReportsSettings.selectedGrouping[1],(0,ce.ky)(this,{defaultBarChartData:ce.Fl,defaultPieChartData:ce.Fl,selectedBoardIds:ce.Fl,selectedBoardIdsCount:ce.Fl,selectedMemberIds:ce.Fl,allOrganizations:ce.Fl,allBoards:ce.Fl,allMembers:ce.Fl,allTimeRecords:ce.Fl,tableData:ce.Fl,barChartData:ce.Fl,pieChartData:ce.Fl,selectedDateRange:ce.LO.ref,hiddenMembers:ce.Fl,appCommonSrv:!1,trelloCardsSrv:!1,planywayIntegrationSrv:!1,settingsSrv:!1,telemetrySrv:!1,trelloIntegrationSrv:!1,trelloProvider:!1,loadBoardsTimeRecordsAsync:!1,loadBoardsDataAsync:!1,fetchDataAsync:!1})}get allOrganizations(){var e;return this.organizations.size?z()(Z()(e=this.organizations).call(e)):[]}setOrganization(e){this.organizations.set(e.id,e)}get allBoards(){var e;return J()(e=this.allOrganizations).call(e,(e=>{let{boards:t}=e;return t}))}setBoard(e){this.boards.set(e.id,e)}get selectedBoardIds(){let e=X()(ce.LO).call(ce.LO),t=this.trelloProvider.getCurrentCollectionConnectedAccountIds();if(this._globalReportsSettings.selectedBoardIds)for(let t of this._globalReportsSettings.selectedBoardIds){let i=this.trelloProvider.getCurrentCollectionAccountIdByConnectedCalendarId(t);var r;if(!i)if(i=Y()(r=this.trelloProvider.getCurrentCollectionConnectedAccountIds()).call(r,(e=>this.trelloIntegrationSrv.getTrelloBoardById(e,t))),!i)continue;e.has(i)?e.get(i).push(t):e.set(i,[t])}else for(let r of t){let t=this.trelloProvider.getCurrentCollectionSelectedCalendarIds(r);t.length>0&&e.set(r,t)}return e}get selectedBoardIdsCount(){var e,t;return K()(e=z()(Z()(t=this.selectedBoardIds).call(t))).call(e).length}setBoardSettings(e,t){this.boardSettings.set(e,t)}setCards(e){for(let t of e)this.cards.set(t.id,t)}get allMembers(){var e,t,r,i;const a=this.planywayIntegrationSrv.getConnectedAccounts(he.Qm.Trello),s=(null!==(e=Y()(a).call(a,(e=>e.isPrimary)))&&void 0!==e?e:a[0]).trelloMemberId;return te()(t=G()(r=z()(Z()(i=this.members).call(i))).call(r,(e=>!this.hiddenMembers.has(e.id)))).call(t,((e,t)=>e.id===s?-1:t.id===s?1:(0,pe.Yb)(e,t)))}get hiddenMembers(){var e,t;let r=new(F()),i=this.planywayIntegrationSrv.getPrimaryAccount(),a=K()(e=z()(Z()(t=this.selectedBoardIds).call(t))).call(e);for(let e of a){let t=this.boards.get(e);if(!t)continue;let a=this._globalCollectionSettings.settings.calendar[t.id];if(null!=a&&a.showOnlyMyCards){for(let[e]of t.memberships)r.add(e);r.delete(i.trelloMemberId)}else for(let e of r)t.memberships.has(e)&&r.delete(e)}return r}setMembers(e){for(let t of e)this.members.set(t.id,t)}get selectedMemberIds(){var e,t;return new(F())(null!==(e=this._globalReportsSettings.selectedMemberIds)&&void 0!==e?e:X()(t=this.allMembers).call(t,(e=>e.id)))}get allTimeRecords(){var e,t,r,i;if(!this.boardsTimeRecords.size)return[];return te()(e=G()(t=K()(r=z()(Z()(i=this.boardsTimeRecords).call(i))).call(r)).call(t,(e=>{if(!e.cardId)return!1;let t=this.cards.get(e.cardId);if(!t)return!1;let r=this._globalCollectionSettings.settings.calendar[e.boardId],i=this.planywayIntegrationSrv.getConnectedAccountById(e.accountId);return!(null!=r&&r.showOnlyMyCards&&!t.providerCard.memberIds.has(i.trelloMemberId))}))).call(e,((e,t)=>e.from<t.from?-1:e.from>t.from?1:0))}setBoardTimeRecords(e){for(let{boardId:t,timeRecords:r}of e)this.boardsTimeRecords.set(t,r)}setLists(e){for(let t of e)this.lists.set(t.id,t)}get defaultBarChartData(){var e,t;let r=te()(e=(0,pe.NU)(...this.selectedDateRange)).call(e,((e,t)=>e.getTime()-t.getTime())),i=new(ie())(X()(t=getDatesRange(r,getGroupingUnit(r))).call(t,(e=>[e,{EMPTY_RECORD:100,date:e,formattedDate:formatDateRangeString(e,ge),groupBy:this.firstLevelGrouping,total:100}])));return{data:z()(Z()(i).call(i)),keys:["EMPTY_RECORD"],colors:new(ie()),datumMetadata:new(ie()),total:100,groupingUnit:_e.Day,isEmptyDataset:!0}}get defaultPieChartData(){const e={data:[{id:me.$d,value:0,label:"",groupBy:this.firstLevelGrouping}],colors:new(ie()),total:0};return{[this.firstLevelGrouping]:e,[this.secondLevelGrouping]:e}}get barChartData(){var e;if(this.isLoading||!this.firstLevelGrouping||!this.secondLevelGrouping||!this.selectedMode)return _objectSpread(_objectSpread({},this.defaultBarChartData),{},{isLoadingDataset:!0});if(!this.selectedMemberIds.size||!this.selectedBoardIdsCount)return this.defaultBarChartData;const[t,r]=this.selectedDateRange;if(!t||!r)return this.defaultBarChartData;let i=G()(e=this.allTimeRecords).call(e,(e=>{var i;let{accountId:a,boardId:s,memberId:n,cardId:o,from:l,to:d}=e;const c=this.boards.get(s),h=this.members.get(n),u=this.cards.get(o),p=this.lists.get(null==u?void 0:u.providerCard.listId);if(c&&h&&u&&p)return!!(0,pe.mh)(l,t,r)&&!(null===(i=this.selectedBoardIds.get(a))||void 0===i||!Y()(i).call(i,(e=>e===s))||!this.selectedMemberIds.has(n))}));if(0===i.length)return this.defaultBarChartData;switch(this.firstLevelGrouping){case _.I4.Board:case _.I4.Member:case _.I4.Task:return getBarChartData(i,this.firstLevelGrouping,this.selectedDateRange,{boards:this.boards,lists:this.lists,members:this.members,cards:this.cards});default:return this.defaultBarChartData}}get pieChartData(){var e;if(this.isLoading||!this.firstLevelGrouping||!this.secondLevelGrouping||!this.selectedMode)return this.defaultPieChartData;if(!this.selectedMemberIds.size||!this.selectedBoardIdsCount)return this.defaultPieChartData;const[t,r]=this.selectedDateRange;if(!t||!r)return this.defaultPieChartData;let i=G()(e=this.allTimeRecords).call(e,(e=>{var i;let{accountId:a,boardId:s,memberId:n,cardId:o,from:l,to:d}=e;const c=this.boards.get(s),h=this.members.get(n),u=this.cards.get(o),p=this.lists.get(null==u?void 0:u.providerCard.listId);if(c&&h&&u&&p)return!!(0,pe.mh)(l,t,r)&&!(null===(i=this.selectedBoardIds.get(a))||void 0===i||!Y()(i).call(i,(e=>e===s))||!this.selectedMemberIds.has(n))}));if(0===i.length)return this.defaultPieChartData;const getGroupedPieChartData=e=>{switch(e){case _.I4.Board:case _.I4.List:case _.I4.Member:case _.I4.Task:return getPieChartData(i,e,this.selectedDateRange,{boards:this.boards,lists:this.lists,members:this.members,cards:this.cards});default:return this.defaultPieChartData[e]}};return{[this.firstLevelGrouping]:getGroupedPieChartData(this.firstLevelGrouping),[this.secondLevelGrouping]:getGroupedPieChartData(this.secondLevelGrouping)}}get tableData(){var e,t;if(!(this.selectedMemberIds.size&&this.selectedBoardIdsCount&&this.boardsTimeRecords.size&&this.firstLevelGrouping&&this.secondLevelGrouping&&this.selectedMode))return[];let r=new(F()),i=G()(e=X()(t=this.allTimeRecords).call(t,(e=>{var t,i;const a=this.boards.get(e.boardId),s=this.members.get(e.memberId),n=this.cards.get(e.cardId),o=this.lists.get(null==n?void 0:n.providerCard.listId);if(!(a&&s&&n&&o))return;if(null===(t=this.selectedBoardIds.get(e.accountId))||void 0===t||!Y()(t).call(t,(e=>e===a.id))||!this.selectedMemberIds.has(s.id))return;const l=e.isDuration?e.durationMinutes:(0,pe.CX)(e.from,e.to);if(!l)return;r.add(n.id);const d=n.providerCard.estimationHours;return{boardId:a.id,board:{color:null===(i=this.boardSettings.get(a.id))||void 0===i?void 0:i.color,title:a.name,imageUrlSmall:a.boardImageUrls.small},taskId:n.id,taskTitle:n.title,taskDate:(0,pe.KA)(n.start,n.end,!1),listId:o.id,listTitle:o.name,timeRecordTitle:e.comment,timeRecordStartDate:new Date(e.from),timeRecordEndDate:new Date(e.to),userId:s.id,user:null!=s?s:{isUnassigned:!0,fullName:"MISC.UNASSIGNED_MEMBER_FULL_NAME"},date:(0,pe.KA)(e.from,e.to,!1),trackedTime:l,estimatedTime:d?60*d:null,isTaskArchived:n.providerCard.isArchived}}))).call(e,(e=>{const[t,r]=this.selectedDateRange;if(!e)return!1;switch(this.selectedMode){case _.Hm.TrackedTime:return!(!t||!r)&&!!(0,pe.mh)(e.timeRecordStartDate,t,r);case _.Hm.TrackedVsEstimated:return!0}}));switch(this.selectedMode){case _.Hm.TrackedTime:return i;case _.Hm.TrackedVsEstimated:let e=[...i];for(let[t,i]of this.cards)if(!r.has(t)&&i.providerCard.estimationHours){var a;let t=this.boards.get(i.providerCard.boardId);if(!t)continue;e.push({boardId:t.id,board:{color:null===(a=this.boardSettings.get(t.id))||void 0===a?void 0:a.color,title:t.name,imageUrlSmall:t.boardImageUrls.small},taskId:i.id,taskTitle:i.title,taskDate:void 0,listId:"",listTitle:"",timeRecordTitle:void 0,timeRecordEndDate:new Date,timeRecordStartDate:new Date,userId:"",user:void 0,date:void 0,trackedTime:0,estimatedTime:60*i.providerCard.estimationHours,isTaskArchived:i.providerCard.isArchived,isFakeRecord:!0})}return e}}async loadBoardsDataAsync(e,t){let r=[],i=X()(t).call(t,(e=>`/boards/${e}`));for(;i.length>0;){let t=[];for(let e=0;e<4&&i.length>0;e++)t.push(se()(i).call(i,0,20));try{let i=await $().all(X()(t).call(t,(t=>this.trelloIntegrationSrv.batchAsync(e,t,"Get Trello boards",{fields:Te,lists:"open",labels:"all",labels_limit:1e3,members:"all",customFields:!0}))));for(let e of K()(i).call(i))r.push(e)}catch(e){throw{message:"Trello load boards data error",method:this.loadBoardsDataAsync.name,error:e}}}return r}async loadBoardsTimeRecordsAsync(e,t){const r=await(0,he.qd)(t,(async t=>{try{let r=await this.trelloCardsSrv.getBoardTimeRecordsAsync(e,t);return oe()(r)?{boardId:t,timeRecords:X()(r).call(r,(t=>_objectSpread(_objectSpread({},t),{},{accountId:e,from:(0,pe.HE)(t.from,t.isDuration),to:(0,pe.HE)(t.to,t.isDuration)})))}:[]}catch(e){throw{message:"Trello load board time entries error",method:this.loadBoardsTimeRecordsAsync.name,error:e}}}),5);return G()(r).call(r,(e=>e))}async fetchDataAsync(e){var t,r,i;const a=z()(de()(t=this.selectedBoardIds).call(t)),s=G()(r=J()(i=this.trelloProvider.getCurrentCollectionConnectedAccountIds()).call(i,(e=>this.trelloIntegrationSrv.getTrelloOrganizations(e)))).call(r,(e=>{var t,r;return(null!==(t=null===(r=e.boards)||void 0===r?void 0:r.length)&&void 0!==t?t:0)>0}));for(let e of s)this.setOrganization(e);if(0!==a.length)try{this.isLoading=!0;let t=new(ie())(this.members);this.clearStorage(),await(0,he.qd)(a,(async r=>{let i=this.selectedBoardIds.get(r),[a,s]=await $().all([abortablePromise(this.loadBoardsDataAsync(r,i),e),abortablePromise(this.trelloIntegrationSrv.getBoardsSettingsAsync(r,i),e)]),n={};for(let e of i)n[e]=s[e].defaultLimitArchivedCards;let[o,l]=await $().all([abortablePromise(this.trelloCardsSrv.getBoardsCardsAsync(r,i,this.appCommonSrv.getCancellationToken(`fetch-reports-data-for-${he.Qm.Trello}`),{loadArchived:!0,limitArchivedCards:n}),e),abortablePromise(this.loadBoardsTimeRecordsAsync(r,i),e)]);for(let e of a){var d,c;let i=this.trelloIntegrationSrv.fromTrelloBoard(r,e,s[e.id]),a=null===(d=Y()(o).call(o,(e=>{let{boardId:t}=e;return t&&t===i.id})))||void 0===d?void 0:X()(c=d.trelloCards).call(c,(e=>ue.fb.createCard(r,v.lP.Trello,he.eT.TrelloCard,{trelloCard:e,cardBoard:i})));if(0!==t.size){var h,u;let e=X()(h=G()(u=i.members).call(u,(e=>{let{id:r}=e;return!t.has(r)}))).call(h,(e=>{let{id:t}=e;return t}));this.setSelectedMemberIds(e,_.vV.Add)}this.setBoard(i),this.setBoardSettings(i.id,s[i.id]),this.setCards(null!=a?a:[]),this.setMembers(i.members),this.setLists(i.lists),this.setBoardTimeRecords(l)}var p,m;0!==t.size&&this.telemetrySrv.logSessionEvent(v.cN.CalendarEvents.ReportsSelectedMembersChanged,{count:K()(p=z()(Z()(m=this.selectedMemberIds).call(m))).call(p).length});return a}),5)}catch(e){throw DOMException,{message:"Trello load reports data error",method:this.fetchDataAsync.name,error:e}}finally{this.isLoading=!1}}clearStorage(){this.boards.clear(),this.boardSettings.clear(),this.cards.clear(),this.members.clear(),this.lists.clear(),this.boardsTimeRecords.clear()}get _globalCollectionSettings(){return this.settingsSrv.collection.global}get _globalReportsSettings(){return this.settingsSrv.collection.global.settings.provider[v.lP.Trello].reports}get _defaultDateRange(){let e=(0,pe.OR)(),t=(0,pe.vr)(),r=(0,pe.$Y)((0,pe.tE)(new Date,e));return[r,(0,pe.h3)((0,pe.sD)(r,t))]}}var Se=r(7488),Ie=r.n(Se),we=r(9938),De=r.n(we),Ee=r(24561),Ae=r(67558),Le=r(52329),Re=r(99612),xe=r(78385),Pe=r(67720),Me=r(41692),Be=r(54339),Oe=r(78402),$e=r(49742),Ne=r(61973),Fe=r(76972),je=r(69690),ze=r(78343),Ue=r(85893);function PwBarChart_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwBarChart_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwBarChart_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwBarChart_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const Ge="#f3f3f3";function hoursToMs(e){return Math.round(3600*e*1e3)}const CustomTooltipComponent=e=>{const{anchor:t,data:r,keys:i,barsCount:a,datumMetadata:n,total:o,x:l,y:d}=e;if(!(i&&a&&n&&o))return null;const c=t.x+(null!=l?l:0)+268+32>window.innerWidth,{t:h}=(0,Ae.$)(),u=(0,Le.q_)({transform:`translate(${c?`calc(${(null!=l?l:0)-16}px - 100%)`:`${(null!=l?l:0)+16}px`}, calc(${(null!=d?d:0)+16}px - 100% / 1.5))`,config:{duration:100}}),m=G()(i).call(i,(e=>e in r));return(0,Ue.jsx)(xe.h,{container:document.body,children:(0,Ue.jsx)(Le.q.div,{style:PwBarChart_objectSpread(PwBarChart_objectSpread({},u),{},{position:"absolute",top:t.y,left:t.x,width:"268px",pointerEvents:"none",zIndex:99999}),children:(0,Ue.jsxs)(p.JA,{sx:{padding:"16px",shadow:Me.Z[4]},children:[(0,Ue.jsxs)(p.EB,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,Ue.jsxs)(p.zM,{component:"div",variant:"body3",children:[(0,Ue.jsx)(s.c,{i18nKey:`TOOLTIPS.REPORTS_TOTAL_BY_${r.groupBy.toUpperCase()}`}),`: ${m.length}`]}),(0,Ue.jsxs)(p.zM,{component:"div",variant:"body3",children:[(0,Ue.jsx)(s.c,{i18nKey:"TOOLTIPS.REPORTS_TOTAL"}),`: ${(0,pe.LU)(hoursToMs(o),"hours")}`]})]}),(0,Ue.jsx)(Pe.Z,{sx:{margin:"12px 0 16px 0"}}),X()(m).call(m,(e=>{var t,i;let a=n.get(e);if(!a)return null;let s=new Date(0),o=(0,Ne.Z)(s,3600*r[e]),l=Math.abs((0,Fe.Z)(s,o)),d=Math.abs((0,je.Z)(s,(0,ze.Z)(o,-l))),c=`${Ie()(t=String(l)).call(t,2,"0")}:${Ie()(i=String(d)).call(i,2,"0")}`;return(0,Ue.jsxs)(p.EB,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",minWidth:"100%","&:not(:last-child)":{marginBottom:"12px"}},children:[(0,Ue.jsxs)(p.EB,{sx:{display:"flex",alignItems:"center",maxWidth:"200px",overflow:"hidden"},children:[(0,Ue.jsx)(p.zM,{component:"span",sx:{lineHeight:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"noWrap"},variant:"body4",children:a.label}),a.isArchived&&(0,Ue.jsx)(p.RX,{label:h("MISC.ARCHIVED"),size:"small",sx:{marginLeft:"6px",marginRight:"6px"}})]}),(0,Ue.jsx)(p.zM,{sx:{lineHeight:"1"},variant:"body4",children:c})]},e)}))]})})})},BarHoverLayer=e=>{var t;const{bars:r,datumMetadata:a,innerHeight:s,keys:n,margin:o,tooltip:l}=e,[d,c]=(0,i.useState)(null),{showTooltipAt:h,hideTooltip:u}=(0,$e.lL)();if(0===r.length)return null;const m={};E()(r).call(r,(e=>{const t=e.data.indexValue;var r;(t in m||(m[t]={data:{},height:0,width:0,total:0,x:0,y:0}),e.data.hidden)||(m[t]={data:e.data.data,total:m[t].total+(null!==(r=e.data.value)&&void 0!==r?r:0),height:m[t].height+e.height,width:e.width,x:e.x,y:e.y})}));const C=X()(t=b()(m)).call(t,((e,t,r)=>{const i="hover."+e,C=m[e];return(0,Ue.jsx)("rect",{height:C.height,style:{color:p.rS.palette.common.black,opacity:d===i?.1:0,transition:"opacity 0.25s",cursor:"pointer"},width:C.width,x:C.x,y:s-C.height,onMouseLeave:()=>(c(null),void u()),onMouseMove:e=>{var i,s,d;i={index:t,x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY,data:C.data,barsCount:r.length,keys:n,datumMetadata:a,total:C.total},h(l(i),[(null!==(s=i.x)&&void 0!==s?s:0)+o.left,(null!==(d=i.y)&&void 0!==d?d:0)+o.top],"top")},onMouseOver:e=>{((e,t)=>{var r,i;c(e),h(l(t),[(null!==(r=t.x)&&void 0!==r?r:0)+o.left,(null!==(i=t.y)&&void 0!==i?i:0)+o.top],"top")})(i,{index:t,x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY,data:C.data,barsCount:r.length,keys:n,datumMetadata:a,total:C.total})}},i)}));return(0,Ue.jsx)(Ue.Fragment,{children:C})},Ve=(0,a.Pi)((e=>{const{sx:t,printingMode:r=!1,onRendered:a}=e,s=(0,Be.ze)({fontSize:12,fontFamily:"Roboto",axis:{domain:{line:{display:"none"}},ticks:{text:{fontFamily:"NotoSansKR.otf",fontSize:r?"9px":"12px",lineHeight:"14px",color:d.Z[700],opacity:.5}}},grid:{line:{stroke:Ge}}}),{barChartData:{data:n,keys:o,colors:l,datumMetadata:h,groupingUnit:u,isEmptyDataset:m,isLoadingDataset:C}}=(0,i.useContext)(g),{width:v,ref:f}=(0,Re.NB)({handleHeight:!1}),{shouldRotateTicks:y,requiredPadding:_}=(0,i.useMemo)((()=>{const e=n[0];if(!n[0]||!v)return{shouldRotateTicks:!1,requiredPadding:0};const t=5.5*e.formattedDate.length,r=v-12*n.length;return{shouldRotateTicks:t*n.length>r,requiredPadding:Math.round(t/3)}}),[v,u,n]),k={height:null==t?void 0:t.height,paddingBottom:y?`${_}px`:0,svg:{height:null!=t&&t.height?`calc(${null==t?void 0:t.height} + ${_}px)`:"auto",overflow:"visible","> rect":{height:"inherit"}}},[T,S]=(0,i.useMemo)((()=>r?(e=>{const t=(r=Math.max(...X()(e).call(e,(e=>e.total))),i=5,a=5,Math.ceil((r-a)/i)*i+a);var r,i,a;const s=t/5;return[z()({length:6},((e,t)=>t*s)),t]})(n):[void 0,"auto"]),[n,r]);return(0,Ue.jsx)(p.EB,{ref:f,sx:(0,c.Z)(t,k),children:(0,Ue.jsx)(Oe.jM,{innerPadding:r?1:0,animate:!1,axisBottom:{renderTick:e=>(e=>{var t,r;const{animatedProps:i,value:a,textX:s,textY:n,textAnchor:o,x:l,y:d,shouldRotateTicks:c,requiredPadding:h,theme:u}=e,p=null===(t=u.axis)||void 0===t||null===(r=t.ticks)||void 0===r?void 0:r.text;let m=0,C=6;return c&&(m=-40,C=h),(0,Ue.jsx)(Le.q.g,{opacity:i.opacity,transform:`translate(${l},${d+C})`,children:(0,Ue.jsx)(Le.q.text,{fontFamily:null==p?void 0:p.fontFamily,style:p,textAnchor:o,transform:`translate(${s},${n}) rotate(${m})`,children:a})})})(PwBarChart_objectSpread(PwBarChart_objectSpread({},e),{},{theme:s,shouldRotateTicks:y,requiredPadding:_,printingMode:r}))},axisLeft:null,axisRight:{tickValues:T,renderTick:e=>(e=>{var t,r;const{animatedProps:i,value:a,textX:s,textY:n,x:o,y:l,printingMode:d,theme:c}=e,h=null===(t=c.axis)||void 0===t||null===(r=t.ticks)||void 0===r?void 0:r.text,u=d?4:8;return(0,Ue.jsxs)(Le.q.g,{opacity:i.opacity,transform:`translate(${o+10},${l-u})`,children:[(0,Ue.jsx)(Le.q.line,{style:{stroke:Ge,strokeWidth:1},x1:-10,x2:12,y1:u,y2:u}),(0,Ue.jsx)(Le.q.text,{style:h,textAnchor:"end",transform:`translate(${s},${n})`,children:`${a}h`})]})})(PwBarChart_objectSpread(PwBarChart_objectSpread({},e),{},{theme:s,printingMode:r}))},axisTop:null,gridYValues:T,colors:e=>{let{id:t}=e;return"EMPTY_RECORD"===t?"transparent":r?l.get(t):p.rS.palette.primary.main},theme:s,maxValue:S,data:n,enableLabel:!1,indexBy:"formattedDate",keys:o,layers:["grid","markers","bars","axes",...m?C?[e=>(e=>{var t;const{bars:r,innerHeight:i,xScale:a}=e;if(0===r.length)return null;const s={};E()(r).call(r,(e=>{const t=e.data.indexValue;s[t]={data:e.data.data,total:0,height:e.height-Math.random()*Number(e.data.data.EMPTY_RECORD)*2,width:e.width,x:a(e.data.indexValue),y:e.y}}));const n=X()(t=b()(s)).call(t,(e=>{const t="hover."+e,r=s[e];return(0,Ue.jsx)(Ee.ZP,{backgroundColor:"#ebedef",foregroundColor:"#f3f5f8",height:r.height,speed:2,viewBox:"0 0 "+r.width+" "+r.height,width:r.width,x:r.x,y:i-r.height,children:(0,Ue.jsx)("rect",{height:r.height,width:r.width})},t)}));return(0,Ue.jsx)(Ue.Fragment,{children:n})})(PwBarChart_objectSpread({},e))]:[]:[e=>(e=>{var t,r,i;const{bars:a,yScale:s,xScale:n,theme:o}=e,l=null===(t=o.axis)||void 0===t||null===(r=t.ticks)||void 0===r?void 0:r.text;if(0===a.length)return null;const d={},c=a[0].width;E()(a).call(a,(e=>{const t=e.data.indexValue;var r;t in d||(d[t]=0),e.data.hidden||(d[t]+=null!==(r=e.data.value)&&void 0!==r?r:0)}));const h=X()(i=b()(d)).call(i,(e=>{const t=n(e)+c/2,r=s(d[e])-8;return(0,Ue.jsx)("text",{style:PwBarChart_objectSpread(PwBarChart_objectSpread({},l),{},{opacity:1}),textAnchor:"middle",x:t,y:r,children:(0,pe.LU)(hoursToMs(d[e]),"hours")},"total."+e)}));return(0,Ue.jsx)(Ue.Fragment,{children:h})})(PwBarChart_objectSpread(PwBarChart_objectSpread({},e),{},{theme:s})),e=>BarHoverLayer(PwBarChart_objectSpread(PwBarChart_objectSpread({},e),{},{keys:o,datumMetadata:h,barsCount:n.length}))],()=>(De()((()=>null==a?void 0:a({isExpanded:y})),50),null)],margin:{top:50,right:32,bottom:50,left:0},padding:.2,tooltip:e=>(0,Ue.jsx)(CustomTooltipComponent,PwBarChart_objectSpread({anchor:f.current.getBoundingClientRect()},e)),valueFormat:e=>(0,pe.LU)(hoursToMs(e),"hours")})})})),Ke=(0,Ue.jsx)("path",{clipRule:"evenodd",d:"M6 0a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h588a6 6 0 0 0 6-6V6a6 6 0 0 0-6-6H6Zm12 12a4 4 0 0 0 0 8h189a4 4 0 0 0 0-8H18ZM6 88a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h338a6 6 0 0 0 6-6V94a6 6 0 0 0-6-6H6Zm12 12a4 4 0 0 0 0 8h189a4 4 0 0 0 0-8H18ZM6 176a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h438a6 6 0 0 0 6-6v-20a6 6 0 0 0-6-6H6Zm12 12a4 4 0 0 0 0 8h189a4 4 0 0 0 0-8H18ZM6 44a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h438a6 6 0 0 0 6-6V50a6 6 0 0 0-6-6H6Zm12 12a4 4 0 0 0 0 8h189a4 4 0 0 0 0-8H18ZM6 132a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h588a6 6 0 0 0 6-6v-20a6 6 0 0 0-6-6H6Zm12 12a4 4 0 0 0 0 8h189a4 4 0 0 0 0-8H18ZM6 220a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h338a6 6 0 0 0 6-6v-20a6 6 0 0 0-6-6H6Zm12 12a4 4 0 0 0 0 8h189a4 4 0 0 0 0-8H18Z",fillRule:"evenodd"});function PwReportsSkeleton(){return(0,Ue.jsx)(o.Z,{theme:p.rS,children:(0,Ue.jsx)(Ee.ZP,{backgroundColor:"#ebedef",foregroundColor:"#f3f5f8",height:252,speed:2,viewBox:"0 0 600 252",width:600,children:Ke})})}PwReportsSkeleton.componentName="pwReportsSkeleton";const He=PwReportsSkeleton;var Ze=r(41266),We=r(22574),Ye=r.n(We),qe=r(53706),Xe=r.n(qe),Qe=r(35704),Je=r.n(Qe),et=r(91829),tt=r.n(et),rt=r(74094),it=r(27060),at=r(39142),st=r(74061),nt=r(58031),ot=r(34300),lt=r.n(ot),dt=r(48999),ct=r(28962),ht=r(6949),ut=r(60265),pt=r(55137),mt=r(57274),Ct=r(51701);const vt=["backgroundColor"];function config_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function config_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=config_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=config_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const getReportsTimeString=e=>{if(e){let t=Ye()(e/60),r=Math.ceil(e%60);return`${t}h ${r<10?"0"+r:r}m`}return"0h 0m"},VarianceComponent=e=>{const{progressValue:t,progressStyles:r={},percentage:i=Math.round(t),tooltipLocalizationString:a}=e;return(0,Ue.jsxs)(p.EB,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,Ue.jsx)(p.jz,{componentsProps:{tooltip:{sx:{[`&.${dt.Z.tooltip}.${dt.Z.tooltipPlacementTop}`]:{marginBottom:0}}}},enterDelay:500,placement:"top",title:Ct.Z.t(a),children:(0,Ue.jsx)(p.EB,{sx:{display:"flex",alignItems:"center",height:"30px"},children:(0,Ue.jsx)(p.gG,{sx:(0,mt.vb)({[`&.${ct.Z.colorPrimary}`]:{minWidth:"100px",borderRadius:"6px",backgroundColor:d.Z[300]},[`& .${ct.Z.bar}`]:{backgroundColor:ht.Z.A400}},r),value:t,variant:"determinate"})})}),(0,Ue.jsx)(p.zM,{sx:{fontSize:"13px",color:(null!=i?i:0)<0?ut.Z[600]:"currentColor"},variant:"body4",children:i?`${i}%`:"-"})]})},RichCellComponent=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=r.image,{backgroundColor:a}=i,s=(0,Ze.Z)(i,vt);return(0,Ue.jsxs)(p.EB,{sx:{display:"flex",alignItems:"center"},children:[(0,Ue.jsx)(p.zW,config_objectSpread(config_objectSpread({src:e,sx:{height:20,width:20,marginRight:"8px",fontSize:"11px",fontWeight:"600",backgroundColor:`trelloBoards.${a}.base`},variant:"rounded"},s),{},{children:(0,pe.T6)(t,"",1)})),(0,Ue.jsx)("span",config_objectSpread(config_objectSpread({style:{overflow:"hidden",textOverflow:"ellipsis"}},r.text),{},{children:t}))]})},ft={[_.I4.Board]:[{id:"boardTitle",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.TITLE"}),columns:[{accessorKey:"boardId",cell:e=>{var t;let{cell:r}=e;const i=r.row.original.board;return RichCellComponent(i.imageUrlSmall,i.title,{image:{backgroundColor:null!==(t=i.color)&&void 0!==t?t:"default"}})}}]}],[_.I4.Member]:[{accessorKey:"userId",cell:e=>{let{cell:t}=e;const r=t.row.original.user;return RichCellComponent(null==r?void 0:r.avatarUrlSmall,null==r?void 0:r.fullName,{image:{variant:"circular"}})}}],[_.I4.List]:[{accessorKey:"listId",cell:e=>{let{cell:t}=e;return(0,Ue.jsx)("span",{children:t.row.original.listTitle})}}],[_.I4.Task]:[{id:"taskTitleHeader",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.TITLE"}),columns:[{accessorKey:"taskId",cell:e=>{let{cell:t}=e;return t.row.original.taskTitle}}]}],[_.I4.None]:[]},yt={[_.I4.Board]:{grouping:["boardId"]},[_.I4.Member]:{grouping:["userId"]},[_.I4.List]:{grouping:["listId"]},[_.I4.Task]:{grouping:["taskId"]},[_.I4.None]:{}};function getTableColumns(e,t,r){switch(r){case _.Hm.TrackedTime:return[{accessorKey:"timeRecordTitle",cell:e=>{let{cell:t}=e;return t.getValue()?(0,Ue.jsx)("span",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:t.getValue()}):(0,Ue.jsx)("span",{style:{paddingRight:"2px",color:"#8b8e93",fontStyle:"italic"},children:(0,Ue.jsx)(s.c,{i18nKey:"MISC.REPORTS_NO_DESCRIPTION"})})}},{id:"date",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.DATE"}),columns:[{accessorKey:"date",cell:e=>{let{cell:t}=e;return t.getValue()&&(0,Ue.jsx)("span",{className:"date",children:t.getValue()})},aggregationFn:"count",aggregatedCell:e=>{let{row:t}=e;var r;if("taskTitle"===t.groupingColumnId)return(0,Ue.jsx)("span",{children:null!==(r=t.original.taskDate)&&void 0!==r?r:"-"})},size:165,minSize:165}],size:180,minSize:180},{id:"trackedTime",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.TIME"}),columns:[{accessorKey:"trackedTime",cell:e=>{let{cell:t}=e;return getReportsTimeString(lt()(t.getValue(),10))},aggregationFn:"sum",aggregatedCell:e=>{let{cell:t,getValue:r}=e;return(0,Ue.jsx)("span",{style:{fontWeight:t.getIsAggregated()?600:"normal"},children:getReportsTimeString(lt()(r(),10))})},size:65,minSize:65}],size:50,minSize:50},...ft[e],...ft[t]];case _.Hm.TrackedVsEstimated:return[{id:"boardTitle",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.TITLE"}),columns:[{accessorKey:"boardId",cell:e=>{var t;let{cell:r}=e;const i=r.row.original.board;return RichCellComponent(i.imageUrlSmall,i.title,{image:{backgroundColor:null!==(t=i.color)&&void 0!==t?t:"default"}})}}]},{accessorKey:"taskId",cell:e=>{let{cell:t}=e;return(0,Ue.jsx)("span",{children:t.row.original.taskTitle})}},{accessorKey:"timeRecordTitle",cell:e=>{let{cell:t}=e;return t.getValue()?(0,Ue.jsx)("span",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:(0,Ue.jsx)("span",{children:t.getValue()})}):(0,Ue.jsx)("span",{style:{color:"#8b8e93",fontStyle:"italic"},children:(0,Ue.jsx)(s.c,{i18nKey:"MISC.REPORTS_NO_DESCRIPTION"})})}},{id:"estimatedTime",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.ESTIMATED"}),columns:[{accessorKey:"estimatedTime",cell:()=>"-",aggregationFn:(e,t,r)=>{var i;const a=new(ie());return E()(r).call(r,(e=>a.set(e.original.taskId,e.original.estimatedTime))),Xe()(i=z()(Z()(a).call(a))).call(i,((e,t)=>e+(null!=t?t:0)),0)},aggregatedCell:e=>{let{getValue:t}=e;return(0,Ue.jsx)("span",{style:{fontWeight:600},children:t()?getReportsTimeString(lt()(t(),10)):"-"})},size:65,minSize:65}],size:65,minSize:65},{id:"tracked",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.TRACKED"}),columns:[{accessorKey:"trackedTime",cell:e=>{let{cell:t}=e;return getReportsTimeString(lt()(t.getValue(),10))},aggregationFn:"sum",aggregatedCell:e=>{let{cell:t,getValue:r}=e;return(0,Ue.jsx)("span",{style:{width:"100%",fontWeight:t.getIsAggregated()?600:"normal",justifySelf:"flex-start"},children:t.row.original.isFakeRecord?"-":getReportsTimeString(lt()(r(),10))})},size:65,minSize:65}],size:65,minSize:65},{id:"variance",header:()=>(0,Ue.jsx)(s.c,{i18nKey:"MISC.VARIANCE",style:{width:"100%",textAlign:"end"}}),columns:[{accessorKey:"variance",cell:()=>null,aggregationFn:"sum",aggregatedCell:e=>{let{row:t}=e;const r=t.getValue("trackedTime"),i=t.getValue("estimatedTime"),a=r>i,getTooltipLocalizationString=()=>i?r?a?"$t(TOOLTIPS.REPORTS_TRACKED_TIME) > $t(TOOLTIPS.REPORTS_ESTIMATED)":i===r?"$t(TOOLTIPS.REPORTS_TRACKED_TIME) = $t(TOOLTIPS.REPORTS_ESTIMATED)":r<i?"$t(TOOLTIPS.REPORTS_TRACKED_TIME) < $t(TOOLTIPS.REPORTS_ESTIMATED)":"TOOLTIPS.REPORTS_ESTIMATED":"TOOLTIPS.REPORTS_ESTIMATED":"TOOLTIPS.REPORTS_NOT_ESTIMATED";if(!i)return(0,Ue.jsx)(VarianceComponent,{percentage:null,progressStyles:{[`&.${ct.Z.colorPrimary}`]:{backgroundColor:pt.Z.A400}},progressValue:0,tooltipLocalizationString:getTooltipLocalizationString()});if(!r)return(0,Ue.jsx)(VarianceComponent,{percentage:null,progressValue:0,tooltipLocalizationString:getTooltipLocalizationString()});if(a){const e=Math.round(100*(1-r/i));return(0,Ue.jsx)(VarianceComponent,{percentage:e,progressStyles:{[`&.${ct.Z.colorPrimary}`]:{backgroundColor:pt.Z.A400}},progressValue:i/r*100,tooltipLocalizationString:getTooltipLocalizationString()})}return(0,Ue.jsx)(VarianceComponent,{progressValue:r/i*100,tooltipLocalizationString:getTooltipLocalizationString()})},size:150,minSize:150}],size:150,minSize:150}]}}function getTableColumnsConfig(e,t,r){switch(r){case _.Hm.TrackedTime:return(0,mt.vb)(yt[e],yt[t],{grouping:[],columnVisibility:{taskDate:!1}});case _.Hm.TrackedVsEstimated:return(0,mt.vb)(yt[_.I4.Board],yt[_.I4.Task],{grouping:[],columnVisibility:{taskDate:!1}})}}const gt=["children"],_t=["children","stickyIndices"];function PwTable_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwTable_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwTable_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwTable_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}function PwTable_getReportsTimeString(e){if(e){let t=Ye()(e/60),r=Math.ceil(e%60);return`${t}h ${r<10?"0"+r:r}m`}return"0h 0m"}const kt=(0,a.Pi)((e=>{const{sx:t}=e,r=(0,i.createContext)({}),{tableData:a,selectedMode:s,firstLevelGrouping:n,secondLevelGrouping:o}=(0,i.useContext)(g),{t:l}=(0,Ae.$)(),[d,h]=(0,i.useState)({}),u=(0,i.useRef)(0),{columns:m,columnsConfig:C}=(0,i.useMemo)((()=>({columns:getTableColumns(n,o,s),columnsConfig:getTableColumnsConfig(n,o,s)})),[n,o,s]),{grouping:v,columnVisibility:f}=C,y=(0,rt.b7)({data:a,columns:m,state:{grouping:v,columnVisibility:f,expanded:d},autoResetExpanded:!1,onExpandedChange:h,getCoreRowModel:(0,it.sC)(),getGroupedRowModel:(0,it.qe)(),getExpandedRowModel:(0,it.rV)(),manualPagination:!0,debugTable:!1}),{rows:k}=y.getRowModel();(0,i.useEffect)((()=>{y.setExpanded(Xe()(k).call(k,((e,t)=>(t.getCanExpand()&&0===t.depth&&(e=PwTable_objectSpread(PwTable_objectSpread({},e),{},{[t.id]:!0})),e)),{}))}),[a]),(0,i.useEffect)((()=>{u.current=0}),[n,o]);const b=(0,i.memo)((function renderRow(e){var t;let{index:r,style:i,width:a}=e;var n;if(0===r)return(0,Ue.jsx)(p.EB,{sx:PwTable_objectSpread(PwTable_objectSpread({},i),{},{position:"sticky",top:"8px",left:0,display:"flex",gap:"16px",height:36,padding:"0 16px 0 8px",fontWeight:400,fontSize:"13px",lineHeight:"15px",color:"grey.700",backgroundColor:"background.default",zIndex:120,"&:before":{content:'""',position:"absolute",width:"100%",height:"100%",top:"-50%",left:0,backgroundColor:"background.default",zIndex:-1},".pwReportsTable-headerCell":{"&_boardTitle":{"+ .pwReportsTable-headerCell_taskTitleHeader":{display:"none"}}}}),children:(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)(p.EB,{sx:{display:"flex",alignItems:"center"},children:(0,Ue.jsx)(p.qS,{onClick:()=>y.toggleAllRowsExpanded(!y.getIsSomeRowsExpanded()),children:(0,Ue.jsx)(p.WX,{component:nt.r,inheritViewBox:!0,sx:{fontSize:16,color:"#8b8e93",transform:`rotate(${y.getIsSomeRowsExpanded()?0:180}deg)`}})})}),X()(n=y.getHeaderGroups()[0].headers).call(n,(e=>(0,Ue.jsx)(p.EB,{className:`pwReportsTable-headerCell_${e.column.id}`,sx:{display:e.isPlaceholder?"none":"flex",alignItems:"center",minWidth:e.column.getSize(),marginRight:0===e.index||!e.isPlaceholder&&1===e.index?"auto":0},children:(0,rt.ie)(e.column.columnDef.header,e.getContext())},e.id)))]})});const o=r-1,d=k[o];if(!d)return null;const h=d.getCanExpand()?24*d.depth:24*v.length+16,u=k[o-1],m=k[o+1],C=u&&u.getIsGrouped()&&!d.getIsGrouped()&&d.depth>2,f=m&&m.getIsGrouped()&&!d.getIsGrouped(),g=d.original.isFakeRecord,b=PwTable_objectSpread(PwTable_objectSpread({},i),{},{top:i.top+(d.getIsGrouped()?8:d.depth<=2?4:0),display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px",height:i.height-(d.getIsGrouped()?8:0),minWidth:"min-content",width:`calc(100% - ${h}px - ${16*(d.getIsGrouped()?2:1)}px)`,marginLeft:`${h}px`,padding:`0 16px 0 ${d.getIsGrouped()?16:0}px`,fontSize:"13px",borderTop:C?"1px solid":"none",borderBottom:f?"none":(d.getCanExpand()?0:1)+"px solid",borderColor:d.getCanExpand()?"transparent":"grey.200",borderRadius:d.getCanExpand()?"6px":"0",cursor:g?"arrow":"pointer",transition:"background-color 0.25s",".cell":{"&-timeRecordTitle":{flexShrink:3,marginRight:"auto",overflow:"hidden"},"&-estimatedTime":{marginLeft:"auto"},"&-trackedTime":{justifyContent:s===_.Hm.TrackedTime?"flex-end":"flex-start"}},"&:hover":{backgroundColor:g?"transparent":"grey.50"}}),T={backgroundColor:"grey.100",transition:"background-color 0.25s",borderBottom:"none","&:hover":{backgroundColor:g?"transparent":"grey.200"},".cell":{"&-firstGroupingLevelTitle ":{fontWeight:500,fontSize:"13px",lineHeight:"20px"}}};let S=g?void 0:d.getToggleExpandedHandler();return(0,Ue.jsx)(p.EB,{sx:d.getCanExpand()&&0===d.depth?(0,c.Z)(b,T):b,onClick:S,children:X()(t=d.getVisibleCells()).call(t,((e,t,r)=>{var i;const n={[_.Hm.TrackedTime]:2,[_.Hm.TrackedVsEstimated]:3},o=Je()(r).call(r,-n[s]),c=Xe()(o).call(o,((e,t)=>{let{column:r}=t;return e+r.getSize()}),0);return(0,Ue.jsx)(p.EB,{className:`cell-${e.column.id}`,sx:{display:(e=>{if(e.getIsPlaceholder())return!1;switch(s){case _.Hm.TrackedTime:if(d.getIsGrouped()){if("date"===e.column.id)return!1;if("timeRecordTitle"===e.column.id)return!1}break;case _.Hm.TrackedVsEstimated:if(d.getIsGrouped()&&"timeRecordTitle"===e.column.id)return!1}return!0})(e)?"flex":"none",alignItems:"center",minWidth:e.column.getSize(),maxWidth:`calc(${a}px - ${h+32+16*r.length}px - ${c}px)`,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.getIsGrouped()?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)(p.WX,{component:nt.r,inheritViewBox:!0,sx:{marginRight:"8px",fontSize:16,color:"#8b8e93",transform:`rotate(${d.getIsExpanded()?0:d.depth>0?90:180}deg)`,visibility:g?"hidden":"visible"}}),(0,Ue.jsx)(p.zM,{component:"span",sx:{fontWeight:500,fontSize:"13px",lineHeight:"24px",letterSpacing:"0.15px",overflow:"hidden",textOverflow:"ellipsis"},children:(0,rt.ie)(e.column.columnDef.cell,e.getContext())}),(0,Ue.jsx)(p.zM,{sx:{color:"grey.500",fontSize:"13px",lineHeight:"24px",marginLeft:"6px"},children:g?"":d.subRows.length}),"taskId"===e.column.id&&e.row.original.isTaskArchived&&(0,Ue.jsx)(p.RX,{label:l("MISC.ARCHIVED"),size:"small",sx:{marginLeft:"12px"}})]}):e.getIsAggregated()?(0,rt.ie)(null!==(i=e.column.columnDef.aggregatedCell)&&void 0!==i?i:e.column.columnDef.cell,e.getContext()):e.getIsPlaceholder()?null:(0,rt.ie)(e.column.columnDef.cell,e.getContext())},e.id)}))},d.id)}),st.wy),ItemWrapper=e=>{let{data:t,index:r,style:i}=e;const{ItemRenderer:a,stickyIndices:s}=t;return s&&tt()(s).call(s,r)?null:(0,Ue.jsx)(a,{index:r,style:i})},T=(0,i.forwardRef)((function InnerElement(e,t){let{children:i}=e,a=(0,Ze.Z)(e,gt);return(0,Ue.jsx)(r.Consumer,{children:e=>{let{ItemRenderer:r,stickyIndices:s}=e;return(0,Ue.jsxs)(p.EB,PwTable_objectSpread(PwTable_objectSpread({ref:t},a),{},{children:[X()(s).call(s,(e=>(0,Ue.jsx)(r,{index:e},e))),i]}))}})})),S=(0,i.forwardRef)((function VariableSizeListComponent(e,t){let{children:i,stickyIndices:a}=e,s=(0,Ze.Z)(e,_t);return(0,Ue.jsx)(r.Provider,{value:{ItemRenderer:i,stickyIndices:a},children:(0,Ue.jsx)(st.S_,PwTable_objectSpread(PwTable_objectSpread({itemData:{ItemRenderer:i,stickyIndices:a},outerRef:t},s),{},{children:ItemWrapper}))})})),I={flexGrow:1,".pwReportsTable-variableList":(0,c.Z)({},(0,p.yR)())};return(0,Ue.jsx)(p.EB,{sx:(0,c.Z)(I,t),children:(0,Ue.jsx)(at.ZP,{children:e=>{let{height:t,width:r}=e;return(0,Ue.jsx)(S,{className:"pwReportsTable-variableList",height:t,initialScrollOffset:u.current,innerElementType:T,itemCount:k.length+1,itemSize:()=>44,stickyIndices:[0],width:r,onScroll:e=>{let{scrollOffset:t}=e;return u.current=t},children:e=>(0,Ue.jsx)(b,PwTable_objectSpread({width:r},e))})}})})}));var bt=r(59905),Tt=r(23926);const St=["open","sx"];function PwTableControls_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwTableControls_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwTableControls_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwTableControls_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const It=[_.I4.Board,_.I4.Task,_.I4.Member],wt=(0,i.forwardRef)((function ButtonComponent(e,t){const{open:r,sx:a}=e,s=(0,Ze.Z)(e,St),n=(0,i.useRef)(null);(0,i.useImperativeHandle)(t,(()=>{var e,t;return{buttonWidth:null!==(e=`${null===(t=n.current)||void 0===t?void 0:t.getBoundingClientRect().width}px`)&&void 0!==e?e:"auto"}}));const o={fontSize:"12px",fontWeight:400,lineHeight:"22px",color:"text.secondary",whiteSpace:"noWrap",svg:{transform:`rotate(${r?0:180}deg)`}};return(0,Ue.jsx)(p.uE,PwTableControls_objectSpread({ref:n,color:"neutral",size:"small",sx:(0,c.Z)(o,a),variant:"outlined"},s))})),MenuComponent=e=>{const{ButtonContent:t,disabled:r,availableGroupingVariants:a,groupingVariant:s,setGroupingVariant:n}=e,{t:o}=(0,Ae.$)(),d=(0,bt.o_)({variant:"popper",popupId:`pwPopup_${s}`}),h=(0,i.useMemo)((()=>{var e;return null===(e=d.anchorEl)||void 0===e?void 0:e.getBoundingClientRect().width}),[d.isOpen]),handleMenuClose=()=>{d.close()};return(0,Ue.jsx)(Tt.d,{mouseEvent:"onMouseDown",onClickAway:handleMenuClose,children:(0,Ue.jsxs)(l.Z,{children:[(0,Ue.jsx)(wt,PwTableControls_objectSpread(PwTableControls_objectSpread({disabled:r},(0,bt.LI)(d)),{},{children:t})),(0,Ue.jsx)(p.AL,{disabled:r,open:d.isOpen,popperProps:PwTableControls_objectSpread({},(0,bt.Rg)(d)),children:(0,Ue.jsx)(p.Nk,{sx:(0,c.Z)({maxHeight:"200px",minWidth:h,borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.25)",overflow:"auto"},(0,p.yR)()),children:X()(a).call(a,(e=>(0,Ue.jsx)(p.w9,{selected:s===e,onClick:()=>{n(e),handleMenuClose()},children:o(`MENU.REPORTS_GROUP_BY_${e.toUpperCase()}`)},e)))})})]})})},Dt=(0,a.Pi)((()=>{const{t:e}=(0,Ae.$)(),{firstLevelGrouping:t,secondLevelGrouping:r,setFirstLevelGrouping:a,setSecondLevelGrouping:s}=(0,i.useContext)(g),{locals:{isViewBusy:n}}=(0,i.useContext)(y),o=_.v4[t],l=(0,i.memo)((function ButtonContent(t){let{groupingVariant:r,prefix:i}=t;return(0,Ue.jsxs)(Ue.Fragment,{children:[e(`$t(${i}) $t(${_.xZ[r]})`),(0,Ue.jsx)(p.WX,{component:nt.r,inheritViewBox:!0,sx:{marginLeft:"6px",marginRight:"-2px",fontSize:16,color:"#8b8e93",transition:"transform 0.25s"}})]})}));return(0,Ue.jsxs)(p.EB,{sx:{display:"flex",gap:"16px"},children:[(0,Ue.jsx)(MenuComponent,{ButtonContent:(0,Ue.jsx)(l,{groupingVariant:t,prefix:"MENU.REPORTS_GROUP_BY"}),availableGroupingVariants:It,disabled:n,groupingVariant:t,setGroupingVariant:a}),(0,Ue.jsx)(MenuComponent,{ButtonContent:(0,Ue.jsx)(l,{groupingVariant:r,prefix:"MISC.AND"}),availableGroupingVariants:o,disabled:n||o[0]===_.I4.None,groupingVariant:r,setGroupingVariant:s})]})}));var Et=r(76205),At=r(83980),Lt=r(16036),Rt=r(73242),xt=r(73718),Pt=r(16628),Mt=r(91057),Bt=r(55827),Ot=r(84055),$t=r(9343),Nt=r(59857),Ft=r(37936);const jt=["organizations","boards","selectedBoardIds","setSelectedBoardIds","selectedBoardIdsCount","clearSelectedBoardIds","isMinimized"];function PwBoardsPicker_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwBoardsPicker_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwBoardsPicker_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwBoardsPicker_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const OrganizationComponent=e=>{let{organization:t}=e;return(0,Ue.jsxs)(p.w9,{dense:!0,sx:{paddingLeft:"8px",paddingRight:"8px",marginLeft:"8px",color:"grey.600",borderRadius:"3px",pointerEvents:"none"},children:[(0,Ue.jsx)(Ft.W,{imageUrl:t.logoUrlSmall,name:t.name,sx:{width:"16px",height:"16px",marginRight:"12px"}}),(0,Ue.jsx)(p.wW,{children:t.name})]})},BoardComponent=e=>{var t;let{board:r,selectedBoardIds:i,setSelectedBoardIds:a}=e;const s=null===(t=i.get(r.accountId))||void 0===t?void 0:Y()(t).call(t,(e=>e===r.id));return(0,Ue.jsxs)(p.w9,{dense:!0,sx:{width:"260px",paddingLeft:"8px",paddingRight:"8px",marginLeft:"8px",borderRadius:"3px"},onClick:()=>a(r.accountId,[r.id],s?_.vV.Remove:_.vV.Add),children:[(0,Ue.jsx)(Ft.j,{boardColor:r.boardColor,boardImageUrl:r.boardImageUrls.small,name:r.name,sx:{width:"16px",height:"16px",marginRight:"12px",fontSize:"11px"}}),(0,Ue.jsx)(p.wW,{sx:{"> span":{overflow:"hidden",textOverflow:"ellipsis"}},children:r.name}),s&&(0,Ue.jsx)(p.WX,{component:Nt.r,inheritViewBox:!0,sx:{width:"16px",height:"16px",marginLeft:"auto"}})]},r.id)},BoardsList=e=>{var t;const{boards:r,searchString:i,selectedBoardIds:a,setSelectedBoardIds:s}=e;return(0,Ue.jsx)(Ue.Fragment,{children:X()(t=G()(r).call(r,(e=>{var t;let{name:r}=e;return!i||tt()(t=r.toLowerCase()).call(t,i.toLowerCase())}))).call(t,(e=>(0,Ue.jsx)(BoardComponent,{board:e,selectedBoardIds:a,setSelectedBoardIds:s},e.id)))})},zt=(0,a.Pi)((e=>{const{organizations:t,boards:r,selectedBoardIds:a,setSelectedBoardIds:s,selectedBoardIdsCount:n,clearSelectedBoardIds:o,isMinimized:l}=e,d=(0,Ze.Z)(e,jt),{services:{telemetrySrv:c}}=(0,i.useContext)(y),h=(0,bt.o_)({variant:"popper",popupId:"pwBoardsPicker"}),[u,m]=(0,i.useState)(""),{t:C}=(0,Ae.$)(),handleSelectBoardIds=(e,t,r)=>{var i;s(e,t,r),c.logSessionEvent(v.cN.CalendarEvents.ReportsSelectedBoardsChanged,{count:K()(i=z()(Z()(a).call(a))).call(i).length})},f=new(F())(X()(r).call(r,(e=>e.id))).size,handleSelectAllClick=()=>{var e;let t=new(ie());switch(n===f?_.vV.Remove:_.vV.Add){case _.vV.Add:for(let e of r){let r=t.get(e.accountId);r?r.add(e.id):t.set(e.accountId,new(F())([e.id]))}for(let[e,r]of be()(t).call(t))s(e,z()(r),_.vV.Add);break;case _.vV.Remove:o()}c.logSessionEvent(v.cN.CalendarEvents.ReportsSelectedBoardsChanged,{count:K()(e=z()(Z()(a).call(a))).call(e).length})},handleChange=e=>{m(e.target.value)};return(0,Ue.jsx)(Tt.d,{mouseEvent:"onMouseDown",touchEvent:"onTouchStart",onClickAway:()=>h.close(),children:(0,Ue.jsxs)(p.EB,PwBoardsPicker_objectSpread(PwBoardsPicker_objectSpread({},d),{},{children:[(0,Ue.jsx)(p.uE,PwBoardsPicker_objectSpread(PwBoardsPicker_objectSpread({color:n>0?"primary":"neutral",size:"small",startIcon:(0,Ue.jsx)(p.WX,{component:Ot.r,inheritViewBox:!0,sx:{width:"16px",height:"16px"}}),sx:{minWidth:"auto",fontSize:"13px",fontWeight:"400",whiteSpace:"noWrap",path:{fill:"currentColor"},".MuiButton-startIcon":{marginTop:"-2px",marginLeft:"2px",marginRight:l?"2px":"8px"}}},(0,bt.LI)(h)),{},{children:l?null:n>0?`${C("BUTTONS.BOARDS")} (${n})`:C("BUTTONS.BOARDS")})),(0,Ue.jsx)(xt.Z,PwBoardsPicker_objectSpread(PwBoardsPicker_objectSpread({placement:"bottom",sx:{zIndex:1},transition:!0},(0,bt.Rg)(h)),{},{children:e=>{let{TransitionProps:r}=e;return(0,Ue.jsx)(Pt.Z,PwBoardsPicker_objectSpread(PwBoardsPicker_objectSpread({},r),{},{timeout:250,children:(0,Ue.jsxs)(p.Nk,{sx:PwBoardsPicker_objectSpread(PwBoardsPicker_objectSpread({paddingTop:0,borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.25)",maxHeight:"min(100vh - 64px, 512px)",overflow:"auto",overflowX:"hidden"},(0,p.yR)()),{},{hr:{borderColor:"#f0f0f0"}}),children:[(0,Ue.jsx)(p.Vf,{InputProps:{startAdornment:(0,Ue.jsx)(Mt.Z,{position:"start",children:(0,Ue.jsx)(p.WX,{component:$t.r,inheritViewBox:!0,sx:{width:"16px",height:"16px"}})})},hiddenLabel:!0,placeholder:C("MENU.BOARD_SEARCH_PLACEHOLDER"),size:"small",sx:{minWidth:"100%",[`& .${Bt.Z.root}`]:{height:"40px",fontSize:"13px",lineHeight:1,color:"text.secondary",backgroundColor:"transparent",paddingLeft:"14px",border:"none","&:after, &:before, &:hover:before":{border:"none"},[`& .${Bt.Z.input}`]:{boxShadow:"none",padding:"8.5px 14px 8.5px 0px","&:hover":{backgroundColor:"transparent",boxShadow:"none"},"&:focus":{backgroundColor:"transparent",boxShadow:"none"}}}},value:u,variant:"standard",onChange:handleChange,onKeyDown:e=>e.stopPropagation()}),(0,Ue.jsx)(Pe.Z,{sx:{marginBottom:"8px"}}),(0,Ue.jsx)(p.w9,{dense:!0,sx:{width:"260px",height:"32px",paddingLeft:"8px",paddingRight:"8px",marginLeft:"8px",borderRadius:"3px"},children:(0,Ue.jsx)(p.BP,{componentsProps:{typography:{fontSize:"13px"}},control:(0,Ue.jsx)(p.GK,{checked:n===f,disableRipple:!0,indeterminate:n>0&&n!==f,sx:{fontSize:"20px",svg:{fill:"transparent"}},onClick:handleSelectAllClick}),label:C("MENU.SELECT_ALL"),sx:{height:"32px",minWidth:"100%",margin:0,".pwCheckbox":{padding:0,marginRight:"8px",marginLeft:"-4px"}}})}),(0,Ue.jsx)(Pe.Z,{sx:{marginBottom:"8px"}}),X()(t).call(t,((e,t,r)=>(0,Ue.jsxs)(p.EB,{children:[(0,Ue.jsx)(OrganizationComponent,{organization:e}),(0,Ue.jsx)(BoardsList,{boards:e.boards,searchString:u,selectedBoardIds:a,setSelectedBoardIds:handleSelectBoardIds}),t!==r.length-1&&(0,Ue.jsx)(Pe.Z,{})]},e.id)))]})}))}}))]}))})}));var Ut=r(99457);const Gt=["members","selectedMemberIds","setSelectedMemberIds","clearSelectedMemberIds","isMinimized"];function PwMembersPicker_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwMembersPicker_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwMembersPicker_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwMembersPicker_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const Vt=(0,a.Pi)((e=>{const{members:t,selectedMemberIds:r,setSelectedMemberIds:a,clearSelectedMemberIds:s,isMinimized:n}=e,o=(0,Ze.Z)(e,Gt),{services:{telemetrySrv:l}}=(0,i.useContext)(y),d=(0,bt.o_)({variant:"popper",popupId:"pwMembersPicker"}),[c,h]=(0,i.useState)(""),{t:u}=(0,Ae.$)(),m=(0,i.useMemo)((()=>{var e;let i=new(F())(X()(t).call(t,(e=>{let{id:t}=e;return t})));return G()(e=z()(r)).call(e,(e=>i.has(e))).length}),[t,r.size]),handleSelectAllClick=()=>{var e;switch(m===t.length?_.vV.Remove:_.vV.Add){case _.vV.Add:a(X()(t).call(t,(e=>e.id)),_.vV.Add);break;case _.vV.Remove:s()}l.logSessionEvent(v.cN.CalendarEvents.ReportsSelectedMembersChanged,{count:K()(e=z()(Z()(r).call(r))).call(e).length})},handleChange=e=>{h(e.target.value)};return(0,Ue.jsx)(Tt.d,{mouseEvent:"onMouseDown",touchEvent:"onTouchStart",onClickAway:()=>d.close(),children:(0,Ue.jsxs)(p.EB,PwMembersPicker_objectSpread(PwMembersPicker_objectSpread({},o),{},{children:[(0,Ue.jsx)(p.EB,{children:(0,Ue.jsx)(p.uE,PwMembersPicker_objectSpread(PwMembersPicker_objectSpread({color:m>0?"primary":"neutral",size:"small",startIcon:(0,Ue.jsx)(p.WX,{component:Ut.r,inheritViewBox:!0,sx:{width:"16px",height:"16px"}}),sx:{minWidth:"auto",fontSize:"13px",fontWeight:"400",whiteSpace:"noWrap",path:{fill:"currentColor"},".MuiButton-startIcon":{marginTop:"-2px",marginLeft:"2px",marginRight:n?"2px":"8px"}}},(0,bt.LI)(d)),{},{children:n?null:m>0?`${u("BUTTONS.MEMBERS")} (${m})`:u("BUTTONS.MEMBERS")}))}),(0,Ue.jsx)(xt.Z,PwMembersPicker_objectSpread(PwMembersPicker_objectSpread({placement:"bottom",sx:{zIndex:1},transition:!0},(0,bt.Rg)(d)),{},{children:e=>{var i;let{TransitionProps:s}=e;return(0,Ue.jsx)(Pt.Z,PwMembersPicker_objectSpread(PwMembersPicker_objectSpread({},s),{},{timeout:250,children:(0,Ue.jsxs)(p.Nk,{sx:PwMembersPicker_objectSpread({paddingTop:0,borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.25)",maxHeight:"min(100vh - 64px, 512px)",overflow:"auto",overflowX:"hidden"},(0,p.yR)()),children:[(0,Ue.jsx)(p.Vf,{InputProps:{startAdornment:(0,Ue.jsx)(Mt.Z,{position:"start",children:(0,Ue.jsx)(p.WX,{component:$t.r,inheritViewBox:!0,sx:{width:"16px",height:"16px"}})})},hiddenLabel:!0,placeholder:u("MENU.MEMBER_SEARCH_PLACEHOLDER"),size:"small",sx:{minWidth:"100%",[`& .${Bt.Z.root}`]:{height:"40px",fontSize:"13px",lineHeight:1,color:"text.secondary",backgroundColor:"transparent",paddingLeft:"14px",border:"none","&:after, &:before, &:hover:before":{border:"none"},[`& .${Bt.Z.input}`]:{boxShadow:"none",padding:"8.5px 14px 8.5px 0px","&:hover":{backgroundColor:"transparent",boxShadow:"none"},"&:focus":{backgroundColor:"transparent",boxShadow:"none"}}}},value:c,variant:"standard",onChange:handleChange,onKeyDown:e=>e.stopPropagation()}),(0,Ue.jsx)(Pe.Z,{sx:{marginBottom:"8px"}}),(0,Ue.jsx)(p.w9,{dense:!0,sx:{width:"260px",height:"32px",paddingLeft:"8px",paddingRight:"8px",marginLeft:"8px",borderRadius:"3px"},children:(0,Ue.jsx)(p.BP,{componentsProps:{typography:{fontSize:"13px"}},control:(0,Ue.jsx)(p.GK,{checked:m===t.length,disableRipple:!0,indeterminate:m>0&&m!==t.length,sx:{fontSize:"20px",svg:{fill:"transparent"}},onClick:handleSelectAllClick}),label:u("MENU.SELECT_ALL"),sx:{height:"32px",minWidth:"100%",margin:0,".pwCheckbox":{padding:0,marginRight:"8px",marginLeft:"-4px"}}})}),(0,Ue.jsx)(Pe.Z,{sx:{marginBottom:"8px"}}),X()(i=G()(t).call(t,(e=>{var t;let{fullName:r}=e;return!c||tt()(t=r.toLowerCase()).call(t,c.toLowerCase())}))).call(i,(e=>(0,Ue.jsxs)(p.w9,{dense:!0,sx:{width:"260px",paddingLeft:"8px",paddingRight:"8px",marginLeft:"8px",borderRadius:"3px"},onClick:()=>(e=>{var t;a([e.id],r.has(e.id)?_.vV.Remove:_.vV.Add),l.logSessionEvent(v.cN.CalendarEvents.ReportsSelectedMembersChanged,{count:K()(t=z()(Z()(r).call(r))).call(t).length})})(e),children:[(0,Ue.jsx)(p.zW,{alt:e.fullName,src:e.avatarUrlSmall,sx:{width:"16px",height:"16px",marginRight:"12px"},variant:"circular"}),(0,Ue.jsx)(p.wW,{sx:{"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"noWrap"}},children:e.fullName}),r.has(e.id)&&(0,Ue.jsx)(p.WX,{component:Nt.r,inheritViewBox:!0,sx:{width:"16px",height:"16px",marginLeft:"auto"}})]},e.id)))]})}))}}))]}))})})),Kt=["open","selectedItem"];function PwReportsModePicker_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwReportsModePicker_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwReportsModePicker_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwReportsModePicker_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const Ht={[_.Hm.TrackedTime]:"MENU.REPORTS_MODE_TRACKED_TIME",[_.Hm.TrackedVsEstimated]:"MENU.REPORTS_MODE_TRACKED_VERSUS_ESTIMATED"},Zt=(0,a.Pi)((e=>{var t;const{open:r,selectedItem:i}=e,a=(0,Ze.Z)(e,Kt);return(0,Ue.jsxs)(p.uE,PwReportsModePicker_objectSpread(PwReportsModePicker_objectSpread({color:"neutral",size:"small",variant:"outlined"},a),{},{children:[null!==(t=null==i?void 0:i.text)&&void 0!==t?t:"",(0,Ue.jsx)(p.WX,{component:nt.r,inheritViewBox:!0,sx:{marginLeft:"6px",marginRight:"-2px",fontSize:16,color:"#8b8e93",transition:"transform 0.25s",transform:`rotate(${r?0:180}deg)`}})]}))})),Wt=(0,a.Pi)((()=>{const{selectedMode:e,setSelectedMode:t}=(0,i.useContext)(g),{t:r}=(0,Ae.$)(),a=(0,bt.o_)({variant:"popper",popupId:"pwReportsModePicker"}),s=[{text:r(Ht[_.Hm.TrackedTime]),value:_.Hm.TrackedTime},{text:r(Ht[_.Hm.TrackedVsEstimated]),value:_.Hm.TrackedVsEstimated}],n=(0,i.useMemo)((()=>Y()(s).call(s,(t=>{let{value:r}=t;return r===e}))),[e]),handleMenuClose=()=>{a.close()};return(0,Ue.jsx)(Tt.d,{mouseEvent:"onMouseDown",onClickAway:handleMenuClose,children:(0,Ue.jsxs)(l.Z,{children:[(0,Ue.jsx)(Zt,PwReportsModePicker_objectSpread(PwReportsModePicker_objectSpread({},(0,bt.LI)(a)),{},{selectedItem:n,sx:{fontSize:"13px",fontWeight:400,lineHeight:"22px",color:"text.secondary",whiteSpace:"noWrap"}})),(0,Ue.jsx)(p.AL,{open:a.isOpen,popperProps:PwReportsModePicker_objectSpread({},(0,bt.Rg)(a)),children:(0,Ue.jsx)(p.Nk,{sx:(0,c.Z)({maxHeight:"200px",borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.25)",overflow:"auto"},(0,p.yR)()),children:X()(s).call(s,(e=>(0,Ue.jsx)(p.w9,{selected:n.value===e.value,onClick:()=>(e=>{e&&t(e.value),handleMenuClose()})(e),children:e.text},e.value)))})})]})})}));var Yt=r(69397),qt=r(66489),Xt=r(2373),Qt=r(25881),Jt=r(6327);const PwBarChartExport=e=>{let{context:t,onRendered:r}=e;return(0,Ue.jsx)(g.Provider,{value:t,children:(0,Ue.jsx)(Ve,{printingMode:!0,sx:{width:"525px",height:"250px"},onRendered:r})})};var er=r(73445);function PwPieChart_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwPieChart_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwPieChart_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwPieChart_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const tr={[_.I4.Board]:"MISC.REPORTS_GROUP_BOARDS",[_.I4.List]:"MISC.REPORTS_GROUP_LISTS",[_.I4.Member]:"MISC.REPORTS_GROUP_MEMBERS",[_.I4.Task]:"MISC.REPORTS_GROUP_TASKS",[_.I4.None]:""},rr=(0,a.Pi)((e=>{const{width:t,height:r,groupBy:a,printingMode:s=!1,onRendered:n}=e,{pieChartData:o}=(0,i.useContext)(g),l=(0,Be.ze)({fontSize:s?9:12}),{data:d,total:c,colors:h}=(0,i.useMemo)((()=>o[a]),[a,o]);return(0,Ue.jsx)(er.by,{animate:!1,arcLinkLabel:e=>`${Math.round(e.value/c*100)}%`,arcLinkLabelsDiagonalLength:8,arcLinkLabelsOffset:0,arcLinkLabelsSkipAngle:4,arcLinkLabelsStraightLength:0,arcLinkLabelsTextOffset:0,arcLinkLabelsThickness:0,colors:e=>{let{id:t}=e;return"EMPTY_RECORD"===t?"transparent":h.get(t)},data:d,height:r,innerRadius:.65,layers:["arcs","arcLinkLabels",e=>(e=>{let{centerX:t,centerY:r,theme:i,groupBy:a}=e;const{t:s}=(0,Ae.$)();return(0,Ue.jsx)("text",{fontWeight:"bold",style:{fontSize:i.fontSize},textAnchor:"middle",x:t,y:r+4,children:s(tr[a])})})(PwPieChart_objectSpread(PwPieChart_objectSpread({},e),{},{theme:l,groupBy:a})),()=>(De()((()=>{var e;return null==n?void 0:n(X()(e=G()(d).call(d,(e=>e.value>0))).call(e,(e=>{var t;return{label:e.label,color:null!==(t=h.get(e.id))&&void 0!==t?t:"",value:e.value}})))}),50),null)],margin:{top:20,right:10,bottom:20,left:10},padAngle:1,theme:l,width:t})})),PwPieChartExport=e=>{let{context:t,groupBy:r,onRendered:i}=e;return(0,Ue.jsx)(g.Provider,{value:t,children:(0,Ue.jsx)(rr,{groupBy:r,height:172,printingMode:!0,width:186,onRendered:i})})};var ir=r(84105);function ExcelReportGenerator_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function ExcelReportGenerator_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=ExcelReportGenerator_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=ExcelReportGenerator_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}function getTime(e){if(!e)return;const t=e/60;return Math.round(100*t)/100}class ExcelReportGenerator{constructor(e){(0,B.Z)(this,"_outputFormat",void 0),this._outputFormat=e}groupTableDataByGrouping(e,t){var r,i,a,s;switch(t){case _.I4.Board:return[...Z()(r=(0,pe.YU)(e,(e=>e.board.title))).call(r)];case _.I4.Member:return[...Z()(i=(0,pe.YU)(e,(e=>e.user.id))).call(i)];case _.I4.Task:return[...Z()(a=(0,pe.YU)(e,(e=>e.taskTitle))).call(a)];case _.I4.List:return[...Z()(s=(0,pe.YU)(e,(e=>e.listTitle))).call(s)];case _.I4.None:return[e]}return[e]}createTrackedTimeReportAsync(e){let{table:t,firstLevelGrouping:r,secondLevelGrouping:i}=e;const{rows:a}=t.getCoreRowModel(),s=[],n=X()(a).call(a,(e=>e.original));for(const e of this.groupTableDataByGrouping(n,r)){const t=[];for(const r of this.groupTableDataByGrouping(e,i))t.push(...r);te()(t).call(t,((e,t)=>e.timeRecordStartDate<t.timeRecordStartDate?-1:e.timeRecordStartDate>t.timeRecordStartDate?1:0)),s.push(...t)}const o=X()(s).call(s,(e=>{var t;let a={};return E()(t=[r,i]).call(t,(t=>{var r;switch(t){case _.I4.Board:a=ExcelReportGenerator_objectSpread(ExcelReportGenerator_objectSpread({},a),{},{Board:e.board.title});break;case _.I4.Member:a=ExcelReportGenerator_objectSpread(ExcelReportGenerator_objectSpread({},a),{},{Members:null===(r=e.user)||void 0===r?void 0:r.fullName});break;case _.I4.Task:a=ExcelReportGenerator_objectSpread(ExcelReportGenerator_objectSpread({},a),{},{Card:e.taskTitle});break;case _.I4.List:a=ExcelReportGenerator_objectSpread(ExcelReportGenerator_objectSpread({},a),{},{List:e.listTitle});case _.I4.None:}})),ExcelReportGenerator_objectSpread(ExcelReportGenerator_objectSpread({},a),{},{Note:e.timeRecordTitle,StartDate:(0,he.tC)(e.timeRecordStartDate),StartTime:(0,he.U9)(e.timeRecordStartDate),EndDate:(0,he.tC)(e.timeRecordEndDate),EndTime:(0,he.U9)(e.timeRecordEndDate),TrackedTimeHours:getTime(e.trackedTime)})})),l=ir.P6.book_new(),d=ir.P6.json_to_sheet(o);return ir.P6.book_append_sheet(l,d,"Report Data"),(0,ir.cW)(l,{bookType:this._outputFormat,type:"array",cellDates:!0,FS:"\t"})}createTrackedVsEstimatedReportAsync(e){let{table:t}=e;const{rows:r}=t.getGroupedRowModel(),i=Xe()(r).call(r,((e,t)=>{const r=[...e];if(t.subRows.length){var i;const e=X()(i=t.subRows).call(i,(e=>{var t;const r=Xe()(t=e.subRows).call(t,((e,t)=>e+t.getValue("trackedTime")),0);return ExcelReportGenerator_objectSpread(ExcelReportGenerator_objectSpread({},e.original),{},{trackedTime:r})}));r.push(...e)}return r}),[]),a=X()(i).call(i,(e=>({Board:e.board.title,Card:e.taskTitle,EstimatedTimeHours:getTime(e.estimatedTime),TrackedTimeHours:getTime(e.trackedTime)}))),s=ir.P6.book_new(),n=ir.P6.json_to_sheet(a);return ir.P6.book_append_sheet(s,n,"Report Data"),(0,ir.cW)(s,{bookType:this._outputFormat,type:"array",cellDates:!0,FS:"\t"})}}var ar=r(59580),sr=r.n(ar),nr=r(8244),or=r.n(nr),lr=r(36727),dr=r.n(lr);const cr=["bold"];function PdfReportGenerator_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PdfReportGenerator_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PdfReportGenerator_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PdfReportGenerator_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const hr="#212121",ur="#9e9e9e",pr="#e53935",mr={[_.I4.Board]:"MISC.REPORTS_GROUPED_BY_BOARDS",[_.I4.List]:"MISC.REPORTS_GROUPED_BY_LISTS",[_.I4.Member]:"MISC.REPORTS_GROUPED_BY_MEMBERS",[_.I4.Task]:"MISC.REPORTS_GROUPED_BY_TASKS",[_.I4.None]:""},Cr={[_.I4.Board]:"MISC.REPORTS_GROUP_BOARDS",[_.I4.List]:"MISC.REPORTS_GROUP_LISTS",[_.I4.Member]:"MISC.REPORTS_GROUP_MEMBERS",[_.I4.Task]:"MISC.REPORTS_GROUP_TASKS",[_.I4.None]:""},vr={noBordersAndPaddings:{vLineColor:"#ffffff",hLineWidth:()=>0,vLineWidth:()=>0,paddingTop:()=>0,paddingBottom:()=>0,paddingLeft:()=>0,paddingRight:()=>0},noBorders:{vLineColor:"#ffffff",hLineWidth:()=>0,vLineWidth:()=>1,paddingTop:()=>0,paddingBottom:e=>0===e?4:0,paddingLeft:e=>0===e?8:2,paddingRight:(e,t)=>e===t.table.widths.length-1?8:2},firstLevelLayout:{hLineColor:"#eeeeee",vLineColor:"#eeeeee",fillColor:e=>0===e?"#eeeeee":"#ffffff",hLineWidth:(e,t)=>e===t.table.body.length?1:0,vLineWidth:()=>1,paddingTop:e=>0===e?8:0,paddingBottom:(e,t)=>0===e||e===t.table.body.length-1?8:0,paddingLeft:e=>0===e?8:2,paddingRight:(e,t)=>e===t.table.widths.length-1?8:2},secondLevelLayout:{hLineColor:"#eeeeee",vLineColor:"#eeeeee",hLineWidth:()=>0,vLineWidth:()=>0,paddingTop:()=>12,paddingBottom:()=>4,paddingLeft:e=>0===e?0:2,paddingRight:(e,t)=>e===t.table.widths.length-1?0:2},thirdLevelLayout:{hLineColor:"#eeeeee",vLineColor:"#eeeeee",hLineWidth:e=>e/2?1:0,vLineWidth:()=>0,paddingTop:()=>4,paddingBottom:()=>4,paddingLeft:e=>0===e?0:2,paddingRight:(e,t)=>e===t.table.widths.length-1?0:2}};function varianceSvg(e,t){const r=50,i=4,a=0,s=0,n=4,o=4,l="#e0e0e0",d="#2979ff",c="#ff9100",h=i/2,u=`path d="M${r-h} 0a${h} ${h},0,0,1,0 ${i}H${h}A${h} ${h},0,0,1,${h} 0Z"`,progress=(e,t,a)=>`<rect width="${r}" height="${i}" fill="${t}"/><rect width="${Math.round(r*e)}" height="${i}" fill="${a}"/>`;let p;return p=t?e?e>t?`<clipPath id="c"><${u}/></clipPath><g clip-path="url(#c)">${progress(t/e,c,d)}</g>`:e<t?`<clipPath id="c"><${u}/></clipPath><g clip-path="url(#c)">${progress(e/t,l,d)}</g>`:`<${u} stroke="none" fill="${d}"/>`:`<${u} stroke="none" fill="${l}"/>`:`<${u} stroke="none" fill="${c}"/>`,`<svg viewBox="${-a} ${-n} ${r+a+s} ${i+n+o}">${p}</svg>`}async function getSvgContentAsync(e){let t;try{const r=await fetch(e);t=await r.text()}catch(e){}return t}class PdfReportGenerator{constructor(e,t){(0,B.Z)(this,"_dateRange",void 0),(0,B.Z)(this,"_translate",void 0),(0,B.Z)(this,"_matches",void 0),(0,B.Z)(this,"_fonts",new(F())(["NotoSans.ttf"])),this._dateRange=e,this._translate=t}async loadFontsAsync(){const e=await async function getJsonContentAsync(e){let t;try{const r=await fetch(e);t=await r.json()}catch(e){}return t}("https://files.planyway.com/common/fonts/table.json");e&&(this._matches=function buildMatches(e){return X()(e).call(e,(e=>{const t={font:e.font,chars:new(F())};for(const r of e.chars)if(oe()(r))for(let e=r[0];e<=r[1];e++)t.chars.add(e);else t.chars.add(r);return t}))}(e))}buildTextNode(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{bold:i}=r,a=(0,Ze.Z)(r,cr);if(this._matches){const r=function splitText(e,t){const r=[];let i,a={start:0,end:0},s=0;for(const l of e){var n;const e=sr()(l).call(l,0)||0,d=e<65536?1:2;var o;null!==(n=i)&&void 0!==n&&n.chars.has(e)?a.end=s+d:(i=Y()(t).call(t,(t=>t.chars.has(e))),i||!a||a.font?(a={font:null===(o=i)||void 0===o?void 0:o.font,start:s,end:s+d},r.push(a)):a.end=s+d),s+=d}return X()(r).call(r,(t=>({font:t.font,text:Je()(e).call(e,t.start,t.end)})))}(e,this._matches);t={text:X()(r).call(r,(e=>{let{font:t,text:r}=e;return t?(this._fonts.add(t),{text:r,bold:i,font:t}):{text:r,bold:i}}))}}else t={text:e,bold:i};return PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},t),a)}getMaxDepth(e){return Xe()(e).call(e,((e,t)=>{var r;return Math.max(e,null!==(r=t.subRows)&&void 0!==r&&r.length?this.getMaxDepth(t.subRows)+1:0)}),0)}getSumTimeString(e){return PwTable_getReportsTimeString(Xe()(e).call(e,((e,t)=>e+t.getValue("trackedTime")),0))}getDocumentDefinition(){return{pageSize:"A4",pageOrientation:"portrait",defaultStyle:{font:"NotoSans.ttf"},pageMargins:[40,70,40,70],content:[],styles:{footer:{color:"#666666",fontSize:8,marginTop:40},header:{color:hr,fontSize:16,marginTop:34}},footer:(e,t)=>({columns:[{style:"footer",marginLeft:40,text:e===t?this.buildTextNode(this._translate("MISC.REPORTS_COPYRIGHT")):""},{style:"footer",marginRight:40,text:this.buildTextNode(this._translate("MISC.REPORTS_PAGE",{currentPage:e,pageCount:t})),alignment:"right"}]})}}getFontsList(){const e={};for(const t of this._fonts)e[t]={normal:`https://files.planyway.com/common/fonts/Regular-${t}`,bold:`https://files.planyway.com/common/fonts/Bold-${t}`};return e}getTable(e){let t;switch(e){case 0:t="firstLevelLayout";break;case 1:t="secondLevelLayout";break;case 2:t="thirdLevelLayout";break;default:t="noBorders"}return{fontSize:9,marginBottom:0===e?16:0,marginLeft:2===e?16:0,layout:t,table:{widths:[],body:[]}}}async createTrackedTimeReportAsync(e){let{table:t,charts:r,firstLevelGrouping:i,secondLevelGrouping:a}=e;const{rows:s}=t.getGroupedRowModel();await this.loadFontsAsync();const n=await r.getChartsNodes(),trackedTimeTable=(e,t)=>PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},this.getTable(t)),{},{table:{widths:["*",100,44],body:e}}),getChartLegendRows=e=>X()(e).call(e,(e=>{let{label:t,value:r,color:i}=e;return[{marginBottom:8,columns:[{width:16,canvas:[{type:"rect",x:0,y:0,w:12,h:12,color:"white"},{type:"ellipse",x:5,y:6,color:i,r1:4,r2:4}]},this.buildTextNode(t,{width:"auto"})]},this.buildTextNode(PwTable_getReportsTimeString(r),{alignment:"right",bold:!0})]})),getChartContent=e=>{let{image:t,groupBy:r,chartLegend:i}=e;return i&&i.length>0?{layout:"noBordersAndPaddings",fontSize:9,marginBottom:30,table:{widths:["*",194],body:[[PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},t),{},{marginTop:-16}),{layout:"noBordersAndPaddings",fontSize:9,table:{widths:[150,44],body:[[this.buildTextNode(this._translate(Cr[r]),{bold:!0,color:ur,marginBottom:8}),this.buildTextNode(this._translate("MISC.TIME"),{alignment:"right",bold:!0,color:ur,marginBottom:8})],...getChartLegendRows(i)]}}]]}}:t?PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},t),{},{marginBottom:16}):""},trackedTimeRow=e=>{var t;const r=PwTable_getReportsTimeString(e.getValue("trackedTime"));switch(e.groupingColumnId){case"boardId":return[this.buildTextNode(e.original.board.title,{bold:!0}),"",this.buildTextNode(r,{alignment:"right",bold:!0})];case"userId":return[this.buildTextNode((null===(t=e.original.user)||void 0===t?void 0:t.fullName)||"",{bold:!0}),"",this.buildTextNode(r,{alignment:"right",bold:!0})];case"taskId":return[{columns:[this.buildTextNode(e.original.taskTitle,{bold:!0,marginRight:8,width:"auto"}),e.original.isTaskArchived?this.buildTextNode(this._translate("MISC.ARCHIVED"),{color:ur,marginRight:8}):""]},"",this.buildTextNode(r,{alignment:"right",bold:!0})];case"listId":return[this.buildTextNode(e.original.listTitle,{bold:!0}),"",this.buildTextNode(r,{alignment:"right",bold:!0})]}return[e.original.timeRecordTitle?this.buildTextNode(e.original.timeRecordTitle):this.buildTextNode(this._translate("MISC.REPORTS_NO_DESCRIPTION"),{color:ur}),this.buildTextNode(e.original.date||""),this.buildTextNode(r,{alignment:"right"})]},o=await getSvgContentAsync("https://files.planyway.com/common/planyway-logo-full.svg"),l=(e=>{const t=[],getSubRows=e=>{if(or()(e).call(e,(e=>!e.groupingColumnId))){var r;const i=X()(e).call(e,(e=>trackedTimeRow(e)));t.push({tableCells:i,depth:null===(r=e[0])||void 0===r?void 0:r.depth})}else E()(e).call(e,(e=>{const r=trackedTimeRow(e);t.push({tableCells:[r],depth:e.depth});const{subRows:i}=e;0!==i.length&&getSubRows(i)}))};return getSubRows(e),t})(s),d=Xe()(l).call(l,((e,t,r)=>{var i;let{tableCells:a,depth:n}=t;if(0===n)return[...e,trackedTimeTable(a,n)];const o=1===this.getMaxDepth(s)?2:n;let d=trackedTimeTable(a,o);if((!l[r+1]||0===l[r+1].depth)&&2===o){var c;const e=X()(c=a[a.length-1]).call(c,(e=>Object.prototype.hasOwnProperty.call(e,"text")?PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},e),{},{border:[!1,!1,!1,!1]}):{text:e,border:[!1,!1,!1,!1]}));a.pop(),d=trackedTimeTable([...a,e],o)}let h=0;return r-1>=0&&0===l[r-1].depth&&2===o&&(h=8),null===(i=e[e.length-1])||void 0===i||i.table.body.push([PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},d),{},{colSpan:e[e.length-1].table.widths.length,marginTop:h})]),e}),[]),c=trackedTimeTable([[this.buildTextNode(this._translate("MISC.TITLE"),{color:ur}),this.buildTextNode(this._translate("MISC.DATE"),{color:ur}),this.buildTextNode(this._translate("MISC.TIME"),{alignment:"right",color:ur})]]),h=X()(n).call(n,(e=>getChartContent(e))),[u,p]=this._dateRange,m=PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},this.getDocumentDefinition()),{},{content:[{fontSize:9,text:this.buildTextNode(u&&p?`${(0,pe.iS)(u,!0)} – ${(0,pe.iS)(p,!0)}`:""),marginBottom:8},{marginBottom:16,columns:[this.buildTextNode(this._translate(i===_.I4.Task?"MISC.REPORTS_GROUPED_BY_ONE_LEVEL":"MISC.REPORTS_GROUPED_BY_TWO_LEVELS",{firstLevelGrouping:this._translate(mr[i]),secondLevelGrouping:this._translate(mr[a])}),{color:hr,fontSize:9}),{text:[this.buildTextNode(this._translate("MISC.REPORTS_TOTAL_HOURS",{totalHours:this.getSumTimeString(s)}),{bold:!0})],fontSize:9,alignment:"right"}]},h,c,...d],header:e=>({columns:[1===e?this.buildTextNode(this._translate("MISC.REPORTS_MODE_TRACKED_TIME"),{bold:!0,marginLeft:40,style:"header"}):this.buildTextNode(this._translate(i===_.I4.Task?"MISC.REPORTS_GROUPED_BY_ONE_LEVEL":"MISC.REPORTS_GROUPED_BY_TWO_LEVELS",{firstLevelGrouping:this._translate(mr[i]),secondLevelGrouping:this._translate(mr[a])}),{fontSize:9,marginLeft:40,style:"header"}),{svg:o||"",fit:[80,18],marginTop:1===e?38:32,marginRight:20,alignment:"right"}]})});return new($())((e=>{dr().createPdf(m,vr,this.getFontsList()).getBuffer((t=>{e(t)}))}))}async createTrackedVsEstimatedReportAsync(e){let{table:t}=e;const{rows:r}=t.getGroupedRowModel();await this.loadFontsAsync();const trackedVsEstimatedTable=(e,t)=>PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},this.getTable(t)),{},{table:{widths:["*",60,60,50,36],body:e}}),trackedVsEstimatedRow=e=>{const t=e.getValue("trackedTime"),r=e.getValue("estimatedTime");let i;const a=t>r&&!!t&&!!r;i=t&&r?a?Math.round(100*(1-t/r)):Math.round(t/r*100):0;const s=t?PwTable_getReportsTimeString(t):"–",n=r?PwTable_getReportsTimeString(r):"–";switch(e.groupingColumnId){case"boardId":return[this.buildTextNode(e.original.board.title,{bold:!0}),this.buildTextNode(n,{bold:!0}),this.buildTextNode(s,{bold:!0}),{svg:varianceSvg(t,r)},this.buildTextNode(i?`${i}%`:"–",{alignment:"right",bold:!0,color:a?pr:hr})];case"taskId":return[this.buildTextNode(e.original.taskTitle,{bold:!0}),this.buildTextNode(n,{bold:!0}),this.buildTextNode(s,{bold:!0}),{svg:varianceSvg(t,r)},this.buildTextNode(i?`${i}%`:"–",{alignment:"right",bold:!0,color:a?pr:hr})]}return[e.original.timeRecordTitle?this.buildTextNode(e.original.timeRecordTitle):this.buildTextNode(this._translate("MISC.REPORTS_NO_DESCRIPTION"),{color:ur}),"–",this.buildTextNode(s),"",""]},i=await getSvgContentAsync("https://files.planyway.com/common/planyway-logo-full.svg"),a=(e=>{const t=[],getSubRows=e=>{if(or()(e).call(e,(e=>!e.groupingColumnId))){var r;const i=X()(r=G()(e).call(e,(e=>e.original.trackedTime))).call(r,(e=>trackedVsEstimatedRow(e)));i.length&&t.push({tableCells:i,depth:e[0].depth})}else E()(e).call(e,(e=>{const r=trackedVsEstimatedRow(e);t.push({tableCells:[r],depth:e.depth});const{subRows:i}=e;0!==i.length&&getSubRows(i)}))};return getSubRows(e),t})(r),s=Xe()(a).call(a,((e,t,r)=>{var i;let{tableCells:s,depth:n}=t;if(0===n)return[...e,trackedVsEstimatedTable(s,n)];let o=trackedVsEstimatedTable(s,n);if((!a[r+1]||0===a[r+1].depth)&&2===n){var l;const e=X()(l=s[s.length-1]).call(l,(e=>Object.prototype.hasOwnProperty.call(e,"text")?PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},e),{},{border:[!1,!1,!1,!1]}):{text:e,border:[!1,!1,!1,!1]}));s.pop(),o=trackedVsEstimatedTable([...s,e],n)}return null===(i=e[e.length-1])||void 0===i||i.table.body.push([PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},o),{},{colSpan:e[e.length-1].table.widths.length})]),e}),[]),n=trackedVsEstimatedTable([[this.buildTextNode(this._translate("MISC.TITLE"),{color:ur}),this.buildTextNode(this._translate("MISC.ESTIMATED"),{color:ur}),this.buildTextNode(this._translate("MISC.TRACKED"),{color:ur}),this.buildTextNode(this._translate("MISC.VARIANCE"),{color:ur}),""]]),o=PdfReportGenerator_objectSpread(PdfReportGenerator_objectSpread({},this.getDocumentDefinition()),{},{content:[this.buildTextNode(this._translate("MISC.ALL_TIME"),{color:hr,fontSize:9,marginBottom:16}),n,...s],header:e=>({columns:[1===e?this.buildTextNode(this._translate("MISC.REPORTS_MODE_TRACKED_VERSUS_ESTIMATED"),{bold:!0,marginLeft:40,style:"header"}):this.buildTextNode(this._translate("MISC.ALL_TIME"),{style:"header",fontSize:9,marginLeft:40}),{alignment:"right",fit:[80,18],marginRight:20,marginTop:1===e?38:32,svg:i||""}]})});return new($())((e=>{dr().createPdf(o,vr,this.getFontsList()).getBuffer((t=>{e(t)}))}))}}var fr=r(37139),yr=r(36559),gr=r(9295),_r=r(25468);const kr=["children","loading","loadingIndicator"];function PwExportReport_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=G()(i).call(i,(function(t){return w()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwExportReport_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?E()(r=PwExportReport_ownKeys(Object(a),!0)).call(r,(function(t){(0,B.Z)(e,t,a[t])})):L()?x()(e,L()(a)):E()(i=PwExportReport_ownKeys(Object(a))).call(i,(function(t){M()(e,t,w()(a,t))}))}return e}const br={[_.Hm.TrackedTime]:v.C2.TrackedTime,[_.Hm.TrackedVsEstimated]:v.C2.TrackedVsEstimated},ExportButton=e=>{let{children:t,loading:r,loadingIndicator:i}=e,a=(0,Ze.Z)(e,kr);return(0,Ue.jsx)(Yt.Z,PwExportReport_objectSpread(PwExportReport_objectSpread({color:"neutral",disabled:r,size:"small",variant:"text"},a),{},{children:r?(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)(qt.Z,{color:"inherit",size:18,sx:{marginRight:"6px"}}),i]}):(0,Ue.jsxs)(Ue.Fragment,{children:[(0,Ue.jsx)(Xt.Z,{component:gr.r,inheritViewBox:!0,sx:{marginLeft:"2px",marginRight:"6px",fontSize:16,color:"#8b8e93"}}),t]})}))},components_PwExportReport=()=>{const e=(0,i.useContext)(g),{selectedMode:t,tableData:r,firstLevelGrouping:a,secondLevelGrouping:s,selectedDateRange:n}=e,{services:{$log:o,notificationSrv:d}}=(0,i.useContext)(y),[h,u]=(0,i.useState)(!1),{t:m}=(0,Ae.$)(),{logSessionEvent:C}=(0,Jt.f)(),f=(0,Qt.E)(),k=(0,bt.o_)({variant:"popper",popupId:"pwExportReportMenu"}),{columns:b,columnsConfig:T}=(0,i.useMemo)((()=>({columns:getTableColumns(a,s,t),columnsConfig:getTableColumnsConfig(a,s,t)})),[a,s,t]),{grouping:S,columnVisibility:I}=T,w=(0,rt.b7)({data:r,columns:b,state:{grouping:S,columnVisibility:I},getCoreRowModel:(0,it.sC)(),getGroupedRowModel:(0,it.qe)()}),closeMenu=()=>{k.close()},createReportAsync=r=>{switch(t){case _.Hm.TrackedVsEstimated:return r.createTrackedVsEstimatedReportAsync({table:w});case _.Hm.TrackedTime:{const t={getChartsNodes:()=>((e,t)=>{const{firstLevelGrouping:r,secondLevelGrouping:i}=e,a=[new($())(((i,a)=>{const[s,n]=t((0,Ue.jsx)(PwBarChartExport,{context:e,onRendered:async e=>{var t;const o=null===(t=n.current)||void 0===t?void 0:t.getElementsByTagName("svg")[0];o?(i({image:{svg:o.outerHTML,height:e.isExpanded?289:250},groupBy:r,chartLegend:null}),s()):a()}}))})),new($())(((i,a)=>{const[s,n]=t((0,Ue.jsx)(PwPieChartExport,{context:e,groupBy:r,onRendered:async e=>{var t;const o=null===(t=n.current)||void 0===t?void 0:t.getElementsByTagName("svg")[0];if(o){if(0===e.length)return i({image:null,groupBy:r,chartLegend:null});i({image:{svg:o.outerHTML},groupBy:r,chartLegend:e}),s()}else a()}}))}))];return i!==_.I4.None&&a.push(new($())(((r,a)=>{const[s,n]=t((0,Ue.jsx)(PwPieChartExport,{context:e,groupBy:i,onRendered:e=>{var t;const o=null===(t=n.current)||void 0===t?void 0:t.getElementsByTagName("svg")[0];if(o){if(0===e.length)return r({image:null,groupBy:i,chartLegend:null});r({image:{svg:o.outerHTML},groupBy:i,chartLegend:e}),s()}else a()}}))}))),$().all(a)})(e,f)};return r.createTrackedTimeReportAsync({table:w,charts:t,firstLevelGrouping:a,secondLevelGrouping:s})}}return $().resolve(new ArrayBuffer(0))},getReportName=e=>{switch(t){case _.Hm.TrackedVsEstimated:return`Planyway-tracked-vs-estimated-report.${e}`;case _.Hm.TrackedTime:{const[t,r]=n;if(!t||!r)break;return`Planyway-tracked-time-report-${(0,pe.tC)(t)}-${(0,pe.tC)(r)}.${e}`}}return`Planyway-report.${e}`};return(0,Ue.jsx)(Tt.d,{mouseEvent:"onMouseDown",onClickAway:closeMenu,children:(0,Ue.jsxs)(l.Z,{children:[(0,Ue.jsx)(ExportButton,PwExportReport_objectSpread(PwExportReport_objectSpread({},(0,bt.LI)(k)),{},{loading:h,loadingIndicator:m("BUTTONS.EXPORTING"),sx:{fontSize:"13px",fontWeight:400,lineHeight:"22px",color:"text.secondary",whiteSpace:"noWrap",textTransform:"none",paddingRight:1},children:m("BUTTONS.EXPORT")})),(0,Ue.jsx)(p.AL,{open:k.isOpen,popperProps:PwExportReport_objectSpread({},(0,bt.Rg)(k)),children:(0,Ue.jsxs)(p.Nk,{sx:(0,c.Z)({maxHeight:"200px",borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.25)",overflow:"auto"},(0,p.yR)()),children:[(0,Ue.jsxs)(p.w9,{onClick:async()=>{closeMenu();try{u(!0);const e=getReportName("pdf"),r=await createReportAsync(new PdfReportGenerator(n,m));if(!r)return;C(v.cN.GeneralEvents.ReportBuilt,{type:br[t],fileType:v.qK.Pdf}),(0,pe.QJ)("application/octet-stream",new Blob([r],{type:"application/octet-stream"}),e)}catch(e){o.error("Export to PDF error:"),o.error(e),d.showNotification(m("NOTIFICATIONS.EXPORT_REPORT_ERROR"),v.k$.Error)}finally{u(!1)}},children:[(0,Ue.jsx)(Xt.Z,{component:_r.r,inheritViewBox:!0,sx:{marginRight:"8px",fontSize:16}}),m("BUTTONS.EXPORT_TO_PDF")]}),(0,Ue.jsxs)(p.w9,{onClick:async()=>{closeMenu();try{u(!0);const e="xlsx",r=getReportName(e),i=await createReportAsync(new ExcelReportGenerator(e));if(!i)return;C(v.cN.GeneralEvents.ReportBuilt,{type:br[t],fileType:v.qK.Excel}),(0,pe.QJ)("application/octet-stream",new Blob([i],{type:"application/octet-stream"}),r)}catch(e){o.error("Export to Excel error:"),o.error(e),d.showNotification(m("NOTIFICATIONS.EXPORT_REPORT_ERROR"),v.k$.Error)}finally{u(!1)}},children:[(0,Ue.jsx)(Xt.Z,{component:yr.r,inheritViewBox:!0,sx:{marginRight:"8px",fontSize:16}}),m("BUTTONS.EXPORT_TO_EXCEL")]}),(0,Ue.jsxs)(p.w9,{onClick:async()=>{closeMenu();try{u(!0);const e="csv",r=getReportName(e),i=await createReportAsync(new ExcelReportGenerator(e));if(!i)return;C(v.cN.GeneralEvents.ReportBuilt,{type:br[t],fileType:v.qK.Csv}),(0,pe.QJ)("text/csv",new Blob([i],{type:"text/csv"}),r)}catch(e){o.error("Export to CSV error:"),o.error(e),d.showNotification(m("NOTIFICATIONS.EXPORT_REPORT_ERROR"),v.k$.Error)}finally{u(!1)}},children:[(0,Ue.jsx)(Xt.Z,{component:fr.r,inheritViewBox:!0,sx:{marginRight:"8px",fontSize:16}}),m("BUTTONS.EXPORT_TO_CSV")]})]})})]})})},Tr=(0,a.Pi)((e=>{const{sx:t}=e,{allOrganizations:r,allBoards:a,allMembers:s,selectedBoardIds:n,setSelectedBoardIds:o,selectedBoardIdsCount:l,clearSelectedBoardIds:d,selectedMemberIds:h,setSelectedMemberIds:u,clearSelectedMemberIds:m,selectedDateRange:C,setSelectedDateRange:f,selectedMode:k}=(0,i.useContext)(g),{services:{$rootScope:b,appCommonSrv:T,telemetrySrv:S}}=(0,i.useContext)(y),{width:I,ref:w}=(0,Re.NB)({handleHeight:!1}),{minimizedElements:D}=(0,Et.Z)(I,w,"adaptiveOrder",{elementsGap:8}),E=T.getExpandedLayoutPanel()===v.sF.Scheduler,A=k===_.Hm.TrackedVsEstimated?[null,null]:C,L={display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px"};return(0,Ue.jsxs)(p.EB,{ref:w,sx:(0,c.Z)(L,t),children:[(0,Ue.jsx)(At.F,{disabled:k===_.Hm.TrackedVsEstimated,isMinimized:D.has("adaptiveOrder_1"),value:A,onChange:f}),(0,Ue.jsxs)(p.EB,{sx:{display:"flex",flexWrap:"noWrap",gap:"8px",marginLeft:"auto"},children:[(0,Ue.jsx)(zt,{boards:a,clearSelectedBoardIds:d,organizations:r,selectedBoardIds:n,selectedBoardIdsCount:l,setSelectedBoardIds:o}),(0,Ue.jsx)(Vt,{clearSelectedMemberIds:m,members:s,selectedMemberIds:h,setSelectedMemberIds:u})]}),(0,Ue.jsx)(components_PwExportReport,{}),(0,Ue.jsx)(Wt,{}),(0,Ue.jsx)(p.qS,{size:"small",sx:{color:"grey.500"},onClick:()=>{E?(T.setExpandedLayoutPanel(null),S.logSessionEvent(v.cN.CalendarEvents.LayoutPanelCollapsed,{collapsedLayoutPanel:v.sF.Scheduler,by:v.UR.ToolbarButton})):(T.setExpandedLayoutPanel(v.sF.Scheduler),S.logSessionEvent(v.cN.CalendarEvents.LayoutPanelExpanded,{collapsedLayoutPanel:v.sF.Scheduler,by:v.UR.ToolbarButton})),b.$apply()},children:(0,Ue.jsx)(p.WX,{component:E?Rt.r:Lt.r,inheritViewBox:!0,sx:{width:"16px",height:"16px",path:{fill:"currentColor"}}})})]})})),TimeTrackingTabLinkComponent=e=>{let{onClick:t}=e;return(0,Ue.jsx)(n.Z,{sx:{lineHeight:"1.42",whiteSpace:"nowrap",cursor:"pointer",transition:"color 0.25s","&:not(:last-child)":{marginRight:"16px"},"&.disabled":{color:"text.disabled",pointerEvents:"none"}},underline:"none",onClick:t})},TableEmptyState=e=>(0,Ue.jsxs)(p.EB,{sx:(0,c.Z)({display:"flex",flexDirection:"column",alignItems:"center",marginTop:"60px"},e.sx),children:[(0,Ue.jsx)(p.WX,{component:f.r,inheritViewBox:!0,sx:{height:"100px",width:"100px",marginBottom:"32px"}}),(0,Ue.jsx)(p.zM,{sx:{marginBottom:"16px"},variant:"h5",children:(0,Ue.jsx)(s.c,{i18nKey:"MISC.REPORTS_NO_TIME_TRACKED_TITLE"})}),(0,Ue.jsx)(p.zM,{sx:{width:"280px",textAlign:"center"},variant:"body2",children:(0,Ue.jsx)(s.c,{components:{TimeTrackingTabLinkComponent:TimeTrackingTabLinkComponent({onClick:e.onLinkClick})},i18nKey:"MISC.REPORTS_NO_TIME_TRACKED_DESCRIPTION"})})]});function PwReportsView(e){const{$log:t,$rootScope:r,appCommonSrv:a,collectionSrv:s,notificationSrv:n,planywayIntegrationSrv:f,settingsSrv:k,telemetrySrv:b,trelloCardsSrv:T,trelloIntegrationSrv:S}=e,{dateFnsLocale:I,muiPickersLocaleText:w}=(0,m.bU)(),[D,E]=(0,i.useState)(!1),A=k.collection.global,L=(0,C.VH)(v.lP.Trello),{current:R}=(0,i.useRef)(new ReportsStore(a,f,k,b,T,S,L));(0,i.useEffect)((()=>{const e=new AbortController,{signal:r}=e;return(async()=>{try{E(!0),await R.fetchDataAsync(r)}catch(e){const{message:r,method:i,error:a}=e;if(!a)throw e;t.error(`${r}:`),t.error(a),b.logError(r,a,{class:PwReportsView.name,method:i})}finally{E(!1)}})(),()=>e.abort()}),[R.selectedBoardIdsCount,R.selectedBoardIds]);const x=R.selectedMode===_.Hm.TrackedTime,P={display:"flex",flexDirection:"column",flexGrow:1,padding:"0 16px 16px 16px",opacity:D?.6:1,overflow:"auto"};return(0,Ue.jsx)(o.Z,{theme:p.rS,children:(0,Ue.jsx)(h._,{adapterLocale:I,dateAdapter:u.H,localeText:w,children:(0,Ue.jsx)(y.Provider,{value:{services:{$log:t,$rootScope:r,appCommonSrv:a,collectionSrv:s,notificationSrv:n,planywayIntegrationSrv:f,settingsSrv:k,telemetrySrv:b,trelloCardsSrv:T,trelloIntegrationSrv:S},providers:{trelloProvider:(0,C.VH)(v.lP.Trello)},locals:{isViewBusy:D,currentLocale:a.getLocale(),firstWeekDay:k.user.global.settings.firstWeekDay}},children:(0,Ue.jsxs)(g.Provider,{value:R,children:[(0,Ue.jsx)(Tr,{sx:{borderBottom:`1px solid ${d.Z[200]}`}}),(0,Ue.jsxs)(p.EB,{sx:(0,c.Z)(P,(0,p.yR)()),children:[x&&(0,Ue.jsx)(Ve,{sx:{width:"100%",height:"500px",[p.rS.breakpoints.down("xl")]:{height:"300px"}}}),x&&0!==R.tableData.length&&(0,Ue.jsx)(Dt,{}),D?(0,Ue.jsx)(l.Z,{sx:{marginTop:(x?50:16)+"px"},children:(0,Ue.jsx)(He,{})}):0===R.tableData.length?(0,Ue.jsx)(TableEmptyState,{sx:{transform:`translateY(${x?0:50}%)`},onLinkClick:()=>{return e=v.ud.TimeTracking,A.settings.schedulerMode=e,r.$broadcast(v.FK.ChangeSchedulerViewRequested,{forceUpdate:!0}),A.saveAsync(),void b.logSessionEvent(v.cN.CalendarEvents.Opened);var e}}):(0,Ue.jsx)(kt,{sx:{minHeight:"300px"}})]})]})})})})}PwReportsView.componentName="pwReportsView",PwReportsView.componentInjections=["$log","$rootScope","appCommonSrv","collectionSrv","trelloCardsSrv","notificationSrv","planywayIntegrationSrv","telemetrySrv","trelloIntegrationSrv","settingsSrv"];const Sr=(0,a.Pi)(PwReportsView)},89095:(e,t,r)=>{r.d(t,{Hm:()=>i,I4:()=>a,v4:()=>s,vV:()=>n,xZ:()=>o});let i=function(e){return e.TrackedTime="TrackedTime",e.TrackedVsEstimated="TrackedVsEstimated",e}({}),a=function(e){return e.Member="Member",e.Board="Board",e.List="List",e.Task="Task",e.None="None",e}({});a.Board,a.Task;const s={[a.Board]:[a.Member,a.List,a.Task],[a.Member]:[a.Board,a.Task],[a.Task]:[a.None]};let n=function(e){return e.Add="ADD",e.Remove="REMOVE",e.Clear="CLEAR",e}({});const o={[a.Board]:"MENU.REPORTS_GROUP_BY_BOARD",[a.Member]:"MENU.REPORTS_GROUP_BY_MEMBER",[a.List]:"MENU.REPORTS_GROUP_BY_LIST",[a.Task]:"MENU.REPORTS_GROUP_BY_TASK",[a.None]:"MENU.REPORTS_GROUP_BY_NONE"}},38450:(e,t,r)=>{r.d(t,{Z:()=>Ve});var i=r(62079),a=r.n(i),s=r(52020),n=r.n(s),o=r(88546),l=r.n(o),d=r(99595),c=r.n(d),h=r(66775),u=r.n(h),p=r(2201),m=r.n(p),C=r(57445),v=r.n(C),f=r(26171),y=r(54847),g=r.n(y),_=r(87994),k=r.n(_),b=r(73324),T=r.n(b),S=r(88946),I=r.n(S),w=r(76555),D=r.n(w),E=r(86981),A=r.n(E),L=r(23513),R=r.n(L),x=r(67294),P=r(53886),M=r(67558),B=r(99612),O=r(52329),$=r(22233),N=r(67720),F=r(35097),j=r(50720),z=r(13184),U=r(18717),G=r(51820),V=r(40405),K=r.n(V),H=r(82617),Z=r(99246),W=r(36338),Y=r(76205),q=r(70404),X=r(56777),Q=r(8937),J=r(29704),ee=r(41266),te=r(85893);const re=["icon","color","onClick","buttonText","tooltipText","isMinimized"];function ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=T()(i).call(i,(function(t){return l()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?c()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,f.Z)(e,t,a[t])})):u()?m()(e,u()(a)):c()(i=ownKeys(Object(a))).call(i,(function(t){v()(e,t,l()(a,t))}))}return e}const PwCreateButton=e=>{const{icon:t,color:r,onClick:i,buttonText:a,tooltipText:s,isMinimized:n}=e,o=(0,ee.Z)(e,re),l=n?"30px":"auto";return(0,te.jsx)(Z.jz,{enterDelay:250,title:s,children:(0,te.jsxs)(Z.uE,_objectSpread(_objectSpread({},o),{},{color:r,size:"small",sx:{minWidth:l,width:l,minHeight:"30px",borderRadius:n?"50%":"4px",backgroundColor:`${r}.main`},variant:"contained",onClick:i,children:[(0,te.jsx)(Z.WX,{component:t,fontSize:"small",inheritViewBox:!0,sx:{fill:"transparent",marginRight:n?0:"8px"}}),(0,te.jsx)(Z.zM,{sx:{display:n?"none":"inline-block",color:"primary.contrastText",lineHeight:"1"},variant:"body4",children:a})]}))})};var ie=r(56242),ae=r(88868),se=r(58545),ne=r(59708),oe=r(71508),le=r(25510),de=r(5204);const PwTimePickers=e=>{let{duration:t,startTime:r,endTime:i,onTimeChanged:a}=e;const s={start:(0,le.$Y)(r),end:(0,le.h3)(r)},n={start:r,end:(0,se.Z)(r,1439)};return(0,te.jsxs)(ne.Z,{direction:"row",gap:.5,children:[(0,te.jsx)(de.p,{maxTime:s.end,minTime:s.start,time:r,timeFieldSize:"small",timeFieldVariant:"filled",onChange:e=>a([e,(0,G.Z)(e,t)])}),(0,te.jsx)(oe.Z,{sx:{paddingTop:1},children:" – "}),(0,te.jsx)(de.p,{maxTime:n.end,minTime:n.start,showDuration:!0,time:i,timeFieldSize:"small",timeFieldVariant:"filled",onChange:e=>a([r,e])})]})};var ce=r(10349),he=r.n(ce),ue=r(91829),pe=r.n(ue),me=r(9938),Ce=r.n(me),ve=r(91055),fe=r(55827),ye=r(23926),ge=r(60265),_e=r(59905),ke=r(2101),be=r(59766),Te=r(82607),Se=r(7277);function PwChooseCardDropdown_ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=T()(i).call(i,(function(t){return l()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwChooseCardDropdown_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?c()(r=PwChooseCardDropdown_ownKeys(Object(a),!0)).call(r,(function(t){(0,f.Z)(e,t,a[t])})):u()?m()(e,u()(a)):c()(i=PwChooseCardDropdown_ownKeys(Object(a))).call(i,(function(t){v()(e,t,l()(a,t))}))}return e}const Ie=(0,x.forwardRef)((function ButtonComponent(e,t){var r,i,s,n,o;const{getTrelloBoard:l,isSelectedCardInvalid:d,onSelectedCardChange:c,placeholder:h,selectedCard:u,setCardSearchString:p,openMenu:m}=e,[C,v]=(0,x.useState)(""),[f,y]=(0,x.useState)(!1),g=l(null!==(r=null==u?void 0:u.accountId)&&void 0!==r?r:"",null!==(i=null==u?void 0:u.providerCard.boardId)&&void 0!==i?i:""),_=Z.rS.palette.trelloBoards[null!==(s=A()(n=he()(a()(Z.rS.palette.trelloBoards))).call(n,(e=>e===(null==g?void 0:g.color))))&&void 0!==s?s:"default"].base;(0,x.useEffect)((()=>{var e;v(null!==(e=null==u?void 0:u.title)&&void 0!==e?e:""),null==p||p(""),y(!1)}),[u]);const k={maxWidth:"100%",width:"100%",marginTop:"-1px",[`.${fe.Z.root}`]:{height:"30px",color:"#20263a",fontSize:"13px",border:"none",transition:"color 0.25s","&:after, &:before, &:hover:before":{display:"none"},[`&.${fe.Z.error}`]:{[`.${fe.Z.input}`]:{"&::placeholder":{color:ge.Z[400]}}}},[`.${fe.Z.input}`]:{padding:0,textOverflow:"ellipsis","&::placeholder":{fontWeight:400,fontSize:"13px",lineHeight:"1",letterSpacing:"0.1px",color:"currentColor",opacity:1,transition:"color 0.25s"},"&:hover":{backgroundColor:"transparent",boxShadow:"none","&::placeholder":{color:"text.secondary"}},"&:focus":{backgroundColor:"transparent",boxShadow:"none","&::placeholder":{color:"text.secondary"}}}};return(0,te.jsxs)(Z.EB,{ref:t,sx:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",width:"100%"},onClick:m,children:[(0,te.jsx)(Z.WX,{component:Se.r,fontSize:"small",inheritViewBox:!0,sx:{width:"16px",height:"16px",marginRight:"8px",path:{fill:d?ge.Z[400]:"text.secondary"},cursor:"pointer"}}),(f||!u)&&(0,te.jsx)(Z.Vf,{autoFocus:f,error:d,hiddenLabel:!0,inputProps:{autoComplete:"off"},placeholder:h,size:"small",sx:k,value:C,variant:"standard",onBlur:()=>{!C&&u&&c(null),y(!1)},onChange:e=>{const t=e.target.value;v(t),p(t.toLowerCase())},onFocus:()=>{m(),y(!0)}}),!f&&u&&(0,te.jsxs)(Z.EB,{sx:{display:"block",overflow:"hidden",textOverflow:"ellipsis"},onClick:()=>y(!0),children:[(0,te.jsx)(Z.zM,{sx:{display:"inline",fontWeight:"400"},variant:"body4",children:null!==(o=null==u?void 0:u.title)&&void 0!==o?o:""}),(0,te.jsx)(Z.zM,{sx:{display:"inline-block",margin:"0 8px",lineHeight:1,fontSize:"15px",color:_},children:"•"}),(0,te.jsx)(Z.zM,{sx:{display:"inline",lineHeight:1,color:_},variant:"body4",children:l(u.accountId,u.providerCard.boardId).name})]})]})})),we=(0,x.memo)((0,x.forwardRef)((function ListItem(e,t){var r,i;const{card:s,getTrelloBoard:n,isSelected:o,listItemComponentProps:l,onItemClick:d}=e,c=n(s.accountId,s.providerCard.boardId),h=Z.rS.palette.trelloBoards[null!==(r=A()(i=he()(a()(Z.rS.palette.trelloBoards))).call(i,(e=>e===(null==c?void 0:c.color))))&&void 0!==r?r:"default"].base;return(0,x.createElement)(Z.w9,PwChooseCardDropdown_objectSpread(PwChooseCardDropdown_objectSpread({},l),{},{key:s.id,ref:t,selected:o,sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"8px 16px",fontSize:"13px",cursor:"pointer",overflow:"hidden","&:hover":{backgroundColor:"action.hover"}},onClick:()=>d(s)}),(0,te.jsx)(Z.zM,{sx:{pointerEvents:"none"},variant:"body2",children:s.title}),(0,te.jsx)(Z.zM,{sx:{color:h,pointerEvents:"none"},variant:"body2",children:c.name}))}))),De=(0,x.memo)((0,x.forwardRef)((function ListComponentProps(e,t){const{cards:r,getTrelloBoard:i,selectedCard:a,onItemClick:s,sx:n,listItemComponentProps:o,onActionButtonClick:l,isActionButtonDisabled:d}=e,{t:c}=(0,M.$)();return(0,te.jsxs)(Z.EB,{sx:{width:"364px",maxHeight:"404px",backgroundColor:"background.default",borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.25)",overflow:"hidden"},children:[(0,te.jsx)(Z.Nk,{autoFocusItem:!0,variant:"selectedMenu",ref:t,sx:n,children:r.length>0?I()(r).call(r,(e=>(0,te.jsx)(we,{card:e,getTrelloBoard:i,isSelected:e.id===(null==a?void 0:a.id),listItemComponentProps:o,onItemClick:s},e.id))):(0,te.jsx)(Z.zM,{sx:{textAlign:"center",margin:"8px 0"},variant:"body2",children:c("MISC.NO_CARDS_FOUND")})}),(0,te.jsx)(N.Z,{light:!0}),(0,te.jsx)(Z.LC,{disabled:d,sx:{alignItems:"center",justifyContent:"center",margin:"8px",borderRadius:"3px","&:hover":{backgroundColor:(0,ke.Fq)(Z.rS.palette.primary.light,Z.rS.palette.action.hoverOpacity)}},onClick:l,children:(0,te.jsx)(Z.zM,{sx:{color:"primary.main"},variant:"body4",children:(0,te.jsxs)(Z.EB,{sx:{display:"flex"},children:[(0,te.jsx)(Z.WX,{component:Te.r,inheritViewBox:!0,sx:{width:"16px",height:"16px",marginRight:"6px",color:"primary.main",path:{fill:"currentColor"}}}),c("BUTTONS.CREATE_CARD")]})})})]})}))),Ee=(0,x.memo)((function PwChooseCardDropdown(e){const{cards:t,getTrelloBoard:r,isActionButtonDisabled:i,onActionButtonClick:a,placeholder:s,selectedCard:n,setSelectedCard:o,shouldValidateSelectedCard:l}=e,d=(0,_e.o_)({variant:"popper",popupId:"pwDurationPicker"}),c=(0,x.useRef)(null),h=(0,x.useRef)(null);(0,x.useEffect)((()=>{d.setAnchorEl(c.current)}),[c]);const u=(0,x.useMemo)((()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.getBoundingClientRect().width}),[c]),[p,m]=(0,x.useState)(!1),[C,v]=(0,x.useState)(""),f=(0,x.useMemo)((()=>C?T()(t).call(t,(e=>{var t;if(pe()(t=e.title.toLowerCase()).call(t,C))return!0})):t),[C,t.length]),y=(0,x.useMemo)((()=>({getTrelloBoard:r,itemSearchString:C,placeholder:s,setItemSearchString:v})),[C,v,r]),g=(0,x.useCallback)((e=>{o(e),handleMenuClose()}),[o]),handleMenuClose=()=>{d.close()},handleMenuOpen=()=>{d.open()};return(0,x.useEffect)((()=>{m(l&&!n)}),[l,n]),(0,x.useEffect)((()=>{p&&Ce()(handleMenuOpen,250)}),[p]),(0,te.jsx)(ye.d,{mouseEvent:"onMouseDown",onClickAway:handleMenuClose,children:(0,te.jsxs)(oe.Z,{onKeyDown:e=>{var t,r;switch(e.key){case ve.s.ArrowDown:case ve.s.ArrowUp:var i;if((null===(t=document.activeElement)||void 0===t?void 0:t.id)!==(null===(r=h.current)||void 0===r?void 0:r.id))null===(i=h.current)||void 0===i||i.focus()}e.stopPropagation()},children:[(0,te.jsx)(Ie,PwChooseCardDropdown_objectSpread({ref:c,openMenu:handleMenuOpen,isSelectedCardInvalid:p,selectedCard:n,setCardSearchString:v,sx:{display:"flex",alignItems:"center",height:"30px",overflow:"hidden","> div":{width:"100%",overflow:"hidden"}},onSelectedCardChange:g},y)),(0,te.jsx)(Z.AL,{open:d.isOpen,popperProps:PwChooseCardDropdown_objectSpread({modifiers:[{name:"offset",options:{offset:[-16,14]}}]},(0,_e.Rg)(d)),selectedItem:n,sx:{minWidth:null!=u?u:"auto"},onSelectedItemChange:g,children:(0,te.jsx)(De,{ref:h,cards:f,getTrelloBoard:r,isActionButtonDisabled:i,selectedCard:n,sx:(0,be.Z)({width:"364px",maxHeight:"344px",paddingBottom:"0",overflowY:"auto",overflowX:"hidden"},(0,Z.yR)()),onActionButtonClick:a,onItemClick:g})})]})})}));let Ae=function(e){return e.Manual="manual",e.Timer="timer",e}({});var Le=r(11087),Re=r(10864);const PwCreationSwitch=e=>{const{value:t,onValueChange:r}=e,{t:i}=(0,M.$)(),a={display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",borderRadius:"50%",cursor:"pointer",backgroundColor:"grey.500",transition:"background-color 0.25s",'&[data-active="true"]':{backgroundColor:"grey.800"},'&:hover:not([data-active="true"])':{backgroundColor:"grey.600"}},s={width:"10px",height:"10px",path:{fill:"currentColor"}};return(0,te.jsxs)(Z.EB,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",width:"16px",minWidth:"16px",height:"36px",padding:"2px",color:"common.white",backgroundColor:"grey.200",borderRadius:"36px"},children:[(0,te.jsx)(Z.jz,{enterDelay:250,placement:"right",title:i("TOOLTIPS.TIMER_MODE"),children:(0,te.jsx)(Z.EB,{"data-active":t===Ae.Timer,sx:a,onClick:()=>r(Ae.Timer),children:(0,te.jsx)(Z.WX,{component:Re.r,inheritViewBox:!0,sx:s})})}),(0,te.jsx)(Z.jz,{enterDelay:250,placement:"right",title:i("TOOLTIPS.MANUAL_MODE"),children:(0,te.jsx)(Z.EB,{"data-active":t===Ae.Manual,sx:a,onClick:()=>r(Ae.Manual),children:(0,te.jsx)(Z.WX,{component:Le.r,inheritViewBox:!0,sx:s})})})]})};var xe=r(73718),Pe=r(16628),Me=r(54656);const Be=["note","setNote"];function PwNoteTextArea_ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=T()(i).call(i,(function(t){return l()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwNoteTextArea_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?c()(r=PwNoteTextArea_ownKeys(Object(a),!0)).call(r,(function(t){(0,f.Z)(e,t,a[t])})):u()?m()(e,u()(a)):c()(i=PwNoteTextArea_ownKeys(Object(a))).call(i,(function(t){v()(e,t,l()(a,t))}))}return e}const PwNoteTextArea=e=>{const{note:t,setNote:r}=e,i=(0,ee.Z)(e,Be),{t:a}=(0,M.$)(),[s,n]=(0,x.useState)(t);(0,x.useEffect)((()=>{n(t)}),[t]);const o=(0,_e.o_)({variant:"popper",popupId:"PwNoteTextArea"}),{onClick:l}=(0,_e.vW)(o),d=(0,x.useRef)(null),handleClose=()=>{o.close()};return(0,te.jsx)(ye.d,{onClickAway:handleClose,children:(0,te.jsxs)(Z.EB,PwNoteTextArea_objectSpread(PwNoteTextArea_objectSpread({},i),{},{children:[(0,te.jsx)(Z.uE,{color:"neutral",size:"small",sx:{display:"flex",justifyContent:"flex-start",minWidth:"72px",maxWidth:"72px",height:"30px",padding:"4px 10px",overflow:"hidden"},onClick:e=>{var t;l(e),null===(t=d.current)||void 0===t||t.focus()},children:(0,te.jsx)(Z.zM,{sx:{lineHeight:1},variant:"body4",children:s||a("BUTTONS.TIME_RECORD_COMMENT")})}),(0,te.jsx)(xe.Z,PwNoteTextArea_objectSpread(PwNoteTextArea_objectSpread({},(0,_e.Rg)(o)),{},{placement:"bottom-start",sx:{zIndex:1,boxShadow:Z.rS.shadows[4],borderRadius:"4px",overflow:"hidden"},transition:!0,children:e=>{let{TransitionProps:i}=e;return(0,te.jsx)(Pe.Z,PwNoteTextArea_objectSpread(PwNoteTextArea_objectSpread({},i),{},{timeout:250,children:(0,te.jsx)(Z.EB,{sx:{minWidth:"372px",padding:"16px",backgroundColor:"background.default"},children:(0,te.jsx)(Z.Vf,{autoFocus:!0,inputProps:{ref:d},maxRows:12,multiline:!0,placeholder:a("MISC.ADD_TIME_RECORD_COMMENT_FOR_ADD_MANUALLY"),size:"small",sx:{minWidth:"auto",width:"100%",padding:0,[`.${Me.Z.notchedOutline}`]:{display:"none"},[`.${Me.Z.root}`]:{[`.${Me.Z.input}`]:PwNoteTextArea_objectSpread({fontSize:"13px",color:"text.primary","&::placeholder":{fontSize:"13px",color:"text.secondary",opacity:1}},(0,Z.yR)())}},value:t,onBlur:()=>n(t),onChange:e=>r(e.target.value),onKeyPress:e=>{let t=e.target;e.charCode===Q.VD.Enter&&(e.preventDefault(),t.blur(),handleClose())}})})}))}}))]}))})};var Oe=r(81887);const $e=["note","setNote"];function PwNoteTextField_ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=T()(i).call(i,(function(t){return l()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwNoteTextField_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?c()(r=PwNoteTextField_ownKeys(Object(a),!0)).call(r,(function(t){(0,f.Z)(e,t,a[t])})):u()?m()(e,u()(a)):c()(i=PwNoteTextField_ownKeys(Object(a))).call(i,(function(t){v()(e,t,l()(a,t))}))}return e}const PwNoteTextField=e=>{const{note:t,setNote:r}=e,i=(0,ee.Z)(e,$e),{t:a}=(0,M.$)(),[s,n]=(0,x.useState)(t),[o,l]=(0,x.useState)(!1);(0,x.useEffect)((()=>{n(t)}),[t]);const d=(0,x.useMemo)((()=>s&&o?(0,te.jsx)(Z.WX,{component:Oe.r,fontSize:"small",inheritViewBox:!0,sx:{width:"16px",height:"16px",path:{color:"text.secondary",fill:"currentColor"},cursor:"pointer"},onMouseDown:()=>{n("")}}):null),[s,o]),finishEditing=()=>{r(s),l(!1)};return(0,te.jsx)(ye.d,{mouseEvent:"onMouseDown",onClickAway:()=>{o&&finishEditing()},children:(0,te.jsx)(Z.EB,PwNoteTextField_objectSpread(PwNoteTextField_objectSpread({},i),{},{children:(0,te.jsx)(Z.Vf,{InputProps:{endAdornment:d},inputProps:{autoComplete:"off"},margin:"none",placeholder:a("MISC.ADD_TIME_RECORD_COMMENT_FOR_ADD_MANUALLY"),size:"small",sx:{width:"100%",[`.${fe.Z.input}`]:{width:"100%"},[`.${Me.Z.root}`]:{[`.${Me.Z.input}`]:{fontSize:"13px",color:"text.primary","&::placeholder":{fontSize:"13px",color:"text.secondary",opacity:1},padding:"4px"}},[`.${Me.Z.notchedOutline}`]:{border:"none"}},value:s,variant:"outlined",onBlur:finishEditing,onChange:e=>n(e.target.value),onFocus:()=>l(!0),onKeyPress:e=>{let t=e.target;e.charCode===Q.VD.Enter&&(e.preventDefault(),t.blur())}})}))})},PwTimerDuration=e=>{const{duration:t}=e;return(0,te.jsx)(Z.zM,{sx:{marginTop:"1px",padding:"4px 10px",lineHeight:1,color:t?"text.primary":"text.disabled"},variant:"subtitle2",children:t||"00:00:00"})},PwCancelTimerDialog=e=>{const{open:t,onClose:r}=e,{t:i}=(0,M.$)();return(0,te.jsx)($.Z,{theme:Z.rS,children:(0,te.jsxs)(Z.X8,{open:t,children:[(0,te.jsx)(Z.Fm,{enableCross:!0,sx:{padding:"24px 24px 16px"},onCrossClick:()=>r(!1),children:i("DIALOGS.DISCARD_TIMER_TITLE")}),(0,te.jsx)(Z.Ly,{sx:{height:"34px",width:"380px",padding:"0 24px"},children:(0,te.jsx)(Z.zM,{children:i("DIALOGS.DISCARD_TIMER_DESCRIPTION")})}),(0,te.jsxs)(Z.I,{sx:{padding:"0 24px 24px"},children:[(0,te.jsx)(Z.uE,{color:"neutral",onClick:()=>r(!1),children:i("BUTTONS.CANCEL")}),(0,te.jsx)(Z.uE,{color:"error",variant:"contained",onClick:()=>r(!0),children:i("DIALOGS.DISCARD_TIMER_ACTION")})]})]})})};var Ne=r(74381),Fe=r(40542),je=r(38842);function PwTimesheetToolbar_ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=T()(i).call(i,(function(t){return l()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwTimesheetToolbar_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?c()(r=PwTimesheetToolbar_ownKeys(Object(a),!0)).call(r,(function(t){(0,f.Z)(e,t,a[t])})):u()?m()(e,u()(a)):c()(i=PwTimesheetToolbar_ownKeys(Object(a))).call(i,(function(t){v()(e,t,l()(a,t))}))}return e}var ze=function(e){return e.AddManually="AddManually",e.StartTimer="StartTimer",e.StopTimer="StopTimer",e}(ze||{});const Ue={[ze.AddManually]:Ne.r,[ze.StartTimer]:Fe.r,[ze.StopTimer]:je.r},Ge={[ze.AddManually]:"primary",[ze.StartTimer]:"primary",[ze.StopTimer]:"error"};function PwTimesheetToolbar(e){var t,r,i,a;const{$log:s,$rootScope:n,appCommonSrv:o,calendarCardsSrv:l,planywayIntegrationSrv:d,settingsSrv:c,telemetrySrv:h,timeTrackingSrv:u,trelloCardsSrv:p,trelloIntegrationSrv:m}=e,{t:C}=(0,M.$)(),v=c.collection.global,f=(0,x.useMemo)((()=>(0,X.VH)(Q.lP.Trello)),[]),y=(0,W.g)(),{localeName:_,dateFnsLocale:b,muiPickersLocaleText:S}=(0,q.bU)(),w=(0,U.Z)(new Date),E=(0,x.useCallback)(((e,t)=>{var r;return null!==(r=m.getTrelloBoardById(e,t))&&void 0!==r?r:{}}),[]),{width:L=0,ref:P}=(0,B.NB)({handleHeight:!1}),V=Number(L)>664?10:4,{minimizedElements:ee}=(0,Y.Z)(L,P,"adaptiveOrder",{elementsGap:V}),re=u.isTimerStarted,[se,ne]=(0,x.useState)(!1),[oe,le]=(0,x.useState)([]),[de,ce]=(0,x.useState)(new(g())),[he,ue]=(0,x.useState)(w),[pe,me]=(0,x.useState)(w),[Ce,ve]=(0,x.useState)(w),[fe,ye]=(0,x.useState)(0),[ge,_e]=(0,x.useState)(new(g())),[ke,be]=(0,x.useState)(!1),[Te,Se]=(0,x.useState)(v.settings.timeTrackingToolbarMode),handleNoteChange=e=>{var t;let r;const i=null!==(t=ge.get(Te))&&void 0!==t?t:"";if(e!==i)return e!==i?r=i?Q.cN.TimeTrackingEvents.NoteChanged:Q.cN.TimeTrackingEvents.NoteAdded:e||(r=Q.cN.TimeTrackingEvents.NoteChanged),r&&h.logSessionEvent(r,{where:Q.Fb.Toolbar}),_e((t=>{let r=new(g())(t);return r.set(Te,e),r}))},handleParentCardChange=e=>{const t=de.get(Te);if(e||t)return(null==e?void 0:e.id)!==(null==t?void 0:t.id)&&h.logSessionEvent(t?Q.cN.TimeTrackingEvents.ParentCardChanged:Q.cN.TimeTrackingEvents.ParentCardAdded,{where:Q.Fb.Toolbar}),ce((t=>{let r=new(g())(t);return r.set(Te,e),r}))},Ie=k()(t=f.getCurrentCollectionConnectedAccountIds()).call(t,(e=>{var t;let r=f.getCurrentCollectionSelectedCalendarIds(e);return T()(t=I()(r).call(r,(t=>m.getTrelloBoardById(e,t)))).call(t,(e=>e))})),we=(0,x.useMemo)((()=>Ie[0]),[de]),De=(0,x.useMemo)((()=>Ie.length>0),[oe]),setTimesheetToolbarMode=e=>{Se((t=>(t!==e&&h.logSessionEvent(Q.cN.TimeTrackingEvents.ToolbarModeChanged,{mode:e}),e))),v.settings.timeTrackingToolbarMode=e,v.saveAsync()},Le=(0,x.useMemo)((()=>{switch(Te){case Ae.Manual:return{type:ze.AddManually,label:C("MISC.ADD"),tooltipLabel:C("TOOLTIPS.ADD_TIME_ENTRY")};case Ae.Timer:return re?{type:ze.StopTimer,label:C("MISC.STOP"),tooltipLabel:C("TOOLTIPS.STOP_TIMER")}:{type:ze.StartTimer,label:C("MISC.START"),tooltipLabel:C("TOOLTIPS.START_TIMER")}}}),[Te,re]);(0,x.useEffect)((()=>{re&&setTimesheetToolbarMode(Ae.Timer)}),[re]),(0,x.useEffect)((()=>{const e=K()((e=>{var t,r;if(null!=e&&e.isTempCard)return;let i=D()(t=k()(r=p.provider.getCurrentCollectionConnectedAccountIds()).call(r,(e=>{var t;return T()(t=p.getCalendarCards(e)).call(t,(e=>!e.isTempCard&&(e.cardType===H.eT.TrelloCard&&!e.isReadOnly&&!e.providerCard.isArchived)))}))).call(t,((e,t)=>e.compare(t)));le(i)}),0);e(),p.addCalendarCardEventListener("added",e),p.addCalendarCardEventListener("updated",e),p.addCalendarCardEventListener("deleted",e),p.addCalendarCardEventListener("cleared",e);const t=n.$on(Q.FK.CardsReloaded,(()=>e()));return()=>{p.removeCalendarCardEventListener("added",e),p.removeCalendarCardEventListener("updated",e),p.removeCalendarCardEventListener("deleted",e),p.removeCalendarCardEventListener("cleared",e),t()}}),[]),(0,x.useEffect)((()=>{switch(Te){case Ae.Manual:break;case Ae.Timer:if(u.currentTimer){const{parentId:r,comment:i}=u.currentTimer;var e,t;if(ge.get(Te)||handleNoteChange(null!=i?i:""),!de.get(Te))handleParentCardChange(null!==(e=null!==(t=A()(oe).call(oe,(e=>e.id===r)))&&void 0!==t?t:u.timerParentCard)&&void 0!==e?e:null);break}}}),[oe,Te,u.currentTimer,u.timerParentCard]);const Re=(0,x.useMemo)((()=>({from:{transform:"translateX(5px)"},to:{transform:"translateX(0px)"},config:PwTimesheetToolbar_objectSpread(PwTimesheetToolbar_objectSpread({},O.vc.wobbly),{},{tension:500,friction:15})})),[]),xe=(0,O.ZI)(),Pe=(0,O.q_)({ref:xe}),createTimeRecordAsync=async(e,t)=>{let r=(0,J.CX)(t.startDate,t.endDate),i=d.getConnectedAccountById(t.accountId);try{h.logSessionEvent(Q.cN.CardEvents.TimeRecordScheduled,{accountId:e.accountId,calendarId:e.calendarId,cardType:H.eT.TrelloTimeRecord,cardRole:H.D.Card,isAllDay:!1,start:t.startDate,end:t.endDate,memberIds:new(R())(i.trelloMemberId),isAssignedToMe:!0,isDuration:!1,durationMinutes:r,where:Q.a6.Scheduler,by:t.by}),await l.createCalendarCardTimeRecordAsync(e,{comment:t.comment||ge.get(Te),isDuration:!1,from:t.startDate,to:t.endDate,durationMinutes:null!=r?r:0,memberId:i.trelloMemberId})}catch(e){s.error("Planyway create time record error:"),s.error(e),h.logError("Planyway create time record error",e,{class:PwTimesheetToolbar.name,method:createTimeRecordAsync.name})}ce((e=>{let t=new(g())(e);return t.set(Te,null),t})),_e((e=>{let t=new(g())(e);return t.set(Te,""),t})),me(w),ve(w),ye(0)},stopTimerAsync=async()=>{const e=await u.stopTimerAsync();if(e&&e.accountId&&e.endDate){h.logSessionEvent(Q.cN.TimeTrackingEvents.TimerStopped,{where:Q.Fb.Toolbar});try{o.setSchedulerBusy(!0);let t=de.get(Te);if(t){let r=PwTimesheetToolbar_objectSpread(PwTimesheetToolbar_objectSpread({},e),{},{endDate:e.endDate,by:Q.AH.Timer});createTimeRecordAsync(t,r)}}catch(e){s.error("Planyway stop timer error:"),s.error(e),h.logError("Planyway stop timer error",e,{class:PwTimesheetToolbar.name,method:stopTimerAsync.name})}finally{o.setSchedulerBusy(!1)}}},Me=(0,x.useCallback)((()=>{h.logSessionEvent(Q.cN.TimeTrackingEvents.ParentCardClicked,{where:Q.Fb.Toolbar})}),[]);return(0,te.jsx)($.Z,{theme:y,children:(0,te.jsx)(j._,{adapterLocale:b,dateAdapter:z.H,localeText:S,children:(0,te.jsxs)(Z.EB,{ref:P,sx:{boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between",alignSelf:"flex-start",gap:`${V}px`,width:"100%",padding:"0 8px",height:"50px",border:"1px solid",borderColor:"primary.main",boxShadow:"0 0 10px rgba(0, 0, 0, 0.08)",borderRadius:"3px"},children:[(0,te.jsxs)(Z.EB,{"data-adaptive-min":286,"data-adaptive-order":2,sx:{display:"grid",alignItems:"center",gridTemplateColumns:"50% 50%",flexGrow:"1",height:"100%"},children:[(0,te.jsx)(Z.EB,{sx:{width:"100%",overflow:"hidden"},children:ee.has("adaptiveOrder_2")?(0,te.jsx)(PwNoteTextArea,{note:null!==(r=ge.get(Te))&&void 0!==r?r:"",setNote:handleNoteChange}):(0,te.jsx)(PwNoteTextField,{note:null!==(i=ge.get(Te))&&void 0!==i?i:"",setNote:handleNoteChange})}),(0,te.jsx)(O.q.div,{style:PwTimesheetToolbar_objectSpread(PwTimesheetToolbar_objectSpread({},Pe),{},{overflow:"hidden"}),children:(0,te.jsx)(Ee,{cards:oe,getTrelloBoard:E,isActionButtonDisabled:!De,placeholder:C("MISC.TIME_TRACKING_CHOOSE_CARD_PLACEHOLDER"),selectedCard:null!==(a=de.get(Te))&&void 0!==a?a:null,setSelectedCard:handleParentCardChange,shouldValidateSelectedCard:ke,onActionButtonClick:()=>{we&&(n.$broadcast(Q.FK.CreateCalendarCardRequested,{providerType:Q.lP.Trello,accountId:we.accountId,calendarId:we.id,cardType:H.eT.TrelloCard,cardRole:H.D.Card,startDate:new Date,endDate:new Date,isAllDay:!0,by:Q.AH.Dialog,forceDetailedMode:!0}),n.$once(Q.FK.CardCreated,((e,t)=>{t.calendarCard&&t.calendarCard.cardType===H.eT.TrelloCard&&handleParentCardChange(t.calendarCard)})))},onClick:Me})})]}),(0,te.jsx)(N.Z,{orientation:"vertical",sx:{[`&.${F.Z.root}`]:{height:"20px",width:"1px"}}}),Te===Ae.Manual?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(ae.o,{value:he,onChange:e=>e&&ue(e)}),(0,te.jsx)(PwTimePickers,{duration:fe,endTime:Ce,startTime:pe,onTimeChanged:e=>{let[t,r]=e;me(t),ve(r),ye((0,J.GM)(t,r))}}),(0,te.jsx)(ie.W,{duration:fe,onChange:e=>{ve((0,G.Z)(pe,e)),ye(e)}})]}):(0,te.jsx)(PwTimerDuration,{duration:u.timerCounterText}),(0,te.jsx)(PwCreateButton,{buttonText:Le.label,color:Ge[Le.type],icon:Ue[Le.type],isMinimized:L<=704,tooltipText:Le.tooltipLabel,onClick:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};be(!0);let t=de.get(Te);if(!t)return e.stopPropagation(),void xe.start(Re);switch(be(!1),Te){case Ae.Manual:{let e=(0,J.q_)(he,pe),r=(0,G.Z)(e,fe),i=d.getConnectedAccountById(t.accountId),a={accountId:t.accountId,comment:ge.get(Te),startDate:e,endDate:r,durationMinutes:fe/1e3/60,memberId:i.trelloMemberId,by:Q.AH.Manually};h.logSessionEvent(Q.cN.TimeTrackingEvents.AddManuallyClicked,{where:Q.Fb.Toolbar}),createTimeRecordAsync(t,a);break}case Ae.Timer:re?await stopTimerAsync():await(async()=>{let e=de.get(Te);if(e)try{let t={providerType:Q.lP.Trello,calendarId:e.calendarId,parentId:e.id,comment:ge.get(Te)};h.logSessionEvent(Q.cN.TimeTrackingEvents.TimerStartClicked,{where:Q.Fb.Toolbar}),await u.startTimerAsync(e.accountId,t)&&h.logSessionEvent(Q.cN.TimeTrackingEvents.TimerStarted,{where:Q.Fb.Toolbar})}catch(e){s.error("Planyway start timer error:"),s.error(e),h.logError("Planyway start timer error",e,{class:PwTimesheetToolbar.name,method:stopTimerAsync.name})}})()}}}),re?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(Z.jz,{enterDelay:250,title:C("TOOLTIPS.DELETE_TIME_ENTRY"),children:(0,te.jsx)(Z.qS,{size:"small",sx:{padding:"2px"},onClick:()=>ne(!0),children:(0,te.jsx)(Z.WX,{component:Oe.r,inheritViewBox:!0,sx:{fontSize:16,color:"grey.600"}})})}),(0,te.jsx)(PwCancelTimerDialog,{open:se,onClose:e=>{e&&stopTimerAsync(),ne(!1)}})]}):(0,te.jsx)(PwCreationSwitch,{value:Te,onValueChange:e=>setTimesheetToolbarMode(e)})]})})})}PwTimesheetToolbar.componentName="pwTimesheetToolbar",PwTimesheetToolbar.componentInjections=["$log","$rootScope","appCommonSrv","calendarCardsSrv","planywayIntegrationSrv","settingsSrv","telemetrySrv","timeTrackingSrv","trelloCardsSrv","trelloIntegrationSrv"];const Ve=(0,P.Pi)(PwTimesheetToolbar)},5199:(e,t,r)=>{r.d(t,{Z:()=>L});var i=r(62079),a=r.n(i),s=r(52020),n=r.n(s),o=r(73324),l=r.n(o),d=r(88546),c=r.n(d),h=r(99595),u=r.n(h),p=r(66775),m=r.n(p),C=r(2201),v=r.n(C),f=r(57445),y=r.n(f),g=r(26171),_=(r(67294),r(45697)),k=r.n(_),b=r(24561),T=r(22233),S=r(99246),I=r(85893);function ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=l()(i).call(i,(function(t){return c()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?u()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,g.Z)(e,t,a[t])})):m()?v()(e,m()(a)):u()(i=ownKeys(Object(a))).call(i,(function(t){y()(e,t,c()(a,t))}))}return e}const w={height:636,viewBox:"0 0 1000 636",width:1e3},D=(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("path",{clipRule:"evenodd",d:"M0 30a6 6 0 0 1 6-6h988a6 6 0 0 1 6 6v80a6 6 0 0 1-6 6H6a6 6 0 0 1-6-6V30Zm14 12a4 4 0 0 1 4-4h67a4 4 0 0 1 0 8H18a4 4 0 0 1-4-4Zm4 10a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM0 238a6 6 0 0 1 6-6h488a6 6 0 0 1 6 6v80a6 6 0 0 1-6 6H6a6 6 0 0 1-6-6v-80Zm14 12a4 4 0 0 1 4-4h67a4 4 0 0 1 0 8H18a4 4 0 0 1-4-4Zm4 10a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM0 134a6 6 0 0 1 6-6h788a6 6 0 0 1 6 6v80a6 6 0 0 1-6 6H6a6 6 0 0 1-6-6v-80Zm14 12a4 4 0 0 1 4-4h67a4 4 0 0 1 0 8H18a4 4 0 0 1-4-4Zm4 10a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM0 342a6 6 0 0 1 6-6h988a6 6 0 0 1 6 6v80a6 6 0 0 1-6 6H6a6 6 0 0 1-6-6v-80Zm14 12a4 4 0 0 1 4-4h67a4 4 0 0 1 0 8H18a4 4 0 0 1-4-4Zm4 10a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM0 446a6 6 0 0 1 6-6h788a6 6 0 0 1 6 6v80a6 6 0 0 1-6 6H6a6 6 0 0 1-6-6v-80Zm14 12a4 4 0 0 1 4-4h67a4 4 0 0 1 0 8H18a4 4 0 0 1-4-4Zm4 10a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM0 550a6 6 0 0 1 6-6h488a6 6 0 0 1 6 6v80a6 6 0 0 1-6 6H6a6 6 0 0 1-6-6v-80Zm14 12a4 4 0 0 1 4-4h67a4 4 0 0 1 0 8H18a4 4 0 0 1-4-4Zm4 10a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18Z",fillRule:"evenodd"}),(0,I.jsx)("rect",{height:"8",rx:"4",width:"98"})]}),E={height:616,viewBox:"0 0 848 616",width:848},A=(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("rect",{fill:"#e7e9eb",height:"8",rx:"4",width:"98"}),(0,I.jsx)("path",{clipRule:"evenodd",d:"M6 24a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6V30a6 6 0 0 0-6-6H6Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8H18Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM6 224a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H6Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8H18Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM6 124a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H6Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8H18Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM6 324a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H6Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8H18Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM6 424a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H6Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8H18Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18ZM6 524a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H6Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8H18Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H18Z",fill:"#e7e9eb",fillRule:"evenodd"}),(0,I.jsx)("rect",{fill:"#e7e9eb",height:"8",rx:"4",width:"98",x:"288"}),(0,I.jsx)("path",{clipRule:"evenodd",d:"M294 24a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6V30a6 6 0 0 0-6-6H294Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H306ZM294 224a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H294Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H306ZM294 124a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H294Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H306ZM294 324a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H294Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H306ZM294 424a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H294Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H306Z",fill:"#e7e9eb",fillRule:"evenodd"}),(0,I.jsx)("rect",{fill:"#e7e9eb",height:"8",rx:"4",width:"98",x:"576"}),(0,I.jsx)("path",{clipRule:"evenodd",d:"M582 24a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6V30a6 6 0 0 0-6-6H582Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H594ZM582 224a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H582Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H594ZM582 124a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H582Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H594ZM582 324a6 6 0 0 0-6 6v80a6 6 0 0 0 6 6h260a6 6 0 0 0 6-6v-80a6 6 0 0 0-6-6H582Zm12 14a4 4 0 0 0 0 8h67a4 4 0 0 0 0-8h-67Zm0 14a4 4 0 0 0 0 8h146a4 4 0 0 0 0-8H594Z",fill:"#e7e9eb",fillRule:"evenodd"})]});function PwTrelloTaskListSkeleton(e){const{taskListsView:t}=e;let r,i;switch(t){case"list":r=w,i=D;break;case"kanban":r=E,i=A;break;default:return null}return(0,I.jsx)(T.Z,{theme:S.rS,children:(0,I.jsx)(b.ZP,_objectSpread(_objectSpread({backgroundColor:"#ebedef",foregroundColor:"#e1e3e4",speed:2,style:{backgroundColor:"#f6f8f9"}},r),{},{children:i}))})}PwTrelloTaskListSkeleton.componentName="pwTrelloTaskListSkeleton",PwTrelloTaskListSkeleton.propTypes={taskListsView:k().string.isRequired};const L=PwTrelloTaskListSkeleton},37936:(e,t,r)=>{r.d(t,{j:()=>w,W:()=>E});var i=r(62079),a=r.n(i),s=r(52020),n=r.n(s),o=r(73324),l=r.n(o),d=r(88546),c=r.n(d),h=r(99595),u=r.n(h),p=r(66775),m=r.n(p),C=r(2201),v=r.n(C),f=r(57445),y=r.n(f),g=r(26171),_=r(41266),k=(r(67294),r(59766)),b=r(99246),T=r(29704),S=r(85893);const I=["name","boardColor","boardImageUrl","sx"];function ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=l()(i).call(i,(function(t){return c()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?u()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,g.Z)(e,t,a[t])})):m()?v()(e,m()(a)):u()(i=ownKeys(Object(a))).call(i,(function(t){y()(e,t,c()(a,t))}))}return e}const w=function PwBoardIcon(e){const{name:t,boardColor:r,boardImageUrl:i,sx:a}=e,s=(0,_.Z)(e,I),n=(0,T.T6)(t,"",1),o={backgroundColor:"default"===r?"primary.main":`trelloBoards.${r}.base`,fontSize:"0.875rem"};return(0,S.jsx)(b.zW,_objectSpread(_objectSpread({},s),{},{alt:t,src:i,sx:(0,k.Z)(o,a),variant:"rounded",children:n}))},D=["name","imageUrl","sx","useAbbreviation"];function PwOrganizationIcon_ownKeys(e,t){var r=a()(e);if(n()){var i=n()(e);t&&(i=l()(i).call(i,(function(t){return c()(e,t).enumerable}))),r.push.apply(r,i)}return r}function PwOrganizationIcon_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?u()(r=PwOrganizationIcon_ownKeys(Object(a),!0)).call(r,(function(t){(0,g.Z)(e,t,a[t])})):m()?v()(e,m()(a)):u()(i=PwOrganizationIcon_ownKeys(Object(a))).call(i,(function(t){y()(e,t,c()(a,t))}))}return e}const E=function PwOrganizationIcon(e){const{name:t,imageUrl:r,sx:i,useAbbreviation:a}=e,s=(0,_.Z)(e,D),n=(0,T.T6)(t,"",1),o={backgroundColor:`trelloOrganizations.${(0,T.XG)(t)}`,fontSize:"0.875rem"};return(0,S.jsx)(b.zW,PwOrganizationIcon_objectSpread(PwOrganizationIcon_objectSpread({},s),{},{alt:t,src:r,sx:(0,k.Z)(o,i),variant:"rounded",children:a&&n}))}},5137:(e,t,r)=>{r.d(t,{Z:()=>Zr});var i=r(40024),a=r.n(i),s=r(88946),n=r.n(s),o=r(99595),l=r.n(o),d=r(57445),c=r.n(d),h=r(51791),u=r.n(h),p=r(90143),m=r.n(p),C=r(56626),v=r.n(C),f=r(67552),y=r.n(f),g=r(86981),_=r.n(g),k=r(62079),b=r.n(k),T=r(52020),S=r.n(T),I=r(73324),w=r.n(I),D=r(88546),E=r.n(D),A=r(66775),L=r.n(A),R=r(2201),x=r.n(R),P=r(26171),M=r(26881),B=r(56777),O=(r(43611),r(8937)),$=r(20115),N=r(29704);function ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function _getDecoratorsApi(){_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _createElementDescriptor(e){var t,r=_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function _coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let F=function _decorate(e,t,r,i){var a,s=_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function _coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(_isDataDescriptor(a.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(a)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(_hasDecorators(a)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["planywayIntegrationSrv","platformSrv","telemetrySrv"])],(function(e){return{F:class ExportService{constructor(t,r,i){e(this),this._planywayIntegrationSrv=t,this._platformSrv=r,this._telemetrySrv=i}},d:[{kind:"get",static:!0,key:"serviceName",value:function serviceName(){return"exportSrv"}},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"method",key:"getExportUrlsAsync",value:async function getExportUrlsAsync(e,t){const{trelloMemberId:r,trelloToken:i}=this._planywayIntegrationSrv.getConnectedAccountById(e);let a=await this._restAsync(O.Tu.Get,`${$.Ao}/trello/${r}/control`,"Get Export URLs",{token:i,query:{boardId:t}});if(!a.success){let e=new Error(a.message);throw e.code=a.code,e.details=a.details,e}return a.data.urls}},{kind:"method",key:"createExportUrlsAsync",value:async function createExportUrlsAsync(e,t){const{trelloMemberId:r,trelloToken:i}=this._planywayIntegrationSrv.getConnectedAccountById(e);let a=await this._restAsync(O.Tu.Post,`${$.Ao}/trello/${r}/control`,"Create Export URLs",{token:i,body:{action:"create",data:{boardId:t,timeZone:(0,N.iT)()}}});if(!a.success){let e=new Error(a.message);throw e.code=a.code,e.details=a.details,e}return a.data.urls}},{kind:"method",key:"deleteExportUrlsAsync",value:async function deleteExportUrlsAsync(e,t){const{trelloMemberId:r,trelloToken:i}=this._planywayIntegrationSrv.getConnectedAccountById(e);let a=await this._restAsync(O.Tu.Post,`${$.Ao}/trello/${r}/control`,"Delete Export URLs",{token:i,body:{action:"delete",data:{boardId:t}}});if(!a.success){let e=new Error(a.message);throw e.code=a.code,e.details=a.details,e}}},{kind:"method",key:"_restAsync",value:async function _restAsync(e,t,r){let i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this._telemetrySrv.logRequest(r,e,t,_objectSpread(_objectSpread({},a.query),a.body)),n=200;try{return await this._platformSrv.restAsync(e,t,_objectSpread(_objectSpread({},a),{},{useTrelloAuth:!0}))}catch(e){throw n=e.status,i=e.response,e}finally{this._telemetrySrv.logRequestEnd(s,n,i)}}}]}}));var j=r(16785);function CalendarIconController_getDecoratorsApi(){CalendarIconController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CalendarIconController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CalendarIconController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CalendarIconController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CalendarIconController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CalendarIconController_createElementDescriptor(e){var t,r=CalendarIconController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CalendarIconController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CalendarIconController_hasDecorators(e){return e.decorators&&e.decorators.length}function CalendarIconController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CalendarIconController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CalendarIconController_toPropertyKey(e){var t=function CalendarIconController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let z=function CalendarIconController_decorate(e,t,r,i){var a,s=CalendarIconController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CalendarIconController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CalendarIconController_isDataDescriptor(a.descriptor)||CalendarIconController_isDataDescriptor(i.descriptor)){if(CalendarIconController_hasDecorators(a)||CalendarIconController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CalendarIconController_hasDecorators(a)){if(CalendarIconController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CalendarIconController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CalendarIconController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$scope","trelloIntegrationSrv"])],(function(e){return{F:class CalendarIconController{constructor(t,r){e(this),this._$scope=t,this._trelloIntegrationSrv=r,this._iconSize="small",this._showAbbreviation=!1,this._$scope.$on("$destroy",(()=>{this._onTrelloBoardUpdated&&(this._trelloIntegrationSrv.removeTrelloBoardEventListener("updated",this._onTrelloBoardUpdated),this._onTrelloBoardUpdated=null)}))}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloCalendarIconCtrl"}},{kind:"get",key:"shouldDisplayCalendarImage",value:function shouldDisplayCalendarImage(){return!!this.calendarImageUrl}},{kind:"get",key:"shouldDisplayCalendarAbbreviation",value:function shouldDisplayCalendarAbbreviation(){return this._showAbbreviation&&this.calendarAbbreviation&&!this.shouldDisplayCalendarImage}},{kind:"get",key:"iconSize",value:function iconSize(){return this._iconSize}},{kind:"set",key:"calendarId",value:function calendarId(e){this._calendarId=e,this._loadCalendar()}},{kind:"set",key:"accountId",value:function accountId(e){this._accountId=e,this._loadCalendar()}},{kind:"get",key:"calendarColor",value:function calendarColor(){return this._calendarColor}},{kind:"get",key:"calendarImageUrl",value:function calendarImageUrl(){return this._calendarImageUrl}},{kind:"get",key:"calendarAbbreviation",value:function calendarAbbreviation(){return this._calendarAbbreviation}},{kind:"method",key:"_loadCalendar",value:function _loadCalendar(){if(!this._calendarId||!this._accountId)return;let e=this._trelloIntegrationSrv.getTrelloBoardById(this._accountId,this._calendarId);if(e){let t=e.boardColor,r=e.boardImageUrls[O.yX.Small],i=(0,N.T6)(e.name,"",1),a=this._calendarColor!==t||this._calendarImageUrl!==r||this._calendarAbbreviation!==i;this._calendarColor=t,this._calendarImageUrl=r,this._calendarAbbreviation=i,a&&this._$scope.$broadcast("$$rebind::calendar")}this._onTrelloBoardUpdated||(this._onTrelloBoardUpdated=e=>{e.id===this._calendarId&&(this._loadCalendar(),this._$scope.$broadcast("$$rebind::calendar"))},this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",this._onTrelloBoardUpdated))}}]}}));var U=r(53706),G=r.n(U),V=r(87994),K=r.n(V),H=r(91829),Z=r.n(H),W=r(51363),Y=r.n(W),q=r(42191),X=r.n(q);function CalendarPickerController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function CalendarPickerController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=CalendarPickerController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=CalendarPickerController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function CalendarPickerController_getDecoratorsApi(){CalendarPickerController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CalendarPickerController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CalendarPickerController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CalendarPickerController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CalendarPickerController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CalendarPickerController_createElementDescriptor(e){var t,r=CalendarPickerController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CalendarPickerController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CalendarPickerController_hasDecorators(e){return e.decorators&&e.decorators.length}function CalendarPickerController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CalendarPickerController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CalendarPickerController_toPropertyKey(e){var t=function CalendarPickerController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Q=function CalendarPickerController_decorate(e,t,r,i){var a,s=CalendarPickerController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CalendarPickerController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CalendarPickerController_isDataDescriptor(a.descriptor)||CalendarPickerController_isDataDescriptor(i.descriptor)){if(CalendarPickerController_hasDecorators(a)||CalendarPickerController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CalendarPickerController_hasDecorators(a)){if(CalendarPickerController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CalendarPickerController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CalendarPickerController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$scope","$translate","dialogSrv","licenseSrv","platformSrv","settingsSrv","telemetrySrv","trelloIntegrationSrv"])],(function(e){return{F:class CalendarPickerController{constructor(t,r,i,a,s,n,o,l){var d;e(this),this._$scope=t,this._$translate=r,this._dialogSrv=i,this._licenseSrv=a,this._platformSrv=s,this._settingsSrv=n,this._telemetrySrv=o,this._trelloIntegrationSrv=l,this._connectedBoardsCount=G()(d=this._provider.getCurrentCollectionConnectedAccountIds()).call(d,((e,t)=>e+this._provider.getCurrentCollectionConnectedCalendarIds(t).length),0)}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloCalendarPickerCtrl"}},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"field",key:"account",value:void 0},{kind:"get",key:"boardsAvailable",value:function boardsAvailable(){return this.calendars.length>0}},{kind:"get",key:"filterText",value:function filterText(){return this._filterText||""}},{kind:"set",key:"filterText",value:function filterText(e){this._filterText=e,this._filteredOrganizations=null}},{kind:"get",key:"filteredOrganizations",value:function filteredOrganizations(){var e;this._filteredOrganizations||(this._filteredOrganizations=w()(e=this.organizations).call(e,(e=>e.filteredBoards.length>0)));return this._filteredOrganizations}},{kind:"get",key:"organizations",value:function organizations(){if(!this._organizations){var e,t,r;let i=K()(e=w()(t=this._provider.getCurrentCollectionConnectedAccountIds()).call(t,(e=>e!==this.account.accountId))).call(e,(e=>this._provider.getCurrentCollectionConnectedCalendarIds(e)));this._organizations=n()(r=this._trelloIntegrationSrv.getTrelloOrganizations(this.account.accountId)).call(r,(e=>{var t,r;if((e={id:e.id,type:e.type,logoUrl:e.logoUrlNormal,colorHash:(0,N.XG)(e.name),name:e.name,abbreviation:(0,N.T6)(e.name),boards:n()(t=w()(r=e.boards).call(r,(e=>!Z()(i).call(i,e.id)))).call(t,(e=>{var t;e=CalendarPickerController_objectSpread({},e);let r=_()(t=this._boards).call(t,(t=>t.id===e.id));return c()(e,"isConnected",{get:()=>r.isConnected,set:e=>r.isConnected=e}),e})),toggleAllBoardsConnected:()=>{var t;let r=e.isAllBoardsConnected;l()(t=e.filteredBoards).call(t,(e=>e.isConnected=!r))}}).id===$.tl)e.tooltip=this._$translate.instant("MISC.GUEST_BOARDS_EXPLANATION");return c()(e,"filteredBoards",{get:()=>{var t;return this.filterText?w()(t=e.boards).call(t,(e=>{var t;return Z()(t=e.name.toLowerCase()).call(t,this.filterText.toLowerCase())})):e.boards}}),c()(e,"isAllBoardsConnected",{get:()=>{var t;let r=w()(t=e.filteredBoards).call(t,(e=>e.isConnected));return 0!==r.length&&r.length===e.filteredBoards.length}}),c()(e,"isSomeBoardsConnected",{get:()=>{var t;let r=w()(t=e.filteredBoards).call(t,(e=>e.isConnected));return 0!==r.length&&r.length!==e.filteredBoards.length}}),e}))}return this._organizations}},{kind:"get",key:"calendars",value:function calendars(){if(!this._boards){var e,t,r,i;let a=K()(e=w()(t=this._provider.getCurrentCollectionConnectedAccountIds()).call(t,(e=>e!==this.account.accountId))).call(e,(e=>this._provider.getCurrentCollectionConnectedCalendarIds(e)));this._boards=n()(r=w()(i=this._trelloIntegrationSrv.getTrelloBoards(this.account.accountId)).call(i,(e=>!Z()(a).call(a,e.id)))).call(r,(e=>{e=CalendarPickerController_objectSpread({},e);let t=this._provider.getCurrentCollectionConnectedCalendar(this.account.accountId,e.id);return c()(e,"isConnected",{get:()=>t.isConnected,set:e=>{if(e){if(!this.account.isPrimary&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TrelloConnect,!0))return;let e=this._connectedBoardsCount+1;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.MultiBoard,!0,{paidCalendarsCount:e}))return}this._connectedBoardsCount+=e?1:-1,t.isConnected=e}}),e}))}return this._boards}},{kind:"set",key:"calendars",value:function calendars(e){this._boards=e}},{kind:"get",key:"createFirstBoardImgUrl",value:function createFirstBoardImgUrl(){return this._platformSrv.getPlatformUrl(Y())}},{kind:"get",key:"notFoundImgUrl",value:function notFoundImgUrl(){return this._platformSrv.getPlatformUrl(X())}},{kind:"method",key:"createBoardAsync",value:async function createBoardAsync(e){this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.CreateBoardDialogOpened,{where:O.bs.AddBoardsDialog}),await this._dialogSrv.showBoardDialogAsync(e,{account:this.account})?(this._boards=null,this._organizations=null,this._filteredOrganizations=null):this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.CreateBoardDialogClosed,{where:O.bs.AddBoardsDialog})}}]}}));var J=r(27525),ee=r.n(J),te=r(76555),re=r.n(te),ie=r(19755),ae=r.n(ie),se=r(82617),ne=r(39790);function CardContextMenuController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function CardContextMenuController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=CardContextMenuController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=CardContextMenuController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function CardContextMenuController_getDecoratorsApi(){CardContextMenuController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CardContextMenuController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CardContextMenuController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CardContextMenuController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CardContextMenuController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CardContextMenuController_createElementDescriptor(e){var t,r=CardContextMenuController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CardContextMenuController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CardContextMenuController_hasDecorators(e){return e.decorators&&e.decorators.length}function CardContextMenuController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CardContextMenuController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CardContextMenuController_toPropertyKey(e){var t=function CardContextMenuController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const oe="priority",le="labels",de="members",ce="addCheckItem",he="complete",ue="copyUrl",pe="convertCheckItemToCard",me="duplicate",Ce="archive",ve="remove",fe="delete",ye={[se.eT.TrelloCard]:[oe,le,de,ce,he,ue,me,Ce,ve,fe],[se.eT.TrelloCustomField]:[le,de,he,ue,ve],[se.eT.TrelloCheckItem]:[le,de,he,ue,pe,ve,fe],[se.eT.TrelloTimeRecord]:[de,ue,me,fe]};let ge=function CardContextMenuController_decorate(e,t,r,i){var a,s=CardContextMenuController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CardContextMenuController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CardContextMenuController_isDataDescriptor(a.descriptor)||CardContextMenuController_isDataDescriptor(i.descriptor)){if(CardContextMenuController_hasDecorators(a)||CardContextMenuController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CardContextMenuController_hasDecorators(a)){if(CardContextMenuController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CardContextMenuController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CardContextMenuController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$element","$rootScope","$scope","$translate","appCommonSrv","dialogSrv","planywayIntegrationSrv","telemetrySrv","trelloIntegrationSrv"])],(function(e){return{F:class CardContextMenuController{constructor(t,r,i,a,s,n,o,l,d){e(this),this._$element=t,this._$rootScope=r,this._$scope=i,this._$translate=a,this._appCommonSrv=s,this._dialogSrv=n,this._planywayIntegrationSrv=o,this._telemetrySrv=l,this._trelloIntegrationSrv=d,this._$scope.$on(O.FK.OpenNestedContextMenuRequested,((e,t)=>{const{calendarCard:r,nestedMenu:i,source:a,sourceElement:s}=t;if(r.providerType!==O.lP.Trello||this._source!==a)return;let n;switch(this._source){case O.xI.Scheduler:n=_()(s).call(s,`.k-event[data-uid="${r.uid}"]`)[0];break;case O.xI.TaskLists:let e=_()(s).call(s,`.pw-tasks-card[data-id="${r.id}"]`);if(e[0]){n=e[0];break}let t=_()(s).call(s,`.pw-tasks-card__check-item[data-id="${r.id}"]`);if(t[0]){n=t[0];break}return;default:return}let o=new(ae().Event)("contextmenu",{target:n}),l=this._getContextMenuScope(i);l&&(this._cardContextMenu=l.$mdMenu,this.setCardContextMenu(this._cardContextMenu),this.cardContextMenu.open(o,r),l.$once("$pwContextMenuClosed",(()=>{let e=this._getContextMenuScope("trello-context");e&&(this._cardContextMenu=e.$mdMenu,this.setCardContextMenu(this._cardContextMenu))})))}));const onTrelloBoardUpdated=e=>{var t,r;e.id===(null===(t=this._contextMenuLabels)||void 0===t?void 0:t.calendarCard.providerCard.boardId)&&(this._contextMenuLabels=null),e.id===(null===(r=this._contextMenuMembers)||void 0===r?void 0:r.calendarCard.providerCard.boardId)&&(this._contextMenuMembers=null)};this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",onTrelloBoardUpdated),this._$scope.$on("$destroy",(()=>{this._trelloIntegrationSrv.removeTrelloBoardEventListener("updated",onTrelloBoardUpdated)}))}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloCardContextMenuCtrl"}},{kind:"field",key:"_source",value:void 0},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"set",key:"onSetContextMenu",value:function onSetContextMenu(e){this._onSetContextMenu=e}},{kind:"get",key:"cardContextMenu",value:function cardContextMenu(){return this._cardContextMenu}},{kind:"method",key:"setCardContextMenu",value:function setCardContextMenu(e){this._cardContextMenu=e,this._onSetContextMenu({providerType:O.lP.Trello,menuController:this._cardContextMenu})}},{kind:"method",key:"isContextMenuItemAvailable",value:function isContextMenuItemAvailable(){if(!this.cardContextMenu)return!1;let e=this.cardContextMenu.pwData;if(!e)return!1;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return ee()(r).call(r,(t=>{var r;if(!(null===(r=ye[e.cardType])||void 0===r?void 0:Z()(r).call(r,t)))return!1;switch(t){case he:return!e.isReadOnly&&!e.providerCard.isArchived&&(e.cardType===se.eT.TrelloCheckItem||e.hasDates);case oe:return!e.isReadOnly&&!e.providerCard.isArchived;case le:return!e.isReadOnly&&!e.providerCard.isArchived&&this.getContextMenuLabels(e).length>0;case de:return!e.isReadOnly&&!e.providerCard.isArchived&&this.getContextMenuMembers(e).length>0;case ce:return this._source===O.xI.TaskLists&&(!e.isReadOnly&&!e.providerCard.isArchived&&!e.isTempCard);case ue:return!e.isTempCard;case me:return!e.isReadOnly&&!e.providerCard.isArchived&&!e.isTempCard;case Ce:return!e.isReadOnly&&!e.isTempCard;case pe:return!e.isReadOnly&&!e.providerCard.isArchived&&e.cardType===se.eT.TrelloCheckItem;case ve:return!e.isReadOnly&&!e.providerCard.isArchived&&e.hasDates;case fe:return!(e.isReadOnly||e.providerCard.isArchived&&e.cardType!==se.eT.TrelloCard||e.isTempCard)}return!0}))}},{kind:"method",key:"toggleCardIsCompleted",value:function toggleCardIsCompleted(e){this._provider.toggleCardsIsCompletedAsync([e],{applyRecurringActionToHead:this._cardContextMenu.applyRecurringActionToHead,telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"get",key:"contextMenuPriorities",value:function contextMenuPriorities(){return this._contextMenuPriorities||(this._contextMenuPriorities=[{label:this._$translate.instant("MENU.PRIORITY_HIGH"),value:3},{label:this._$translate.instant("MENU.PRIORITY_MEDIUM"),value:2},{label:this._$translate.instant("MENU.PRIORITY_LOW"),value:1},{label:this._$translate.instant("MENU.PRIORITY_UNSET"),value:0}]),this._contextMenuPriorities}},{kind:"method",key:"setCardPriority",value:function setCardPriority(e,t){this._provider.setCardsPriorityAsync([e],t,{applyRecurringActionToHead:this._cardContextMenu.applyRecurringActionToHead,telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"getContextMenuLabels",value:function getContextMenuLabels(e){if(!e)return[];if(!this._contextMenuLabels||this._contextMenuLabels.calendarCard!==e){this._contextMenuLabels={calendarCard:e};let a=this._trelloIntegrationSrv.getTrelloBoardById(e.accountId,e.providerCard.boardId);var t,r,i;if(a)this._contextMenuLabels.cardBoardLabels=n()(t=re()(r=w()(i=a.labels).call(i,(e=>e.id!==$.$d))).call(r,N.G4)).call(t,(e=>CardContextMenuController_objectSpread(CardContextMenuController_objectSpread({},e),{},{name:e.name||this._$translate.instant(e.color?O.y_[e.color]:"MISC.LABEL_COLOR_NO_COLOR")})));else this._contextMenuLabels.cardBoardLabels=[]}return this._contextMenuLabels.cardBoardLabels}},{kind:"method",key:"isContextMenuLabelSelected",value:function isContextMenuLabelSelected(e,t){return!!e&&e.providerCard.labelIds.has(t.id)}},{kind:"method",key:"toggleCardLabel",value:function toggleCardLabel(e,t){this._provider.toggleCardsLabelAsync([e],t.id,{applyRecurringActionToHead:this._cardContextMenu.applyRecurringActionToHead,telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"get",key:"isMultipleMembersSupported",value:function isMultipleMembersSupported(){return!!this.cardContextMenu&&(!!this.cardContextMenu.pwData&&(0,ne.xZ)(this.cardContextMenu.pwData))}},{kind:"method",key:"getContextMenuMembers",value:function getContextMenuMembers(e){if(!e||e.providerType!==O.lP.Trello)return[];if(!this._contextMenuMembers||this._contextMenuMembers.calendarCard!==e){this._contextMenuMembers={calendarCard:e};let i=this._trelloIntegrationSrv.getTrelloBoardById(e.accountId,e.providerCard.boardId),a=this._planywayIntegrationSrv.getConnectedAccountById(e.accountId).trelloMemberId,s=this._trelloIntegrationSrv.getTrelloMemberById(e.accountId,a);var t,r;if(i)this._contextMenuMembers.cardTrelloMembers=re()(t=w()(r=i.members).call(r,(e=>e.id!==$.$d))).call(t,((e,t)=>(0,N.Yb)(e,t,s)));else this._contextMenuMembers.cardTrelloMembers=[]}return this._contextMenuMembers.cardTrelloMembers}},{kind:"method",key:"isContextMenuMemberSelected",value:function isContextMenuMemberSelected(e,t){return!!e&&e.providerCard.memberIds.has(t.id)}},{kind:"get",key:"memberFilter",value:function memberFilter(){return this._memberFilter}},{kind:"set",key:"memberFilter",value:function memberFilter(e){this._memberFilter=e,e&&(this._memberFilterRegex=(0,N.n0)(e))}},{kind:"method",key:"filterMembersByFullName",value:function filterMembersByFullName(){return e=>!this.memberFilter||this._memberFilterRegex.test(e.fullName)}},{kind:"method",key:"toggleCardMember",value:function toggleCardMember(e,t){this._provider.toggleCardsMemberAsync([e],t.id,{applyRecurringActionToHead:this._cardContextMenu.applyRecurringActionToHead,telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"addChecklistItem",value:function addChecklistItem(e){this._$rootScope.$broadcast(O.FK.TaskListsAddCheckItemRequested,{calendarCard:e})}},{kind:"method",key:"copyCardUrl",value:function copyCardUrl(e){this._provider.copyCardUrlAsync(e,{telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"duplicateCard",value:function duplicateCard(e){this._provider.duplicateCardsAsync([e],{telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"toggleCardIsArchived",value:function toggleCardIsArchived(e){this._provider.toggleCardsIsArchivedAsync([e],{applyRecurringActionToHead:this._cardContextMenu.applyRecurringActionToHead,telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"convertCheckItemToCard",value:function convertCheckItemToCard(e){this._provider.convertCheckItemsToToCardsAsync([e],{telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"removeCard",value:function removeCard(e){this._provider.removeCardDatesAsync([e],{applyRecurringActionToHead:this._cardContextMenu.applyRecurringActionToHead,telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"deleteCard",value:function deleteCard(e){this._provider.deleteCardsAsync([e],{applyRecurringActionToHead:this._cardContextMenu.applyRecurringActionToHead,forceConfirm:this._cardContextMenu.forceConfirm,telemetry:{where:this._cardContextMenu.where,by:O.AH.ContextMenu}})}},{kind:"method",key:"showEditLabelsDialog",value:function showEditLabelsDialog(e){this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.LabelEditDialogOpened,{where:this._cardContextMenu.where,by:O.AH.ContextMenu}),this._dialogSrv.showEditLabelsDialogAsync({accountId:e.accountId,boardId:e.providerCard.boardId,calendarCard:e})}},{kind:"method",key:"_getContextMenuScope",value:function _getContextMenuScope(e){var t;let r=_()(t=this._$element).call(t,`md-menu[data-menu='${e}']`);if(0!==r.length)return r.scope()}}]}}));var _e=r(54847),ke=r.n(_e),be=r(23513),Te=r.n(be),Se=r(35704),Ie=r.n(Se),we=r(10349),De=r.n(we),Ee=r(68052),Ae=r.n(Ee),Le=r(35293),Re=r.n(Le),xe=r(84705),Pe=r.n(xe),Me=r(60312),Be=r.n(Me),Oe=r(45181),$e=r.n(Oe),Ne=r(13464),Fe=r.n(Ne),je=r(35820),ze=r.n(je),Ue=r(40405),Ge=r.n(Ue),Ve=r(90869),Ke=r.n(Ve),He=r(77738),Ze=r.n(He),We=r(18965),Ye=r(16496),qe=r.n(Ye),Xe=r(63333),Qe=r(36395),Je=r(41092),et=r(46930);r(95877);function CardEditorController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function CardEditorController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=CardEditorController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=CardEditorController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function CardEditorController_getDecoratorsApi(){CardEditorController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CardEditorController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CardEditorController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CardEditorController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CardEditorController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CardEditorController_createElementDescriptor(e){var t,r=CardEditorController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CardEditorController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CardEditorController_hasDecorators(e){return e.decorators&&e.decorators.length}function CardEditorController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CardEditorController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CardEditorController_toPropertyKey(e){var t=function CardEditorController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const tt="complete",rt="archive",it="addMember",at="addLabel",st="addChecklist",nt="addAttachment",ot="addPriority",lt="addDependency",dt="addEstimation",ct="logTime",ht="changeMilestone",ut="openInSource",pt="changeVisibility",mt="duplicate",Ct="copyUrl",vt="convertCheckItemToCard",ft="deleteCard",yt={[se.eT.TrelloCard]:[tt,rt,it,at,st,nt,ot,lt,dt,ct,ht,ut,pt,mt,Ct,ft],[se.eT.TrelloCustomField]:[tt,it,at,st,nt,ut,Ct,ft],[se.eT.TrelloCheckItem]:[tt,it,at,nt,ut,Ct,vt,ft],[se.eT.TrelloTimeRecord]:[it,ut,mt,Ct,ft]},gt={dialog:O.AH.Dialog,panel:O.AH.DialogPanel},_t={[se.vK.Checkbox]:"icons-16:checkbox-completed-card-outline",[se.vK.Date]:"icons-16:calendar-outline",[se.vK.List]:"icons-16:format-list-checks",[se.vK.Number]:"icons-16:pound",[se.vK.Text]:"icons-16:format-text"},kt=[se.eT.TrelloCard,se.eT.TrelloCheckItem,se.eT.TrelloCustomField],bt=[se.eT.TrelloCard,se.eT.TrelloCheckItem,se.eT.TrelloTimeRecord],Tt="minutes",St="hours",It="days",wt="weeks",Dt="plural",Et="singular",At={[Dt]:{[Tt]:"MISC.REMINDER_UNIT_MINUTES",[St]:"MISC.REMINDER_UNIT_HOURS",[It]:"MISC.REMINDER_UNIT_DAYS",[wt]:"MISC.REMINDER_UNIT_WEEKS"},[Et]:{[Tt]:"MISC.REMINDER_UNIT_MINUTE",[St]:"MISC.REMINDER_UNIT_HOUR",[It]:"MISC.REMINDER_UNIT_DAY",[wt]:"MISC.REMINDER_UNIT_WEEK"}},Lt=new(ke());let Rt,xt=function CardEditorController_decorate(e,t,r,i){var a,s=CardEditorController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CardEditorController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CardEditorController_isDataDescriptor(a.descriptor)||CardEditorController_isDataDescriptor(i.descriptor)){if(CardEditorController_hasDecorators(a)||CardEditorController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CardEditorController_hasDecorators(a)){if(CardEditorController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CardEditorController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CardEditorController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$element","$rootScope","$scope","$sce","$log","$window","$interval","$timeout","$translate","$mdMenu","$showdownProvider","appCommonSrv","calendarCardsSrv","dialogSrv","htmlHelperSrv","licenseSrv","notificationSrv","planywayNotificationsSrv","planywayIntegrationSrv","platformSrv","settingsSrv","telemetrySrv","timeTrackingSrv","trelloIntegrationSrv"])],(function(e){return{F:class CardEditorController{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p,m,C,v,f,y,g,k,b,T,S,I){var w;e(this),this._$element=t,this._$rootScope=r,this._$scope=i,this._$sce=a,this._$log=s,this._$window=n,this._$interval=o,this._$timeout=l,this._$translate=d,this._$mdMenu=c,this._appCommonSrv=u,this._calendarCardsSrv=p,this._dialogSrv=m,this._htmlHelperSrv=C,this._licenseSrv=v,this._notificationSrv=f,this._planywayNotificationsSrv=y,this._planywayIntegrationSrv=g,this._platformSrv=k,this._settingsSrv=b,this._telemetrySrv=T,this._timeTrackingSrv=S,this._trelloIntegrationSrv=I;const D=ae()("body");this._selectedBoards=null,this._isDescriptionEditing=!1,this._isNewCardValid=!0,this._dragState={isDragging:!1},this._cardCommentsLimit=50,this._cardTimeRecordsLimit=20,this._$scope.$on(O.FK.TrelloBoardSelectionChanged,(()=>this._selectedBoards=null)),this._$scope.$on(O.FK.CardTypeChanged,(()=>this._providerWhitelist=null)),this._$scope.$on(O.FK.TrelloCardChanged,((e,t)=>{t.calendarCard.id===this.calendarCard.id&&this._loadCommentsAsync(!0)})),this._$timeout((()=>{this._renderDelayed=!0,this._$scope.$broadcast("md-resize-textarea")}),150);const E=Ge()((()=>{var e;let t=_()(e=this._$element).call(e,".pw-dialog-edit-card-time-records-item:hover").scope();t&&this._$scope.$evalAsync((()=>t.recordHovered=!0))}),200);this._$element.on("mouseover",".pw-dialog-edit-card-time-records-item",(()=>{this._isTimeRecordsScrolling||E()}));const A=Ge()((()=>{this._$scope.$evalAsync((()=>this._isTimeRecordsScrolling=!1))}),200);let L;this._htmlHelperSrv.elementAdded(this._$element,".pw-dialog-edit-card-time-records__content",(e=>{e.on("scroll",(()=>{this._isTimeRecordsScrolling=!0,A()}))})),this._rebindRelativeDates(),this._$scope.$on(O.FK.CardDialogKeyDown,((e,t)=>{let{keyboardEvent:r}=t;ae()(r.target).is("input, textarea")?this._onInputKeyDown(r):this._onEditorKeyDown(r),this.isCommentEditing()&&ae()(r.target).closest(".pw-js-dialog-edit-card-comment")[0]&&r.ctrlKey&&r.which===O.VD.Enter&&(this._commentEditingId=null)})),this._$element.on("mousedown",".pw-js-drag-icon",(()=>{this._keepScrollFocus()}));const onClick=e=>{var t;let r=ae()(e.target);if(r.hasClass("pw-js-dialog-primary-btn")||!r.closest(".pw-dialog-edit-card")[0]||L||this.isLinkAdding()&&(r.closest(".pw-js-dialog-edit-card-link-add-panel")[0]||this.rejectLinkAdding()),this.isCheckItemAdding()?r.closest(".pw-js-dialog-edit-card-check-item-add-panel")[0]||this._$timeout((()=>{ae()(".pw-js-dialog-edit-card-check-item-add-panel-input").trigger("blur"),this.submitCheckItemAddingAsync()})):(this._$timeout((()=>ae()(".pw-js-dialog-edit-card-check-item-add-panel").removeClass("pw-dialog-edit-card-check-item--temp-check-item-editing")),0,!1),!r.closest(".pw-js-menu-btn")[0]&&r.closest(".pw-js-dialog-edit-card-check-item-add-panel")[0]&&this._$timeout((()=>r.closest(".pw-js-dialog-edit-card-check-item-add-panel").addClass("pw-dialog-edit-card-check-item--temp-check-item-editing")),0,!1)),this.isTimeRecordAdding()&&(r.closest(".pw-js-dialog-edit-card-time-record-add-panel")[0]&&!r.is(".pw-js-dialog-edit-card-time-record-add-panel")||this._$timeout((()=>{ae()(".pw-js-dialog-edit-card-time-record-add-panel-input").trigger("blur"),this.submitTimeRecordAddingAsync()}))),this.isCommentAdding()&&(this.newComment.comment||r.closest(".pw-js-dialog-edit-card-comment-add-panel")[0]||this._$timeout((()=>this.rejectCommentAdding()))),this.isCommentEditing()){r.closest(".pw-js-dialog-edit-card-comment").data("comment-id")===this._commentEditingId&&r.closest(".pw-js-dialog-edit-card-comment-input")[0]||this._$timeout((()=>this._commentEditingId=null))}null===(t=this.clickRequester)||void 0===t||t.click(),this.clickRequester=null};this._$element.on("mousedown",(e=>{L=!(!ae()(e.target).is("input, textarea")&&!_()(D).call(D,"> .md-open-menu-container.md-active, > .k-animation-container > .k-list-container.k-state-border-up")[0])})),this._$element.on("click",onClick),this._$scope.$on("$mdMenuClosed",((e,t)=>{let{causedByEvent:r}=t;ae()(r.target).closest(".pw-dialog-edit-card")[0]||onClick(r)})),this._$element.on("click",".pw-js-dialog-edit-card-description-render",(e=>{this.isBusy||this.isReadOnly||(this.isTrelloCheckItemCard||this.isTrelloTimeRecordCard)&&!this.parentCard||ae()(e.target).closest("a")[0]||this._$window.getSelection().toString()||(this.isDescriptionEditing=!0)})),this._$element.on("focus",".pw-js-dialog-edit-card-description-input",(()=>{this.isDescriptionEditing=!0})),this._$element.on("blur",".pw-js-dialog-edit-card-description-input",(()=>{this.isDescriptionEditing=!1})),Rt=()=>this._$scope.$evalAsync((()=>this._cardAttachments=null)),_()(w=this._$element).call(w,".pw-dialog-content").on("drop",(e=>{this._onDropAttachmentsAsync(e.originalEvent)}));const onBodyDragAll=e=>{e.preventDefault()},onBodyDragStart=()=>{this._toggleHighlightAttachmentsDropArea(!0)},onBodyDragEnd=e=>{e.relatedTarget||this._toggleHighlightAttachmentsDropArea(!1)};D.on("drag dragstart dragend dragenter dragover dragleave drop",onBodyDragAll).on("dragenter dragover",onBodyDragStart).on("dragleave dragend drop",onBodyDragEnd);const onDocumentPaste=e=>{this._onPasteAttachmentsAsync(e)};this._$window.document.addEventListener("paste",onDocumentPaste),this._$scope.$on("$destroy",(()=>{this._removeServiceListeners(),D.off("drag dragstart dragend dragenter dragover dragleave drop",onBodyDragAll).off("dragenter dragover",onBodyDragStart).off("dragleave dragend drop",onBodyDragEnd),this._$window.document.removeEventListener("paste",onDocumentPaste),this.isNewCard&&!this._isSaveCardCalled&&this._clearCardData(),this._keepScrollFocus(),this._$interval.cancel(this._rebindRelativeDatesInterval)})),this._registerEditor(),this.$onInit=()=>{const updateTitle=()=>{this._logCardEvent({event:O.cN.CardEvents.TitleChanged}),this._setCardPropertiesAsync({title:this.title})};this._updateTitle=this.isNewCard?Ge()(updateTitle,300):updateTitle}}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloCardEditorCtrl"}},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"field",key:"calendarCard",value:void 0},{kind:"field",key:"cardTypes",value:void 0},{kind:"field",key:"isDetailed",value:void 0},{kind:"field",key:"isDense",value:void 0},{kind:"field",key:"hasChanges",value:void 0},{kind:"field",key:"_forceDetailedMode",value:void 0},{kind:"field",key:"_dialogOpenerContext",value:void 0},{kind:"field",key:"_scrollToCommentId",value:void 0},{kind:"field",key:"clickRequester",value:void 0},{kind:"field",key:"_cardLinksForceLoadedCardsCache",value:()=>new(ke())},{kind:"field",key:"_tempCheckItemsMap",value:()=>new(ke())},{kind:"get",key:"calendarAccountId",value:function calendarAccountId(){return void 0===this._calendarAccountId&&(this._calendarAccountId=this.isNewCard?null:this.calendarCard.accountId),this._calendarAccountId}},{kind:"get",key:"setCalendarHandler",value:function setCalendarHandler(){return this._setCalendarHandler||(this._setCalendarHandler=e=>{let t=this._planywayIntegrationSrv.getConnectedAccountById(e.accountId);if(t.accountType===se.Qm.Trello)this._moveToBoardAsync(e),this._logCardEvent({event:O.cN.CardEvents.BoardChanged,data:{accountId:e.accountId,calendarId:e.id}});else{let r=(0,B.fL)(t.accountType);if(!r)return;this._logCardEvent({event:O.cN.CardEvents.CardProviderChanged,data:{providerType:r,accountId:e.accountId,calendarId:e.id}}),this._tmpAccountId=e.accountId,this._tmpCalendarId=e.id,this.calendarCard.providerType=r}}),this._setCalendarHandler}},{kind:"get",key:"providerWhitelist",value:function providerWhitelist(){return this._providerWhitelist||this.isNewCard||(this._providerWhitelist=[O.lP.Trello]),this._providerWhitelist}},{kind:"method",key:"isCardButtonVisible",value:function isCardButtonVisible(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ee()(t).call(t,(e=>{var t;if(!(null===(t=yt[this.calendarCard.cardType])||void 0===t?void 0:Z()(t).call(t,e)))return!1;switch(e){case tt:return this.hasDates||this.isTrelloCheckItemCard;case rt:return!this.isNewCard;case at:return(!this.isNewCard||this.isTrelloCard)&&!this.isLabelsEditingDisabled;case nt:return(!this.isNewCard||this.isTrelloCard)&&!this.isAttachmentsEditingDisabled;case ut:return!this.isNewCard&&this.cardUrl;case mt:return!this.isNewCard;case vt:return!this.isNewCard&&this.isTrelloCheckItemCard;case Ct:return!this.isNewCard;default:return!0}}))}},{kind:"method",key:"cancelDialog",value:function cancelDialog(){this.hideDialog(O.Xs.Cancelled)}},{kind:"get",key:"panelPopupTargetComponent",value:function panelPopupTargetComponent(){return this.isDense?Xe.Rg:Xe.ix}},{kind:"get",key:"isCompleted",value:function isCompleted(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:return this.hasDates&&this._isCompleted;case se.eT.TrelloCustomField:case se.eT.TrelloCheckItem:return this._isCompleted;default:return!1}}},{kind:"set",key:"isCompleted",value:function isCompleted(e){this._checkEditAvailable()&&this.isCompleted!==e&&(this._isCompleted=e,this._logCardEvent({event:e?O.cN.CardEvents.MarkedCompleted:O.cN.CardEvents.MarkedIncompleted,data:{by:O.AH.Dialog}}),this._setCardPropertiesAsync({isCompleted:e}))}},{kind:"get",key:"cardNumber",value:function cardNumber(){if(this._collectionSettings.global.settings.showCardNumber)return this.calendarCard.providerCard.cardNumber}},{kind:"get",key:"titlePlaceholder",value:function titlePlaceholder(){switch(this.calendarCard.cardType){case se.eT.TrelloCheckItem:return this._$translate.instant("MISC.ADD_CHECK_ITEM_TITLE");case se.eT.TrelloTimeRecord:return this._$translate.instant(this.isNewCard?"MISC.ADD_TIME_RECORD_COMMENT_FOR_ADD_MANUALLY":"MISC.ADD_TIME_RECORD_COMMENT_PLACEHOLDER");default:return this._$translate.instant("MISC.ADD_CARD_TITLE")}}},{kind:"get",key:"title",value:function title(){return this._title}},{kind:"set",key:"title",value:function title(e){if(this._checkEditAvailable()){if(!e)switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCheckItem:if(!this.isNewCard)return;break;case se.eT.TrelloTimeRecord:break;default:return}this.title!==e&&(this._title=e,this._updateTitle())}}},{kind:"get",key:"availableCardTypes",value:function availableCardTypes(){if(!this._availableCardTypes){var e;let t=null!==(e=this.cardTypes)&&void 0!==e?e:[];0===t.length&&((this.isNewCard||this.isTrelloCard)&&t.push(se.eT.TrelloCard),!this.isNewCard&&this.isTrelloCustomFieldCard&&t.push(se.eT.TrelloCustomField),!this.isNewCard&&this.isTrelloCheckItemCard&&t.push(se.eT.TrelloCheckItem),(this.isNewCard||this.isTrelloTimeRecordCard)&&t.push(se.eT.TrelloTimeRecord));const r=this._appCommonSrv.getSchedulerMode();this._availableCardTypes=n()(t).call(t,(e=>{let t;switch(e){case se.eT.TrelloCard:const e=this;t={cardType:se.eT.TrelloCard,get cardRole(){return e.calendarCard.cardRole},get title(){return e.isMilestone?e._$translate.instant("BUTTONS.CARD_TYPE_TRELLO_MILESTONE"):e._$translate.instant("BUTTONS.CARD_TYPE_TRELLO_CARD")},get classes(){return e.isMilestone?"pw-dialog-edit-card__content-card-type--milestone":""},get icon(){return e.isMilestone?"icons-16:milestones":null},convert:()=>e.isMilestone?e.convertToMilestoneAsync():e.convertToCardAsync(),isAvailableToCreate:r===O.ud.Calendar||r===O.ud.Timeline};break;case se.eT.TrelloCheckItem:t={cardType:se.eT.TrelloCheckItem,cardRole:se.D.Card,title:this._$translate.instant("BUTTONS.CARD_TYPE_TRELLO_CHECK_LIST_ITEM"),classes:"",icon:null,convert:()=>this.convertToCheckItemAsync(),isAvailableToCreate:!1};break;case se.eT.TrelloCustomField:t={cardType:se.eT.TrelloCustomField,cardRole:se.D.Card,title:this._$translate.instant("BUTTONS.CARD_TYPE_TRELLO_CUSTOM_FIELD"),classes:"",icon:null,convert:()=>{},isAvailableToCreate:!1};break;case se.eT.TrelloTimeRecord:t={cardType:se.eT.TrelloTimeRecord,cardRole:se.D.Card,title:this._$translate.instant("BUTTONS.CARD_TYPE_TRELLO_TIME_RECORD"),classes:"",icon:null,convert:()=>this.convertToTimeRecordAsync(),isAvailableToCreate:!0}}return c()(t,"isReadOnly",{get:()=>{var e;return!t.isAvailableToCreate||1===w()(e=this._availableCardTypes).call(e,(e=>e.isAvailableToCreate)).length}}),t}))}return this._availableCardTypes}},{kind:"get",key:"selectedCardType",value:function selectedCardType(){var e;return _()(e=this.availableCardTypes).call(e,(e=>{let{cardType:t,cardRole:r}=e;return t===this.calendarCard.cardType&&r===this.calendarCard.cardRole}))}},{kind:"method",key:"convertToCardAsync",value:async function convertToCardAsync(){this._updateCardPromise&&await this._updateCardPromise;let e,t,r=this.isAllDay,i=this.startDate,a=this.endDate;if(r&&(i=(0,N.$Y)(i),a=(0,N.$Y)(a)),this.isTrelloCard||(e=this._planywayNotificationsSrv.getDefaultReminders(this.isAllDay),e.length>0&&(t=!0)),this.isMilestone){var s,n,o,l;let e=r?null!==(s=null===(n=this.cardBoard)||void 0===n?void 0:n.dueLinkTypeAllDay)&&void 0!==s?s:se.PL.DueEnd:null!==(o=null===(l=this.cardBoard)||void 0===l?void 0:l.dueLinkType)&&void 0!==o?o:se.PL.DueStart;if(r)switch(e){case se.PL.DueStart:a=i,this._endDate=a;break;case se.PL.DueEnd:case se.PL.NotLinked:i=a,this._startDate=i}else switch(e){case se.PL.DueStart:a=(0,N.mH)(i,et.XM),this._endDate=a;break;case se.PL.DueEnd:case se.PL.NotLinked:i=(0,N.mH)(a,-et.XM),this._startDate=i}}this._maxEndDate=null,this._clearCardData(se.eT.TrelloCard),this._calendarCardsSrv.changeCalendarCardType(this.calendarCard,se.eT.TrelloCard,this.calendarCard.accountId),this._isNewCardValid=!0,this._logCardEvent({event:O.cN.CardEvents.TypeChanged,data:{by:O.AH.Dialog,cardType:se.eT.TrelloCard}}),this._$scope.$broadcast(O.FK.CardTypeChanged),await this._setCardPropertiesAsync({cardRole:se.D.Card,isAllDay:r,start:i,end:a,notifications:e,isSubscribed:t}),this.isNewCard&&(this.title||ae()(".pw-js-edit-card-dialog-title").trigger("focus"))}},{kind:"method",key:"convertToCheckItemAsync",value:async function convertToCheckItemAsync(){var e;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.AdvancedChecklists,!0))return;this._updateCardPromise&&await this._updateCardPromise;let t=this.isAllDay,r=this.startDate,i=this.endDate;if(t&&(r=(0,N.$Y)(r),i=(0,N.$Y)(i)),this.isMilestone){var a,s,n,o;let e=t?null!==(a=null===(s=this.cardBoard)||void 0===s?void 0:s.dueLinkTypeAllDay)&&void 0!==a?a:se.PL.DueEnd:null!==(n=null===(o=this.cardBoard)||void 0===o?void 0:o.dueLinkType)&&void 0!==n?n:se.PL.DueStart;if(t)switch(e){case se.PL.DueStart:i=r,this._endDate=i;break;case se.PL.DueEnd:case se.PL.NotLinked:r=i,this._startDate=r}else switch(e){case se.PL.DueStart:i=(0,N.mH)(r,et.XM),this._endDate=i;break;case se.PL.DueEnd:case se.PL.NotLinked:r=(0,N.mH)(i,-et.XM),this._startDate=r}}this._maxEndDate=null;let l=new(Te())(Ie()(e=De()(this.calendarCard.providerCard.memberIds)).call(e,0,1));this._clearCardData(se.eT.TrelloCheckItem),this._calendarCardsSrv.changeCalendarCardType(this.calendarCard,se.eT.TrelloCheckItem,this.calendarCard.accountId),this._isNewCardValid=!0,this._logCardEvent({event:O.cN.CardEvents.TypeChanged,data:{by:O.AH.Dialog,cardType:se.eT.TrelloCheckItem}}),this._$scope.$broadcast(O.FK.CardTypeChanged),await this._setCardPropertiesAsync({cardRole:se.D.Card,isAllDay:t,start:r,end:i,memberIds:l}),this.isNewCard&&(this.title?this.parentCard||ae()(".pw-js-card-select-search-input").trigger("focus"):ae()(".pw-js-edit-card-dialog-title").trigger("focus"))}},{kind:"method",key:"convertToTimeRecordAsync",value:async function convertToTimeRecordAsync(){if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))return;this._updateCardPromise&&await this._updateCardPromise;let e=this.isAllDay,t=this.startDate,r=this.endDate;if(e){let i=this._timeTrackingSrv.timeRecordDefaultDurationMinutes;e=!1,(0,N.KC)(t,new Date)?(r=(0,N.GG)(new Date,"quarterHour"),t=(0,N.mH)(r,-i)):(t=(0,N.nT)(t),r=(0,N.mH)(t,i))}else(0,N.CX)(t,r)>this._timeTrackingSrv.timeRecordMaxDurationMinutes&&(r=(0,N.mH)(t,this._timeTrackingSrv.timeRecordMaxDurationMinutes));if(this.isMilestone){var i,a,s,n;let o=e?null!==(i=null===(a=this.cardBoard)||void 0===a?void 0:a.dueLinkTypeAllDay)&&void 0!==i?i:se.PL.DueEnd:null!==(s=null===(n=this.cardBoard)||void 0===n?void 0:n.dueLinkType)&&void 0!==s?s:se.PL.DueStart;if(e)switch(o){case se.PL.DueStart:r=t,this._endDate=r;break;case se.PL.DueEnd:case se.PL.NotLinked:t=r,this._startDate=t}else switch(o){case se.PL.DueStart:r=(0,N.mH)(t,this._timeTrackingSrv.timeRecordDefaultDurationMinutes),this._endDate=r;break;case se.PL.DueEnd:case se.PL.NotLinked:t=(0,N.mH)(r,-this._timeTrackingSrv.timeRecordDefaultDurationMinutes),this._startDate=t}}this._maxEndDate=null;let o=new(Te())([this._currentMemberId]);this._clearCardData(se.eT.TrelloTimeRecord),this._calendarCardsSrv.changeCalendarCardType(this.calendarCard,se.eT.TrelloTimeRecord,this.calendarCard.accountId),this._isNewCardValid=!0,this._logCardEvent({event:O.cN.CardEvents.TypeChanged,data:{by:O.AH.Dialog,cardType:se.eT.TrelloTimeRecord}}),this._$scope.$broadcast(O.FK.CardTypeChanged),await this._setCardPropertiesAsync({cardRole:se.D.Card,isAllDay:e,start:t,end:r,memberIds:o}),this.isNewCard&&(this.title?this.parentCard||ae()(".pw-js-card-select-search-input").trigger("focus"):ae()(".pw-js-edit-card-dialog-title").trigger("focus"))}},{kind:"method",key:"convertToMilestoneAsync",value:async function convertToMilestoneAsync(){var e,t,r,i;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Milestones,!0))return;this._updateCardPromise&&await this._updateCardPromise;let a,s,n=this.isAllDay,o=this.startDate,l=this.endDate;switch(n&&(o=(0,N.$Y)(o),l=(0,N.$Y)(l)),this.isTrelloCard||(a=this._planywayNotificationsSrv.getDefaultReminders(this.isAllDay),a.length>0&&(s=!0)),n?null!==(e=null===(t=this.cardBoard)||void 0===t?void 0:t.dueLinkTypeAllDay)&&void 0!==e?e:se.PL.DueEnd:null!==(r=null===(i=this.cardBoard)||void 0===i?void 0:i.dueLinkType)&&void 0!==r?r:se.PL.DueStart){case se.PL.DueStart:l=o,this._endDate=l;break;case se.PL.DueEnd:case se.PL.NotLinked:o=l,this._startDate=o}this._maxEndDate=null,this._clearCardData(se.eT.TrelloCard),this._calendarCardsSrv.changeCalendarCardType(this.calendarCard,se.eT.TrelloCard,this.calendarCard.accountId),this._isNewCardValid=!0,this._logCardEvent({event:O.cN.CardEvents.TypeChanged,data:{by:O.AH.Dialog,cardType:se.eT.TrelloCard,cardRole:se.D.Milestone}}),this._$scope.$broadcast(O.FK.CardTypeChanged),await this._setCardPropertiesAsync({cardRole:se.D.Milestone,isAllDay:n,start:o,end:l,notifications:a,isSubscribed:s}),this.isNewCard&&(this.title||ae()(".pw-js-edit-card-dialog-title").trigger("focus"))}},{kind:"get",key:"parentCard",value:function parentCard(){return this._parentCard}},{kind:"set",key:"parentCard",value:function parentCard(e){var t;if(!this._checkEditAvailable())return;if(this.parentCard===e)return;let r;if(e?(this.parentCard&&this._logCardEvent({event:O.cN.CardEvents.ParentCardChanged}),r=this._parentCard,this._parentCard=e,this.calendarCard.providerCard.parentId=e.id,this.calendarCard.providerCard.boardId=e.providerCard.boardId,this.calendarCard.providerCard.listId=e.providerCard.listId,this.calendarCard.providerCard.labelIds=e.providerCard.labelIds,this.calendarCard.description=e.description,this._isNewCardValid=!0):(this._parentCard=null,this.calendarCard.providerCard.parentId=null,this.calendarCard.providerCard.labelIds=new(Te()),this.calendarCard.description=null),this.setCardBoard(this.calendarCard.accountId,this.calendarCard.providerCard.boardId),this._cardLabels=null,this._cardMembers=null,this.calendarCard.providerCard.memberIds=w()(t=this.calendarCard.providerCard.memberIds).call(t,(e=>{var t;return ee()(t=this.cardBoard.members).call(t,(t=>t.id===e))})),this.calendarCard.cardType===se.eT.TrelloTimeRecord)this.calendarCard.providerCard.hasMembers||(this.calendarCard.providerCard.memberIds=new(Te())([this._currentMemberId]));if(this.isNewCard)this._calendarCardsSrv.updateCalendarCardAsync(this.calendarCard);else if(this.calendarCard.cardType===se.eT.TrelloTimeRecord)(async()=>{try{this.isBusy=!0,await this._calendarCardsSrv.moveCalendarCardTimeRecordAsync(r,this.calendarCard.id,e)}catch(e){this._$log.error("Planyway time entry updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_TIME_ENTRY_ERROR"),O.k$.Error)}finally{this.isBusy=!1}})()}},{kind:"get",key:"canChangeParentCard",value:function canChangeParentCard(){if(this.isReadOnly)return!1;switch(this.calendarCard.cardType){case se.eT.TrelloCheckItem:return this.isNewCard;case se.eT.TrelloTimeRecord:return!0;default:return!1}}},{kind:"get",key:"parentCardSearchString",value:function parentCardSearchString(){return this._parentCardSearchString}},{kind:"set",key:"parentCardSearchString",value:function parentCardSearchString(e){this._parentCardSearchString=e}},{kind:"method",key:"parentCardFilter",value:function parentCardFilter(e){switch(this.calendarCard.cardType){case se.eT.TrelloCheckItem:case se.eT.TrelloTimeRecord:return e.cardType===se.eT.TrelloCard&&!e.isReadOnly&&!e.providerCard.isArchived&&(this.isNewCard||e.accountId===this.calendarAccountId);default:return!1}}},{kind:"method",key:"openParentCard",value:function openParentCard(){this.parentCard&&(this._logCardEvent({event:O.cN.CardEvents.ParentCardOpened}),this._dialogSrv.showEditCardDialogAsync(this.parentCard,{openerContext:this._dialogOpenerContext,noAnimation:this.isDetailed}))}},{kind:"get",key:"hasDates",value:function hasDates(){return this.calendarCard.hasDates}},{kind:"get",key:"isSingleDate",value:function isSingleDate(){return this.calendarCard.isSingleDate}},{kind:"get",key:"isCardDatesYearShown",value:function isCardDatesYearShown(){return!(0,N.FT)(this.startDate,new Date)||!(0,N.FT)(this.endDate,new Date)}},{kind:"get",key:"isAllDay",value:function isAllDay(){return this._isAllDay}},{kind:"set",key:"isAllDay",value:function isAllDay(e){if(this._checkEditAvailable()&&this.isAllDay!==e){if(this._isAllDay=e,this.calendarCard.cardType===se.eT.TrelloTimeRecord)this.isAllDay?(this._startDate=(0,N.$Y)(this.startDate),this._endDate=this.startDate):(0,N.KC)(this.startDate,new Date)?(this._endDate=(0,N.GG)(new Date,"quarterHour"),this._startDate=(0,N.mH)(this.endDate,-this.durationMinutes)):(this._startDate=(0,N.nT)(this.startDate),this._endDate=(0,N.mH)(this.startDate,this.durationMinutes)),this._maxEndDate=null,this._logCardEvent({event:e?O.cN.CardEvents.TimeRemoved:O.cN.CardEvents.TimeAdded}),this._setCardPropertiesAsync({isAllDay:e,start:this.startDate,end:this.endDate,durationMinutes:this.durationMinutes});else{this.isAllDay?(this._startDate=(0,N.$Y)(this.startDate),this._endDate=this.endDate):(this._startDate=(0,N.nT)(this.startDate),this._endDate=(0,N.mH)((0,N.nT)(this.endDate),et.XM)),this._maxEndDate=null,this._logCardEvent({event:e?O.cN.CardEvents.IsAllDaySet:O.cN.CardEvents.IsAllDayUnset});let t,r=this._planywayNotificationsSrv.getDefaultReminders(this.isAllDay);r.length>0&&(t=!0),this._setCardPropertiesAsync({isAllDay:e,start:this.startDate,end:this.endDate,notifications:r,isSubscribed:t})}this._cardReminders=null}}},{kind:"get",key:"startDate",value:function startDate(){return this._startDate}},{kind:"set",key:"startDate",value:function startDate(e){if(this._checkEditAvailable()){if(e&&!(0,N.rs)(this.startDate,e)){if(this.hasDates){if(this.isAllDay){let t=(0,N.i2)(this.startDate,this.endDate);this._startDate=e,this._endDate=(0,N.E4)(this.startDate,t)}else{let t=(0,N.CX)(this.startDate,this.endDate);this._startDate=e,this._endDate=(0,N.mH)(this.startDate,t)}this._logCardEvent({event:O.cN.CardEvents.StartChanged}),this._setCardPropertiesAsync({start:e,end:this.endDate})}else{this._isAllDay=!0,this._startDate=e,this._endDate=e,this._isNewCardValid=!0,this._logCardEvent({event:O.cN.CardEvents.Scheduled,data:{by:O.AH.SetDates}});let t,r=this._planywayNotificationsSrv.getDefaultReminders(this.isAllDay);r.length>0&&(t=!0),this._setCardPropertiesAsync({isAllDay:this.isAllDay,start:e,end:e,notifications:r,isSubscribed:t})}this._maxEndDate=null}}else this._$timeout((()=>this._startDate=this._startDate&&new Date(this._startDate)))}},{kind:"get",key:"endDate",value:function endDate(){return this._endDate}},{kind:"set",key:"endDate",value:function endDate(e){if(this._checkEditAvailable()){if(e&&!(0,N.rs)(this.endDate,e)){if(this.hasDates)this._endDate=e,this._logCardEvent({event:O.cN.CardEvents.EndChanged}),this._setCardPropertiesAsync({end:e});else{this._isAllDay=!0,this._startDate=e,this._endDate=e,this._isNewCardValid=!0,this._logCardEvent({event:O.cN.CardEvents.Scheduled,data:{by:O.AH.SetDates}});let t,r=this._planywayNotificationsSrv.getDefaultReminders(this.isAllDay);r.length>0&&(t=!0),this._setCardPropertiesAsync({isAllDay:this.isAllDay,start:e,end:e,notifications:r,isSubscribed:t})}this._maxEndDate=null}}else this._$timeout((()=>this._endDate=this._endDate&&new Date(this._endDate)))}},{kind:"get",key:"minEndDate",value:function minEndDate(){return this.startDate}},{kind:"get",key:"maxEndDate",value:function maxEndDate(){if(this.calendarCard.cardType===se.eT.TrelloTimeRecord)return this._maxEndDate||((0,N.KC)(this.startDate,new Date)&&(0,N.KC)(this.endDate,new Date)?this._maxEndDate=(0,N.h3)(this.startDate):this._maxEndDate=(0,N.v8)(this.startDate,this._timeTrackingSrv.timeRecordMaxDurationSeconds)),this._maxEndDate}},{kind:"method",key:"onAddEstimationClick",value:function onAddEstimationClick(){this._logCardEvent({event:O.cN.CardEvents.EstimationClicked})}},{kind:"method",key:"beginEstimatedHoursEditing",value:function beginEstimatedHoursEditing(){this.isEstimatedHoursEditing=!0}},{kind:"method",key:"submitEstimatedHoursEditing",value:function submitEstimatedHoursEditing(e,t){var r;this.isEstimatedHoursEditing=!1,this._estimationAddingBy=e;let i=Ae()(null==t||null===(r=t.target)||void 0===r?void 0:r.value);this.estimationHours=Re()(i)?null:i}},{kind:"get",key:"isEstimatedHoursEditing",value:function isEstimatedHoursEditing(){return this._isEstimatedHoursEditing}},{kind:"set",key:"isEstimatedHoursEditing",value:function isEstimatedHoursEditing(e){this._isEstimatedHoursEditing=e}},{kind:"get",key:"estimationHours",value:function estimationHours(){return void 0!==this._dirtyEstimationHours?this._dirtyEstimationHours:this.calendarCard.providerCard.estimationHours}},{kind:"set",key:"estimationHours",value:function estimationHours(e){if(this.calendarCard.cardType===se.eT.TrelloCard&&this._checkEditAvailable()&&(null!==e&&(e=(0,N.QV)((0,N.uZ)(e,this.minEstimationHours,this.maxEstimationHours),2)),this.estimationHours!==e)){let t,r=null!==this.estimationHours&&void 0!==this.estimationHours,i=null!=e;if(i&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TaskEstimation,!0))return;t=!r&&i?O.cN.CardEvents.EstimationAdded:r&&!i?O.cN.CardEvents.EstimationDeleted:O.cN.CardEvents.EstimationChanged,this._logCardEvent({event:t,data:{by:gt[this._estimationAddingBy],estimationHours:e}}),this._dirtyEstimationHours=e,(async()=>{await this._setCardPropertiesAsync({estimationHours:e}),this._dirtyEstimationHours=void 0})()}}},{kind:"field",key:"onSetEstimationHours",value(){return e=>{this._estimationAddingBy="panel",this.estimationHours=e}}},{kind:"get",key:"minEstimationHours",value:function minEstimationHours(){return.01}},{kind:"get",key:"maxEstimationHours",value:function maxEstimationHours(){return 8760}},{kind:"get",key:"cardEstimation",value:function cardEstimation(){var e;let t=(null!==(e=this.parentCard)&&void 0!==e?e:this.calendarCard).providerCard.estimationHours;if(t)return`${t}h`}},{kind:"get",key:"isCardUnderestimated",value:function isCardUnderestimated(){var e;let t=null!==(e=this.parentCard)&&void 0!==e?e:this.calendarCard,r=t.providerCard.estimationHours,i=t.providerCard.totalTimeRecordDurationHours;return!(!i||!r)&&i>r}},{kind:"get",key:"underestimatedCardTooltip",value:function underestimatedCardTooltip(){return this._underestimatedCardTooltip||(this._underestimatedCardTooltip=this._$sce.trustAsHtml(this._$translate.instant("TOOLTIPS.UNDERESTIMATED_CARD"))),this._underestimatedCardTooltip}},{kind:"get",key:"durationMinutes",value:function durationMinutes(){return this._durationMinutes}},{kind:"set",key:"durationMinutes",value:function durationMinutes(e){this._checkEditAvailable()&&this.durationMinutes!==e&&(this._durationMinutes=e,this._logCardEvent({event:O.cN.CardEvents.DurationChanged,data:{durationMinutes:e}}),this.isAllDay||(this.endDate=(0,N.mH)(this.startDate,e)),this._setCardPropertiesAsync({durationMinutes:e}))}},{kind:"get",key:"isRecurringAvailable",value:function isRecurringAvailable(){return!(this.isReadOnly&&!this.recurrenceRule)&&(this.hasDates&&!this.isMilestone&&!this.isTrelloCustomFieldCard&&!this.isTrelloCheckItemCard&&!this.isTrelloTimeRecordCard&&!this.calendarCard.recurrenceId)}},{kind:"get",key:"recurrenceRule",value:function recurrenceRule(){return this._recurrenceRule}},{kind:"set",key:"recurrenceRule",value:function recurrenceRule(e){e&&!this._checkEditAvailable()||this.recurrenceRule!==e&&(this._recurrenceRule=e,this._logCardEvent({event:O.cN.CardEvents.RecurrenceRuleChanged,data:{recurrenceRule:e}}),this._setCardPropertiesAsync({recurrenceRule:e}))}},{kind:"get",key:"isRecurrentCard",value:function isRecurrentCard(){return!(!this.recurrenceRule&&!this.calendarCard.recurrenceId)}},{kind:"get",key:"priority",value:function priority(){return this._priority}},{kind:"set",key:"priority",value:function priority(e){if((!e||this._checkEditAvailable())&&this.priority!==e){if(this._priority=e,this._isProviderTypeChanging)return;this._setCardPropertiesAsync({priority:this._priority.value})}}},{kind:"get",key:"availablePriorities",value:function availablePriorities(){return this._availablePriorities||(this._availablePriorities=[{label:this._$translate.instant("MENU.PRIORITY_HIGH"),value:3},{label:this._$translate.instant("MENU.PRIORITY_MEDIUM"),value:2},{label:this._$translate.instant("MENU.PRIORITY_LOW"),value:1},{label:this._$translate.instant("MENU.PRIORITY_UNSET"),value:0}]),this._availablePriorities}},{kind:"method",key:"setPriority",value:function setPriority(e,t){t&&(this.priority=t,this._logCardEvent({event:O.cN.CardEvents.PriorityChanged,data:{by:gt[e],priority:this.priority.value}}))}},{kind:"get",key:"isBoardEditingDisabled",value:function isBoardEditingDisabled(){return this.isTrelloCheckItemCard||this.isTrelloTimeRecordCard}},{kind:"get",key:"selectedBoards",value:function selectedBoards(){var e;null===this._selectedBoards&&(this._selectedBoards=K()(e=this._provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{let t=this._provider.getCurrentCollectionSelectedCalendarIds(e);return n()(t).call(t,(t=>this._trelloIntegrationSrv.getTrelloBoardById(e,t)))})));return this._selectedBoards}},{kind:"get",key:"cardBoard",value:function cardBoard(){return this._cardBoard}},{kind:"method",key:"setCardBoard",value:function setCardBoard(e,t){e&&t&&(this._cardBoard=this._trelloIntegrationSrv.getTrelloBoardById(e,t),this._cardBoardLabels=null,this._cardBoardMembers=null,this._cardBoardLists=null,this._cardCustomFields=null)}},{kind:"get",key:"isListAvailable",value:function isListAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return this.cardBoard;case se.eT.TrelloCheckItem:case se.eT.TrelloTimeRecord:return this.parentCard&&this.cardBoard}return!1}},{kind:"get",key:"isListEditingDisabled",value:function isListEditingDisabled(){return this.isTrelloCheckItemCard||this.isTrelloTimeRecordCard}},{kind:"get",key:"cardList",value:function cardList(){if(!this._cardList&&this.cardBoard){if(this.calendarCard.providerCard.listId&&(this._cardList=this._trelloIntegrationSrv.getTrelloListById(this.calendarCard.accountId,this.calendarCard.providerCard.listId),!this._cardList))return this._cardList={name:this._$translate.instant("DIALOGS.UNKNOWN_LIST")},this._cardList;if(!this._cardList||this._cardList.boardId!==this.cardBoard.id){var e;let t=this.cardBoard.defaultListId&&_()(e=this.cardBoardLists).call(e,(e=>e.id===this.cardBoard.defaultListId));t||(t=this.cardBoardLists[0]||{name:this._$translate.instant("DIALOGS.NEW_LIST")}),this._cardList=t}}return this._cardList}},{kind:"get",key:"cardBoardLists",value:function cardBoardLists(){if(!this.cardBoard)return[];if(!this._cardBoardLists){var e,t;if(this.cardBoard.lists.length>0)this._cardBoardLists=n()(e=re()(t=this.cardBoard.lists).call(t,N.H9)).call(e,(e=>CardEditorController_objectSpread({},e)));else this._cardBoardLists=[{name:this._$translate.instant("DIALOGS.NEW_LIST")}];this._cardList=null}return this._cardBoardLists}},{kind:"method",key:"moveToList",value:function moveToList(e){var t,r;e.id&&this._checkEditAvailable()&&(this._cardList&&this._cardList.id===e.id||(this._cardList&&this._logCardEvent({event:O.cN.CardEvents.ListChanged}),this._cardList=null,this._setCardPropertiesAsync({boardId:(null===(t=this._cardBoard)||void 0===t?void 0:t.id)!==e.boardId?e.boardId:void 0,listId:e.id,position:null===(r=this._cardBoard)||void 0===r?void 0:r.defaultCardPosition})))}},{kind:"get",key:"isLabelsAvailable",value:function isLabelsAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return this.cardBoard;case se.eT.TrelloCheckItem:return this.parentCard&&this.cardBoard&&this.cardLabels.length>0}return!1}},{kind:"get",key:"isLabelsEditingDisabled",value:function isLabelsEditingDisabled(){return this.isTrelloCheckItemCard||this.isTrelloTimeRecordCard}},{kind:"get",key:"cardLabels",value:function cardLabels(){if(this.delayRender||this._isProviderTypeChanging)return[];if(!this.cardBoard)return[];var e,t,r,i;this._cardLabels||(this._cardLabels=n()(e=re()(t=w()(r=n()(i=De()(this.calendarCard.providerCard.labelIds)).call(i,(e=>this._trelloIntegrationSrv.getTrelloLabelById(this.calendarCard.accountId,e)))).call(r,(e=>e&&this.calendarCard.providerCard.boardId===e.boardId))).call(t,N.G4)).call(e,(e=>CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{name:e.name||this._$translate.instant(e.color?O.y_[e.color]:"MISC.LABEL_COLOR_NO_COLOR")}))));return this._cardLabels}},{kind:"get",key:"cardBoardLabels",value:function cardBoardLabels(){if(this.delayRender)return[];if(!this.cardBoard)return[];var e,t,r;this._cardBoardLabels||(this._cardBoardLabels=n()(e=re()(t=w()(r=this.cardBoard.labels).call(r,(e=>e.id!==$.$d))).call(t,N.G4)).call(e,(e=>CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{name:e.name||this._$translate.instant(e.color?O.y_[e.color]:"MISC.LABEL_COLOR_NO_COLOR"),isSelected:this.calendarCard.providerCard.labelIds.has(e.id)}))),this._cardLabels=null);return this._cardBoardLabels}},{kind:"method",key:"toggleLabel",value:function toggleLabel(e,t){if(!this._checkEditAvailable())return;this._cardBoardLabels=null;let r=!this.calendarCard.providerCard.labelIds.has(t.id);this._logCardEvent({event:r?O.cN.CardEvents.LabelAdded:O.cN.CardEvents.LabelRemoved,data:{by:gt[e]}}),this._setCardPropertiesAsync({labelIds:(0,ne.iG)(this.calendarCard,t.id)})}},{kind:"method",key:"showEditLabelsDialog",value:function showEditLabelsDialog(e){this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.LabelEditDialogOpened,{where:this._dialogOpenerContext.telemetryWhere,by:gt[e]}),this._dialogSrv.showEditLabelsDialogAsync({accountId:this.calendarCard.accountId,boardId:this.calendarCard.providerCard.boardId,calendarCard:this.calendarCard})}},{kind:"get",key:"isMembersAvailable",value:function isMembersAvailable(){return!this._isProviderTypeChanging&&!!this.cardBoard}},{kind:"get",key:"isMultipleMembersSupported",value:function isMultipleMembersSupported(){return(0,ne.xZ)(this.calendarCard)}},{kind:"get",key:"isMemberRequired",value:function isMemberRequired(){return(0,ne.Ms)(this.calendarCard)}},{kind:"get",key:"cardMembers",value:function cardMembers(){if(this.delayRender)return[];if(!this.cardBoard)return[];let e=this._trelloIntegrationSrv.getTrelloMemberById(this.calendarCard.accountId,this._currentMemberId);var t,r,i;this._cardMembers||(this._cardMembers=re()(t=w()(r=n()(i=De()(this.calendarCard.providerCard.memberIds)).call(i,(e=>this._trelloIntegrationSrv.getTrelloMemberById(this.calendarCard.accountId,e)))).call(r,(e=>e))).call(t,((t,r)=>(0,N.Yb)(t,r,e))));return this._cardMembers}},{kind:"get",key:"cardBoardMembers",value:function cardBoardMembers(){if(this.delayRender||this._isProviderTypeChanging)return[];if(!this.cardBoard)return[];let e=this._trelloIntegrationSrv.getTrelloMemberById(this.calendarCard.accountId,this._currentMemberId);var t,r,i;this._cardBoardMembers||(this._cardBoardMembers=n()(t=re()(r=w()(i=this.cardBoard.members).call(i,(e=>e.id!==$.$d))).call(r,((t,r)=>(0,N.Yb)(t,r,e)))).call(t,(e=>CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{isSelected:this.calendarCard.providerCard.memberIds.has(e.id)}))),this._cardMembers=null);return this._cardBoardMembers}},{kind:"get",key:"memberFilter",value:function memberFilter(){return this._memberFilter}},{kind:"set",key:"memberFilter",value:function memberFilter(e){this._memberFilter=e,e&&(this._memberFilterRegex=(0,N.n0)(e))}},{kind:"method",key:"filterMembersByFullName",value:function filterMembersByFullName(){return e=>!this.memberFilter||this._memberFilterRegex.test(e.fullName)}},{kind:"method",key:"toggleMember",value:function toggleMember(e,t){if(!this._checkEditAvailable())return;this._cardBoardMembers=null;let r=!this.calendarCard.providerCard.memberIds.has(t.id),i=t.id===this._currentMemberId,a=(0,ne.Pv)(this.calendarCard,t.id);this._logCardEvent({event:r?i?O.cN.CardEvents.MemberAssignedSelf:O.cN.CardEvents.MemberAssigned:i?O.cN.CardEvents.MemberUnassignedSelf:O.cN.CardEvents.MemberUnassigned,data:{by:gt[e],memberIds:a}}),this._setCardPropertiesAsync({memberIds:a})}},{kind:"get",key:"isLinksAvailable",value:function isLinksAvailable(){return this.calendarCard.cardType===se.eT.TrelloCard&&(this.calendarCard.providerCard.canHaveLinks&&(!this.isReadOnly||this.cardLinks.length>0))}},{kind:"get",key:"tempLink",value:function tempLink(){return this._tempLink}},{kind:"method",key:"isLinkAdding",value:function isLinkAdding(){return this._isLinkAdding}},{kind:"method",key:"beginLinkAdding",value:function beginLinkAdding(e){if(this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Dependencies,!0))if(this.isLinkAdding())this.rejectLinkAdding();else{var t;if(!this._tempLink)this._tempLink={isBusy:!0,linkType:_()(t=this.availableCardLinkTypes).call(t,(e=>e.value===O.z7.IsBlockedBy))};this._linkAddingBy=e,this._$scope.$evalAsync((()=>{this._isLinkAdding=!0,this._scrollToSection("links")}))}}},{kind:"method",key:"rejectLinkAdding",value:function rejectLinkAdding(){this._$scope.$evalAsync((()=>{this._tempLink=null,this._isLinkAdding=!1}))}},{kind:"method",key:"submitLinkAddingAsync",value:async function submitLinkAddingAsync(){var e;if(this.isLinkAdding()&&null!==(e=this._tempLink)&&void 0!==e&&e.linkedCard)try{this._logCardEvent({event:O.cN.CardEvents.CardLinkAdded,data:{by:gt[this._linkAddingBy],linkType:this.tempLink.linkType.value}}),this._hasChanges=!0,this._isLinkAdding=!1,this._cardLinks=null,this.cardLinks.push(CardEditorController_objectSpread(CardEditorController_objectSpread({},this.tempLink),{},{toCardId:this.tempLink.linkedCard.id})),await this._calendarCardsSrv.createCalendarCardLinkAsync(this.calendarCard,this.tempLink.linkedCard.id,this.tempLink.linkType.value),this._tempLink=null}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardLinks=null))}}},{kind:"get",key:"availableCardLinkTypes",value:function availableCardLinkTypes(){return this._availableCardLinkTypes||(this._availableCardLinkTypes=[{value:O.z7.IsBlockedBy,title:this._$translate.instant("MENU.CARD_LINK_IS_BLOCKED_BY"),color:"#ff9800",description:this._$translate.instant("MENU.CARD_LINK_IS_BLOCKED_BY_DESCRIPTION"),placeholder:this._$translate.instant("MENU.CARD_LINK_ADD_WAITING_ON_CARD")},{value:O.z7.Blocks,title:this._$translate.instant("MENU.CARD_LINK_BLOCKS"),color:"#ef6a6e",description:this._$translate.instant("MENU.CARD_LINK_BLOCKS_DESCRIPTION"),placeholder:this._$translate.instant("MENU.CARD_LINK_ADD_CARD_THAT_IS_BLOCKED")}]),this._availableCardLinkTypes}},{kind:"method",key:"linkedCardFilter",value:function linkedCardFilter(e){var t,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=i&&_()(t=this.cardLinks).call(t,(e=>e.toCardId===i.id));return this.calendarCard.cardType===se.eT.TrelloCard&&(e.providerCard.canHaveLinks&&e.id!==this.calendarCard.id&&!e.isReadOnly&&!e.providerCard.isArchived&&(!ee()(r=this.cardLinks).call(r,(t=>t.toCardId===e.id))||a&&a.linkedCard===e))}},{kind:"get",key:"cardLinks",value:function cardLinks(){if(this.delayRender)return[];if(!this.cardBoard)return[];if(!this.isTrelloCard)return[];if(!this._cardLinks){let e=this._calendarCardsSrv.getCalendarCardLinks(this.calendarCard)||[];this._cardLinks=n()(e).call(e,(e=>{let t=e.linkError===O.DB.NoCard&&!this._cardLinksForceLoadedCardsCache.has(e.toCardId),r=CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{isBusy:t,openLinkedCardAsync:async()=>{r.linkedCard&&(this.isNewCard&&await this.saveCalendarCardAsync(),this._logCardEvent({event:O.cN.CardEvents.CardLinkLinkedCardOpened,data:{linkType:r.linkType.value}}),this._dialogSrv.showEditCardDialogAsync(r.linkedCard,{openerContext:this._dialogOpenerContext,noAnimation:this.isDetailed}))},removeAsync:async()=>{if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.REMOVE_CARD_LINK_TITLE"),this._$translate.instant("DIALOGS.REMOVE_CARD_LINK_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.REMOVE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._logCardEvent({event:O.cN.CardEvents.CardLinkRemoved,data:{linkType:r.linkType.value}}),this._hasChanges=!0,this._$scope.$evalAsync((()=>r.isBusy=!0)),await this._calendarCardsSrv.removeCalendarCardLinkAsync(this.calendarCard,r.toCardId,r.linkType.value)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardLinks=null))}}});return c()(r,"isReadonly",{get:()=>{var e;return!(r.linkedCard&&!r.linkedCard.isReadOnly&&!r.linkedCard.providerCard.isArchived)||!ee()(e=this.selectedBoards).call(e,(e=>e.id===r.linkedCard.providerCard.boardId))}}),c()(r,"canEdit",{get:()=>!(this.isBusy||this.isReadOnly||e.isBusy||e.isReadonly||e.linkErrorMessage)}),c()(r,"linkedCard",{get:()=>e.linkedCard,set:async e=>{if(r.linkedCard!==e&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Dependencies,!0))try{this._logCardEvent({event:O.cN.CardEvents.CardLinkCardChanged,data:{linkedCard:e}}),this._hasChanges=!0,this._$scope.$evalAsync((()=>r.isBusy=!0)),await this._calendarCardsSrv.updateCalendarCardLinkedCardAsync(this.calendarCard,r.linkedCard.id,e.id,r.linkType.value)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardLinks=null))}}}),c()(r,"linkType",{get:()=>{var t;return _()(t=this.availableCardLinkTypes).call(t,(t=>t.value===e.linkType))},set:async e=>{if(r.linkType!==e&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Dependencies,!0))try{this._logCardEvent({event:O.cN.CardEvents.CardLinkTypeChanged,data:{linkType:e.value}}),this._hasChanges=!0,this._$scope.$evalAsync((()=>r.isBusy=!0)),await this._calendarCardsSrv.updateCalendarCardLinkAsync(this.calendarCard,r.toCardId,r.linkType.value,e.value)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardLinks=null))}}}),c()(r,"linkErrorMessage",{get:()=>{if(!r._linkErrorMessage)switch(r.linkError){case O.DB.NoCard:r._linkErrorMessage=this._$translate.instant("TOOLTIPS.CARD_LINK_ERROR_NO_CARD");break;case O.DB.NoLink:r._linkErrorMessage=this._$translate.instant("TOOLTIPS.CARD_LINK_ERROR_NO_LINK");break;case O.DB.LinksDisabled:r._linkErrorMessage=this._$translate.instant("TOOLTIPS.CARD_LINK_ERROR_LINKS_DISABLED")}return r._linkErrorMessage}}),t?(async()=>{let t=await this._calendarCardsSrv.getCalendarCardByIdAsync(r.accountId,se.eT.TrelloCard,r.toCardId);this._cardLinksForceLoadedCardsCache.set(r.toCardId,t),this._$scope.$evalAsync((()=>{t&&(e.linkedCard=t),r.isBusy=!1}))})():e.linkedCard?this._cardLinksForceLoadedCardsCache.delete(e.toCardId):e.linkedCard=this._cardLinksForceLoadedCardsCache.get(e.toCardId),r}))}return this._cardLinks}},{kind:"method",key:"showAddDependencyDialogAsync",value:async function showAddDependencyDialogAsync(e,t){var r;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Dependencies,!0))return;let i=await this._dialogSrv.showAddDependencyDialogAsync({isEditingMode:!1,linkedCardFilter:e=>this.linkedCardFilter(e),relativeTo:t.currentTarget});i&&(this._linkAddingBy=e,this._isLinkAdding=!0,this._tempLink={isBusy:!0,linkType:_()(r=this.availableCardLinkTypes).call(r,(e=>e.value===i.linkType)),linkedCard:i.linkedCard},this.submitLinkAddingAsync())}},{kind:"get",key:"isDescriptionAvailable",value:function isDescriptionAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return!this.isReadOnly||this.description;case se.eT.TrelloCheckItem:return this.parentCard&&this.description}return!1}},{kind:"get",key:"isDescriptionEditingDisabled",value:function isDescriptionEditingDisabled(){return this.isTrelloCheckItemCard||this.isTrelloTimeRecordCard}},{kind:"get",key:"isDescriptionEditing",value:function isDescriptionEditing(){return this._isDescriptionEditing}},{kind:"set",key:"isDescriptionEditing",value:function isDescriptionEditing(e){this.isDescriptionEditing!==e&&(this._$scope.$evalAsync((()=>this._isDescriptionEditing=e)),e&&this._$timeout((()=>{ae()(".pw-js-dialog-edit-card-description-input").trigger("focus"),this._$scope.$broadcast(O.FK.AutosizeControlsResizeRequested)}),0,!1))}},{kind:"get",key:"description",value:function description(){return this._description}},{kind:"set",key:"description",value:function description(e){this._checkEditAvailable()&&this.description!==e&&(this._description=null==e?void 0:Pe()(e).call(e),this._logCardEvent({event:O.cN.CardEvents.DescriptionChanged}),this._setCardPropertiesAsync({description:this.description}))}},{kind:"get",key:"isCustomFieldsAvailable",value:function isCustomFieldsAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return this.cardBoard&&this.cardCustomFields.length>0;case se.eT.TrelloCheckItem:return this.parentCard&&this.cardBoard&&this.cardCustomFields.length>0}return!1}},{kind:"get",key:"cardCustomFields",value:function cardCustomFields(){if(this.delayRender)return[];if(!this.cardBoard)return[];if(!this._cardCustomFields){var e,t;this._dirtyCardCustomFieldValues||(this._dirtyCardCustomFieldValues=new(ke()));const r=this._calendarCardsSrv.getCalendarCardCustomFieldValues(this.calendarCard)||{};this._cardCustomFields=n()(e=w()(t=this.cardBoard.customFields).call(t,(e=>e.id!==this.cardBoard.cardDataCustomFieldId))).call(e,(e=>{var t;let i={id:e.id,type:e.type,icon:_t[e.type],name:e.name,options:null===(t=e.options)||void 0===t?void 0:n()(t).call(t,(e=>({id:e.id,name:e.name,color:e.color})))};return c()(i,"value",{get:()=>{var e;let t=this._dirtyCardCustomFieldValues.has(i.id)?this._dirtyCardCustomFieldValues.get(i.id):r[i.id];switch(i.type){case se.vK.Checkbox:return!!t;case se.vK.List:return _()(e=i.options).call(e,(e=>e.id===t));default:return null!=t?t:""}},set:async e=>{var t;switch(i.type){case se.vK.Date:"now"===e&&(e=new Date);break;case se.vK.List:e=(null===(t=e)||void 0===t?void 0:t.id)||null}if(r[i.id]!==e){r[i.id]=e;try{this._logCardEvent({event:O.cN.CardEvents.CustomFieldChanged}),this._dirtyCardCustomFieldValues.set(i.id,e),await this._setCardPropertiesAsync({[`${$.pN}${i.id}`]:e})}finally{this._dirtyCardCustomFieldValues.delete(i.id)}}}}),i}))}return this._cardCustomFields}},{kind:"get",key:"trelloCustomFieldName",value:function trelloCustomFieldName(){var e;return(null===(e=this._trelloCustomField)||void 0===e?void 0:e.name)||this._$translate.instant("DIALOGS.CARD_ROLE_CUSTOM_FIELD")}},{kind:"get",key:"isRemindersAvailable",value:function isRemindersAvailable(){return this.calendarCard.cardType===se.eT.TrelloCard&&(this.hasDates&&(!this.isReadOnly||this.cardReminders.length>0))}},{kind:"get",key:"canAddReminder",value:function canAddReminder(){return this.calendarCard.cardType===se.eT.TrelloCard&&this.cardReminders.length<this._planywayNotificationsSrv.maxRemindersPerCard}},{kind:"get",key:"cardReminders",value:function cardReminders(){if(this.delayRender)return[];if(!this.cardBoard)return[];if(!this._cardReminders){var e,t;this._cardRemindersLastIntervalUnits||(this._cardRemindersLastIntervalUnits=new(ke())),this._cardRemindersLastIntervalUnitsAllDay||(this._cardRemindersLastIntervalUnitsAllDay=new(ke()));const r=this._planywayNotificationsSrv.remindTimeDayStart;this._cardReminders=re()(e=n()(t=this.calendarCard.providerCard.notifications).call(t,(e=>{let t=CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{delete:()=>{var e,r;this._logCardEvent({event:O.cN.CardEvents.ReminderDeleted,data:{reminderType:t.type,remindBeforeValue:t.remindValue,remindBeforeUnit:t.selectedRemindUnit.unit,remindTime:t.remindTime}});let i=n()(e=w()(r=this.cardReminders).call(r,(e=>e.id!==t.id))).call(e,(e=>({id:e.id,type:e.type,remindBefore:e.remindBefore})));this._setCardPropertiesAsync({notifications:i,isSubscribed:!(0===i.length&&this.isNewCard&&!this._isSubscribedByMember)&&void 0})}});if(c()(t,"minRemindValue",{get:()=>0}),c()(t,"maxRemindValue",{get:()=>{switch(t._remindUnit){case wt:return 4;case It:return 28;case St:return 672;case Tt:return 40320}}}),this.isAllDay){let e,i,a=t.remindBefore%1440,s=t.remindBefore+1440-a,n=1440-a,o=this._cardRemindersLastIntervalUnitsAllDay.get(t.id);o&&o.remindBefore===s?({unit:e,value:i}=o):(t.remindBefore>0?({unit:e,value:i}=(0,N.GP)(s)):(e=It,i=0),this._cardRemindersLastIntervalUnitsAllDay.set(t.id,{remindBefore:s,unit:e,value:i})),t._remindUnit=e,t._remindValue=(0,N.uZ)(i,e===It?0:t.minRemindValue,t.maxRemindValue),t._remindTime=(0,N.mH)(r,n>1440?Math.abs(a):n)}else{let e,r,i=t.remindBefore,a=this._cardRemindersLastIntervalUnits.get(t.id);a&&a.remindBefore===i?({unit:e,value:r}=a):(({unit:e,value:r}=(0,N.GP)(i)),this._cardRemindersLastIntervalUnits.set(t.id,{remindBefore:i,unit:e,value:r})),t._remindUnit=e,t._remindValue=r}return c()(t,"remindValue",{get:()=>t._remindValue,set:e=>{var i;if(!Be()(e))return;if(e<t.minRemindValue?e=t.minRemindValue:e>t.maxRemindValue&&(e=t.maxRemindValue),t._remindValue===e)return;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Reminders,!0))return;if(t._remindValue=e,t._availableUnits=null,this.isAllDay){let i=1440-(0,N.CX)(r,t._remindTime),a=(0,N.a5)(t._remindUnit,e);t.remindBefore=a-1440+i,this._trelloUserSettings.local.lastRemindBeforeAllDay=t.remindBefore,this._cardRemindersLastIntervalUnitsAllDay.set(t.id,{remindBefore:a,unit:t._remindUnit,value:e})}else{let r=(0,N.a5)(t._remindUnit,e);t.remindBefore=r,this._trelloUserSettings.local.lastRemindBefore=t.remindBefore,this._cardRemindersLastIntervalUnits.set(t.id,{remindBefore:r,unit:t._remindUnit,value:e})}this._userSettings.local.save(),this._logCardEvent({event:O.cN.CardEvents.ReminderChanged,data:{reminderType:t.type,remindBeforeValue:t.remindValue,remindBeforeUnit:t.selectedRemindUnit.unit,remindTime:t.remindTime}});let a=n()(i=this.cardReminders).call(i,(e=>({id:e.id,type:e.type,remindBefore:e.remindBefore})));this._setCardPropertiesAsync({notifications:a})}}),c()(t,"availableRemindUnits",{get:()=>{if(!t._availableUnits){let e;e=this.isAllDay?[It,wt]:[Tt,St,It,wt],t._availableUnits=n()(e).call(e,(e=>({title:this._$translate.instant(At[1===t.remindValue?Et:Dt][e]),unit:e})))}return t._availableUnits}}),c()(t,"selectedRemindUnit",{get:()=>{var e;return _()(e=t.availableRemindUnits).call(e,(e=>e.unit===t._remindUnit))},set:e=>{var i;if(t._remindUnit===e.unit)return;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Reminders,!0))return;if(t._remindUnit=e.unit,t._remindValue<t.minRemindValue?t._remindValue=t.minRemindValue:t._remindValue>t.maxRemindValue&&(t._remindValue=t.maxRemindValue),this.isAllDay){let i=1440-(0,N.CX)(r,t._remindTime),a=(0,N.a5)(e.unit,t._remindValue);t.remindBefore=a-1440+i,this._trelloUserSettings.local.lastRemindBeforeAllDay=t.remindBefore,this._cardRemindersLastIntervalUnitsAllDay.set(t.id,{remindBefore:a,unit:e.unit,value:t._remindValue})}else{let r=(0,N.a5)(e.unit,t._remindValue);t.remindBefore=r,this._trelloUserSettings.local.lastRemindBefore=t.remindBefore,this._cardRemindersLastIntervalUnits.set(t.id,{remindBefore:r,unit:e.unit,value:t._remindValue})}this._userSettings.local.save(),this._logCardEvent({event:O.cN.CardEvents.ReminderChanged,data:{reminderType:t.type,remindBeforeValue:t.remindValue,remindBeforeUnit:t.selectedRemindUnit.unit,remindTime:t.remindTime}});let a=n()(i=this.cardReminders).call(i,(e=>({id:e.id,type:e.type,remindBefore:e.remindBefore})));this._setCardPropertiesAsync({notifications:a})}}),c()(t,"minRemindTime",{get:()=>r}),c()(t,"maxRemindTime",{get:()=>(t._maxRemindTime||(t._maxRemindTime=(0,N.mH)(t.minRemindTime,1440)),t._maxRemindTime)}),c()(t,"remindTime",{get:()=>{if(this.isAllDay)return t._remindTime},set:e=>{var i;if(!e||(0,N.rs)(t._remindTime,e))return;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Reminders,!0))return;if(t._remindTime=e,!this.isAllDay)return;{let e=1440-(0,N.CX)(r,t._remindTime),i=(0,N.a5)(t._remindUnit,t._remindValue);t.remindBefore=i-1440+e,this._trelloUserSettings.local.lastRemindBeforeAllDay=t.remindBefore,this._userSettings.local.save(),this._cardRemindersLastIntervalUnitsAllDay.set(t.id,{remindBefore:i,unit:t._remindUnit,value:t._remindValue})}this._keepScrollFocus(),this._logCardEvent({event:O.cN.CardEvents.ReminderChanged,data:{reminderType:t.type,remindBeforeValue:t.remindValue,remindBeforeUnit:t.selectedRemindUnit.unit,remindTime:t.remindTime}});let a=n()(i=this.cardReminders).call(i,(e=>({id:e.id,type:e.type,remindBefore:e.remindBefore})));this._setCardPropertiesAsync({notifications:a})}}),t}))).call(e,N.Yp),this._cardReminderPresets=null}return this._cardReminders}},{kind:"get",key:"cardReminderPresets",value:function cardReminderPresets(){if(!this._cardReminderPresets)if(this.isAllDay){const e=this._planywayNotificationsSrv.remindTimeDayStart;this._cardReminderPresets=[{type:se.k$.RemindStart,remindBefore:-540,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_ON_THE_DAY_OF_THE_CARD_9_00",{time:kendo.toString((0,N.D0)(e,9,0),"t")})},{type:se.k$.RemindStart,remindBefore:900,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_AT_DAY_BEFORE_9_00",{time:kendo.toString((0,N.D0)(e,9),"t")})},{type:se.k$.RemindStart,remindBefore:2340,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_AT_2_DAYS_BEFORE_9_00",{time:kendo.toString((0,N.D0)(e,9),"t")})},{type:se.k$.RemindStart,remindBefore:9540,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_AT_1_WEEK_BEFORE_9_00",{time:kendo.toString((0,N.D0)(e,9),"t")})},{type:se.k$.RemindStart,remindBefore:null}]}else this._cardReminderPresets=[{type:se.k$.RemindStart,remindBefore:5,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_5_MINUTES")},{type:se.k$.RemindStart,remindBefore:10,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_10_MINUTES")},{type:se.k$.RemindStart,remindBefore:15,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_15_MINUTES")},{type:se.k$.RemindStart,remindBefore:30,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_30_MINUTES")},{type:se.k$.RemindStart,remindBefore:60,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_1_HOUR")},{type:se.k$.RemindStart,remindBefore:1440,text:this._$translate.instant("DIALOGS.REMIND_BEFORE_1_DAY")},{type:se.k$.RemindStart,remindBefore:null}];return this._cardReminderPresets}},{kind:"method",key:"getReminderPresetString",value:function getReminderPresetString(e){let t,r;if(this.isAllDay&&(0===e.remindValue&&e.selectedRemindUnit.unit===It?(t=this._$translate.instant("DIALOGS.REMIND_BEFORE_ON_THE_DAY_OF_THE_CARD"),r=""):r=this._$translate.instant("DIALOGS.REMIND_BEFORE_AT")),void 0===t){let r=1===e.remindValue?Et:Dt;t=`${e.remindValue} ${this._$translate.instant(At[r][e.selectedRemindUnit.unit])}`}return void 0===r&&(r=this._$translate.instant("DIALOGS.REMIND_BEFORE")),`${t} ${r} ${kendo.toString(e.remindTime,"t")}`}},{kind:"method",key:"addReminderAsync",value:async function addReminderAsync(e,t){var r,i;if(!this.canAddReminder)return;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Reminders,!0))return;let a,s;if(null===t.remindBefore){let e=await this._dialogSrv.showAddCustomReminderDialogAsync({isEditingMode:!1,isAllDay:this.isAllDay,isNegativeReminderAvailable:!0,type:se.k$.RemindStart,remindBefore:this.isAllDay?this._trelloUserSettings.local.lastRemindBeforeAllDay:this._trelloUserSettings.local.lastRemindBefore,relativeTo:".pw-js-edit-card-reminders"});if(!e)return;a=e.type,s=e.remindBefore,this.isAllDay?this._trelloUserSettings.local.lastRemindBeforeAllDay=s:this._trelloUserSettings.local.lastRemindBefore=s,this._userSettings.local.save()}else a=t.type,s=t.remindBefore;const o=Ze()();let l=[...n()(r=this.cardReminders).call(r,(e=>({id:e.id,type:e.type,remindBefore:e.remindBefore}))),{id:o,type:a,remindBefore:s}];this.calendarCard.providerCard.notifications=l,this._cardReminders=null;let d=_()(i=this.cardReminders).call(i,(e=>e.id===o));this._logCardEvent({event:O.cN.CardEvents.ReminderAdded,data:{by:gt[e],reminderType:d.type,remindBeforeValue:d.remindValue,remindBeforeUnit:d.selectedRemindUnit.unit,remindTime:d.remindTime}}),this._setCardPropertiesAsync({isSubscribed:!0,notifications:l})}},{kind:"method",key:"editReminderAsync",value:async function editReminderAsync(e,t,r){var i,a,s;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Reminders,!0))return;let o,l;if(null===r.remindBefore){let e=await this._dialogSrv.showAddCustomReminderDialogAsync({isEditingMode:!0,isAllDay:this.isAllDay,isNegativeReminderAvailable:!0,type:t.type,remindBefore:t.remindBefore,relativeTo:".pw-js-edit-card-reminders"});if(!e)return;o=e.type,l=e.remindBefore,this.isAllDay?this._trelloUserSettings.local.lastRemindBeforeAllDay=l:this._trelloUserSettings.local.lastRemindBefore=l,this._userSettings.local.save()}else o=t.type,l=r.remindBefore;const d=Ze()();let c=[...n()(i=w()(a=this.cardReminders).call(a,(e=>e.id!==t.id))).call(i,(e=>({id:e.id,type:e.type,remindBefore:e.remindBefore}))),{id:d,type:o,remindBefore:l}];this.calendarCard.providerCard.notifications=c,this._cardReminders=null;let h=_()(s=this.cardReminders).call(s,(e=>e.id===d));this._logCardEvent({event:O.cN.CardEvents.ReminderChanged,data:{by:gt[e],reminderType:h.type,remindBeforeValue:h.remindValue,remindBeforeUnit:h.selectedRemindUnit.unit,remindTime:h.remindTime}}),this._setCardPropertiesAsync({notifications:c})}},{kind:"get",key:"isChecklistsAvailable",value:function isChecklistsAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return!this.isReadOnly||this.cardChecklists.length>0}return!1}},{kind:"get",key:"isAddChecklistBusy",value:function isAddChecklistBusy(){return this._isAddChecklistBusy}},{kind:"method",key:"addChecklistAsync",value:async function addChecklistAsync(e){if(this._checkEditAvailable())try{this._logCardEvent({event:O.cN.CardEvents.ChecklistAdded,data:{by:gt[e]}}),this._hasChanges=!0,this._$scope.$evalAsync((()=>{this._isAddChecklistBusy=!0,this._cardChecklists=null}));let{id:t}=await this._calendarCardsSrv.createCalendarCardChecklistAsync(this.calendarCard);this._$scope.$evalAsync((()=>{this._cardChecklists=null,this._isAddChecklistBusy=!1,1===this.cardChecklists.length?this._$timeout((()=>{var e;_()(e=ae()(`.pw-js-dialog-edit-card-check-item-add-panel[data-checklist-id="${t}"]`)).call(e,".pw-js-dialog-edit-card-check-item-add-panel-input").trigger("focus")}),0,!1):this._$timeout((()=>{ae()(`.pw-js-dialog-edit-card-checklist-header[data-checklist-id="${t}"]`).trigger("focus").trigger("select")}),0,!1),this._scrollToSection("checklists")}))}catch(e){this._$scope.$evalAsync((()=>{this._cardChecklists=null,this._isAddChecklistBusy=!1})),this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}}},{kind:"get",key:"cardChecklists",value:function cardChecklists(){if(this.delayRender)return[];if(!this.cardBoard)return[];if(!this._cardChecklists){var e;this._dirtyCardChecklistNames||(this._dirtyCardChecklistNames=new(ke())),this._dirtyCardCheckItemNames||(this._dirtyCardCheckItemNames=new(ke())),this._dirtyCardCheckItemCompleted||(this._dirtyCardCheckItemCompleted=new(ke())),this._dirtyCardCheckItemIsAllDay||(this._dirtyCardCheckItemIsAllDay=new(ke())),this._dirtyCardCheckItemStart||(this._dirtyCardCheckItemStart=new(ke())),this._dirtyCardCheckItemEnd||(this._dirtyCardCheckItemEnd=new(ke())),this._dirtyCardCheckItemMembers||(this._dirtyCardCheckItemMembers=new(ke())),this._busyCheckItemIds||(this._busyCheckItemIds=new(Te()));let t=this._calendarCardsSrv.getCalendarCardChecklists(this.calendarCard)||[];this._cardChecklists=re()(e=n()(t).call(t,(e=>{var t;let r=e.checkItems;if(!this._tempCheckItemsMap.has(e.id)){let t={id:$.$d+e.id,start:null,end:null,name:"",memberIds:[],checklistId:e.id};c()(t,"isValid",{get:()=>{var e;return!!Pe()(e=t.name).call(e)||!!t.end||t.memberIds.length}}),this._tempCheckItemsMap.set(e.id,t)}r=[...r,this._tempCheckItemsMap.get(e.id)];let i=CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{deleteAsync:async()=>{if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.DELETE_CHECKLIST_TITLE"),this._$translate.instant("DIALOGS.DELETE_CHECKLIST_CONFIRM",{name:Ke()(e.name,36)}),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._logCardEvent({event:O.cN.CardEvents.ChecklistDeleted}),this._hasChanges=!0,this._$scope.$evalAsync((()=>this._cardChecklists=null)),await this._calendarCardsSrv.deleteCalendarCardChecklistAsync(this.calendarCard,i.id)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardChecklists=null))}},getCheckItemNewPosition:e=>{var t;return(0,N.V1)(e,w()(t=i.checkItems).call(t,(e=>!e.isTempCheckItem)))},checkItems:re()(t=n()(r).call(r,(t=>{let r=CardEditorController_objectSpread(CardEditorController_objectSpread({},t),{},{checklistId:e.id,convertToCardAsync:async()=>{if(!r.isTempCheckItem)try{this._appCommonSrv.setSchedulerBusy(!0),this._logCardEvent({event:O.cN.CardEvents.CheckItemConverted}),this._hasChanges=!0,this._$scope.$evalAsync((()=>this._cardChecklists=null)),await this._calendarCardsSrv.convertCalendarCardCheckItemAsync(this.calendarCard,r.checklistId,r.id)}catch(e){this._$log.error("Planyway convert card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.CONVERT_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardChecklists=null)),this._appCommonSrv.setSchedulerBusy(!1)}},deleteAsync:async()=>{if(r.isTempCheckItem)return void this.rejectCheckItemAdding(r.checklistId);if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.DELETE_CHECK_ITEM_TITLE"),this._$translate.instant("DIALOGS.DELETE_CHECK_ITEM_CONFIRM",{name:Ke()(t.name,36)}),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._logCardEvent({event:O.cN.CardEvents.CheckItemDeleted}),this._hasChanges=!0,this._$scope.$evalAsync((()=>this._cardChecklists=null)),await this._calendarCardsSrv.deleteCalendarCardCheckItemAsync(this.calendarCard,r.checklistId,r.id)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardChecklists=null))}},changeDates:(e,t,i,a)=>{if(r.isAllDay!==e||!(0,N.rs)(r.start,t)||!(0,N.rs)(r.end,i))if(this._licenseSrv.checkPaidFeatureAvailable(O.ZV.AdvancedChecklists,!0))if(r.isTempCheckItem)r.isAllDay=e,r.start=t,r.end=i;else{let a,s;if(r.hasDates)if(r.isAllDay!==e)a=e?O.cN.CardEvents.CheckItemIsAllDaySet:O.cN.CardEvents.CheckItemIsAllDayUnset;else if((0,N.rs)(r.start,t)){if((0,N.rs)(r.end,i))return;a=O.cN.CardEvents.CheckItemEndChanged}else a=O.cN.CardEvents.CheckItemStartChanged;else a=O.cN.CardEvents.Scheduled,s={cardType:se.eT.TrelloCheckItem,cardRole:se.D.Card,isAllDay:e,start:t,end:i,by:O.AH.SetDates};this._logCardEvent({event:a,data:s}),r.isAllDay=e,r.start=t,r.end=i}else a(r.isAllDay,r.start,r.end)},removeDatesAsync:async()=>{if(r.hasDates)try{r.isTempCheckItem?(t.isAllDay=null,t.start=null,t.end=null):(this._logCardEvent({event:O.cN.CardEvents.CheckItemDatesRemoved}),this._hasChanges=!0,this._dirtyCardCheckItemStart.set(r.id,null),this._dirtyCardCheckItemEnd.set(r.id,null),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,r.checklistId,r.id,{isAllDay:null,start:null,end:null}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemStart.delete(r.id),this._dirtyCardCheckItemEnd.delete(r.id),this._$scope.$evalAsync((()=>this._cardChecklists=null))}},isMemberSelected:e=>{let i=this._dirtyCardCheckItemMembers.has(r.id)?this._dirtyCardCheckItemMembers.get(r.id):t.memberIds;return Z()(i).call(i,e.id)},toggleMemberAsync:async e=>{var i;if(!Z()(i=t.memberIds).call(i,e.id)&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.AdvancedChecklists,!0))return!1;try{if(r.isTempCheckItem){var a;t.memberIds=Z()(a=t.memberIds).call(a,e.id)?[]:[e.id]}else{let i=this._dirtyCardCheckItemMembers.has(r.id)?this._dirtyCardCheckItemMembers.get(r.id):t.memberIds;Z()(i).call(i,e.id)?(i=[],this._logCardEvent({event:O.cN.CardEvents.CheckItemMemberUnassigned})):(i=[e.id],this._logCardEvent({event:O.cN.CardEvents.CheckItemMemberAssigned})),this._hasChanges=!0,this._dirtyCardCheckItemMembers.set(r.id,i),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,r.checklistId,r.id,{memberIds:i})}}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemMembers.delete(r.id),this._$scope.$evalAsync((()=>this._cardChecklists=null))}}});return c()(r,"isTempCheckItem",{get:()=>t===this._tempCheckItemsMap.get(t.checklistId)}),c()(r,"isBusy",{get:()=>!this.isNewCard&&this._busyCheckItemIds.has(r.id)}),c()(r,"name",{get:()=>this._dirtyCardCheckItemNames.has(r.id)?this._dirtyCardCheckItemNames.get(r.id):t.name,set:async e=>{if((e||r.isTempCheckItem)&&r.name!==e)try{r.isTempCheckItem?t.name=e:(this._logCardEvent({event:O.cN.CardEvents.CheckItemNameChanged}),this._hasChanges=!0,this._dirtyCardCheckItemNames.set(r.id,e),this._$timeout((()=>{var e;_()(e=ae()(`.pw-js-dialog-edit-card-check-item-add-panel[data-checklist-id="${i.id}"]`)).call(e,".pw-js-dialog-edit-card-check-item-add-panel-input").trigger("focus")}),0,!1),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,r.checklistId,r.id,{name:e}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemNames.delete(r.id),this._$scope.$evalAsync((()=>this._cardChecklists=null))}}}),c()(r,"isCompleted",{get:()=>this._dirtyCardCheckItemCompleted.has(r.id)?this._dirtyCardCheckItemCompleted.get(r.id):t.isCompleted,set:async e=>{if(r.isCompleted!==e)try{this._logCardEvent({event:e?O.cN.CardEvents.CheckItemMarkedCompleted:O.cN.CardEvents.CheckItemMarkedIncompleted}),this._hasChanges=!0,this._dirtyCardCheckItemCompleted.set(r.id,e),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,r.checklistId,r.id,{isCompleted:e})}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemCompleted.delete(r.id),this._$scope.$evalAsync((()=>this._cardChecklists=null))}}}),c()(r,"hasDates",{get:()=>(0,N.qb)(r.start)&&(0,N.qb)(r.end)}),c()(r,"isAllDay",{get:()=>{var e;return this._dirtyCardCheckItemIsAllDay.has(r.id)?this._dirtyCardCheckItemIsAllDay.get(r.id):null===(e=t.isAllDay)||void 0===e||e},set:e=>{r.isAllDay!==e&&this._dirtyCardCheckItemIsAllDay.set(r.id,e)}}),c()(r,"start",{get:()=>this._dirtyCardCheckItemStart.has(r.id)?this._dirtyCardCheckItemStart.get(r.id):t.start,set:e=>{e&&!(0,N.rs)(r.start,e)&&this._dirtyCardCheckItemStart.set(r.id,e)}}),c()(r,"end",{get:()=>this._dirtyCardCheckItemEnd.has(r.id)?this._dirtyCardCheckItemEnd.get(r.id):t.end,set:async e=>{if(e&&(!(0,N.rs)(r.end,e)||this._dirtyCardCheckItemIsAllDay.has(r.id)||this._dirtyCardCheckItemStart.has(r.id)))try{r.isTempCheckItem?(t.isAllDay=r.isAllDay,t.start=r.start,t.end=e):(this._hasChanges=!0,this._dirtyCardCheckItemEnd.set(r.id,e),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,r.checklistId,r.id,{isAllDay:r.isAllDay,start:r.start,end:e}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemIsAllDay.delete(r.id),this._dirtyCardCheckItemStart.delete(r.id),this._dirtyCardCheckItemEnd.delete(r.id),this._$scope.$evalAsync((()=>this._cardChecklists=null))}}}),c()(r,"shortDate",{get:()=>{if(r.hasDates)return(0,N.kC)(r.start,r.end)}}),c()(r,"membersCount",{get:()=>(this._dirtyCardCheckItemMembers.has(r.id)?this._dirtyCardCheckItemMembers.get(r.id):t.memberIds).length}),c()(r,"members",{get:()=>{var e,i,a;if(!this.cardBoard)return[];let s=this._dirtyCardCheckItemMembers.has(r.id)?this._dirtyCardCheckItemMembers.get(r.id):t.memberIds,o=this._trelloIntegrationSrv.getTrelloMemberById(this.calendarCard.accountId,this._currentMemberId);return n()(e=re()(i=w()(a=n()(s).call(s,(e=>{var t;return _()(t=this.cardBoard.members).call(t,(t=>t.id===e))}))).call(a,(e=>e))).call(i,((e,t)=>(0,N.Yb)(e,t,o)))).call(e,(e=>CardEditorController_objectSpread({},e)))}}),r}))).call(t,N.ke)});return c()(i,"isBusy",{get:()=>{var e;return!this.isNewCard&&$e()(e=i.id).call(e,$.$d)}}),c()(i,"isNameEditing",{get:()=>this._checklistNameEditingId===i.id,set:e=>{e?this._checklistNameEditingId=i.id:this._checklistNameEditingId===i.id&&(this._checklistNameEditingId=null)}}),c()(i,"name",{get:()=>this._dirtyCardChecklistNames.has(i.id)?this._dirtyCardChecklistNames.get(i.id):e.name,set:async e=>{if(e&&i.name!==e)try{var t;this._logCardEvent({event:O.cN.CardEvents.ChecklistNameChanged}),this._hasChanges=!0,this._dirtyCardChecklistNames.set(i.id,e),ee()(t=i.checkItems).call(t,(e=>!e.isTempCheckItem))||this._$timeout((()=>{var e;_()(e=ae()(`.pw-js-dialog-edit-card-check-item-add-panel[data-checklist-id="${i.id}"]`)).call(e,".pw-js-dialog-edit-card-check-item-add-panel-input").trigger("focus")}),0,!1),await this._calendarCardsSrv.updateCalendarCardChecklistAsync(this.calendarCard,i.id,{name:e})}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardChecklistNames.delete(i.id),this._$scope.$evalAsync((()=>this._cardChecklists=null))}}}),c()(i,"formattedName",{get:()=>{let e=0,t=0;for(let r of i.checkItems)r.isTempCheckItem||(e++,r.isCompleted&&t++);return`${i.name} (${t}/${e})`}}),c()(i,"isCollapsed",{get:()=>{var e,t;return null!==(e=null===(t=this._trelloCollectionSettings.local.editCardDialog.checklists[i.id])||void 0===t?void 0:t.isCollapsed)&&void 0!==e&&e},set:e=>{if(i.isCollapsed===e)return;this._logCardEvent({event:e?O.cN.CardEvents.ChecklistCollapsed:O.cN.CardEvents.ChecklistExpanded});let t=this._trelloCollectionSettings.local.editCardDialog.checklists,r=t[i.id];delete t[i.id],t[i.id]=CardEditorController_objectSpread(CardEditorController_objectSpread({},r),{},{isCollapsed:e}),this._collectionSettings.local.save()}}),c()(i,"isCompletedCheckItemsHidden",{get:()=>{var e,t;return null!==(e=null===(t=this._trelloCollectionSettings.local.editCardDialog.checklists[i.id])||void 0===t?void 0:t.hideCompleted)&&void 0!==e&&e},set:e=>{if(i.isCompletedCheckItemsHidden===e)return;i.isCollapsed=!1,this._logCardEvent({event:e?O.cN.CardEvents.ChecklistCompletedHidden:O.cN.CardEvents.ChecklistCompletedShown});let t=this._trelloCollectionSettings.local.editCardDialog.checklists,r=t[i.id];delete t[i.id],t[i.id]=CardEditorController_objectSpread(CardEditorController_objectSpread({},r),{},{hideCompleted:e}),this._collectionSettings.local.save()}}),c()(i,"hasVisibleCheckItems",{get:()=>{var e;return i.isCompletedCheckItemsHidden?ee()(e=i.checkItems).call(e,(e=>!e.isCompleted)):i.checkItems.length>1}}),i}))).call(e,N.Fo)}return this._cardChecklists}},{kind:"get",key:"sortableChecklistOptions",value:function sortableChecklistOptions(){return this._dragState.sortableChecklistOptions||(this._dragState.sortableChecklistOptions={handler:".pw-dialog-edit-card-checklist__header, .pw-dialog-edit-card-checklist__header *",ignore:"input, :not(.pw-dialog-edit-card-checklist__header):not(.pw-dialog-edit-card-checklist__header *)",autoScroll:!0,placeholder:e=>{let t=e.clone().addClass("pw-dialog-edit-card-checklist--placeholder");return e.next()[0]||(this._dragState.lastElement=t,t.css({marginBottom:0})),_()(t).call(t,"input").removeAttr("id"),t},hint:e=>{let t=ae()('<div class="pw-dialog-edit-card-checklist pw-dialog-edit-card-checklist--hint"></div>').css({width:e.width()}),r=_()(e).call(e,".pw-dialog-edit-card-checklist__header").clone();return _()(r).call(r,".pw-js-remove-from-drag-hint").remove(),t.append(r),_()(t).call(t,"input").removeAttr("id"),t}}),this._dragState.sortableChecklistOptions}},{kind:"method",key:"onChecklistDragStart",value:function onChecklistDragStart(e){this.isBusy||this.isReadOnly?e.preventDefault():(this._dragState.isDragging=!0,this.clickRequester=null)}},{kind:"method",key:"onChecklistDrag",value:function onChecklistDrag(e){if(this._dragState.lastElement){let t=e.item.prev();t[0]!==this._dragState.lastElement[0]&&(this._dragState.lastElement.css({marginBottom:""}),t.css({marginBottom:0}),this._dragState.lastElement=t)}}},{kind:"method",key:"onChecklistDragEnd",value:function onChecklistDragEnd(e){var t,r;if(this.onChecklistDragCancel(e),e.newIndex===e.oldIndex)return;if(e.preventDefault(),"sort"!==e.action)return void this._$log.warn(`Unexpected checklist drag and drop event: ${e.action}`);let i=this.cardChecklists[e.oldIndex];m()(t=this.cardChecklists).call(t,e.newIndex,0,m()(r=this.cardChecklists).call(r,e.oldIndex,1)[0]),i.position=(e=>{if(0===e)return this.cardChecklists[e+1].position/2;if(e>=this.cardChecklists.length-1)return this.cardChecklists[e-1].position+$.LA;return(this.cardChecklists[e-1].position+this.cardChecklists[e+1].position)/2})(e.newIndex),this._logCardEvent({event:O.cN.CardEvents.ChecklistOrderChanged}),this._calendarCardsSrv.updateCalendarCardChecklistAsync(this.calendarCard,i.id,{position:i.position})}},{kind:"method",key:"onChecklistDragCancel",value:function onChecklistDragCancel(e){var t;e.sender.draggable.dropped=!0,this._dragState.isDragging=!1,null===(t=this._dragState.lastElement)||void 0===t||t.css({marginBottom:""}),this._dragState.lastElement=null}},{kind:"get",key:"sortableCheckItemOptions",value:function sortableCheckItemOptions(){return this._dragState.sortableCheckItemOptions||(this._dragState.sortableCheckItemOptions={connectWith:".pw-dialog-edit-card-checklist",filter:"> .pw-dialog-edit-card-check-item--draggable",ignore:"textarea",autoScroll:!0,placeholder:e=>{let t=e.clone().addClass("pw-dialog-edit-card-check-item--placeholder");return _()(t).call(t,"textarea").removeAttr("id"),t},hint:e=>{let t=e.clone().addClass("pw-dialog-edit-card-check-item--hint").css({width:e.width()});return _()(t).call(t,".pw-js-remove-from-drag-hint").remove(),_()(t).call(t,"textarea").removeAttr("id"),t}}),this._dragState.sortableCheckItemOptions}},{kind:"method",key:"onCheckItemDragStart",value:function onCheckItemDragStart(e){var t,r;if(this.isBusy||this.isReadOnly)return void e.preventDefault();let i=e.item.data("checklist-id"),a=Fe()(t=this.cardChecklists).call(t,(e=>e.id===i)),s=this.cardChecklists[a],n=e.item.data("check-item-id"),o=null==s?void 0:_()(r=s.checkItems).call(r,(e=>e.id===n));o&&!o.isBusy?(this._dragState.lastChecklistIndex=a,this._dragState.isDragging=!0,this.clickRequester=null):e.preventDefault()}},{kind:"method",key:"beforeCheckItemDrag",value:function beforeCheckItemDrag(e){var t;if(e.sender.element.hasClass("pw-dialog-edit-card-checklist--collapsed"))return void e.preventDefault();let r=e.target.data("checklist-id"),i=Fe()(t=this.cardChecklists).call(t,(e=>e.id===r));i===this._dragState.lastChecklistIndex?this._dragState.isDragDown="next"===e.direction:(this._dragState.isDragDown=i>this._dragState.lastChecklistIndex,this._dragState.lastChecklistIndex=i)}},{kind:"method",key:"onCheckItemDragEndAsync",value:async function onCheckItemDragEndAsync(e,t){var r,i,a,s,n,o,l;if(this.onCheckItemDragCancel(e),e.newIndex===e.oldIndex)return;let d=_()(r=this.cardChecklists).call(r,(e=>e.id===t));if(!d)return;let c,h,u=e.item.data("check-item-id");const getNewIndex=()=>{let t=d.hasVisibleCheckItems?e.newIndex:0;if(!d.isCompletedCheckItemsHidden)return t;let r=0,i=0;for(;i<t;){var a;null!==(a=d.checkItems[r])&&void 0!==a&&a.isCompleted||i++,r++}if(!this._dragState.isDragDown)for(;null!==(s=d.checkItems[r])&&void 0!==s&&s.isCompleted;){var s;r++}return r};let p;switch(e.action){case"remove":h=Fe()(i=d.checkItems).call(i,(e=>e.id===u)),this._dragState.movedCheckItem=m()(a=d.checkItems).call(a,h,1)[0];break;case"receive":e.preventDefault();let r=e.item.data("checklist-id");c=this._dragState.movedCheckItem,p=getNewIndex(),m()(s=d.checkItems).call(s,p,0,c);try{this._busyCheckItemIds.add(c.id);let e=d.getCheckItemNewPosition(p);this._logCardEvent({event:O.cN.CardEvents.CheckItemChecklistChanged}),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,r,u,{checklistId:t,position:e}),c.checklistId=t,c.position=e}finally{this._$scope.$evalAsync((()=>{this._cardChecklists=null,this._busyCheckItemIds.delete(c.id)}))}break;case"sort":e.preventDefault(),h=Fe()(n=d.checkItems).call(n,(e=>e.id===u)),c=m()(o=d.checkItems).call(o,h,1)[0],p=getNewIndex(),m()(l=d.checkItems).call(l,p,0,c),c.position=d.getCheckItemNewPosition(p),this._logCardEvent({event:O.cN.CardEvents.CheckItemOrderChanged}),this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,t,c.id,{position:c.position})}}},{kind:"method",key:"onCheckItemDragCancel",value:function onCheckItemDragCancel(e){var t;e.sender.draggable.dropped=!0,this._dragState.isDragging=!1,null===(t=this._dragState.lastElement)||void 0===t||t.css({marginBottom:""}),this._dragState.lastElement=null}},{kind:"get",key:"tempCheckItem",value:function tempCheckItem(){return this._tempCheckItemsMap.get(this._activeChecklistId)}},{kind:"method",key:"isCheckItemAdding",value:function isCheckItemAdding(e){var t;return!(null===(t=this.tempCheckItem)||void 0===t||!t.isValid)&&(!e||this.tempCheckItem.checklistId===e)}},{kind:"method",key:"beginCheckItemAdding",value:function beginCheckItemAdding(e){var t;if(this._checkEditAvailable()){if(null!==(t=this.tempCheckItem)&&void 0!==t&&t.isValid&&this._activeChecklistId!==e)return this.submitCheckItemAddingAsync(),void(this._activeChecklistId=e);this._activeChecklistId=e,this._$scope.$evalAsync((()=>{this._cardChecklists=null,ae()(`.pw-js-dialog-edit-card-check-item-add-panel[data-checklist-id="${this._activeChecklistId}"]`).addClass("pw-dialog-edit-card-check-item--temp-check-item-editing")}))}}},{kind:"method",key:"rejectCheckItemAdding",value:function rejectCheckItemAdding(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._activeChecklistId;this._tempCheckItemsMap.delete(e),this._$scope.$evalAsync((()=>{var t;this._cardChecklists=null,_()(t=ae()(`.pw-js-dialog-edit-card-check-item-add-panel[data-checklist-id="${e}"]`).removeClass("pw-dialog-edit-card-check-item--temp-check-item-editing")).call(t,"button").trigger("blur")}))}},{kind:"method",key:"submitCheckItemAddingAsync",value:async function submitCheckItemAddingAsync(){if(this._isAddCheckItemBusy)return;if(!this.isCheckItemAdding()||!this.tempCheckItem)return;if(!this.tempCheckItem.isValid)return;let e=this.tempCheckItem.id,t=this.tempCheckItem;try{var r,i,a,s;t.start&&t.end?this._logCardEvent({event:O.cN.CardEvents.Scheduled,data:{cardType:se.eT.TrelloCheckItem,cardRole:se.D.Card,isAllDay:t.isAllDay,start:t.start,end:t.end,by:O.AH.SetDates}}):this._logCardEvent({event:O.cN.CardEvents.CheckItemAdded}),this._hasChanges=!0,this._isAddCheckItemBusy=!0,this._busyCheckItemIds.add(e);let n=t.checklistId,o=await this._calendarCardsSrv.createCalendarCardCheckItemAsync(this.calendarCard,n,{name:t.name||this._$translate.instant("MISC.NO_TITLE"),position:t.position}),l={isAllDay:null!==(r=t.isAllDay)&&void 0!==r?r:null,start:null!==(i=t.start)&&void 0!==i?i:null,end:null!==(a=t.end)&&void 0!==a?a:null,memberIds:null!==(s=t.memberIds)&&void 0!==s?s:null};this._tempCheckItemsMap.delete(n),this._$scope.$evalAsync((()=>this._cardChecklists=null)),this._busyCheckItemIds.delete(e),this._$timeout((()=>ae()(".pw-js-dialog-edit-card-check-item-add-panel").removeClass("pw-dialog-edit-card-check-item--temp-check-item-editing")),0,!1),this._$timeout((()=>{var e;_()(e=ae()(`.pw-js-dialog-edit-card-check-item-add-panel[data-checklist-id="${n}"]`)).call(e,".pw-js-dialog-edit-card-check-item-add-panel-input").trigger("focus")}),0,!1),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.calendarCard,n,o.id,l)}catch(r){this._tempCheckItem=t,this._busyCheckItemIds.delete(e),this._$log.error("Planyway card updating error:"),this._$log.error(r),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>{this._cardChecklists=null,this._isAddCheckItemBusy=!1}))}}},{kind:"get",key:"isTimeRecordsAvailable",value:function isTimeRecordsAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return!this.isReadOnly||this.cardTimeRecords.length>0;case se.eT.TrelloCheckItem:return this.parentCard&&(!this.isReadOnly||this.cardTimeRecords.length>0)}return!1}},{kind:"method",key:"isLoadMoreTimeRecordsAvailable",value:function isLoadMoreTimeRecordsAvailable(){return this.cardTimeRecordsLimit<this.cardTimeRecords.length}},{kind:"get",key:"cardTimeRecordsLimit",value:function cardTimeRecordsLimit(){return this._cardTimeRecordsLimit}},{kind:"method",key:"loadMoreCardTimeRecords",value:function loadMoreCardTimeRecords(){this._cardTimeRecordsLimit+=20}},{kind:"method",key:"isTimeRecordAdding",value:function isTimeRecordAdding(){return this._isTimeRecordAdding}},{kind:"method",key:"beginTimeRecordAddingAsync",value:async function beginTimeRecordAddingAsync(){this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0)&&(this.isTimeRecordAdding()&&await this.submitTimeRecordAddingAsync(),this.isSectionCollapsed("timeRecords")&&this.toggleSectionCollapse("timeRecords"),this._tempTimeRecord||(this._tempTimeRecord={id:$.$d,canBeUpdated:!0,canBeDeleted:!0,comment:"",isDuration:!1,to:(0,N.GG)(new Date,"minute"),durationMinutes:this._timeTrackingSrv.timeRecordDefaultDurationMinutes,memberId:this._currentMemberId},this._tempTimeRecord.from=(0,N.mH)(this._tempTimeRecord.to,-this._tempTimeRecord.durationMinutes)),this._$scope.$evalAsync((()=>{this._isTimeRecordAdding=!0,this._cardTimeRecords=null,this._scrollToSection("timeRecords")})))}},{kind:"method",key:"rejectTimeRecordAdding",value:function rejectTimeRecordAdding(){this._isTimeRecordAdding=!1,this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}},{kind:"method",key:"submitTimeRecordAddingAsync",value:async function submitTimeRecordAddingAsync(){if(!this.isTimeRecordAdding()||!this._tempTimeRecord)return;let e=this._tempTimeRecord;try{this._logCardEvent({event:O.cN.CardEvents.Scheduled,data:{cardType:se.eT.TrelloTimeRecord,cardRole:se.D.Card,isDuration:e.isDuration,durationMinutes:e.durationMinutes,by:O.AH.Manually}}),this._hasChanges=!0,this._tempTimeRecord=null,this._isTimeRecordBusy=!0,await this._calendarCardsSrv.createCalendarCardTimeRecordAsync(this.calendarCard,{comment:e.comment,isDuration:e.isDuration,from:e.from,to:e.to,durationMinutes:e.durationMinutes,memberId:e.memberId}),this._isTimeRecordAdding=!1}catch(t){this._tempTimeRecord=e,this._$log.error("Planyway card updating error:"),this._$log.error(t),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>{this._isTimeRecordBusy=!1,this._cardTimeRecords=null}))}}},{kind:"get",key:"cardTimeRecords",value:function cardTimeRecords(){if(this.delayRender)return[];if(!this.cardBoard)return[];if(!this._cardTimeRecords){var e;this._dirtyCardTimeRecordComment||(this._dirtyCardTimeRecordComment=new(ke())),this._dirtyCardTimeRecordIsDuration||(this._dirtyCardTimeRecordIsDuration=new(ke())),this._dirtyCardTimeRecordFrom||(this._dirtyCardTimeRecordFrom=new(ke())),this._dirtyCardTimeRecordTo||(this._dirtyCardTimeRecordTo=new(ke())),this._dirtyCardTimeRecordDurationMinutes||(this._dirtyCardTimeRecordDurationMinutes=new(ke())),this._dirtyCardTimeRecordMember||(this._dirtyCardTimeRecordMember=new(ke()));let t=this._calendarCardsSrv.getCalendarCardTimeRecords(this.calendarCard)||[];this._tempTimeRecord&&this.isTimeRecordAdding()&&(t=[this._tempTimeRecord,...t]),this._cardTimeRecords=re()(e=n()(t).call(t,(e=>{let t=CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{deleteAsync:async()=>{if(t.isTempRecord)return this.rejectTimeRecordAdding(),void(this._tempTimeRecord=null);if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.DELETE_TIME_RECORD_TITLE"),this._$translate.instant("DIALOGS.DELETE_TIME_RECORD_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._logCardEvent({event:O.cN.CardEvents.TimeRecordDeleted,data:{isDuration:t.isDuration,durationMinutes:t.durationMinutes}}),this._hasChanges=!0,this._$scope.$evalAsync((()=>this._cardTimeRecords=null)),await this._calendarCardsSrv.deleteCalendarCardTimeRecordAsync(this.calendarCard,t.id)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}}});return c()(t,"isTempRecord",{get:()=>e===this._tempTimeRecord}),c()(t,"isBusy",{get:()=>!this.isNewCard&&this._isTimeRecordBusy&&t.id===$.$d}),c()(t,"comment",{get:()=>this._dirtyCardTimeRecordComment.has(t.id)?this._dirtyCardTimeRecordComment.get(t.id):e.comment,set:async r=>{if(t.comment!==r&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))try{t.isTempRecord?e.comment=r:(this._logCardEvent({event:O.cN.CardEvents.TimeRecordCommentChanged}),this._hasChanges=!0,this._dirtyCardTimeRecordComment.set(t.id,r),await this._calendarCardsSrv.updateCalendarCardTimeRecordAsync(this.calendarCard,t.id,{comment:r}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardTimeRecordComment.delete(t.id),this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}}}),c()(t,"isDuration",{get:()=>this._dirtyCardTimeRecordIsDuration.has(t.id)?this._dirtyCardTimeRecordIsDuration.get(t.id):e.isDuration,set:async r=>{if(t.isDuration!==r&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))try{let i,a,s=t.durationMinutes;r?(i=(0,N.$Y)(t.from),a=i):(0,N.KC)(t.from,new Date)?(a=(0,N.GG)(new Date,"quarterHour"),i=(0,N.mH)(a,-s)):(i=(0,N.nT)(t.from),a=(0,N.mH)(i,s)),t._maxTo=null,t.isTempRecord?(e.isDuration=r,e.from=i,e.to=a):(this._logCardEvent({event:r?O.cN.CardEvents.TimeRecordTimeRemoved:O.cN.CardEvents.TimeRecordTimeAdded,data:{isDuration:r,durationMinutes:t.durationMinutes}}),this._hasChanges=!0,this._dirtyCardTimeRecordIsDuration.set(t.id,r),this._dirtyCardTimeRecordFrom.set(t.id,i),this._dirtyCardTimeRecordTo.set(t.id,a),this._dirtyCardTimeRecordDurationMinutes.set(t.id,s),await this._calendarCardsSrv.updateCalendarCardTimeRecordAsync(this.calendarCard,t.id,{isDuration:r,from:i,to:a,durationMinutes:s}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardTimeRecordIsDuration.delete(t.id),this._dirtyCardTimeRecordFrom.delete(t.id),this._dirtyCardTimeRecordTo.delete(t.id),this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}}}),c()(t,"from",{get:()=>this._dirtyCardTimeRecordFrom.has(t.id)?this._dirtyCardTimeRecordFrom.get(t.id):e.from,set:async r=>{if(r&&!(0,N.rs)(t.from,r))if(this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))try{let i;if(t.isDuration){let e=(0,N.i2)(t.from,t.to);i=(0,N.E4)(r,e)}else{let e=(0,N.CX)(t.from,t.to);i=(0,N.mH)(r,e)}t._maxTo=null,t.isTempRecord?(e.from=r,e.to=i):(this._logCardEvent({event:O.cN.CardEvents.TimeRecordFromChanged,data:{isDuration:t.isDuration,durationMinutes:t.durationMinutes}}),this._hasChanges=!0,this._dirtyCardTimeRecordFrom.set(t.id,r),this._dirtyCardTimeRecordTo.set(t.id,i),await this._calendarCardsSrv.updateCalendarCardTimeRecordAsync(this.calendarCard,t.id,{isDuration:t.isDuration,from:r,to:i}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardTimeRecordFrom.delete(t.id),this._dirtyCardTimeRecordTo.delete(t.id),this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}else this._$timeout((()=>e.from=new Date(e.from)))}}),c()(t,"to",{get:()=>this._dirtyCardTimeRecordTo.has(t.id)?this._dirtyCardTimeRecordTo.get(t.id):e.to,set:async r=>{if(r&&!(0,N.rs)(t.to,r))if(this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))try{t._maxTo=null,t.isTempRecord?(e.to=r,e.durationMinutes=(0,N.CX)(t.from,r)):(this._logCardEvent({event:O.cN.CardEvents.TimeRecordToChanged,data:{isDuration:t.isDuration,durationMinutes:(0,N.CX)(t.from,r)}}),this._hasChanges=!0,this._dirtyCardTimeRecordTo.set(t.id,r),await this._calendarCardsSrv.updateCalendarCardTimeRecordAsync(this.calendarCard,t.id,{isDuration:t.isDuration,to:r,durationMinutes:(0,N.CX)(t.from,r)}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardTimeRecordTo.delete(t.id),this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}else this._$timeout((()=>e.to=new Date(e.to)))}}),c()(t,"maxTo",{get:()=>(t._maxTo||((0,N.KC)(t.from,new Date)&&(0,N.KC)(t.to,new Date)?t._maxTo=(0,N.h3)(t.from):t._maxTo=(0,N.v8)(t.from,this._timeTrackingSrv.timeRecordMaxDurationSeconds)),t._maxTo)}),c()(t,"date",{get:()=>{let e="Dm";return(0,N.FT)(t.from,new Date)&&(0,N.FT)(t.to,new Date)||(e="D"),kendo.toString(t.from,e)}}),c()(t,"isLastYear",{get:()=>!(0,N.FT)(t.from,new Date)||!(0,N.FT)(t.to,new Date)}),c()(t,"durationHours",{get:()=>(0,N.QZ)(t.durationMinutes)}),c()(t,"durationMinutes",{get:()=>t.isDuration?this._dirtyCardTimeRecordDurationMinutes.has(t.id)?this._dirtyCardTimeRecordDurationMinutes.get(t.id):e.durationMinutes:(0,N.CX)(t.from,t.to),set:async r=>{if(t.durationMinutes!==r&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))try{let i=t.to;t.isDuration||(i=(0,N.mH)(t.from,r)),t.isTempRecord?(e.to=i,e.durationMinutes=r):(this._logCardEvent({event:O.cN.CardEvents.TimeRecordDurationChanged,data:{isDuration:t.isDuration,durationMinutes:r}}),this._hasChanges=!0,this._dirtyCardTimeRecordDurationMinutes.set(t.id,r),this._dirtyCardTimeRecordTo.set(t.id,i),await this._calendarCardsSrv.updateCalendarCardTimeRecordAsync(this.calendarCard,t.id,{isDuration:t.isDuration,from:t.from,to:i,durationMinutes:r}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardTimeRecordDurationMinutes.delete(t.id),this._dirtyCardTimeRecordTo.delete(t.id),this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}}}),c()(t,"member",{get:()=>this._dirtyCardTimeRecordMember.has(t.id)?this._dirtyCardTimeRecordMember.get(t.id):CardEditorController_objectSpread({},this._trelloIntegrationSrv.getTrelloMemberById(this.calendarCard.accountId,e.memberId)),set:async r=>{if(t.memberId!==r.id&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))try{t.isTempRecord?e.memberId=r.id:(this._logCardEvent({event:O.cN.CardEvents.TimeRecordMemberChanged}),this._hasChanges=!0,this._dirtyCardTimeRecordMember.set(t.id,r),await this._calendarCardsSrv.updateCalendarCardTimeRecordAsync(this.calendarCard,t.id,{memberId:r.id}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardTimeRecordMember.delete(t.id),this._$scope.$evalAsync((()=>this._cardTimeRecords=null))}}}),t}))).call(e,N.EA)}return this._cardTimeRecords}},{kind:"get",key:"cardTotalTimeRecordDuration",value:function cardTotalTimeRecordDuration(){var e;let t=(null!==(e=this.parentCard)&&void 0!==e?e:this.calendarCard).providerCard.totalTimeRecordDurationHours;if(t)return`${t}h`}},{kind:"get",key:"isCardTimerStarted",value:function isCardTimerStarted(){if(!this._timeTrackingSrv.isTimerStarted)return!1;if(this._timeTrackingSrv.timerAccountId!==this.calendarCard.accountId)return!1;switch(this.calendarCard.cardType){case se.eT.TrelloCustomField:case se.eT.TrelloCheckItem:return this._timeTrackingSrv.timerParentId===this.calendarCard.providerCard.parentId;default:return this._timeTrackingSrv.timerParentId===this.calendarCard.id}}},{kind:"method",key:"startTimerAsync",value:async function startTimerAsync(){if(this._timeTrackingSrv.isTimerBusy)return;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))return;if(this._telemetrySrv.logSessionEvent(O.cN.TimeTrackingEvents.TimerStartClicked,{where:O.Fb.Dialog}),this._timeTrackingSrv.isTimerStarted){if(!await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.NOW_THE_TIMER_IS_ON_TITLE"),this._$translate.instant("DIALOGS.START_NEW_TIMER_AND_STOP_CURRENT_ONE_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.START_NEW_TIMER"),isPrimary:!0,dialogResult:!0}]}))return;await this.stopTimerAsync()}let e;switch(this.calendarCard.cardType){case se.eT.TrelloCustomField:case se.eT.TrelloCheckItem:e=this.calendarCard.providerCard.parentId;break;default:e=this.calendarCard.id}await this._timeTrackingSrv.startTimerAsync(this.calendarCard.accountId,{providerType:O.lP.Trello,calendarId:this.calendarCard.calendarId,parentId:e})&&this._telemetrySrv.logSessionEvent(O.cN.TimeTrackingEvents.TimerStarted,{where:O.Fb.Dialog})}},{kind:"method",key:"stopTimerAsync",value:async function stopTimerAsync(){if(!this._timeTrackingSrv.isTimerBusy)try{let e=await this._timeTrackingSrv.stopTimerAsync();if(!e)return;this.isSectionCollapsed("timeRecords")&&this.toggleSectionCollapse("timeRecords"),this._telemetrySrv.logSessionEvent(O.cN.TimeTrackingEvents.TimerStopped,{where:O.Fb.Dialog});let t=await this._calendarCardsSrv.getCalendarCardByIdAsync(e.accountId,se.eT.TrelloCard,e.parentId);if(t){let r=(0,N.CX)(e.startDate,e.endDate);this._logCardEvent({event:O.cN.CardEvents.Scheduled,data:{cardType:se.eT.TrelloTimeRecord,cardRole:se.D.Card,isDuration:!1,durationMinutes:r,by:O.AH.Timer}});let i=await this._calendarCardsSrv.createCalendarCardTimeRecordAsync(t,{comment:e.comment,isDuration:!1,from:e.startDate,to:e.endDate,durationMinutes:r,memberId:this._currentMemberId});this._$timeout((()=>{var e;let t=Fe()(e=this.cardTimeRecords).call(e,(e=>e.id===i.id));this.cardTimeRecordsLimit<t&&(this._cardTimeRecordsLimit=t+1),this.cardTimeRecords[t].createdFromTimer=!0}),0,!1)}}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}}},{kind:"get",key:"timerTime",value:function timerTime(){if(this.isCardTimerStarted)return this._timeTrackingSrv.timerCounterText}},{kind:"get",key:"isAttachmentsAvailable",value:function isAttachmentsAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return!this.isReadOnly||this.cardAttachments.length>0;case se.eT.TrelloCheckItem:return this.parentCard&&(!this.isReadOnly||this.cardAttachments.length>0)}return!1}},{kind:"get",key:"isAttachmentsEditingDisabled",value:function isAttachmentsEditingDisabled(){return this.isTrelloCheckItemCard||this.isTrelloTimeRecordCard}},{kind:"get",key:"cardAttachments",value:function cardAttachments(){if(this.delayRender)return[];if(!this.cardBoard)return[];if(!this._cardAttachments){var e;let t=this._calendarCardsSrv.getCalendarCardAttachments(this.calendarCard)||[];this._cardAttachments=re()(e=n()(t).call(t,(e=>{var t;let r=CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{isImage:(null===(t=e.mimeType)||void 0===t?void 0:$e()(t).call(t,"image/"))||O.ek.has((0,N.RT)(e.url)),tryOpen:t=>{t.isDefaultPrevented()||(this._logCardEvent({event:O.cN.CardEvents.AttachmentClicked,data:{attachmentType:e.type}}),r.isImage&&(t.preventDefault(),this._showAttachment(e)))},showEditDialogAsync:async t=>{try{let i=await this._dialogSrv.showEditAttachmentDialogAsync({attachment:e,relativeTo:t.currentTarget});if(!i)return;let a=!1,s={};if(i.name!==e.name&&(this._logCardEvent({event:O.cN.CardEvents.AttachmentNameChanged,data:{attachmentType:e.type}}),a=!0,s.name=i.name),i.url!==e.url&&(this._logCardEvent({event:O.cN.CardEvents.AttachmentLinkChanged,data:{attachmentType:e.type}}),a=!0,s.url=i.url),!a)return;this._hasChanges=!0,this._$scope.$evalAsync((()=>this._cardAttachments=null)),await this._calendarCardsSrv.updateCalendarCardAttachmentAsync(this.calendarCard,r.id,s)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardAttachments=null))}},deleteAsync:async()=>{if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.REMOVE_ATTACHMENT_TITLE"),this._$translate.instant("DIALOGS.REMOVE_ATTACHMENT_CONFIRM",{name:Ke()(e.name,36)}),{buttons:[{text:this._$translate.instant("BUTTONS.YES"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._logCardEvent({event:O.cN.CardEvents.AttachmentDeleted,data:{attachmentType:e.type}}),this._hasChanges=!0,this._$scope.$evalAsync((()=>this._cardAttachments=null)),await this._calendarCardsSrv.deleteCalendarCardAttachmentAsync(this.calendarCard,r.id)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardAttachments=null))}}});return c()(r,"isBusy",{get:()=>{var e;return!this.isNewCard&&$e()(e=r.id).call(e,$.$d)}}),c()(r,"progressPercent",{get:()=>{if(r.isBusy){let e=Lt.get(r.id);if(e)return Math.round(e)}}}),c()(r,"previewUrl",{get:()=>{var t;return null===(t=e.previews[1])||void 0===t?void 0:t.url}}),c()(r,"extension",{get:()=>{switch(e.type){case O.sf.File:return(0,N.RT)(e.url)||(0,N.RT)(e.name)||"file";case O.sf.Link:return"link"}}}),c()(r,"shortDate",{get:()=>(0,N.zg)(e.date)}),c()(r,"fullDate",{get:()=>(0,N.Tu)(e.date)}),r}))).call(e,N.X_),this._rebindRelativeDates()}return this._cardAttachments}},{kind:"get",key:"addAttachmentDialogTargetComponent",value:function addAttachmentDialogTargetComponent(){return Qe.g}},{kind:"field",key:"onAddAttachmentByDialog",value(){return async e=>this._createAttachmentsAsync(e,{event:O.cN.CardEvents.AttachmentAdded,data:{by:gt.dialog}})}},{kind:"field",key:"onAddAttachmentByPanel",value(){return async e=>this._createAttachmentsAsync(e,{event:O.cN.CardEvents.AttachmentAdded,data:{by:gt.panel}})}},{kind:"get",key:"isHighlightAttachmentsDropArea",value:function isHighlightAttachmentsDropArea(){return!(this.isBusy||this.isReadOnly||!this.isAttachmentsAvailable)&&this._isHighlightAttachmentsDropArea}},{kind:"method",key:"_createAttachmentsAsync",value:async function _createAttachmentsAsync(e,t){if(0!==(e=w()(e).call(e,(e=>!(e.type===O.sf.File&&e.file.size>10485760)||(this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.ATTACH_MAX_FILE_SIZE_WARNING",{fileName:Ke()(e.name,36)}),O.k$.Warning),!1)))).length)try{this._hasChanges=!0,this._$scope.$evalAsync((()=>{this._scrollToSection("attachments")}));for(let r of e)Rt(),this._logCardEvent({event:t.event,data:CardEditorController_objectSpread(CardEditorController_objectSpread({},t.data),{},{attachmentType:r.type})}),await this._calendarCardsSrv.createCalendarCardAttachmentAsync(this.calendarCard,r,(e=>{const{id:t,isComplete:r,percent:i}=e;r?Lt.has(t)&&(Rt(),Lt.delete(t)):Lt.get(t)!==i&&(Rt(),Lt.set(t,i))}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{Rt()}}},{kind:"method",key:"_toggleHighlightAttachmentsDropArea",value:function _toggleHighlightAttachmentsDropArea(e){this._isHighlightAttachmentsDropArea!==e&&this._$scope.$evalAsync((()=>{ae()(".pw-dialog").toggleClass("pw-dialog--dragover",e),this._isHighlightAttachmentsDropArea=e}))}},{kind:"method",key:"_onDropAttachmentsAsync",value:function _onDropAttachmentsAsync(e){var t,r;if(this.isBusy||this.isReadOnly||!this.isAttachmentsAvailable)return;let i=(null===(t=e.dataTransfer)||void 0===t?void 0:t.files)||[],a=n()(r=De()(i)).call(r,(e=>({type:O.sf.File,name:e.name,file:e})));return this._createAttachmentsAsync(a,{event:O.cN.CardEvents.AttachmentAdded,data:{by:O.AH.Mouse}})}},{kind:"method",key:"_onPasteAttachmentsAsync",value:function _onPasteAttachmentsAsync(e){var t,r,i;if(this.isBusy||this.isReadOnly||!this.isAttachmentsAvailable)return;let a=(null===(t=e.clipboardData)||void 0===t?void 0:t.items)||[],s=w()(r=K()(i=De()(a)).call(i,(t=>{switch(t.kind){case"string":if(ae()(e.target).is("input:focus, textarea:focus"))return;let r=e.clipboardData.getData(t.type).split(/\s+/);return n()(r).call(r,(e=>{if(/^https?:\/\//.test(e))return{type:O.sf.Link,name:Ke()(e,256),url:e}}));case"file":let i=t.getAsFile();if(!i)return;return{type:O.sf.File,name:Ke()(i.name,256),file:i}}}))).call(r,(e=>e));return this._createAttachmentsAsync(s,{event:O.cN.CardEvents.AttachmentAdded,data:{by:O.AH.Paste}})}},{kind:"method",key:"_showAttachment",value:function _showAttachment(e){var t,r;const i=n()(t=w()(r=this.cardAttachments).call(r,(e=>e.isImage))).call(t,(e=>({src:e.url,title:e.name,description:`${this._$translate.instant("DIALOGS.ADDED")} ${e.shortDate}`}))),a=Fe()(i).call(i,(t=>{let{src:r}=t;return r===e.url}));this._dialogSrv.showAttachmentPopupAsync(i,a)}},{kind:"get",key:"isCommentsAvailable",value:function isCommentsAvailable(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:case se.eT.TrelloCustomField:return this.canComment||this.cardComments.length>0;case se.eT.TrelloCheckItem:return this.parentCard&&(this.canComment||this.cardComments.length>0)}return!1}},{kind:"get",key:"isCommentsBusy",value:function isCommentsBusy(){return this._isCommentsBusy}},{kind:"get",key:"canComment",value:function canComment(){var e;return(!this.isReadOnly||(null===(e=this.cardBoard)||void 0===e?void 0:e.isCommentsPublic))&&!this.isArchived}},{kind:"get",key:"newComment",value:function newComment(){return this._tempComment}},{kind:"method",key:"isCommentAdding",value:function isCommentAdding(){return this._isCommentAdding}},{kind:"method",key:"isCommentEditing",value:function isCommentEditing(){return!!this._commentEditingId}},{kind:"method",key:"beginCommentAdding",value:function beginCommentAdding(){this._tempComment||(this._tempComment={comment:""}),this._isCommentAdding=!0,this._$timeout((()=>{ae()(".pw-js-dialog-edit-card-comment-add-panel-input").trigger("focus"),this._$scope.$broadcast(O.FK.AutosizeControlsResizeRequested)}),0,!1)}},{kind:"method",key:"rejectCommentAdding",value:function rejectCommentAdding(){this._$scope.$evalAsync((()=>{this._isCommentAdding=!1,this._tempComment=null})),this._keepScrollFocus()}},{kind:"method",key:"submitCommentAddingAsync",value:async function submitCommentAddingAsync(){var e;if(this.isCommentAdding()&&null!==(e=this._tempComment)&&void 0!==e&&e.comment)try{this.isSectionCollapsed("comments")&&this.toggleSectionCollapse("comments"),await this._loadCommentsAsync(),this._logCardEvent({event:O.cN.CardEvents.CommentAdded}),this._hasChanges=!0;let e=this._tempComment.comment;this._isCommentAdding=!1,this._tempComment=null,this._cardComments=null,await this._calendarCardsSrv.createCalendarCardCommentAsync(this.calendarCard,{comment:e})}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardComments=null))}}},{kind:"get",key:"cardComments",value:function cardComments(){if(this.delayRender)return[];if(!this.cardBoard)return[];if(!this._cardComments){var e,t;this._dirtyCardComments||(this._dirtyCardComments=new(ke()));let r=this._calendarCardsSrv.getCalendarCardComments(this.calendarCard)||[];this._cardComments=Ie()(e=re()(t=n()(r).call(r,(e=>{let t=CardEditorController_objectSpread(CardEditorController_objectSpread({},e),{},{accountId:this.calendarCard.accountId,member:CardEditorController_objectSpread({},e.member),sourceMember:e.sourceMember&&CardEditorController_objectSpread({},e.sourceMember),reply:()=>{this._logCardEvent({event:O.cN.CardEvents.CommentReplyClicked}),this._$timeout((()=>{var e;this.beginCommentAdding();let r=_()(e=this._$element).call(e,".pw-js-dialog-edit-card-comment-add-panel-input")[0];if(!r)return;let i=this._trelloIntegrationSrv.getTrelloMemberById(this.calendarCard.accountId,t.memberId);if(!i)return;let a=`@${i.userName}`;if(this.newComment.comment){var s;if(Z()(s=this.newComment.comment).call(s,a))return;this.newComment.comment+=(/\s$/.test(this.newComment.comment)?"":" ")+a}else this.newComment.comment=a;this._$timeout((()=>{var e;return null===(e=r[0])||void 0===e?void 0:e.setSelectionRange(this.newComment.comment.length,this.newComment.comment.length)}),0,!1)}),0,!1)},deleteAsync:async()=>{if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.DELETE_COMMENT_TITLE"),this._$translate.instant("DIALOGS.DELETE_COMMENT_CONFIRM",{comment:Ke()(e.comment,36)}),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._logCardEvent({event:O.cN.CardEvents.CommentDeleted}),this._hasChanges=!0,this._$scope.$evalAsync((()=>this._cardComments=null)),await this._calendarCardsSrv.deleteCalendarCardCommentAsync(this.calendarCard,t.id)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._$scope.$evalAsync((()=>this._cardComments=null))}},openSourceCardAsync:async()=>{try{this.isBusy=!0;const{accountId:e,sourceCardId:r}=t;let i=await this._calendarCardsSrv.getCalendarCardByIdAsync(e,se.eT.TrelloCard,r);if(!i)return void this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.CARD_IS_NOT_FOUND_ERROR"),O.k$.Warning);this._logCardEvent({event:O.cN.CardEvents.CommentSourceOpened}),this._dialogSrv.showEditCardDialogAsync(i)}finally{this.isBusy=!1}}});return c()(t,"isBusy",{get:()=>{var e;return!this.isNewCard&&$e()(e=t.id).call(e,$.$d)}}),c()(t,"shortCreationDate",{get:()=>(0,N.zg)(e.creationDate)}),c()(t,"fullCreationDate",{get:()=>(0,N.Tu)(e.creationDate)}),c()(t,"shortLastEditDate",{get:()=>(0,N.zg)(e.lastEditDate)}),c()(t,"fullLastEditDate",{get:()=>(0,N.Tu)(e.lastEditDate)}),c()(t,"isCommentEditing",{get:()=>this._commentEditingId===t.id,set:e=>{e?(this._commentEditingId=t.id,this._$timeout((()=>{var e;let r=_()(e=ae()(`.pw-js-dialog-edit-card-comment[data-comment-id="${t.id}"]`)).call(e,".pw-js-dialog-edit-card-comment-input");r[0]&&(r[0].setSelectionRange(r[0].value.length,r[0].value.length),r.trigger("focus")),this._$scope.$broadcast(O.FK.AutosizeControlsResizeRequested)}),0,!1)):this._commentEditingId===t.id&&(this._commentEditingId=null)}}),c()(t,"comment",{get:()=>this._dirtyCardComments.has(t.id)?this._dirtyCardComments.get(t.id):e.comment,set:async e=>{if(e&&t.comment!==e)try{this._logCardEvent({event:O.cN.CardEvents.CommentEdited}),this._hasChanges=!0,this._dirtyCardComments.set(t.id,e),await this._calendarCardsSrv.updateCalendarCardCommentAsync(this.calendarCard,t.id,{comment:e})}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardComments.delete(t.id),this._$scope.$evalAsync((()=>this._cardComments=null))}}}),t}))).call(t,N.Pk)).call(e,0,this._cardCommentsLimit),this._rebindRelativeDates()}return this._cardComments}},{kind:"get",key:"commentCountTotal",value:function commentCountTotal(){switch(this.calendarCard.cardType){case se.eT.TrelloCard:return this.calendarCard.providerCard.badges.comments;case se.eT.TrelloCustomField:case se.eT.TrelloCheckItem:if(this.parentCard)return this.parentCard.providerCard.badges.comments}return 0}},{kind:"method",key:"setMentionContextMenu",value:function setMentionContextMenu(e){this._mentionContextMenu=e}},{kind:"method",key:"openMentionContextMenu",value:function openMentionContextMenu(e,t,r){let i;switch(this.memberFilter="",e){case"input":if("@"!==t.originalEvent.key)return;if(/(\p{L}|\p{N})@$/u.test(t.currentTarget.value.substring(0,t.currentTarget.selectionStart)))return;let{top:e,left:r}=qe()(t.currentTarget,t.currentTarget.selectionStart);i=new(ae().Event)("contextmenu",{relativeTo:{target:t.currentTarget,offsetX:r+6,offsetY:e-6,positionLeft:"left",positionTop:"bottom"}});break;case"button":i=new(ae().Event)(t.type,{relativeTo:{target:t.target,offsetX:32,offsetY:35,positionLeft:"right",positionTop:"bottom"}});break;default:return}this._mentionContextMenu.open(i,r)}},{kind:"method",key:"addMentionToComment",value:function addMentionToComment(e,t){let r;var i;(this._logCardEvent({event:O.cN.CardEvents.CommentMentionAdded}),this.isCommentAdding())?(r=ae()(".pw-js-dialog-edit-card-comment-add-panel-input")[0],this._$timeout((()=>{ae()(".pw-js-dialog-edit-card-comment-add-panel-input").trigger("focus"),this._$scope.$broadcast(O.FK.AutosizeControlsResizeRequested)}),0,!1)):r=_()(i=ae()(`.pw-js-dialog-edit-card-comment[data-comment-id="${t.id}"]`)).call(i,".pw-js-dialog-edit-card-comment-input")[0];if(r){var a,s;let i=r.selectionStart,n=e.userName;0===i||/\s/.test(r.value[i-1])?n="@"+n:"@"!==r.value[i-1]&&(n=" @"+n),i<r.value.length&&!/\s/.test(r.value[i])&&(n+=" "),t.comment=Ie()(a=r.value).call(a,0,i)+n+Ie()(s=r.value).call(s,i),t.isCommentEditing=!0,this._$timeout((()=>r.setSelectionRange(i+n.length,i+n.length)),0,!1)}}},{kind:"method",key:"_loadCommentsAsync",value:function _loadCommentsAsync(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._commentsLoaded||e)return this._loadCommentsPromise||(this._loadCommentsPromise=(async()=>{if(!this.isNewCard)try{this._isCommentsBusy=!0,await this._calendarCardsSrv.reloadCalendarCardCommentsAsync(this.calendarCard),this._commentsLoaded=!0}catch(e){this._$log.error("Trello load comments error:"),this._$log.error(e),this._telemetrySrv.logError("Trello load comments error",e,{class:this.constructor.name,method:this._loadCommentsAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.LOAD_TRELLO_COMMENTS_ERROR"),O.k$.Error)}finally{this._loadCommentsPromise=null,this._$scope.$evalAsync((()=>{this._cardComments=null,this._isCommentsBusy=!1}))}})()),this._loadCommentsPromise}},{kind:"get",key:"cardUrl",value:function cardUrl(){return this.calendarCard.cardUrl}},{kind:"get",key:"cardUrlTarget",value:function cardUrlTarget(){0}},{kind:"method",key:"openCardInSource",value:function openCardInSource(e){this._logCardEvent({event:O.cN.CardEvents.CardOpenClicked,data:{by:O.AH.DialogPanel}}),e.which===O.Jm.Left&&this.hideDialog()}},{kind:"method",key:"switchDetailedModeAsync",value:async function switchDetailedModeAsync(){await new(ze())((e=>this._$scope.$emit(O.FK.CardDialogSwitchDetailedModeRequested,{resolve:e}))),this.isDetailed&&this._loadCommentsAsync(),this._logCardEvent({event:O.cN.CardEvents.EditDialogModeChanged,data:{by:O.AH.Dialog,isDetailed:!this.isDetailed}})}},{kind:"method",key:"hideDialog",value:function hideDialog(e){this._$scope.$emit(O.FK.CardDialogHideRequested,{dialogResult:e})}},{kind:"method",key:"initialize",value:function initialize(){var e,t;if(!O.EJ.has(this.calendarCard.cardType)){var r;const e=this._tmpAccountId||this.calendarCard.accountId;this._calendarCardsSrv.changeCalendarCardType(this.calendarCard,se.eT.TrelloCard,e);const{title:t,isAllDay:i,start:a,end:s}=this.calendarCard;this.calendarCard.providerCard=this._provider.getCalendarCardClass().fromSourceCard(this.calendarCard.id,e,se.eT.TrelloCard),this.calendarCard.providerCard.boardId=null!==(r=this._tmpCalendarId)&&void 0!==r?r:this.calendarCard.providerCard.boardId,this.calendarCard.title=t,this.calendarCard.isAllDay=i,this.calendarCard.start=a,this.calendarCard.end=s,this._tmpAccountId=null,this._tmpCalendarId=null}switch(this.setCardBoard(this.calendarCard.accountId,this.calendarCard.providerCard.boardId),this._isArchived=this.calendarCard.providerCard.isArchived,this._isCompleted=this.calendarCard.providerCard.isCompleted,this._isSubscribed=this.calendarCard.providerCard.isSubscribed,this._title=this.calendarCard.title,this._isAllDay=this.calendarCard.isAllDay,this._startDate=this.calendarCard.start,this._endDate=this.calendarCard.end,this._maxEndDate=null,this._durationMinutes=this.calendarCard.providerCard.durationMinutes,this._recurrenceRule=this.calendarCard.recurrenceRule,this._priority=_()(e=this.availablePriorities).call(e,(e=>{let{value:t}=e;return t===this.calendarCard.providerCard.priority})),this._description=null===(t=this.calendarCard.description)||void 0===t?void 0:Pe()(t).call(t),this._addServiceListeners(),this.calendarCard.cardType){case se.eT.TrelloCustomField:this._trelloCustomField=this._trelloIntegrationSrv.getTrelloCustomFieldById(this.calendarCard.accountId,this.calendarCard.providerCard.trelloCustomFieldId),this.calendarCard.providerCard.parentId&&(this._parentCard=this._calendarCardsSrv.getCalendarCardById(this.calendarCard.accountId,se.eT.TrelloCard,this.calendarCard.providerCard.parentId));break;case se.eT.TrelloCheckItem:case se.eT.TrelloTimeRecord:this.calendarCard.providerCard.parentId&&(this._parentCard=this._calendarCardsSrv.getCalendarCardById(this.calendarCard.accountId,se.eT.TrelloCard,this.calendarCard.providerCard.parentId))}this.isDetailed&&this._loadCommentsAsync(),this._scrollToCommentId&&(async()=>{this.isDetailed||this.switchDetailedModeAsync();let e=await this._htmlHelperSrv.elementAddedOnceAsync(this._$element,`.pw-dialog-edit-card-comment[data-comment-id="${this._scrollToCommentId}"]`);e&&this._$timeout((()=>{e.trigger("focus")}),250,!1)})()}},{kind:"get",key:"isBusy",value:function isBusy(){return this._isBusy}},{kind:"set",key:"isBusy",value:function isBusy(e){this._$scope.$evalAsync((()=>this._isBusy=e))}},{kind:"get",key:"isNewCard",value:function isNewCard(){return this.calendarCard.isTempCard}},{kind:"get",key:"isNewCardValid",value:function isNewCardValid(){return this._isNewCardValid}},{kind:"method",key:"isCardFieldValid",value:function isCardFieldValid(e){if("parentCard"===e)switch(this.calendarCard.cardType){case se.eT.TrelloCheckItem:case se.eT.TrelloTimeRecord:return!!this.parentCard;default:return!0}return!1}},{kind:"get",key:"isCardReadOnly",value:function isCardReadOnly(){var e;return!!this.calendarCard.isReadOnly||this.calendarCard.providerCard.boardId&&!ee()(e=this.selectedBoards).call(e,(e=>e.id===this.calendarCard.providerCard.boardId))}},{kind:"get",key:"isReadOnly",value:function isReadOnly(){return this.isCardReadOnly||this.isArchived}},{kind:"get",key:"isToggleDatesDisabled",value:function isToggleDatesDisabled(){return this._isToggleDatesDisabled}},{kind:"set",key:"isToggleDatesDisabled",value:function isToggleDatesDisabled(e){this._$scope.$evalAsync((()=>this._isToggleDatesDisabled=e))}},{kind:"get",key:"isTrelloCard",value:function isTrelloCard(){return this.calendarCard.cardType===se.eT.TrelloCard}},{kind:"get",key:"isMilestone",value:function isMilestone(){return this.calendarCard.cardRole===se.D.Milestone}},{kind:"get",key:"isTrelloCustomFieldCard",value:function isTrelloCustomFieldCard(){return this.calendarCard.cardType===se.eT.TrelloCustomField}},{kind:"get",key:"isTrelloCheckItemCard",value:function isTrelloCheckItemCard(){return this.calendarCard.cardType===se.eT.TrelloCheckItem}},{kind:"get",key:"isTrelloTimeRecordCard",value:function isTrelloTimeRecordCard(){return this.calendarCard.cardType===se.eT.TrelloTimeRecord}},{kind:"get",key:"isSubscribed",value:function isSubscribed(){return this._isSubscribed}},{kind:"method",key:"toggleCardIsSubscribed",value:function toggleCardIsSubscribed(e){this._checkEditAvailable()&&(this._isSubscribed=!this.isSubscribed,this._isSubscribedByMember=!0,this._logCardEvent({event:this.isSubscribed?O.cN.CardEvents.Subscribed:O.cN.CardEvents.Unsubscribed,data:{by:gt[e]}}),this._setCardPropertiesAsync({isSubscribed:this.isSubscribed}),this._keepScrollFocus())}},{kind:"method",key:"copyCardUrlAsync",value:function copyCardUrlAsync(){return this._provider.copyCardUrlAsync(this.calendarCard,{telemetry:{by:O.AH.DialogPanel}})}},{kind:"method",key:"convertCheckItemToToCardAsync",value:function convertCheckItemToToCardAsync(){if(this._checkEditAvailable())return this._convertCalendarCardCheckItemAsync({event:O.cN.CardEvents.CheckItemConverted,data:{by:O.AH.DialogPanel}})}},{kind:"method",key:"duplicateCardAsync",value:function duplicateCardAsync(){if(this._checkEditAvailable())return this._duplicateCardAsync({event:O.cN.CardEvents.Duplicated,data:{by:O.AH.DialogPanel}})}},{kind:"get",key:"isArchived",value:function isArchived(){return this._isArchived}},{kind:"method",key:"toggleCardIsArchived",value:function toggleCardIsArchived(){this._checkEditAvailable()&&(this._isArchived=!this.isArchived,this._logCardEvent({event:this.isArchived?O.cN.CardEvents.Archived:O.cN.CardEvents.Unarchived,data:{by:O.AH.Dialog}}),this._setCardPropertiesAsync({isArchived:this.isArchived}),this._keepScrollFocus())}},{kind:"method",key:"removeDatesAsync",value:function removeDatesAsync(){return this._removeCardDatesAsync({event:O.cN.CardEvents.DatesRemoved,data:{by:O.AH.DialogPanel}})}},{kind:"method",key:"deleteCardAsync",value:function deleteCardAsync(){return this._deleteCardAsync({event:O.cN.CardEvents.Deleted,data:{by:O.AH.DialogPanel}})}},{kind:"get",key:"cardTooltipOptions",value:function cardTooltipOptions(){return this._cardTooltipOptions||(this._cardTooltipOptions={getCardForTooltip:(e,t,r)=>this._cardLinksForceLoadedCardsCache.has(t)?this._cardLinksForceLoadedCardsCache.get(t):this._calendarCardsSrv.getCalendarCardById(e,r,t)}),this._cardTooltipOptions}},{kind:"get",key:"delayRender",value:function delayRender(){return!this._renderDelayed}},{kind:"get",key:"showWeekNumbers",value:function showWeekNumbers(){return this._collectionSettings.global.settings.showWeekNumbers}},{kind:"method",key:"isSectionCollapsed",value:function isSectionCollapsed(e){var t;return Z()(t=this._trelloCollectionSettings.local.editCardDialog.collapsed).call(t,e)}},{kind:"method",key:"toggleSectionCollapse",value:function toggleSectionCollapse(e){let t=this._trelloCollectionSettings.local.editCardDialog.collapsed,r=u()(t).call(t,e);-1===r?t.push(e):m()(t).call(t,r,1),this._collectionSettings.local.save(),this._$timeout((()=>this._$scope.$broadcast("md-resize-textarea")),0,!1)}},{kind:"get",key:"isMacOS",value:function isMacOS(){return this._platformSrv.isMacOS()}},{kind:"get",key:"preventEscape",value:function preventEscape(){return this._dragState.isDragging}},{kind:"method",key:"saveCalendarCardAsync",value:async function saveCalendarCardAsync(){var e,t,r;if(!this._isSaveCardCalled){if(this._isSaveCardCalled=!0,this.title&&this.isNewCard&&this._setCardPropertiesAsync({title:this.title}),this.isCheckItemAdding()&&await this.submitCheckItemAddingAsync(),this.isTimeRecordAdding()&&await this.submitTimeRecordAddingAsync(),this.isCommentAdding()&&await this.submitCommentAddingAsync(),!this.isNewCard)return this._isSaveCardCalled=!1,void this.hideDialog(O.Xs.CardEdited);try{switch(this.calendarCard.cardType){case se.eT.TrelloCheckItem:case se.eT.TrelloTimeRecord:await this._$timeout((()=>this._isNewCardValid=!0)),await this._$timeout((()=>this._isNewCardValid=this.isCardFieldValid("parentCard")));break;default:this._isNewCardValid=!0}if(!this.isNewCardValid)return;let i;switch(this._appCommonSrv.setSchedulerBusy(!0),this._updateCardPromise&&await this._updateCardPromise,this._hasChanges=!1,this.hideDialog(O.Xs.CardCreated),this._collectionSettings.local.settings.lastUsedCalendarData={accountType:se.Qm.Trello,accountId:this.calendarCard.accountId,calendarId:this.calendarCard.calendarId},this._collectionSettings.local.save(),this.calendarCard.cardType){case se.eT.TrelloCard:i=await this._calendarCardsSrv.createCalendarCardAsync(this.calendarCard);break;case se.eT.TrelloCheckItem:let a=re()(e=this._calendarCardsSrv.getCalendarCardChecklists(this.parentCard)||[]).call(e,N.Fo)[0];a||(a=await this._calendarCardsSrv.createCalendarCardChecklistAsync(this.parentCard,{name:this._$translate.instant("MISC.CHECKLIST")}));let{id:s}=await this._calendarCardsSrv.createCalendarCardCheckItemAsync(this.parentCard,a.id,{name:this.title||this._$translate.instant("MISC.NO_TITLE"),position:"bottom",isCompleted:this.isCompleted});i=await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(this.parentCard,a.id,s,{start:this.startDate,end:this.endDate,isAllDay:this.isAllDay,memberIds:n()(t=this.cardMembers).call(t,(e=>e.id))});break;case se.eT.TrelloTimeRecord:i=await this._calendarCardsSrv.createCalendarCardTimeRecordAsync(this.parentCard,{comment:this.title,isDuration:this.isAllDay,from:this.startDate,to:this.endDate,durationMinutes:this.durationMinutes,memberId:w()(r=De()(this.calendarCard.providerCard.memberIds)).call(r,(e=>e!==$.$d))[0]})}i&&this._$rootScope.$broadcast(O.FK.CardCreated,{calendarCard:i})}catch(e){this._$log.error("Planyway card creating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant(this._createCardMessagesByCardType[this.calendarCard.cardType].error),O.k$.Error),this._calendarCardsSrv.deleteCalendarCardAsync(this.calendarCard)}finally{this._appCommonSrv.setSchedulerBusy(!1),this._isSaveCardCalled=!1}}}},{kind:"method",key:"confirmCloseAsync",value:async function confirmCloseAsync(){let e=!1;if(this.isLinkAdding()&&(this.rejectLinkAdding(),e=!0),this.isCheckItemAdding()&&(await this.submitCheckItemAddingAsync(),e=!0),this.isTimeRecordAdding()&&(await this.submitTimeRecordAddingAsync(),e=!0),this.isCommentAdding()&&(this.rejectCommentAdding(),e=!0),e)return!1;if(this.isNewCard){switch(this.calendarCard.cardType){case se.eT.TrelloCheckItem:case se.eT.TrelloTimeRecord:if(!this.isCardFieldValid("parentCard")&&!this._isDeleting)return this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.NO_PARENT_CARD_TITLE"),this._$translate.instant("DIALOGS.NO_PARENT_CARD_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]})}if(this._isSaveCardCalled)return!0;if(!this.hasChanges&&this._forceDetailedMode)return!0;if(!this._isDeleting)return await this.saveCalendarCardAsync(),!1}return!0}},{kind:"get",key:"_parentDialogController",value:function _parentDialogController(){return this._parentDialogControllerInternal||(this._parentDialogControllerInternal=(0,N.sO)(this._$scope,Je.Z)),this._parentDialogControllerInternal}},{kind:"method",key:"_registerEditor",value:function _registerEditor(){var e;null===(e=this._parentDialogController)||void 0===e||e.registerCardEditorControllerAsync(this)}},{kind:"get",key:"_tmpAccountId",value:function _tmpAccountId(){var e;return null===(e=this._parentDialogController)||void 0===e?void 0:e._tmpAccountId}},{kind:"set",key:"_tmpAccountId",value:function _tmpAccountId(e){this._parentDialogController&&(this._parentDialogController._tmpAccountId=e)}},{kind:"get",key:"_tmpCalendarId",value:function _tmpCalendarId(){var e;return null===(e=this._parentDialogController)||void 0===e?void 0:e._tmpCalendarId}},{kind:"set",key:"_tmpCalendarId",value:function _tmpCalendarId(e){this._parentDialogController&&(this._parentDialogController._tmpCalendarId=e)}},{kind:"get",key:"_isProviderTypeChanging",value:function _isProviderTypeChanging(){return this._tmpAccountId||this._tmpCalendarId}},{kind:"method",key:"_onInputKeyDown",value:function _onInputKeyDown(e){e.stopPropagation();let t=ae()(e.target),r=e.which;if(this.isLinkAdding()&&t.closest(".pw-js-dialog-edit-card-link-add-panel")[0]&&r===O.VD.Escape)this.rejectLinkAdding();if(this.isCheckItemAdding()){if(t.closest(".pw-js-dialog-edit-card-check-item-add-panel")[0])switch(r){case O.VD.Enter:case O.VD.Enter2:e.ctrlKey||e.shiftKey||this._$timeout((()=>this.submitCheckItemAddingAsync()),0,!1);break;case O.VD.Escape:this.rejectCheckItemAdding()}}else r===O.VD.Escape&&this._$timeout((()=>ae()(".pw-js-dialog-edit-card-check-item-add-panel").removeClass("pw-dialog-edit-card-check-item--temp-check-item-editing")),0,!1);if(this.isTimeRecordAdding()&&t.closest(".pw-js-dialog-edit-card-time-record-add-panel")[0])switch(r){case O.VD.Enter:case O.VD.Enter2:e.ctrlKey||e.shiftKey||this._$timeout((()=>this.submitTimeRecordAddingAsync()),0,!1);break;case O.VD.Escape:this.rejectTimeRecordAdding()}if(this.isCommentAdding()&&t.closest(".pw-js-dialog-edit-card-comment-add-panel")[0])switch(r){case O.VD.Enter:case O.VD.Enter2:(e.ctrlKey||e.shiftKey)&&this._$timeout((()=>this.submitCommentAddingAsync()),0,!1);break;case O.VD.Escape:this.rejectCommentAdding()}}},{kind:"method",key:"_onEditorKeyDown",value:function _onEditorKeyDown(e){var t;let r=e.which;if(O.gD.has(r)&&(r!==O.VD.C||!e.ctrlKey&&!e.metaKey)&&(e.preventDefault(),e.stopPropagation(),null===(t=O.Vj[this.calendarCard.cardType])||void 0===t?void 0:Z()(t).call(t,r))){switch(this.calendarCard.cardType){case se.eT.TrelloCard:if(this.isCardReadOnly)return;if(!this.isArchived)break;if(r===O.VD.C)break;if((r===O.VD.Delete||r===O.VD.Backspace)&&(e.shiftKey||e.metaKey))break;return;case se.eT.TrelloCustomField:if(this.isCardReadOnly)return;if(!this.isArchived){if(r===O.VD.E)break;if(r===O.VD.S)break;if(r===O.VD.Space||r===O.VD.M)break;if(!(r!==O.VD.Delete&&r!==O.VD.Backspace||e.shiftKey||e.metaKey))break;if(r>=O.VD.Key0&&r<=O.VD.Key9||r===O.VD.L)break}return;case se.eT.TrelloCheckItem:if(this.isCardReadOnly)return;if(!this.isArchived){if(r===O.VD.E)break;if(r===O.VD.Space||r===O.VD.M)break;if(r===O.VD.Delete||r===O.VD.Backspace)break;if(r>=O.VD.Key0&&r<=O.VD.Key9||r===O.VD.L)break}return;case se.eT.TrelloTimeRecord:if(this.isCardReadOnly)return;if(!this.isArchived){if(r===O.VD.D&&!this.calendarCard.isTempCard)break;if(r===O.VD.M)break;if(r===O.VD.Space&&!this.calendarCard.providerCard.memberIds.has(this._currentMemberId))break;if((r===O.VD.Delete||r===O.VD.Backspace)&&(e.shiftKey||e.metaKey))break;if(r>=O.VD.Key0&&r<=O.VD.Key9||r===O.VD.L)break}return}this._updateCardByHotkey(e.keyCode,{altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey})}}},{kind:"method",key:"_updateCardByHotkey",value:function _updateCardByHotkey(e,t){switch(e){case O.VD.C:if(this.isNewCard||!this._checkEditAvailable())break;this._isArchived=!this.isArchived,this._logCardEvent({event:this.isArchived?O.cN.CardEvents.Archived:O.cN.CardEvents.Unarchived,data:{by:O.AH.DialogHotkey}}),this._setCardPropertiesAsync({isArchived:this.isArchived});break;case O.VD.D:if(this.isNewCard||!this._checkEditAvailable())break;(t.ctrlKey||t.metaKey)&&this._duplicateCardAsync({event:O.cN.CardEvents.Duplicated,data:{by:O.AH.DialogHotkey}});break;case O.VD.E:if(!this.hasDates)break;if(!this._checkEditAvailable())break;this._isCompleted=!this.isCompleted,this._logCardEvent({event:this.isCompleted?O.cN.CardEvents.MarkedCompleted:O.cN.CardEvents.MarkedIncompleted,data:{by:O.AH.DialogHotkey}}),this._setCardPropertiesAsync({isCompleted:this.isCompleted});break;case O.VD.L:if(!this.isLabelsAvailable)break;ae()(".pw-js-dialog-edit-card-labels-menu-btn").trigger("click");break;case O.VD.M:if(!this.isMembersAvailable)break;ae()(".pw-js-dialog-edit-card-members-menu-btn").trigger("click");break;case O.VD.S:if(!this._checkEditAvailable())break;this._isSubscribed=!this.isSubscribed,this._isSubscribedByMember=!0,this._logCardEvent({event:this.isSubscribed?O.cN.CardEvents.Subscribed:O.cN.CardEvents.Unsubscribed,data:{by:O.AH.DialogHotkey}}),this._setCardPropertiesAsync({isSubscribed:this.isSubscribed});break;case O.VD.Space:if(!this.isMembersAvailable)break;if(!this._checkEditAvailable())break;this._cardBoardMembers=null;let i=!this.calendarCard.providerCard.memberIds.has(this._currentMemberId),a=(0,ne.Pv)(this.calendarCard,this._currentMemberId);this._logCardEvent({event:i?O.cN.CardEvents.MemberAssignedSelf:O.cN.CardEvents.MemberUnassignedSelf,data:{memberIds:a,by:O.AH.DialogHotkey}}),this._setCardPropertiesAsync({memberIds:a});break;case O.VD.Delete:case O.VD.Backspace:if(t.shiftKey||t.metaKey){if(this.isNewCard)break;this._deleteCardAsync({event:O.cN.CardEvents.Deleted,data:{by:O.AH.DialogHotkey}})}else this._removeCardDatesAsync({event:O.cN.CardEvents.DatesRemoved,data:{by:O.AH.DialogHotkey}});break;default:if(e>=O.VD.Key0&&e<=O.VD.Key9){var r;if(!this.isLabelsAvailable)break;if(!this._checkEditAvailable())break;let t=O.I[e],i=_()(r=this.cardBoardLabels).call(r,(e=>e.color===t));if(!i)break;this._cardBoardLabels=null;let a=!this.calendarCard.providerCard.labelIds.has(i.id);this._logCardEvent({event:a?O.cN.CardEvents.LabelAdded:O.cN.CardEvents.LabelRemoved,data:{by:O.AH.DialogHotkey}}),this._setCardPropertiesAsync({labelIds:(0,ne.iG)(this.calendarCard,i.id)})}}}},{kind:"get",key:"_currentMemberId",value:function _currentMemberId(){return this._planywayIntegrationSrv.getConnectedAccountById(this.calendarCard.accountId).trelloMemberId}},{kind:"get",key:"_userSettings",value:function _userSettings(){return this._settingsSrv.user}},{kind:"get",key:"_trelloUserSettings",value:function _trelloUserSettings(){return{local:this._userSettings.local.settings.provider[O.lP.Trello],global:this._userSettings.global.settings.provider[O.lP.Trello]}}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[O.lP.Trello],global:this._collectionSettings.global.settings.provider[O.lP.Trello]}}},{kind:"set",key:"_hasChanges",value:function _hasChanges(e){this._$scope.$emit(O.FK.CardDialogSetHasChangesRequested,{hasChanges:e})}},{kind:"get",key:"_createCardMessagesByCardType",value:function _createCardMessagesByCardType(){return this._createCardMessagesByCardTypeLazy||(this._createCardMessagesByCardTypeLazy={[se.eT.TrelloCard]:{error:"NOTIFICATIONS.CREATE_TRELLO_CARD_ERROR"},[se.eT.TrelloCheckItem]:{error:"NOTIFICATIONS.CREATE_TRELLO_CHECK_ITEM_CARD_ERROR"},[se.eT.TrelloTimeRecord]:{error:"NOTIFICATIONS.CREATE_TRELLO_TIME_RECORD_CARD_ERROR"}}),this._createCardMessagesByCardTypeLazy}},{kind:"get",key:"_removeCardDatesMessagesByCardType",value:function _removeCardDatesMessagesByCardType(){return this._removeCardDatesMessagesByCardTypeLazy||(this._removeCardDatesMessagesByCardTypeLazy={[se.eT.TrelloCard]:{title:"DIALOGS.REMOVE_TRELLO_CARD_DATES_TITLE",confirm:"DIALOGS.REMOVE_TRELLO_CARD_DATES_CONFIRM",error:"NOTIFICATIONS.REMOVE_TRELLO_CARD_ERROR"},[se.eT.TrelloCustomField]:{title:"DIALOGS.REMOVE_TRELLO_CUSTOM_FIELD_CARD_DATES_TITLE",confirm:"DIALOGS.REMOVE_TRELLO_CUSTOM_FIELD_CARD_DATES_CONFIRM",error:"NOTIFICATIONS.REMOVE_TRELLO_CUSTOM_FIELD_CARD_ERROR"},[se.eT.TrelloCheckItem]:{title:"DIALOGS.REMOVE_TRELLO_CHECK_ITEM_CARD_DATES_TITLE",confirm:"DIALOGS.REMOVE_TRELLO_CHECK_ITEM_CARD_DATES_CONFIRM",error:"NOTIFICATIONS.REMOVE_TRELLO_CHECK_ITEM_CARD_ERROR"}}),this._removeCardDatesMessagesByCardTypeLazy}},{kind:"get",key:"_deleteCardMessagesByCardType",value:function _deleteCardMessagesByCardType(){return this._deleteCardMessagesByCardTypeLazy||(this._deleteCardMessagesByCardTypeLazy={[se.eT.TrelloCard]:{title:"DIALOGS.DELETE_TRELLO_CARD_TITLE",confirm:"DIALOGS.DELETE_TRELLO_CARD_CONFIRM",error:"NOTIFICATIONS.DELETE_TRELLO_CARD_ERROR"},[se.eT.TrelloCheckItem]:{title:"DIALOGS.DELETE_TRELLO_CHECK_ITEM_CARD_TITLE",confirm:"DIALOGS.DELETE_TRELLO_CHECK_ITEM_CARD_CONFIRM",error:"NOTIFICATIONS.DELETE_TRELLO_CHECK_ITEM_CARD_ERROR"},[se.eT.TrelloTimeRecord]:{title:"DIALOGS.DELETE_TRELLO_TIME_RECORD_CARD_TITLE",confirm:"DIALOGS.DELETE_TRELLO_TIME_RECORD_CARD_CONFIRM",error:"NOTIFICATIONS.DELETE_TRELLO_TIME_RECORD_CARD_ERROR"}}),this._deleteCardMessagesByCardTypeLazy}},{kind:"get",key:"_cancelCreateCardMessagesByCardType",value:function _cancelCreateCardMessagesByCardType(){return this._cancelCreateCardMessagesByCardTypeLazy||(this._cancelCreateCardMessagesByCardTypeLazy={[se.eT.TrelloCard]:{title:"DIALOGS.CANCEL_CREATE_TRELLO_CARD_TITLE",confirm:"DIALOGS.CANCEL_CREATE_TRELLO_CARD_CONFIRM",error:"NOTIFICATIONS.DELETE_TRELLO_CARD_ERROR"},[se.eT.TrelloCheckItem]:{title:"DIALOGS.CANCEL_CREATE_TRELLO_CHECK_ITEM_CARD_TITLE",confirm:"DIALOGS.CANCEL_CREATE_TRELLO_CHECK_ITEM_CARD_CONFIRM",error:"NOTIFICATIONS.DELETE_TRELLO_CHECK_ITEM_CARD_ERROR"},[se.eT.TrelloTimeRecord]:{title:"DIALOGS.CANCEL_CREATE_TRELLO_TIME_RECORD_CARD_TITLE",confirm:"DIALOGS.CANCEL_CREATE_TRELLO_TIME_RECORD_CARD_CONFIRM",error:"NOTIFICATIONS.DELETE_TRELLO_TIME_RECORD_CARD_ERROR"}}),this._cancelCreateCardMessagesByCardTypeLazy}},{kind:"method",key:"_scrollToSection",value:function _scrollToSection(e){let t;switch(e){case"links":t=".pw-js-dialog-edit-card-link-add-panel";break;case"reminders":t=".pw-js-dialog-edit-card-reminders-section";break;case"checklists":t=".pw-js-dialog-edit-card-checklists-section";break;case"timeRecords":t=".pw-js-dialog-edit-card-time-records-section";break;case"attachments":t=".pw-js-dialog-edit-card-attachments-section";break;default:return}this._$timeout((()=>{this._htmlHelperSrv.elementAdded(this._$element,t,(e=>{(0,We.Z)(e[0],{scrollMode:"if-needed",block:"nearest",inline:"nearest",behavior:"smooth"})}),!0)}),0,!1)}},{kind:"method",key:"_addServiceListeners",value:function _addServiceListeners(){this._serviceEventsListenersAdded||(this._serviceEventsListenersAdded=!0,this._onAddOrUpdateCard=(e,t)=>{var r;e.id===this.calendarCard.id?this._addOrUpdateCard(e,t):e.id===this.calendarCard.providerCard.parentId?(e=this._calendarCardsSrv.getCalendarCardById(this.calendarCard.accountId,this.calendarCard.cardType,this.calendarCard.id))?this._addOrUpdateCard(e,t):this._deleteCard():ee()(r=this.cardLinks).call(r,(t=>t.toCardId===e.id))&&(this._cardLinks=null)},this._onDeleteCard=(e,t)=>{var r;e.id===this.calendarCard.id?t.replacedWith?this._addOrUpdateCard(t.replacedWith,t):this._deleteCard():ee()(r=this.cardLinks).call(r,(t=>t.toCardId===e.id))&&(this._cardLinks=null)},this._calendarCardsSrv.addCalendarCardEventListener("added",this._onAddOrUpdateCard),this._calendarCardsSrv.addCalendarCardEventListener("updated",this._onAddOrUpdateCard),this._calendarCardsSrv.addCalendarCardEventListener("deleted",this._onDeleteCard),this._onTrelloBoardChanged=e=>{this._selectedBoards=null,this._organizations=null,e.accountId===this.calendarCard.accountId&&e.id===this.calendarCard.providerCard.boardId&&this.setCardBoard(e.accountId,e.id)},this._trelloIntegrationSrv.addTrelloBoardEventListener("added",this._onTrelloBoardChanged),this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",this._onTrelloBoardChanged),this._trelloIntegrationSrv.addTrelloBoardEventListener("deleted",this._onTrelloBoardChanged))}},{kind:"method",key:"_removeServiceListeners",value:function _removeServiceListeners(){this._serviceEventsListenersAdded&&(this._serviceEventsListenersAdded=!1,this._calendarCardsSrv.removeCalendarCardEventListener("added",this._onAddOrUpdateCard),this._calendarCardsSrv.removeCalendarCardEventListener("updated",this._onAddOrUpdateCard),this._calendarCardsSrv.removeCalendarCardEventListener("deleted",this._onDeleteCard),this._trelloIntegrationSrv.removeTrelloBoardEventListener("added",this._onTrelloBoardChanged),this._trelloIntegrationSrv.removeTrelloBoardEventListener("updated",this._onTrelloBoardChanged),this._trelloIntegrationSrv.removeTrelloBoardEventListener("deleted",this._onTrelloBoardChanged))}},{kind:"method",key:"_addOrUpdateCard",value:function _addOrUpdateCard(e,t){e.providerCard.isArchived&&this._$mdMenu.hide(),this.calendarCard=e.isTempCard?e:e.clone(),this._$scope.$evalAsync((()=>{var r,i;(this._isArchived=e.providerCard.isArchived,this._isCompleted=e.providerCard.isCompleted,this._isSubscribed=e.providerCard.isSubscribed,this._isAllDay=e.isAllDay,this._startDate=e.start,this._endDate=e.end,this._maxEndDate=null,this._durationMinutes=e.providerCard.durationMinutes,this._recurrenceRule=e.recurrenceRule,this._priority=_()(r=this.availablePriorities).call(r,(t=>{let{value:r}=t;return r===e.providerCard.priority})),t.hasExternalChanges)&&(this._title=e.title,this._description=null===(i=e.description)||void 0===i?void 0:Pe()(i).call(i));this.setCardBoard(e.accountId,e.providerCard.boardId),this._cardLinks=null,this._cardReminders=null,this._cardChecklists=null,this._cardTimeRecords=null,this._cardAttachments=null,this._cardComments=null,e.isTempCard&&(this._hasChanges=!0),this._updateCardPromise&&(this._updateCardPromise.resolve(),this._updateCardPromise=null)})),t.hasExternalChanges&&this._loadCommentsAsync(!0)}},{kind:"method",key:"_moveToBoardAsync",value:async function _moveToBoardAsync(e){if(this._checkEditAvailable()&&this.calendarCard.providerCard.boardId!==e.id)try{var t;this.isBusy=!0,await this._trelloIntegrationSrv.loadBoardDataAsync(e.accountId,e.id);let r=this._trelloIntegrationSrv.getTrelloBoardById(e.accountId,e.id);if(!r)return;this.setCardBoard(e.accountId,e.id),await this._setCardPropertiesAsync({accountId:r.accountId,boardId:r.id,listId:r.defaultListId||(null===(t=r.lists[0])||void 0===t?void 0:t.id)||null,position:r.defaultCardPosition})}finally{this.isBusy=!1}}},{kind:"method",key:"_deleteCard",value:function _deleteCard(){this._hasChanges=!1,this.hideDialog(O.Xs.CardDeleted)}},{kind:"method",key:"_clearCardData",value:function _clearCardData(e){if(this.isTrelloCard&&(!e||e!==se.eT.TrelloCard)){if(this.cardLinks.length>0){let e=[...this.cardLinks];for(let t of e)this._calendarCardsSrv.removeCalendarCardLinkAsync(this.calendarCard,t.toCardId,t.linkType.value)}if(this.cardReminders.length>0&&this._setCardPropertiesAsync({notifications:[],isSubscribed:!!this._isSubscribedByMember&&void 0}),this.cardChecklists.length>0){let e=[...this.cardChecklists];for(let t of e)this._calendarCardsSrv.deleteCalendarCardChecklistAsync(this.calendarCard,t.id)}if(this.cardTimeRecords.length>0){let e=[...this.cardTimeRecords];for(let t of e)this._calendarCardsSrv.deleteCalendarCardTimeRecordAsync(this.calendarCard,t.id)}if(this.cardAttachments.length>0){let e=[...this.cardAttachments];for(let t of e)this._calendarCardsSrv.deleteCalendarCardAttachmentAsync(this.calendarCard,t.id)}if(this.cardComments.length>0){let e=[...this.cardComments];for(let t of e)this._calendarCardsSrv.deleteCalendarCardCommentAsync(this.calendarCard,t.id)}this.calendarCard.providerCard.labelIds=new(Te()),this._cardLabels=null,this.calendarCard.providerCard.memberIds=new(Te()),this._cardMembers=null,this.calendarCard.providerCard.priority=0,this.calendarCard.providerCard.estimationHours=0,this.calendarCard.recurrenceRule=void 0,this.calendarCard.exceptionDates=void 0}!this.isTrelloCard&&!this.isTrelloCheckItemCard||e&&(e===se.eT.TrelloCard||e===se.eT.TrelloCheckItem)||(this.calendarCard.providerCard.isCompleted=!1),!this.isTrelloCheckItemCard&&!this.isTrelloTimeRecordCard||e&&(e===se.eT.TrelloCheckItem||e===se.eT.TrelloTimeRecord)||(this.parentCard=null,this.parentCardSearchString=null),e||(this.calendarCard.providerCard.boardId=null,this.calendarCard.providerCard.listId=null)}},{kind:"method",key:"_setCardPropertiesAsync",value:async function _setCardPropertiesAsync(e){this._$timeout((()=>this._keepScrollFocus()),0,!1),this._hasChanges=!0;try{if(this.isNewCard){this._updateCardPromise&&await this._updateCardPromise;let e=null;this._updateCardPromise=new(ze())((t=>e=t)),this._updateCardPromise.resolve=e}else this.calendarCard.recurrenceRule&&(void 0!==e.isAllDay&&e.isAllDay!==this.calendarCard.isAllDay||e.start&&!(0,N.rs)(e.start,this.calendarCard.start)||void 0!==e.recurrenceRule&&e.isAllDay!==this.calendarCard.recurrenceRule)&&(e.exceptionDates=[],this.calendarCard.deleteExceptionDates(),(async()=>{try{await this._calendarCardsSrv.deleteRecurrenceExceptionsAsync(this.calendarCard.cardType,this.calendarCard)}catch(e){this._$log.error("Planyway delete card exceptions error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway delete card exceptions error",e,{class:this.constructor.name,method:this._setCardPropertiesAsync.name})}})());await this._calendarCardsSrv.updateCalendarCardPropertiesAsync(this.calendarCard,e)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}}},{kind:"method",key:"_duplicateCardAsync",value:async function _duplicateCardAsync(e){this._logCardEvent(e);try{let e;switch(this.isBusy=!0,this._appCommonSrv.setSchedulerBusy(!0),this.calendarCard.cardType){case se.eT.TrelloCard:e=await this._calendarCardsSrv.createCalendarCardAsync(this.calendarCard.duplicate());break;case se.eT.TrelloTimeRecord:let t=this._calendarCardsSrv.getCalendarCardById(this.calendarCard.accountId,se.eT.TrelloCard,this.calendarCard.providerCard.parentId);if(!t)return;let r=await this._calendarCardsSrv.createCalendarCardTimeRecordAsync(t,{comment:this.calendarCard.title,isDuration:this.calendarCard.isAllDay,from:this.calendarCard.start,to:this.calendarCard.end,durationMinutes:this.calendarCard.providerCard.durationMinutes,memberId:this._currentMemberId});e=this._calendarCardsSrv.getCalendarCardById(this.calendarCard.accountId,se.eT.TrelloTimeRecord,r.id)}this._dialogSrv.showEditCardDialogAsync(e,{openerContext:this._dialogOpenerContext,noAnimation:this.isDetailed})}catch(e){this._$log.error("Planyway duplicate card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.DUPLICATE_CARD_ERROR"),O.k$.Error),this._telemetrySrv.logError("Planyway duplicate card error",e,{class:this.constructor.name,method:this._duplicateCardAsync.name})}finally{this.isBusy=!1,this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_convertCalendarCardCheckItemAsync",value:async function _convertCalendarCardCheckItemAsync(e){this._logCardEvent(e);try{var t;if(this.isBusy=!0,this._appCommonSrv.setSchedulerBusy(!0),!this.parentCard)return;let e=null===(t=this._calendarCardsSrv.getCalendarCardChecklists(this.parentCard))||void 0===t?void 0:_()(t).call(t,(e=>{var t;return ee()(t=e.checkItems).call(t,(e=>e.id===this.calendarCard.id))}));if(!e)return;let r=await this._calendarCardsSrv.convertCalendarCardCheckItemAsync(this.parentCard,e.id,this.calendarCard.id);if(!r)return;this._dialogSrv.showEditCardDialogAsync(r,{openerContext:this._dialogOpenerContext,noAnimation:this.isDetailed})}catch(e){this._$log.error("Planyway convert card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.CONVERT_CARD_ERROR"),O.k$.Error),this._telemetrySrv.logError("Planyway convert card error",e,{class:this.constructor.name,method:this._convertCalendarCardCheckItemAsync.name})}finally{this.isBusy=!1,this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_removeCardDatesAsync",value:async function _removeCardDatesAsync(e){if(!this.hasDates||this.isToggleDatesDisabled)return;if(!Z()(kt).call(kt,this.calendarCard.cardType))return;if(await this._dialogSrv.showConfirmAsync(this._$translate.instant(this._removeCardDatesMessagesByCardType[this.calendarCard.cardType].title),this._$translate.instant(this._removeCardDatesMessagesByCardType[this.calendarCard.cardType].confirm),{buttons:[{text:this._$translate.instant("BUTTONS.YES"),isPrimary:!0,isDangerous:!0,dialogResult:!0}],dontAskType:O.Ek.RemoveFromCalendar})){this._logCardEvent(e);try{this.isToggleDatesDisabled=!0,!this.isNewCard&&this.calendarCard.recurrenceRule&&(async()=>{try{await this._calendarCardsSrv.deleteRecurrenceExceptionsAsync(this.calendarCard.cardType,this.calendarCard)}catch(e){this._$log.error("Planyway delete card exceptions error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway delete card exceptions error",e,{class:this.constructor.name,method:this._removeCardDatesAsync.name})}})(),await this._calendarCardsSrv.removeCalendarCardAsync(this.calendarCard)}catch(e){this._$log.error("Planyway remove card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant(this._removeCardDatesMessagesByCardType[this.calendarCard.cardType].error),O.k$.Error),this._telemetrySrv.logError("Planyway remove card error",e,{class:this.constructor.name,method:this._removeCardDatesAsync.name})}finally{this.isToggleDatesDisabled=!1}}}},{kind:"method",key:"_deleteCardAsync",value:async function _deleteCardAsync(e){if(!Z()(bt).call(bt,this.calendarCard.cardType))return;let t=this.isNewCard?this._cancelCreateCardMessagesByCardType[this.calendarCard.cardType]:this._deleteCardMessagesByCardType[this.calendarCard.cardType];if(!this.isNewCard||this.hasChanges){if(!await this._dialogSrv.showConfirmAsync(this._$translate.instant(t.title),this._$translate.instant(t.confirm),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE_CARD"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))return}this._logCardEvent(e),this._isDeleting=!0;try{this._appCommonSrv.setSchedulerBusy(!0),!this.isNewCard&&this.calendarCard.recurrenceRule&&(async()=>{try{await this._calendarCardsSrv.deleteRecurrenceExceptionsAsync(this.calendarCard.cardType,this.calendarCard)}catch(e){this._$log.error("Planyway delete card exceptions error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway delete card exceptions error",e,{class:this.constructor.name,method:this._deleteCardAsync.name})}})(),await this._calendarCardsSrv.deleteCalendarCardAsync(this.calendarCard)}catch(e){this._$log.error("Planyway delete card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant(t.error),O.k$.Error),this._telemetrySrv.logError("Planyway delete card error",e,{class:this.constructor.name,method:this._deleteCardAsync.name})}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_checkEditAvailable",value:function _checkEditAvailable(){if(this.isMilestone&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Milestones,!0))return!1;if(this.recurrenceRule&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.RecurringCards,!0))return!1;switch(this.calendarCard.cardType){case se.eT.TrelloCheckItem:if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.AdvancedChecklists,!0))return!1;break;case se.eT.TrelloTimeRecord:if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TimeTracking,!0))return!1}return!0}},{kind:"method",key:"_logCardEvent",value:function _logCardEvent(e){e.data=CardEditorController_objectSpread({accountId:this.calendarCard.accountId,calendarId:this.calendarCard.calendarId,isAllDay:this.isAllDay,start:this.startDate,end:this.endDate,durationMinutes:this.durationMinutes,memberIds:this.calendarCard.providerCard.memberIds,isAssignedToMe:this.calendarCard.providerCard.memberIds.has(this._currentMemberId)},e.data),this._$scope.$emit(O.FK.CardDialogLogCardEventRequested,e)}},{kind:"method",key:"_keepScrollFocus",value:function _keepScrollFocus(){this._$scope.$emit(O.FK.CardDialogKeepScrollFocusRequested)}},{kind:"method",key:"_rebindRelativeDates",value:function _rebindRelativeDates(){this._rebindRelativeDatesInterval&&(this._$interval.cancel(this._rebindRelativeDatesInterval),this._$scope.$broadcast("$$rebind::relativeDates")),this._rebindRelativeDatesInterval=this._$interval((()=>this._$scope.$broadcast("$$rebind::relativeDates")),3e4,!1)}}]}}));function CardTooltipController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function CardTooltipController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=CardTooltipController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=CardTooltipController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function CardTooltipController_getDecoratorsApi(){CardTooltipController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CardTooltipController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CardTooltipController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CardTooltipController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CardTooltipController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CardTooltipController_createElementDescriptor(e){var t,r=CardTooltipController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CardTooltipController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CardTooltipController_hasDecorators(e){return e.decorators&&e.decorators.length}function CardTooltipController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CardTooltipController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CardTooltipController_toPropertyKey(e){var t=function CardTooltipController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const Pt="labels",Mt="members",Bt="priority",Ot="estimation",$t="trackedTime",Nt="checklist",Ft="customField";let jt=function CardTooltipController_decorate(e,t,r,i){var a,s=CardTooltipController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CardTooltipController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CardTooltipController_isDataDescriptor(a.descriptor)||CardTooltipController_isDataDescriptor(i.descriptor)){if(CardTooltipController_hasDecorators(a)||CardTooltipController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CardTooltipController_hasDecorators(a)){if(CardTooltipController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CardTooltipController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CardTooltipController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$translate","appCommonSrv","calendarCardsSrv","settingsSrv","trelloIntegrationSrv","calendarCard"])],(function(e){return{F:class CardTooltipController{constructor(t,r,i,a,s,n){var o;switch(e(this),this._$translate=t,this._appCommonSrv=r,this._calendarCardsSrv=i,this._settingsSrv=a,this._trelloIntegrationSrv=s,this._calendarCard=n,this._showCardNumber=this._collectionSettings.global.settings.showCardNumber,this._calendarCard.cardType){case se.eT.TrelloCard:this._trelloBoard=this._trelloIntegrationSrv.getTrelloBoardById(this._calendarCard.accountId,this._calendarCard.providerCard.boardId),this._trelloList=this._trelloIntegrationSrv.getTrelloListById(this._calendarCard.accountId,this._calendarCard.providerCard.listId);break;case se.eT.TrelloCustomField:this._trelloBoard=this._trelloIntegrationSrv.getTrelloBoardById(this._calendarCard.accountId,this._calendarCard.providerCard.boardId),this._trelloList=this._trelloIntegrationSrv.getTrelloListById(this._calendarCard.accountId,this._calendarCard.providerCard.listId),this._parentCard=this._calendarCardsSrv.getCalendarCardById(this._calendarCard.accountId,se.eT.TrelloCard,this._calendarCard.providerCard.parentId),this._trelloCustomField=this._trelloIntegrationSrv.getTrelloCustomFieldById(this._calendarCard.accountId,this._calendarCard.providerCard.trelloCustomFieldId);break;case se.eT.TrelloCheckItem:this._trelloBoard=this._trelloIntegrationSrv.getTrelloBoardById(this._calendarCard.accountId,this._calendarCard.providerCard.boardId),this._trelloList=this._trelloIntegrationSrv.getTrelloListById(this._calendarCard.accountId,this._calendarCard.providerCard.listId),this._parentCard=this._calendarCardsSrv.getCalendarCardById(this._calendarCard.accountId,se.eT.TrelloCard,this._calendarCard.providerCard.parentId),this._trelloChecklist=null===(o=this._calendarCardsSrv.getCalendarCardChecklists(this._calendarCard))||void 0===o?void 0:_()(o).call(o,(e=>{var t;return ee()(t=e.checkItems).call(t,(e=>e.id===this._calendarCard.id))}));break;case se.eT.TrelloTimeRecord:this._trelloBoard=this._trelloIntegrationSrv.getTrelloBoardById(this._calendarCard.accountId,this._calendarCard.providerCard.boardId),this._trelloList=this._trelloIntegrationSrv.getTrelloListById(this._calendarCard.accountId,this._calendarCard.providerCard.listId),this._parentCard=this._calendarCardsSrv.getCalendarCardById(this._calendarCard.accountId,se.eT.TrelloCard,this._calendarCard.providerCard.parentId)}}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloCardTooltipCtrl"}},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"method",key:"isTooltipItemAvailable",value:function isTooltipItemAvailable(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ee()(t).call(t,(e=>{switch(e){case Pt:return this.cardLabels.length>0;case Mt:return this.cardMembers.length>0;case Bt:return!!this.cardPriority;case Ot:return!!this.cardEstimation;case $t:return!!this.cardTotalTimeRecordDuration;case Nt:return this._calendarCard.cardType===se.eT.TrelloCheckItem;case Ft:return this._calendarCard.cardType===se.eT.TrelloCustomField}}))}},{kind:"get",key:"cardLabels",value:function cardLabels(){var e,t,r,i;this._cardLabels||(this._cardLabels=n()(e=re()(t=w()(r=n()(i=De()((this._parentCard||this._calendarCard).providerCard.labelIds)).call(i,(e=>this._trelloIntegrationSrv.getTrelloLabelById(this._calendarCard.accountId,e)))).call(r,(e=>e&&this._calendarCard.providerCard.boardId===e.boardId))).call(t,N.G4)).call(e,(e=>CardTooltipController_objectSpread(CardTooltipController_objectSpread({},e),{},{name:e.name||this._$translate.instant(e.color?O.y_[e.color]:"MISC.LABEL_COLOR_NO_COLOR")}))));return this._cardLabels}},{kind:"get",key:"cardPriority",value:function cardPriority(){return this._calendarCard.providerCard.priority}},{kind:"get",key:"cardPriorityName",value:function cardPriorityName(){switch(this._calendarCard.providerCard.priority){case 0:return this._$translate.instant("MENU.PRIORITY_UNSET");case 1:return this._$translate.instant("MENU.PRIORITY_LOW");case 2:return this._$translate.instant("MENU.PRIORITY_MEDIUM");case 3:return this._$translate.instant("MENU.PRIORITY_HIGH");default:return""}}},{kind:"get",key:"cardTitle",value:function cardTitle(){return this._showCardNumber&&this._calendarCard.providerCard.cardNumber?`#${this._calendarCard.providerCard.cardNumber} ${this._calendarCard.title}`:this._calendarCard.title}},{kind:"get",key:"hasDates",value:function hasDates(){return this._calendarCard.hasDates}},{kind:"get",key:"cardTimesText",value:function cardTimesText(){if(!this._calendarCard.hasDates)return;let e=this._calendarCard.realStart||this._calendarCard.start,t=this._calendarCard.realEnd||this._calendarCard.end,r=(0,N.KA)(e,t,!this.isAllDay);if(this._calendarCard.cardType===se.eT.TrelloTimeRecord)return r;if(this._calendarCard.isAllDay&&(t=(0,N.E4)(t,1)),!this.isMilestone){let i=(0,N.bt)(e,t,this._appCommonSrv.getSchedulerWorkWeek()).minutes,a=(0,N.gG)(i);if(a)return`${r} (${a})`}return r}},{kind:"get",key:"cardTimeDurationText",value:function cardTimeDurationText(){if(this._calendarCard.cardType===se.eT.TrelloTimeRecord)return(0,N.QZ)(this._calendarCard.providerCard.durationMinutes)}},{kind:"get",key:"isMilestone",value:function isMilestone(){return this._calendarCard.cardRole===se.D.Milestone}},{kind:"get",key:"isAllDay",value:function isAllDay(){return this._calendarCard.isAllDay}},{kind:"get",key:"isRecurring",value:function isRecurring(){return this._calendarCard.isRecurring?this._calendarCard.isRecurring():!!this._calendarCard.recurrenceRule||!!this._calendarCard.recurrenceId}},{kind:"get",key:"isException",value:function isException(){return this._calendarCard.isException?this._calendarCard.isException():!!this._calendarCard.recurrenceId}},{kind:"get",key:"cardAccountId",value:function cardAccountId(){return this._calendarCard.accountId}},{kind:"get",key:"cardCalendarId",value:function cardCalendarId(){return this._calendarCard.providerCard.boardId}},{kind:"get",key:"cardBoardName",value:function cardBoardName(){var e;return null===(e=this._trelloBoard)||void 0===e?void 0:e.name}},{kind:"get",key:"cardListName",value:function cardListName(){var e;return null===(e=this._trelloList)||void 0===e?void 0:e.name}},{kind:"get",key:"cardMembers",value:function cardMembers(){var e,t,r;this._cardMembers||(this._cardMembers=re()(e=w()(t=n()(r=De()(this._calendarCard.providerCard.memberIds)).call(r,(e=>this._trelloIntegrationSrv.getTrelloMemberById(this._calendarCard.accountId,e)))).call(t,(e=>e))).call(e,N.Yb));return this._cardMembers}},{kind:"get",key:"cardCustomFieldName",value:function cardCustomFieldName(){var e;if(this._calendarCard.cardType===se.eT.TrelloCustomField)return null===(e=this._trelloCustomField)||void 0===e?void 0:e.name}},{kind:"get",key:"cardParentTitle",value:function cardParentTitle(){var e;switch(this._calendarCard.cardType){case se.eT.TrelloCheckItem:case se.eT.TrelloTimeRecord:return null===(e=this._parentCard)||void 0===e?void 0:e.title}}},{kind:"get",key:"cardChecklistName",value:function cardChecklistName(){var e;if(this._calendarCard.cardType===se.eT.TrelloCheckItem)return null===(e=this._trelloChecklist)||void 0===e?void 0:e.name}},{kind:"get",key:"cardEstimation",value:function cardEstimation(){if(this._calendarCard.cardType===se.eT.TrelloCard){if(!this._calendarCard.providerCard.estimationHours)return;return`${kendo.toString(this._calendarCard.providerCard.estimationHours)}h`}}},{kind:"get",key:"cardTotalTimeRecordDuration",value:function cardTotalTimeRecordDuration(){if(this._calendarCard.cardType===se.eT.TrelloCard){if(!this._calendarCard.providerCard.totalTimeRecordDurationHours)return;return`${kendo.toString(this._calendarCard.providerCard.totalTimeRecordDurationHours)}h`}}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[O.lP.Trello],global:this._collectionSettings.global.settings.provider[O.lP.Trello]}}}]}}));var zt=r(27582),Ut=r(8244),Gt=r.n(Ut),Vt=r(89221),Kt=r.n(Vt);function MainToolbarFiltersMenuController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function MainToolbarFiltersMenuController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=MainToolbarFiltersMenuController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=MainToolbarFiltersMenuController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function MainToolbarFiltersMenuController_getDecoratorsApi(){MainToolbarFiltersMenuController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!MainToolbarFiltersMenuController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=MainToolbarFiltersMenuController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:MainToolbarFiltersMenuController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=MainToolbarFiltersMenuController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function MainToolbarFiltersMenuController_createElementDescriptor(e){var t,r=MainToolbarFiltersMenuController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function MainToolbarFiltersMenuController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function MainToolbarFiltersMenuController_hasDecorators(e){return e.decorators&&e.decorators.length}function MainToolbarFiltersMenuController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function MainToolbarFiltersMenuController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function MainToolbarFiltersMenuController_toPropertyKey(e){var t=function MainToolbarFiltersMenuController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Ht=function MainToolbarFiltersMenuController_decorate(e,t,r,i){var a,s=MainToolbarFiltersMenuController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function MainToolbarFiltersMenuController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(MainToolbarFiltersMenuController_isDataDescriptor(a.descriptor)||MainToolbarFiltersMenuController_isDataDescriptor(i.descriptor)){if(MainToolbarFiltersMenuController_hasDecorators(a)||MainToolbarFiltersMenuController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(MainToolbarFiltersMenuController_hasDecorators(a)){if(MainToolbarFiltersMenuController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}MainToolbarFiltersMenuController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,MainToolbarFiltersMenuController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$rootScope","$log","$scope","$translate","appCommonSrv","dialogSrv","licenseSrv","notificationSrv","planywayIntegrationSrv","settingsSrv","telemetrySrv","trelloIntegrationSrv"])],(function(e){return{F:class MainToolbarFiltersMenuController{constructor(t,r,i,a,s,n,o,l,d,c,h,u){e(this),this._$rootScope=t,this._$log=r,this._$scope=i,this._$translate=a,this._appCommonSrv=s,this._dialogSrv=n,this._licenseSrv=o,this._notificationSrv=l,this._planywayIntegrationSrv=d,this._settingsSrv=c,this._telemetrySrv=h,this._trelloIntegrationSrv=u;for(let e of[O.FK.CollectionAccountReady,O.FK.CollectionChanged,O.FK.TrelloBoardSelectionChanged,O.FK.SettingsChanged])this._$scope.$on(e,(()=>this._isFiltersLoaded=!1));const onTrelloBoardChanged=()=>this._$scope.$evalAsync((()=>this._isFiltersLoaded=!1));this._trelloIntegrationSrv.addTrelloBoardEventListener("added",onTrelloBoardChanged),this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",onTrelloBoardChanged),this._trelloIntegrationSrv.addTrelloBoardEventListener("deleted",onTrelloBoardChanged),this._$scope.$on("$destroy",(()=>{this._trelloIntegrationSrv.removeTrelloBoardEventListener("added",onTrelloBoardChanged),this._trelloIntegrationSrv.removeTrelloBoardEventListener("updated",onTrelloBoardChanged),this._trelloIntegrationSrv.removeTrelloBoardEventListener("deleted",onTrelloBoardChanged)})),this._$scope.$on(O.FK.FilterByCurrentMemberRequested,(()=>{this._$scope.$evalAsync((()=>this.toggleFilterByCurrentMember()))})),this.$onInit=()=>{this._registerFilterProvider({providerType:O.lP.Trello,filterProvider:{getActiveFiltersCount:()=>this.isFiltersLoaded?this.activeFiltersCount:0,clearAllFilters:()=>this.clearAllFilters()}})}}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloMainToolbarFiltersMenuCtrl"}},{kind:"field",key:"filtersMenuOpened",value:void 0},{kind:"field",key:"filtersSearchString",value:void 0},{kind:"field",key:"_registerFilterProvider",value:void 0},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"get",key:"isFiltersLoaded",value:function isFiltersLoaded(){if(!this._isFiltersLoaded){var e;let t=K()(e=this._provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{let t=this._provider.getCurrentCollectionSelectedCalendarIds(e);return n()(t).call(t,(t=>this._trelloIntegrationSrv.getTrelloBoardById(e,t)))}));if(0===t.length)return!1;if(Gt()(t).call(t,(e=>!e.isDataLoaded)))return!1;this._loadFilters(t),this._isFiltersLoaded=!0}return!0}},{kind:"get",key:"isFiltersActive",value:function isFiltersActive(){return this.activeFiltersCount>0}},{kind:"get",key:"activeFiltersCount",value:function activeFiltersCount(){return this.memberFiltersActiveCount+this.labelFiltersActiveCount+this.listFiltersActiveCount+this.customFieldAsCardsFiltersActiveCount+this.customFiltersActiveCount}},{kind:"get",key:"isAddCustomFiltersAvailable",value:function isAddCustomFiltersAvailable(){var e;return ee()(e=this._customFields).call(e,(e=>{switch(e.type){case se.vK.Checkbox:return!0;case se.vK.List:return e.options.length>0;default:return!1}}))}},{kind:"method",key:"addCustomFilter",value:function addCustomFilter(){this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.AddCustomFilterClicked),this._dialogSrv.showCustomFiltersDialogAsync()}},{kind:"method",key:"isFilteredByCurrentMember",value:function isFilteredByCurrentMember(e){return 1===this.activeFiltersCount&&this._filteredMemberIds.has(this._getAccountMemberId(e))}},{kind:"method",key:"toggleFilterByCurrentMember",value:function toggleFilterByCurrentMember(){var e,t;Gt()(e=this._provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>this.isFilteredByCurrentMember(e)))?this._filteredMemberIds=new(Te()):(this._filteredMemberIds=new(Te())(n()(t=this._provider.getCurrentCollectionConnectedAccountIds()).call(t,(e=>this._getAccountMemberId(e)))),this._filteredLabelHashes=new(Te()),this._filteredListIds=new(Te()),this._filteredCustomFieldHashes=new(Te()),this._filteredCustomFilterIds=new(Te()));this._saveFilters(),this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.FilterByCurrentMemberToggled)}},{kind:"method",key:"clearAllFilters",value:function clearAllFilters(){if(!this.isFiltersActive)return;this._filteredMemberIds=new(Te()),this._filteredLabelHashes=new(Te()),this._filteredListIds=new(Te()),this._filteredCustomFieldHashes=new(Te()),this._filteredCustomFilterIds=new(Te());let e=this._trelloCollectionSettings.global.filters;e.members=De()(this._filteredMemberIds),e.labels=De()(this._filteredLabelHashes),e.lists=De()(this._filteredListIds),e.customFields=De()(this._filteredCustomFieldHashes),e.customFilters=De()(this._filteredCustomFilterIds)}},{kind:"method",key:"isGroupCollapsed",value:function isGroupCollapsed(e){var t;return Z()(t=this._trelloCollectionSettings.local.filters.collapsed).call(t,e)}},{kind:"method",key:"toggleGroupCollapsed",value:function toggleGroupCollapsed(e){let t=this._trelloCollectionSettings.local.filters.collapsed,r=u()(t).call(t,e);-1===r?t.push(e):m()(t).call(t,r,1),this._collectionSettings.local.save()}},{kind:"get",key:"memberFiltersActiveCount",value:function memberFiltersActiveCount(){return this._filteredMemberIds.size}},{kind:"get",key:"members",value:function members(){return this._members}},{kind:"method",key:"isMemberSelected",value:function isMemberSelected(e){return this._filteredMemberIds.has(e.id)}},{kind:"method",key:"toggleMember",value:function toggleMember(e){this._filteredMemberIds.has(e.id)?this._filteredMemberIds.delete(e.id):this._filteredMemberIds.add(e.id),this._saveFilters(),this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.MembersChanged)}},{kind:"get",key:"labelFiltersActiveCount",value:function labelFiltersActiveCount(){return this._filteredLabelHashes.size}},{kind:"get",key:"labels",value:function labels(){return this._labels}},{kind:"method",key:"isLabelSelected",value:function isLabelSelected(e){return this._filteredLabelHashes.has(e.hash)}},{kind:"method",key:"toggleLabel",value:function toggleLabel(e){this._filteredLabelHashes.has(e.hash)?this._filteredLabelHashes.delete(e.hash):this._filteredLabelHashes.add(e.hash),this._saveFilters(),this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.LabelsChanged)}},{kind:"get",key:"listFiltersActiveCount",value:function listFiltersActiveCount(){return this._filteredListIds.size}},{kind:"get",key:"lists",value:function lists(){return this._lists}},{kind:"method",key:"isListSelected",value:function isListSelected(e){return this._filteredListIds.has(e.id)}},{kind:"method",key:"toggleList",value:function toggleList(e){this._filteredListIds.has(e.id)?this._filteredListIds.delete(e.id):this._filteredListIds.add(e.id),this._saveFilters(),this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.ListsChanged)}},{kind:"get",key:"customFieldAsCardsFiltersActiveCount",value:function customFieldAsCardsFiltersActiveCount(){return this._filteredCustomFieldHashes.size}},{kind:"get",key:"customFieldsAsCards",value:function customFieldsAsCards(){var e;return w()(e=this._customFields).call(e,(e=>e.type===se.vK.Date))}},{kind:"method",key:"isCustomFieldAsCardsSelected",value:function isCustomFieldAsCardsSelected(e){return this._filteredCustomFieldHashes.has(e.hash)}},{kind:"method",key:"toggleCustomFieldAsCards",value:function toggleCustomFieldAsCards(e){this._filteredCustomFieldHashes.has(e.hash)?this._filteredCustomFieldHashes.delete(e.hash):this._filteredCustomFieldHashes.add(e.hash),this._saveFilters(),this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.CustomFieldsChanged)}},{kind:"get",key:"customFiltersActiveCount",value:function customFiltersActiveCount(){return this._filteredCustomFilterIds.size}},{kind:"get",key:"customFilters",value:function customFilters(){return this._customFilters}},{kind:"method",key:"isCustomFilterSelected",value:function isCustomFilterSelected(e){return this._filteredCustomFilterIds.has(e.id)}},{kind:"method",key:"toggleCustomFilter",value:function toggleCustomFilter(e){this._filteredCustomFilterIds.has(e.id)?this._filteredCustomFilterIds.delete(e.id):this._filteredCustomFilterIds.add(e.id),this._saveFilters(),this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.CustomFiltersChanged)}},{kind:"method",key:"removeCustomFilterAsync",value:async function removeCustomFilterAsync(e){try{var t;if(!await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.CUSTOM_FILTERS_REMOVE_TITLE"),this._$translate.instant("DIALOGS.CUSTOM_FILTERS_REMOVE_TEXT",{filterName:e.name}),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))return;this._appCommonSrv.setSchedulerBusy(!0),this._filteredCustomFilterIds.delete(e.id),this._saveFilters();let r=this._trelloIntegrationSrv.getTrelloBoardById(e.accountId,e.boardId),i=w()(t=r.customFilters).call(t,(t=>t.id!==e.id));r.customFilters=i,await this._trelloIntegrationSrv.saveBoardSettingsAsync(e.accountId,r.id,{customFilters:i}),this._$rootScope.$broadcast(O.FK.SettingsChanged);let a={customFilterType:e.targetType};switch(e.targetType){case O.go.CustomField:let t=this._trelloIntegrationSrv.getTrelloCustomFieldById(e.accountId,e.targetId);if(!t)break;a.customFieldType=t.type}this._telemetrySrv.logSessionEvent(O.cN.FiltersEvents.CustomFilterRemoved,a)}catch(e){this._$log.error("Planyway failed to remove custom filter:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.REMOVE_CUSTOM_FILTER_ERROR"),O.k$.Error)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[O.lP.Trello],global:this._collectionSettings.global.settings.provider[O.lP.Trello]}}},{kind:"method",key:"_getAccountMemberId",value:function _getAccountMemberId(e){return this._planywayIntegrationSrv.getConnectedAccountById(e).trelloMemberId}},{kind:"method",key:"_loadFilters",value:function _loadFilters(e){var t,r,i,a,s,o,l;let d=new(ke()),c=new(ke()),h=new(ke()),u=new(ke()),p=new(ke());for(let r of e){for(let e of r.members)d.set(e.id,MainToolbarFiltersMenuController_objectSpread(MainToolbarFiltersMenuController_objectSpread({},e),{},{isCurrentMember:e.id===this._getAccountMemberId(r.accountId)}));for(let e of r.labels){let t=(0,N.uz)(e);c.set(t,MainToolbarFiltersMenuController_objectSpread(MainToolbarFiltersMenuController_objectSpread({},e),{},{hash:t}))}for(let e of r.lists)h.set(e.id,{id:e.id,name:e.name,accountId:r.accountId,boardId:r.id,boardName:r.name});let e=this._trelloCollectionSettings.global.customFieldsAsCards;for(let t of r.customFields){if(t.type===se.vK.Date&&!Z()(e).call(e,t.id))continue;let i=(0,N.SY)(t);u.set(i,{hash:i,name:t.name,type:t.type,options:t.options,accountId:r.accountId,boardId:r.id})}for(let e of r.customFilters){let i;if(e.targetType===O.go.CustomField){let a=this._trelloIntegrationSrv.getTrelloCustomFieldById(r.accountId,e.targetId);if(!a)continue;switch(a.type){case se.vK.List:let r=_()(t=a.options).call(t,(t=>t.id===e.value));if(!r)continue;i=e.name||this._$translate.instant("DIALOGS.CUSTOM_FILTERS_FILTER_NAME",{filterName:a.name,filterValue:r.name});break;case se.vK.Checkbox:i=e.name||this._$translate.instant("DIALOGS.CUSTOM_FILTERS_FILTER_NAME",{filterName:a.name,filterValue:e.value?this._$translate.instant("DIALOGS.CUSTOM_FILTERS_CHECKED"):this._$translate.instant("DIALOGS.CUSTOM_FILTERS_NOT_CHECKED")})}}p.set(e.id,MainToolbarFiltersMenuController_objectSpread(MainToolbarFiltersMenuController_objectSpread({},e),{},{name:i,accountId:r.accountId,boardId:r.id}))}}this._members=re()(r=De()(Kt()(d).call(d))).call(r,N.Yb),this._members.unshift({id:$.$d,fullName:this._$translate.instant("MISC.UNASSIGNED_MEMBER_FULL_NAME"),initials:this._$translate.instant("MISC.UNASSIGNED_MEMBER_INITIALS")}),this._labels=n()(i=re()(a=De()(Kt()(c).call(c))).call(a,N.G4)).call(i,(e=>({hash:e.hash,color:e.color,name:e.name||this._$translate.instant(e.color?O.y_[e.color]:"MISC.LABEL_COLOR_NO_COLOR")}))),this._labels.unshift({hash:$.$d,name:this._$translate.instant("MISC.NO_LABEL"),color:"no-labels"}),this._lists=n()(s=re()(o=De()(Kt()(h).call(h))).call(o,N.H9)).call(s,(e=>({id:e.id,name:e.name,accountId:e.accountId,boardId:e.boardId}))),this._customFields=re()(l=De()(Kt()(u).call(u))).call(l,N.y9),this._customFilters=De()(Kt()(p).call(p));let m=this._trelloCollectionSettings.global.filters;this._filteredMemberIds=new(Te())(m.members),this._filteredLabelHashes=new(Te())(m.labels),this._filteredListIds=new(Te())(m.lists),this._filteredCustomFieldHashes=new(Te())(m.customFields),this._filteredCustomFilterIds=new(Te())(m.customFilters);for(let e of this._filteredMemberIds)e===$.$d||d.has(e)||this._filteredMemberIds.delete(e);for(let e of this._filteredLabelHashes)e===$.$d||c.has(e)||this._filteredLabelHashes.delete(e);for(let e of this._filteredListIds)h.has(e)||this._filteredListIds.delete(e);for(let e of this._filteredCustomFieldHashes)u.has(e)||this._filteredCustomFieldHashes.delete(e);this._filteredCustomFilterIds=new(Te())(m.customFilters);for(let e of this._filteredCustomFilterIds)p.has(e)||this._filteredCustomFilterIds.delete(e)}},{kind:"method",key:"_saveFilters",value:function _saveFilters(){let e=this._trelloCollectionSettings.global.filters;e.members=De()(this._filteredMemberIds),e.labels=De()(this._filteredLabelHashes),e.lists=De()(this._filteredListIds),e.customFields=De()(this._filteredCustomFieldHashes),e.customFilters=De()(this._filteredCustomFilterIds),this._collectionSettings.global.saveAsync(),this._$rootScope.$broadcast(O.FK.FiltersChanged)}}]}}));function MainToolbarRightController_getDecoratorsApi(){MainToolbarRightController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!MainToolbarRightController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=MainToolbarRightController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:MainToolbarRightController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=MainToolbarRightController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function MainToolbarRightController_createElementDescriptor(e){var t,r=MainToolbarRightController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function MainToolbarRightController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function MainToolbarRightController_hasDecorators(e){return e.decorators&&e.decorators.length}function MainToolbarRightController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function MainToolbarRightController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function MainToolbarRightController_toPropertyKey(e){var t=function MainToolbarRightController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Zt=function MainToolbarRightController_decorate(e,t,r,i){var a,s=MainToolbarRightController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function MainToolbarRightController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(MainToolbarRightController_isDataDescriptor(a.descriptor)||MainToolbarRightController_isDataDescriptor(i.descriptor)){if(MainToolbarRightController_hasDecorators(a)||MainToolbarRightController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(MainToolbarRightController_hasDecorators(a)){if(MainToolbarRightController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}MainToolbarRightController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,MainToolbarRightController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["dialogSrv","licenseSrv","planywayNotificationsSrv","telemetrySrv"])],(function(e){return{F:class MainToolbarRightController{constructor(t,r,i,a){e(this),this._dialogSrv=t,this._licenseSrv=r,this._planywayNotificationsSrv=i,this._telemetrySrv=a}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloMainToolbarRightCtrl"}},{kind:"get",key:"hasUnreadNotifications",value:function hasUnreadNotifications(){return this._planywayNotificationsSrv.unreadNotificationsCount>0}},{kind:"method",key:"showNotificationCenter",value:function showNotificationCenter(){this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Notifications,!0)&&(this._telemetrySrv.logSingleEvent(O.cN.NotificationEvents.CenterOpened,{by:O.Yd.ToolbarButton}),this._dialogSrv.showNotificationCenterDialogAsync("content"))}}]}}));function MembersPanelController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function MembersPanelController_getDecoratorsApi(){MembersPanelController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!MembersPanelController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=MembersPanelController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:MembersPanelController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=MembersPanelController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function MembersPanelController_createElementDescriptor(e){var t,r=MembersPanelController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function MembersPanelController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function MembersPanelController_hasDecorators(e){return e.decorators&&e.decorators.length}function MembersPanelController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function MembersPanelController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function MembersPanelController_toPropertyKey(e){var t=function MembersPanelController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Wt=function MembersPanelController_decorate(e,t,r,i){var a,s=MembersPanelController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function MembersPanelController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(MembersPanelController_isDataDescriptor(a.descriptor)||MembersPanelController_isDataDescriptor(i.descriptor)){if(MembersPanelController_hasDecorators(a)||MembersPanelController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(MembersPanelController_hasDecorators(a)){if(MembersPanelController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}MembersPanelController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,MembersPanelController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$scope","dialogSrv","planywayIntegrationSrv","telemetrySrv","trelloIntegrationSrv"])],(function(e){return{F:class MembersPanelController{constructor(t,r,i,a,s){e(this),this._$scope=t,this._dialogSrv=r,this._planywayIntegrationSrv=i,this._telemetrySrv=a,this._trelloIntegrationSrv=s}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloMembersPanelCtrl"}},{kind:"get",key:"board",value:function board(){return this._board}},{kind:"set",key:"board",value:function board(e){this._$scope.$evalAsync((()=>{this._board=e,this._members=null}))}},{kind:"get",key:"members",value:function members(){var e,t;this._members||(this._members=this.board?re()(e=n()(t=this.board.members).call(t,(e=>function MembersPanelController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=MembersPanelController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=MembersPanelController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}({},e)))).call(e,((e,t)=>this._sortMembers(e,t))):[],this._$scope.$broadcast("$$rebind::member"));return this._members}},{kind:"method",key:"getMembershipType",value:function getMembershipType(e){var t;return null===(t=this.board.memberships.get(e))||void 0===t?void 0:t.memberType}},{kind:"get",key:"canInviteMembers",value:function canInviteMembers(){return this.board.canShare}},{kind:"method",key:"showShareBoardDialogAsync",value:function showShareBoardDialogAsync(){let e=this._trelloIntegrationSrv.getTrelloBoardById(this.board.accountId,this.board.id);this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.MembersDialogOpened,{where:O.JM.TaskLists}),this._dialogSrv.showBoardShareDialogAsync({accountId:this.board.accountId,trelloBoard:e,where:O.JM.TaskLists})}},{kind:"get",key:"_currentMemberId",value:function _currentMemberId(){return this._planywayIntegrationSrv.getConnectedAccountById(this.board.accountId).trelloMemberId}},{kind:"method",key:"_sortMembers",value:function _sortMembers(e,t){return e.id===this._currentMemberId?-1:t.id===this._currentMemberId?1:this.getMembershipType(e.id)===O.IM.Admin&&this.getMembershipType(t.id)!==O.IM.Admin?-1:this.getMembershipType(t.id)===O.IM.Admin&&this.getMembershipType(e.id)!==O.IM.Admin?1:this.getMembershipType(e.id)===O.IM.Normal&&this.getMembershipType(t.id)!==O.IM.Normal?-1:this.getMembershipType(t.id)===O.IM.Normal&&this.getMembershipType(e.id)!==O.IM.Normal?1:(0,N.Yb)(e,t)}},{kind:"get",key:"_isBoardMemberAdmin",value:function _isBoardMemberAdmin(){return this.board&&this.getMembershipType(this._currentMemberId)===O.IM.Admin}}]}}));function SchedulerToolbarViewSettingsMenuController_getDecoratorsApi(){SchedulerToolbarViewSettingsMenuController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!SchedulerToolbarViewSettingsMenuController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=SchedulerToolbarViewSettingsMenuController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:SchedulerToolbarViewSettingsMenuController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=SchedulerToolbarViewSettingsMenuController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function SchedulerToolbarViewSettingsMenuController_createElementDescriptor(e){var t,r=SchedulerToolbarViewSettingsMenuController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function SchedulerToolbarViewSettingsMenuController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function SchedulerToolbarViewSettingsMenuController_hasDecorators(e){return e.decorators&&e.decorators.length}function SchedulerToolbarViewSettingsMenuController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function SchedulerToolbarViewSettingsMenuController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function SchedulerToolbarViewSettingsMenuController_toPropertyKey(e){var t=function SchedulerToolbarViewSettingsMenuController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Yt=function SchedulerToolbarViewSettingsMenuController_decorate(e,t,r,i){var a,s=SchedulerToolbarViewSettingsMenuController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function SchedulerToolbarViewSettingsMenuController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(SchedulerToolbarViewSettingsMenuController_isDataDescriptor(a.descriptor)||SchedulerToolbarViewSettingsMenuController_isDataDescriptor(i.descriptor)){if(SchedulerToolbarViewSettingsMenuController_hasDecorators(a)||SchedulerToolbarViewSettingsMenuController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(SchedulerToolbarViewSettingsMenuController_hasDecorators(a)){if(SchedulerToolbarViewSettingsMenuController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}SchedulerToolbarViewSettingsMenuController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,SchedulerToolbarViewSettingsMenuController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$rootScope","$translate","appCommonSrv","calendarCardsSrv","settingsSrv","telemetrySrv"])],(function(e){return{F:class SchedulerToolbarViewSettingsMenuController{constructor(t,r,i,a,s,n){e(this),this._$rootScope=t,this._$translate=r,this._appCommonSrv=i,this._calendarCardsSrv=a,this._settingsSrv=s,this._telemetrySrv=n}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloSchedulerToolbarViewSettingsMenuCtrl"}},{kind:"get",key:"isArchivedCardsShown",value:function isArchivedCardsShown(){return this._collectionSettings.global.settings.isArchivedCardsShown}},{kind:"set",key:"isArchivedCardsShown",value:function isArchivedCardsShown(e){this._collectionSettings.global.settings.isArchivedCardsShown=e,this._collectionSettings.global.saveAsync(),e&&(this._calendarCardsSrv.needReloadCalendarCards(),this._$rootScope.$broadcast(O.FK.CardsReloaded)),this._$rootScope.$broadcast(O.FK.FiltersChanged),this._telemetrySrv.logSessionEvent(O.cN.SettingsEvents.ShowArchivedCardsChanged)}},{kind:"get",key:"isCheckItemCardsShown",value:function isCheckItemCardsShown(){return this._collectionSettings.global.settings.isCheckItemCardsShown}},{kind:"set",key:"isCheckItemCardsShown",value:function isCheckItemCardsShown(e){this._collectionSettings.global.settings.isCheckItemCardsShown=e,this._$rootScope.$broadcast(O.FK.FiltersChanged),this._collectionSettings.global.saveAsync(),this._telemetrySrv.logSessionEvent(O.cN.SettingsEvents.ShowCheckItemCardsChanged)}},{kind:"get",key:"isTimeRecordCardsShown",value:function isTimeRecordCardsShown(){return this._collectionSettings.global.settings.isTimeRecordCardsShown}},{kind:"set",key:"isTimeRecordCardsShown",value:function isTimeRecordCardsShown(e){this._collectionSettings.global.settings.isTimeRecordCardsShown=e,this._$rootScope.$broadcast(O.FK.FiltersChanged),this._collectionSettings.global.saveAsync(),this._telemetrySrv.logSessionEvent(O.cN.SettingsEvents.ShowTimeRecordCardsChanged)}},{kind:"get",key:"isMilestonesShown",value:function isMilestonesShown(){return this._collectionSettings.global.settings.isMilestonesShown}},{kind:"set",key:"isMilestonesShown",value:function isMilestonesShown(e){this._collectionSettings.global.settings.isMilestonesShown=e,this._appCommonSrv.getSchedulerMode()===O.ud.Timeline&&this._$rootScope.$broadcast(O.FK.TimelineResourcesReloaded,{resourcesType:this._appCommonSrv.getTimelineResourcesType()}),this._$rootScope.$broadcast(O.FK.FiltersChanged),this._collectionSettings.global.saveAsync(),this._telemetrySrv.logSessionEvent(O.cN.SettingsEvents.ShowMilestonesChanged)}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}}]}}));var qt=r(59863),Xt=r.n(qt);function SidebarPanelController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function SidebarPanelController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=SidebarPanelController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=SidebarPanelController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function SidebarPanelController_getDecoratorsApi(){SidebarPanelController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!SidebarPanelController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=SidebarPanelController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:SidebarPanelController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=SidebarPanelController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function SidebarPanelController_createElementDescriptor(e){var t,r=SidebarPanelController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function SidebarPanelController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function SidebarPanelController_hasDecorators(e){return e.decorators&&e.decorators.length}function SidebarPanelController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function SidebarPanelController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function SidebarPanelController_toPropertyKey(e){var t=function SidebarPanelController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Qt=function SidebarPanelController_decorate(e,t,r,i){var a,s=SidebarPanelController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function SidebarPanelController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(SidebarPanelController_isDataDescriptor(a.descriptor)||SidebarPanelController_isDataDescriptor(i.descriptor)){if(SidebarPanelController_hasDecorators(a)||SidebarPanelController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(SidebarPanelController_hasDecorators(a)){if(SidebarPanelController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}SidebarPanelController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,SidebarPanelController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$rootScope","$scope","$log","$translate","appCommonSrv","dialogSrv","licenseSrv","notificationSrv","planywayIntegrationSrv","settingsSrv","telemetrySrv","trelloIntegrationSrv","collectionSrv"])],(function(e){return{F:class SidebarPanelController{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p){var m=this;e(this),this._$rootScope=t,this._$scope=r,this._$log=i,this._$translate=a,this._appCommonSrv=s,this._dialogSrv=n,this._licenseSrv=o,this._notificationSrv=l,this._planywayIntegrationSrv=d,this._settingsSrv=c,this._telemetrySrv=h,this._trelloIntegrationSrv=u,this._collectionSrv=p,this._onTrelloBoardChanged=()=>this._$scope.$evalAsync((()=>this._boards=null)),this._trelloIntegrationSrv.addTrelloBoardEventListener("added",this._onTrelloBoardChanged),this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",this._onTrelloBoardChanged),this._trelloIntegrationSrv.addTrelloBoardEventListener("deleted",this._onTrelloBoardChanged),this._trelloIntegrationSrv.addTrelloBoardEventListener("cleared",this._onTrelloBoardChanged);const onSourceChanged=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.accountType&&t.accountType!==se.Qm.Trello||m._$scope.$evalAsync((()=>{if(m._accounts=null,m._boards=null,m._notifyTrelloBoardsSelectionChanged(),e.name===O.FK.AccountAdded)m.addBoardToCollectionAsync(void 0,t)}))};this._$scope.$on(O.FK.AccountAdded,onSourceChanged),this._$scope.$on(O.FK.AccountDeleted,onSourceChanged),this._$scope.$on(O.FK.CalendarsChanged,onSourceChanged),this._$scope.$on(O.FK.CollectionChanged,onSourceChanged),this._$scope.$on(O.FK.FiltersChanged,(()=>{this._$scope.$evalAsync((()=>{var e;let t=K()(e=this._provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>this._provider.getCurrentCollectionConnectedCalendars(e)));for(let e of this.boards){var r;e.showOnlyMyCards=(null===(r=_()(t).call(t,(t=>t.calendarId===e.id)))||void 0===r?void 0:r.showOnlyMyCards)||!1}}))})),this._$scope.$on(O.FK.SingleCalendarSelectionRequested,((e,t)=>{let{accountType:r,accountId:i,calendarId:a}=t;if(r!==se.Qm.Trello)for(let e of this._provider.getCurrentCollectionConnectedAccountIds())this._changeBoardsSelection(e,!1);else{for(let e of this.boards)e.isSelected=e.accountId===i&&e.id===a;this._saveBoardsSelection(i)}})),this._$scope.$on("$destroy",(()=>{this._trelloIntegrationSrv.removeTrelloBoardEventListener("added",this._onTrelloBoardChanged),this._trelloIntegrationSrv.removeTrelloBoardEventListener("updated",this._onTrelloBoardChanged),this._trelloIntegrationSrv.removeTrelloBoardEventListener("deleted",this._onTrelloBoardChanged),this._trelloIntegrationSrv.removeTrelloBoardEventListener("cleared",this._onTrelloBoardChanged)}))}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloSidebarPanelCtrl"}},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"field",key:"_boardFilters",value:()=>new(ke())},{kind:"get",key:"isGoogleSyncAvailable",value:function isGoogleSyncAvailable(){return Xt()(this._settingsSrv).connect&&this.boards.length>0}},{kind:"get",key:"hasGoogleSyncErrors",value:function hasGoogleSyncErrors(){var e;return ee()(e=this.boards).call(e,(e=>this.canRestartGoogleSync(e)))}},{kind:"method",key:"showBoardsGoogleSyncDialog",value:function showBoardsGoogleSyncDialog(){this._telemetrySrv.logSessionEvent(O.cN.GoogleSyncEvents.SyncWithGoogleOpened,{where:O.MJ.Sidebar}),this._dialogSrv.showBoardsGoogleSyncDialogAsync()}},{kind:"get",key:"accounts",value:function accounts(){var e;this._accounts||(this._accounts=n()(e=this._provider.getCurrentCollectionConnectedAccounts()).call(e,(e=>{let t=SidebarPanelController_objectSpread({},e);return c()(t,"isInvalid",{get:()=>this._provider.invalidAccountIds.has(e.accountId)}),t})));return this._accounts}},{kind:"method",key:"reconnectAccountAsync",value:function reconnectAccountAsync(e){this._trelloIntegrationSrv.reconnectAccountAsync(e)}},{kind:"method",key:"disconnectAccountAsync",value:async function disconnectAccountAsync(e){if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.SIGN_OUT_OF_ACCOUNT_TITLE"),this._$translate.instant("DIALOGS.SIGN_OUT_OF_ACCOUNT_CONFIRM",{accountName:e.accountName}),{buttons:[{text:this._$translate.instant("BUTTONS.SIGN_OUT"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]})){if(!await this._planywayIntegrationSrv.disconnectAccountAsync(e))return;this._telemetrySrv.logSessionEvent(O.cN.GeneralEvents.AccountDisconnected,{accountType:se.Qm.Trello}),await this._provider.removeAccountFromAllCollectionsAsync(e)}}},{kind:"method",key:"isAccountCollapsed",value:function isAccountCollapsed(e){return this._provider.isAccountCollapsed(e.accountId)}},{kind:"method",key:"toggleAccountCollapsed",value:function toggleAccountCollapsed(e){this._provider.toggleAccountCollapsed(e.accountId)}},{kind:"get",key:"isIntegrationBusy",value:function isIntegrationBusy(){return this._trelloIntegrationSrv.isIntegrationBusy()}},{kind:"get",key:"canAddBoardToCollection",value:function canAddBoardToCollection(){return!this._collectionSrv.isCurrentCollectionReadOnly}},{kind:"method",key:"addBoardToCollectionAsync",value:async function addBoardToCollectionAsync(e,t){this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionAddCalendarDialogOpened,{accountType:se.Qm.Trello,where:O.Zz.Sidebar});let r=await this._dialogSrv.showManageAccountCalendarsDialogAsync(t,e);r?(this._$rootScope.$broadcast(O.FK.CalendarsChanging,t),r.connectedCalendarIds.length>0&&this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarAdded,{accountType:se.Qm.Trello,count:r.connectedCalendarIds.length}),r.disconnectedCalendarIds.length>0&&this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarRemoved,{accountType:se.Qm.Trello,count:r.disconnectedCalendarIds.length})):this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionAddCalendarDialogClosed,{accountType:se.Qm.Trello,where:O.Zz.Sidebar})}},{kind:"get",key:"canCreateBoard",value:function canCreateBoard(){return!0}},{kind:"method",key:"createBoardAsync",value:async function createBoardAsync(e,t){this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.CreateBoardDialogOpened,{where:O.bs.Sidebar}),await this._dialogSrv.showBoardDialogAsync(e,{account:t})||this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.CreateBoardDialogClosed,{where:O.bs.Sidebar})}},{kind:"method",key:"canSelectAllBoards",value:function canSelectAllBoards(e){var t;return ee()(t=this.boards).call(t,(t=>t.accountId===e.accountId&&!t.isSelected))}},{kind:"method",key:"selectAllBoards",value:function selectAllBoards(e){var t;if(!this.canSelectAllBoards(e))return;if(!e.isPrimary&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TrelloConnect,!0))return;let r=G()(t=this._provider.getCurrentCollectionConnectedAccountIds()).call(t,((t,r)=>(r===e.accountId?t+=this._provider.getCurrentCollectionConnectedCalendarIds(r).length:t+=this._provider.getCurrentCollectionSelectedCalendarIds(r).length,t)),0);this._licenseSrv.checkPaidFeatureAvailable(O.ZV.MultiBoard,!0,{paidCalendarsCount:r})&&(this._changeBoardsSelection(e.accountId,!0),this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarSelectedAll,{accountType:se.Qm.Trello,count:this.boards.length}))}},{kind:"method",key:"canSelectNoneBoards",value:function canSelectNoneBoards(e){var t;return ee()(t=this.boards).call(t,(t=>t.accountId===e.accountId&&t.isSelected))}},{kind:"method",key:"selectNoneBoards",value:function selectNoneBoards(e){this.canSelectNoneBoards(e)&&(this._changeBoardsSelection(e.accountId,!1),this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarSelectedNone,{accountType:se.Qm.Trello,count:0}))}},{kind:"get",key:"canRemoveAccountFromCollection",value:function canRemoveAccountFromCollection(){return!this._collectionSrv.isCurrentCollectionReadOnly}},{kind:"method",key:"removeAccountFromCollection",value:function removeAccountFromCollection(e){this._provider.removeAccountFromCurrentCollectionAsync(e),this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionAccountRemoved,{accountType:e.accountType})}},{kind:"method",key:"isCreateBoardCalloutAvailable",value:function isCreateBoardCalloutAvailable(e){return 0===this._trelloIntegrationSrv.getTrelloBoards(e.accountId).length&&!this._appCommonSrv.isSchedulerBusy()}},{kind:"get",key:"boards",value:function boards(){var e;this._boards||(this._boards=K()(e=this._provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{var t;return n()(t=this._provider.getCurrentCollectionConnectedCalendars(e)).call(t,(t=>SidebarPanelController_objectSpread(SidebarPanelController_objectSpread({},this._trelloIntegrationSrv.getTrelloBoardById(e,t.calendarId)),t)))})));return this._boards}},{kind:"method",key:"isTrelloBoardBusy",value:function isTrelloBoardBusy(e){return e.isSelected&&this._trelloIntegrationSrv.isConnectedTrelloBoardBusy(e.accountId,e.id)}},{kind:"method",key:"setBoardSelection",value:function setBoardSelection(e,t){if(e.isSelected!==t){if(t){var r;if(!this._planywayIntegrationSrv.getConnectedAccountById(e.accountId).isPrimary&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.TrelloConnect,!0))return;let t=G()(r=this._provider.getCurrentCollectionConnectedAccountIds()).call(r,((e,t)=>e+this._provider.getCurrentCollectionSelectedCalendarIds(t).length),0)+1;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.MultiBoard,!0,{paidCalendarsCount:t}))return}e.isSelected=t,this._telemetrySrv.logSessionEvent(e.isSelected?O.cN.CollectionEvents.CollectionCalendarSelected:O.cN.CollectionEvents.CollectionCalendarDeselected,{accountType:se.Qm.Trello,count:1}),this._saveBoardsSelection(e.accountId)}}},{kind:"method",key:"showShareBoardDialogAsync",value:async function showShareBoardDialogAsync(e){if(!e.isDataLoaded)try{this._appCommonSrv.setSchedulerBusy(!0),await this._trelloIntegrationSrv.loadBoardDataAsync(e.accountId,e.id),e=this._trelloIntegrationSrv.getTrelloBoardById(e.accountId,e.id)}finally{this._appCommonSrv.setSchedulerBusy(!1)}this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.MembersDialogOpened,{where:O.JM.Sidebar}),this._dialogSrv.showBoardShareDialogAsync({accountId:e.accountId,trelloBoard:e,where:O.JM.Sidebar})}},{kind:"method",key:"canShowOnlyThisBoard",value:function canShowOnlyThisBoard(e){return this.canSelectAllBoards(e)||this.canSelectNoneBoards(e)}},{kind:"method",key:"showOnlyThisBoard",value:function showOnlyThisBoard(e,t){this.canShowOnlyThisBoard(e)&&(this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarSelectedOnlyThis,{accountType:se.Qm.Trello,count:1}),this._$rootScope.$broadcast(O.FK.SingleCalendarSelectionRequested,{accountType:se.Qm.Trello,accountId:e.accountId,calendarId:t.id}))}},{kind:"method",key:"canEditBoard",value:function canEditBoard(e,t){return!t.isReadOnly}},{kind:"method",key:"editBoardAsync",value:async function editBoardAsync(e,t,r){if(!r.isDataLoaded)try{this._appCommonSrv.setSchedulerBusy(!0),await this._trelloIntegrationSrv.loadBoardDataAsync(r.accountId,r.id),r=this._trelloIntegrationSrv.getTrelloBoardById(r.accountId,r.id)}finally{this._appCommonSrv.setSchedulerBusy(!1)}this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.EditBoardDialogOpened,{where:O.bs.Sidebar}),await this._dialogSrv.showBoardDialogAsync(e,{account:t,board:r})||this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.EditBoardDialogClosed,{where:O.bs.Sidebar})}},{kind:"method",key:"isGoogleSyncBusy",value:function isGoogleSyncBusy(e){return this._trelloIntegrationSrv.isGoogleSyncBusy(e.accountId,e.id)}},{kind:"method",key:"canStartGoogleSync",value:function canStartGoogleSync(e){if(!Xt()(this._settingsSrv).connect)return!1;if(e.isReadOnly)return!1;let t=this._trelloIntegrationSrv.getGoogleSyncStatus(e.accountId,e.id);return t&&t===se.wR.NotSynced}},{kind:"method",key:"startGoogleSyncAsync",value:async function startGoogleSyncAsync(e){this.canStartGoogleSync(e)&&!this.isGoogleSyncBusy(e)&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.GoogleSync,!0)&&(this._telemetrySrv.logSessionEvent(O.cN.GoogleSyncEvents.SyncWithGoogleEnableGoogleSyncClicked,{where:O.MJ.BoardMenu}),await this._dialogSrv.showGoogleSyncStartDialogAsync(e.accountId,e.id))}},{kind:"method",key:"canRestartGoogleSync",value:function canRestartGoogleSync(e){if(!Xt()(this._settingsSrv).connect)return!1;if(e.isReadOnly)return!1;let t=this._trelloIntegrationSrv.getGoogleSyncStatus(e.accountId,e.id);return t&&t!==se.wR.NotSynced&&t!==se.wR.Ok}},{kind:"method",key:"restartGoogleSyncAsync",value:async function restartGoogleSyncAsync(e){this.canRestartGoogleSync(e)&&!this.isGoogleSyncBusy(e)&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.GoogleSync,!0)&&(await this._trelloIntegrationSrv.stopGoogleSyncAsync(e.accountId,e.id),await this._dialogSrv.showGoogleSyncStartDialogAsync(e.accountId,e.id))}},{kind:"method",key:"canStopGoogleSync",value:function canStopGoogleSync(e){if(!Xt()(this._settingsSrv).connect)return!1;let t=this._trelloIntegrationSrv.getGoogleSyncStatus(e.accountId,e.id);return t&&t!==se.wR.NotSynced}},{kind:"method",key:"stopGoogleSyncAsync",value:async function stopGoogleSyncAsync(e){if(!this.canStopGoogleSync(e)||this.isGoogleSyncBusy(e))return;await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.GOOGLE_SYNC_STOP_TITLE"),this._$translate.instant("DIALOGS.GOOGLE_SYNC_STOP_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.YES"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]})&&await this._trelloIntegrationSrv.stopGoogleSyncAsync(e.accountId,e.id)}},{kind:"get",key:"canExportByUrl",value:function canExportByUrl(){return Xt()(this._settingsSrv).connect}},{kind:"method",key:"exportByUrlAsync",value:function exportByUrlAsync(e){this._dialogSrv.showExportDialogAsync(e)}},{kind:"get",key:"canRemoveBoardFromCollection",value:function canRemoveBoardFromCollection(){return!this._collectionSrv.isCurrentCollectionReadOnly}},{kind:"method",key:"removeBoardFromCollection",value:function removeBoardFromCollection(e,t){let r=this._provider.getCurrentCollectionConnectedCalendar(e.accountId,t.id);r.isConnected=!1,this._provider.setCurrentCollectionConnectedCalendars(e.accountId,[r]),this._$rootScope.$broadcast(O.FK.CalendarsChanging,e),this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarRemoved,{accountType:se.Qm.Trello,count:1})}},{kind:"method",key:"canRemoveBoard",value:function canRemoveBoard(e,t){var r;if(t.isReadOnly)return!1;let{trelloMemberId:i}=this._planywayIntegrationSrv.getConnectedAccountById(t.accountId);return(null===(r=t.memberships.get(i))||void 0===r?void 0:r.memberType)===O.IM.Admin}},{kind:"method",key:"removeBoardAsync",value:async function removeBoardAsync(e,t){if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.REMOVE_TRELLO_BOARD_TITLE"),this._$translate.instant("DIALOGS.REMOVE_TRELLO_BOARD_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.YES"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._appCommonSrv.setSchedulerBusy(!0),await this._trelloIntegrationSrv.closeTrelloBoardAsync(e.accountId,t.id),this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.BoardRemoved,{where:O.bs.Sidebar}),this._boards=null,this._notifyTrelloBoardsSelectionChanged()}catch(e){this._$log.error("Trello remove board error:"),this._$log.error(e),this._telemetrySrv.logError("Trello remove board error",e,{class:this.constructor.name,method:this.removeBoardAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.REMOVE_BOARD_ERROR"),O.k$.Error)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"get",key:"availableBoardsFilters",value:function availableBoardsFilters(){return this._availableBoardsFilters||(this._availableBoardsFilters=[{type:O.pk.OnlyMyCards,title:this._$translate.instant("MENU.SHOW_ONLY_MY_CARDS")}]),this._availableBoardsFilters}},{kind:"method",key:"boardFilters",value:function boardFilters(e){var t;this._boardFilters.has(e.id)||this._boardFilters.set(e.id,n()(t=this.availableBoardsFilters).call(t,(t=>{const r=SidebarPanelController_objectSpread({},t);let i=this._provider.getCurrentCollectionConnectedCalendar(e.accountId,e.id);return c()(r,"isActive",{get:()=>{if(r.type===O.pk.OnlyMyCards)return i.showOnlyMyCards},set:t=>{if(i.showOnlyMyCards!==t){if(r.type===O.pk.OnlyMyCards)this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarFilterChanged,{onlyMyCards:t}),i.showOnlyMyCards=t,this._provider.setCurrentCollectionConnectedCalendars(e.accountId,[i]);this._$rootScope.$broadcast(O.FK.FiltersChanged)}}}),r})));return this._boardFilters.get(e.id)}},{kind:"method",key:"hasActiveBoardFilters",value:function hasActiveBoardFilters(e){var t;return ee()(t=this.boardFilters(e)).call(t,(e=>e.isActive))}},{kind:"method",key:"_changeBoardsSelection",value:function _changeBoardsSelection(e,t){for(let i of w()(r=this.boards).call(r,(t=>t.accountId===e))){var r;i.isReadOnly&&i.isPublic||(i.isSelected=t)}this._saveBoardsSelection(e)}},{kind:"method",key:"_saveBoardsSelection",value:function _saveBoardsSelection(e){var t,r;let i=n()(t=w()(r=this.boards).call(r,(t=>t.accountId===e))).call(t,(e=>SidebarPanelController_objectSpread(SidebarPanelController_objectSpread({},this._provider.getCurrentCollectionConnectedCalendar(e.accountId,e.calendarId)),{},{isSelected:e.isSelected})));this._provider.setCurrentCollectionConnectedCalendars(e,i),this._notifyTrelloBoardsSelectionChanged()}},{kind:"method",key:"_notifyTrelloBoardsSelectionChanged",value:function _notifyTrelloBoardsSelectionChanged(){this._$rootScope.$broadcast(O.FK.CardsReloaded),this._$rootScope.$broadcast(O.FK.TrelloBoardSelectionChanged),this._$rootScope.$broadcast(O.FK.ChangeSchedulerViewRequested),this._$rootScope.$broadcast(O.FK.WorkPanelReloaded);for(let e of[O.y.Calendars,O.y.Labels,O.y.Lists,O.y.Members])this._$rootScope.$broadcast(O.FK.TimelineResourcesReloaded,{resourcesType:e})}}]}}));function TaskListCardController_getDecoratorsApi(){TaskListCardController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!TaskListCardController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=TaskListCardController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:TaskListCardController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=TaskListCardController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function TaskListCardController_createElementDescriptor(e){var t,r=TaskListCardController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function TaskListCardController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function TaskListCardController_hasDecorators(e){return e.decorators&&e.decorators.length}function TaskListCardController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function TaskListCardController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function TaskListCardController_toPropertyKey(e){var t=function TaskListCardController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Jt=function TaskListCardController_decorate(e,t,r,i){var a,s=TaskListCardController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function TaskListCardController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(TaskListCardController_isDataDescriptor(a.descriptor)||TaskListCardController_isDataDescriptor(i.descriptor)){if(TaskListCardController_hasDecorators(a)||TaskListCardController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(TaskListCardController_hasDecorators(a)){if(TaskListCardController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}TaskListCardController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,TaskListCardController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$element","$rootScope","$scope","$timeout","$translate","appCommonSrv","settingsSrv"])],(function(e){return{F:class TaskListCardController{constructor(t,r,i,a,s,n,o){e(this),this._$element=t,this._$scope=i,this._$rootScope=r,this._$timeout=a,this._$translate=s,this._appCommonSrv=n,this._settingsSrv=o,this._$rootScope.$on(O.FK.TaskListsAddCheckItemRequested,((e,t)=>{this.card.id===t.calendarCard.id&&(this.card.isCheckItemsExpanded||(this.card.isCheckItemsExpanded=!0),this.beginCheckItemCreating())}))}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloTaskListCardCtrl"}},{kind:"field",key:"_card",value:void 0},{kind:"field",key:"_isTaskListCardCreating",value:void 0},{kind:"field",key:"_tempCheckItem",value:void 0},{kind:"field",key:"_beginCheckItemCreating",value:void 0},{kind:"get",key:"card",value:function card(){return this._card}},{kind:"get",key:"cardTitle",value:function cardTitle(){return this.showCardNumber&&this.card.cardNumber?`#${this.card.cardNumber} ${this.card.title}`:this.card.title}},{kind:"get",key:"cardBoardMembers",value:function cardBoardMembers(){return this.card.cardBoardMembers}},{kind:"get",key:"isTaskListCardCreating",value:function isTaskListCardCreating(){return this._isTaskListCardCreating}},{kind:"get",key:"showCardNumber",value:function showCardNumber(){return this._collectionSettings.global.settings.showCardNumber}},{kind:"get",key:"showLabelNames",value:function showLabelNames(){return this._trelloCollectionSettings.local.taskLists.showLabelNames}},{kind:"set",key:"showLabelNames",value:function showLabelNames(e){this._trelloCollectionSettings.local.taskLists.showLabelNames=e,this._collectionSettings.local.save()}},{kind:"get",key:"showWeekNumbers",value:function showWeekNumbers(){return this._collectionSettings.global.settings.showWeekNumbers}},{kind:"get",key:"defaultCardIsAllDay",value:function defaultCardIsAllDay(){return this.card.cardBoard.defaultCardIsAllDay}},{kind:"get",key:"defaultCardDuration",value:function defaultCardDuration(){return this.card.cardBoard.defaultCardDuration}},{kind:"set",key:"onOpenCardContextMenu",value:function onOpenCardContextMenu(e){this._onOpenCardContextMenu=e}},{kind:"get",key:"sortableCheckItemOptions",value:function sortableCheckItemOptions(){return this._sortableCheckItemOptions||(this._sortableCheckItemOptions={filter:".pw-tasks-card__check-item",ignore:[".pw-tasks-card__check-item--temp-check-item","input"].join(", "),autoScroll:!0,disableSorting:!0,group:$.dl,placeholder:e=>{let t=e.clone();return t.addClass("pw-tasks-card__check-item--placeholder"),t.css({width:e.width()}),_()(t).call(t,"input").removeAttr("id"),t},hint:e=>{let t=e.clone();return t.addClass("pw-tasks-card__check-item--hint"),t.css({width:e.width()}),_()(t).call(t,"input").removeAttr("id"),t}}),this._sortableCheckItemOptions}},{kind:"get",key:"isCheckItemDragAvailable",value:function isCheckItemDragAvailable(){switch(this._appCommonSrv.getSchedulerMode()){case O.ud.Board:case O.ud.TimeTracking:return!1}return!this._isCheckItemDragging}},{kind:"method",key:"onCheckItemDragStart",value:function onCheckItemDragStart(e){!this.card.isReadonly&&this.isCheckItemDragAvailable?this._isCheckItemDragging=!0:e.preventDefault()}},{kind:"method",key:"onCheckItemDragEnd",value:function onCheckItemDragEnd(e){this._isCheckItemDragging=!1,this._$rootScope.$broadcast(O.FK.CheckListItemDragEnded),e.newIndex===e.oldIndex?e.sender.draggable.dropped=!0:e.preventDefault()}},{kind:"method",key:"onCheckItemDragCancel",value:function onCheckItemDragCancel(){this._isCheckItemDragging=!1,this._$rootScope.$broadcast(O.FK.CheckListItemDragEnded)}},{kind:"method",key:"openCardContextMenu",value:function openCardContextMenu(e){this._onOpenCardContextMenu({cardId:this.card.id,mouseEvent:e})}},{kind:"method",key:"toggleCheckItemsExpanded",value:function toggleCheckItemsExpanded(){this.card.isCheckItemsExpanded=!this.card.isCheckItemsExpanded,0===this.card.checkItems.length&&this.beginCheckItemCreating()}},{kind:"method",key:"onCheckItemNameMouseDown",value:function onCheckItemNameMouseDown(e){0!==e.button&&e.preventDefault()}},{kind:"get",key:"tempCheckItem",value:function tempCheckItem(){return this._tempCheckItem}},{kind:"method",key:"beginCheckItemCreating",value:function beginCheckItemCreating(){this._beginCheckItemCreating(this.card)}},{kind:"method",key:"isCheckItemCreating",value:function isCheckItemCreating(e){return!!this._tempCheckItem&&(!e||this._tempCheckItem.cardId===e)}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[O.lP.Trello],global:this._collectionSettings.global.settings.provider[O.lP.Trello]}}}]}}));function TaskListContextMenuController_getDecoratorsApi(){TaskListContextMenuController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!TaskListContextMenuController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=TaskListContextMenuController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:TaskListContextMenuController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=TaskListContextMenuController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function TaskListContextMenuController_createElementDescriptor(e){var t,r=TaskListContextMenuController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function TaskListContextMenuController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function TaskListContextMenuController_hasDecorators(e){return e.decorators&&e.decorators.length}function TaskListContextMenuController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function TaskListContextMenuController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function TaskListContextMenuController_toPropertyKey(e){var t=function TaskListContextMenuController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let er=function TaskListContextMenuController_decorate(e,t,r,i){var a,s=TaskListContextMenuController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function TaskListContextMenuController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(TaskListContextMenuController_isDataDescriptor(a.descriptor)||TaskListContextMenuController_isDataDescriptor(i.descriptor)){if(TaskListContextMenuController_hasDecorators(a)||TaskListContextMenuController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(TaskListContextMenuController_hasDecorators(a)){if(TaskListContextMenuController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}TaskListContextMenuController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,TaskListContextMenuController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$translate"])],(function(e){return{F:class TaskListContextMenuController{constructor(t){e(this),this._$translate=t}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloTaskListContextMenuCtrl"}},{kind:"set",key:"onSetContextMenu",value:function onSetContextMenu(e){this._onSetContextMenu=e}},{kind:"set",key:"onEditTaskList",value:function onEditTaskList(e){this._onEditTaskList=e}},{kind:"set",key:"onSortTaskList",value:function onSortTaskList(e){this._onSortTaskList=e}},{kind:"set",key:"onArchiveTaskList",value:function onArchiveTaskList(e){this._onArchiveTaskList=e}},{kind:"get",key:"taskListContextMenu",value:function taskListContextMenu(){return this._taskListContextMenu}},{kind:"get",key:"taskListSortTypes",value:function taskListSortTypes(){return this._taskListSortTypes||(this._taskListSortTypes=[{type:O.uS.DateCreatedNewest,name:this._$translate.instant("MENU.SORT_DATE_CREATED_NEWEST")},{type:O.uS.DateCreatedOldest,name:this._$translate.instant("MENU.SORT_DATE_CREATED_OLDEST")},{type:O.uS.CardName,name:this._$translate.instant("MENU.SORT_CARD_NAME")},{type:O.uS.StartDate,name:this._$translate.instant("MENU.SORT_START_DATE")},{type:O.uS.EndDate,name:this._$translate.instant("MENU.SORT_END_DATE")}]),this._taskListSortTypes}},{kind:"method",key:"setTaskListContextMenu",value:function setTaskListContextMenu(e){this._taskListContextMenu=e,this._onSetContextMenu({menuController:this._taskListContextMenu})}},{kind:"method",key:"editTaskList",value:function editTaskList(e){this._onEditTaskList({taskList:e})}},{kind:"method",key:"sortTaskList",value:function sortTaskList(e,t){this._onSortTaskList({taskList:e,type:t})}},{kind:"method",key:"archiveTaskList",value:function archiveTaskList(e){this._onArchiveTaskList({taskList:e})}}]}}));var tr=r(31082),rr=r.n(tr),ir=r(26469),ar=r.n(ir);function TaskListsController_ownKeys(e,t){var r=b()(e);if(S()){var i=S()(e);t&&(i=w()(i).call(i,(function(t){return E()(e,t).enumerable}))),r.push.apply(r,i)}return r}function TaskListsController_objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?l()(r=TaskListsController_ownKeys(Object(a),!0)).call(r,(function(t){(0,P.Z)(e,t,a[t])})):L()?x()(e,L()(a)):l()(i=TaskListsController_ownKeys(Object(a))).call(i,(function(t){c()(e,t,E()(a,t))}))}return e}function TaskListsController_getDecoratorsApi(){TaskListsController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!TaskListsController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=TaskListsController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:TaskListsController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=TaskListsController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function TaskListsController_createElementDescriptor(e){var t,r=TaskListsController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function TaskListsController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function TaskListsController_hasDecorators(e){return e.decorators&&e.decorators.length}function TaskListsController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function TaskListsController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function TaskListsController_toPropertyKey(e){var t=function TaskListsController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function compareTaskListCards(e,t){if("string"==typeof e.position)switch(e.position){case se.XL.Top:return-1;case se.XL.Bottom:return 1}if("string"==typeof t.position)switch(t.position){case se.XL.Top:return 1;case se.XL.Bottom:return-1}return e.position-t.position}let sr=function TaskListsController_decorate(e,t,r,i){var a,s=TaskListsController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function TaskListsController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(TaskListsController_isDataDescriptor(a.descriptor)||TaskListsController_isDataDescriptor(i.descriptor)){if(TaskListsController_hasDecorators(a)||TaskListsController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(TaskListsController_hasDecorators(a)){if(TaskListsController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}TaskListsController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,TaskListsController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$element","$rootScope","$scope","$log","$window","$timeout","$translate","$mdPanel","appCommonSrv","calendarCardsSrv","dialogSrv","htmlHelperSrv","licenseSrv","notificationSrv","onboardingSrv","platformSrv","planywayNotificationsSrv","planywayIntegrationSrv","settingsSrv","telemetrySrv","trelloIntegrationSrv"])],(function(e){return{F:class TaskListsController{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p,m,C,v,f,y,g,_,k){e(this),this._$element=t,this._$rootScope=r,this._$scope=i,this._$log=a,this._$window=s,this._$timeout=n,this._$translate=o,this._$mdPanel=l,this._appCommonSrv=d,this._calendarCardsSrv=c,this._dialogSrv=h,this._htmlHelperSrv=u,this._licenseSrv=p,this._notificationSrv=m,this._onboardingSrv=C,this._platformSrv=v,this._planywayNotificationsSrv=f,this._planywayIntegrationSrv=y,this._settingsSrv=g,this._telemetrySrv=_,this._trelloIntegrationSrv=k;const pushApplyCardsChangesQueue=e=>{this._applyCardsChangesQueue||(this._applyCardsChangesQueue=[],this._applyCardsChangesTimeout=this._$timeout((()=>{try{for(let e of this._applyCardsChangesQueue)e();this._updateCardContextMenu()}finally{this._applyCardsChangesQueue=null,this._applyCardsChangesTimeout=null}}))),this._applyCardsChangesQueue.push(e)};this._onAddOrUpdateCard=e=>{this.currentBoard&&pushApplyCardsChangesQueue((()=>this._addOrUpdateCard(e)))},this._onDeleteCard=e=>{this.currentBoard&&pushApplyCardsChangesQueue((()=>this._deleteCard(e)))},this._onClearedCards=e=>{if(this.currentBoard&&e.accountId===this.currentBoard.accountId){this._applyCardsChangesQueue&&(this._applyCardsChangesQueue=null),this._applyCardsChangesTimeout&&this._$timeout.cancel(this._applyCardsChangesTimeout),this._loadedCardsMap.clear();for(let e of Kt()(t=this._taskListsMap).call(t)){var t;e.resetCards()}}},this._isInitialized=!1,this._$rootScope.$on(O.FK.TaskListsViewChanged,(()=>{this._taskListsViewMode=null})),this._$scope.$on(O.FK.CardsFieldsSettingsChanged,(()=>{i.$broadcast("$$rebind::card")}))}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloTaskListsCtrl"}},{kind:"field",key:"_isInitialized",value:()=>!1},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"field",key:"_taskListsMap",value:()=>new(ke())},{kind:"field",key:"_loadedCardsMap",value:()=>new(ke())},{kind:"field",key:"_checkItemsRenderedCardIds",value:()=>new(Te())},{kind:"field",key:"_dirtyCardIsAllDay",value:()=>new(ke())},{kind:"field",key:"_dirtyCardStart",value:()=>new(ke())},{kind:"field",key:"_dirtyCardEnd",value:()=>new(ke())},{kind:"field",key:"_dirtyCardCheckItemNames",value:()=>new(ke())},{kind:"field",key:"_dirtyCardCheckItemCompleted",value:()=>new(ke())},{kind:"field",key:"_dirtyCardCheckItemIsAllDay",value:()=>new(ke())},{kind:"field",key:"_dirtyCardCheckItemStart",value:()=>new(ke())},{kind:"field",key:"_dirtyCardCheckItemEnd",value:()=>new(ke())},{kind:"field",key:"_dirtyCardCheckItemMembers",value:()=>new(ke())},{kind:"field",key:"_taskListEditingMode",value:()=>null},{kind:"method",key:"initializeTaskLists",value:function initializeTaskLists(){if(this._isInitialized)return;this._$scope.$evalAsync((()=>this._isInitialized=!0));const loadTaskListsAsync=async()=>{if(!this.currentBoard)return;if(!this._provider.isCurrentCollectionAccountReady(this.currentBoard.accountId))return;for(let e of this.currentBoard.lists){let t=this._convertFromTrelloList(e);this._taskListsMap.set(e.id,t)}for(let r of Kt()(e=this._taskListsMap).call(e)){var e,t;_()(t=this.currentBoard.lists).call(t,(e=>e.id===r.id))||this._taskListsMap.delete(r.id)}this._taskLists=null,this._taskListLanes=null;let r=await this._calendarCardsSrv.getCalendarCardsAsync();this._loadedCardsMap.clear();for(let e of r)e.accountId===this.currentBoard.accountId&&e.providerCard.boardId===this.currentBoard.id&&this._addOrUpdateCard(e)},reloadSelectedBoardAsync=async()=>{this._currentBoard=null,this._lastRejectedCardProperties=null,this._isAddBoardCalloutAvailable=!1;for(let e of this._provider.getCurrentCollectionConnectedAccounts()){if(!this._provider.isCurrentCollectionAccountReady(e.accountId)){this._isAddBoardCalloutAvailable=!1;break}this._trelloIntegrationSrv.getTrelloBoards(e.accountId).length>0&&(this._isAddBoardCalloutAvailable=!0)}this._loadTaskListsPromise||(this._loadTaskListsPromise=this._$timeout((()=>{if(!this._$scope.$$destroyed)return loadTaskListsAsync()})));try{await this._loadTaskListsPromise}finally{this._loadTaskListsPromise=null}};this._onUpdateTrelloBoard=e=>{if(!this.currentBoard||e.id!==this.currentBoard.id)return;if(this._currentBoard=null,!this.currentBoard)return;let t;var r;this.currentBoard.lists.length!==this._taskListsMap.size?t=!0:t=ee()(r=this.currentBoard.lists).call(r,(e=>{let t=this._taskListsMap.get(e.id);return!t||t.name!==e.name}));t?reloadSelectedBoardAsync():(this._taskLists=null,this._taskListLanes=null)},this._onDeleteTrelloBoard=e=>{this.currentBoard&&e.id===this.currentBoard.id&&(this._currentBoard=null)},this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",this._onUpdateTrelloBoard),this._trelloIntegrationSrv.addTrelloBoardEventListener("deleted",this._onDeleteTrelloBoard),this._calendarCardsSrv.addCalendarCardEventListener("added",this._onAddOrUpdateCard),this._calendarCardsSrv.addCalendarCardEventListener("updated",this._onAddOrUpdateCard),this._calendarCardsSrv.addCalendarCardEventListener("deleted",this._onDeleteCard),this._calendarCardsSrv.addCalendarCardEventListener("cleared",this._onClearedCards),this._$scope.$on(O.FK.CollectionChanging,(()=>{this._taskListsMap.clear(),this._loadedCardsMap.clear(),this._taskLists=null,this._taskListLanes=null})),this._$scope.$on(O.FK.CollectionChanged,reloadSelectedBoardAsync),this._$scope.$on(O.FK.TaskListsBoardChanged,reloadSelectedBoardAsync),this._$scope.$on(O.FK.CardsReloaded,reloadSelectedBoardAsync),this._$scope.$on(O.FK.TaskListsViewChanged,(()=>{this._taskListLanes=null})),this._$scope.$on(O.FK.FiltersChanged,(()=>{for(let t of Kt()(e=this._taskListsMap).call(e)){var e;t.resetCards()}})),reloadSelectedBoardAsync();const e=Ge()((()=>{var e,t;let r=_()(e=this._$element).call(e,".pw-tasks-card:hover").scope();r&&this._$scope.$evalAsync((()=>r.cardHovered=!0));let i=_()(t=this._$element).call(t,".pw-tasks-card__check-item-wrapper:hover").scope();i&&this._$scope.$evalAsync((()=>i.checkItemHovered=!0))}),200);this._$element.on("mouseover",".pw-tasks-card, .pw-tasks-card__check-item-wrapper",(()=>{this.isTaskListScrolling||this.isTaskListDragging||this.isCardDragging||e()})),this._$element.on("click",".pw-tasks-card__check-item-name",(e=>{var t;let{currentTarget:r}=e;if(this.isTaskListScrolling||this.isTaskListDragging||this.isCardDragging)return;let i=_()(t=this._$element).call(t,r.closest(".pw-tasks-card__check-item-wrapper")).scope();i&&this._$scope.$evalAsync((()=>i.isCheckItemEditing=!0))})),this._$element.on("blur",".pw-js-tasks-list-check-item-name",(e=>{var t;let{currentTarget:r}=e;if(this.isTaskListScrolling||this.isTaskListDragging||this.isCardDragging)return;let i=_()(t=this._$element).call(t,r.closest(".pw-tasks-card__check-item-wrapper")).scope();i&&this._$scope.$evalAsync((()=>i.isCheckItemEditing=!1))}));const t=Ge()((()=>{this._$scope.$evalAsync((()=>this._isTaskListScrolling=!1))}),200);ae()("pw-scheduler").on("scroll",(()=>{this._isTaskListScrolling=!0,t()})),this._htmlHelperSrv.elementAdded(this._$element,".pw-js-tasks-list-scrollable-container",(e=>{e.on("scroll",(()=>{this._isTaskListScrolling=!0,t()}))})),this._htmlHelperSrv.elementAdded(this._$element,".pw-js-tasks-list-scrollable-list",(e=>{e.on("scroll",(()=>{this._isTaskListScrolling=!0,t()}))})),this._$scope.$on("$destroy",(()=>{this._trelloIntegrationSrv.removeTrelloBoardEventListener("updated",this._onUpdateTrelloBoard),this._trelloIntegrationSrv.removeTrelloBoardEventListener("deleted",this._onDeleteTrelloBoard),this._calendarCardsSrv.removeCalendarCardEventListener("added",this._onAddOrUpdateCard),this._calendarCardsSrv.removeCalendarCardEventListener("updated",this._onAddOrUpdateCard),this._calendarCardsSrv.removeCalendarCardEventListener("deleted",this._onDeleteCard),this._calendarCardsSrv.removeCalendarCardEventListener("cleared",this._onClearedCards)}))}},{kind:"get",key:"isBusy",value:function isBusy(){return!!this.currentBoard&&(!this._appCommonSrv.isSchedulerBusy()&&this._trelloIntegrationSrv.isConnectedTrelloBoardBusy(this.currentBoard.accountId,this.currentBoard.id))}},{kind:"get",key:"isInitialized",value:function isInitialized(){return this._isInitialized}},{kind:"get",key:"isTaskListsAvailable",value:function isTaskListsAvailable(){return!!this.currentBoard}},{kind:"get",key:"isAddBoardCalloutAvailable",value:function isAddBoardCalloutAvailable(){return this._isAddBoardCalloutAvailable}},{kind:"get",key:"emptyStateImage",value:function emptyStateImage(){return this._platformSrv.getPlatformUrl(ar())}},{kind:"get",key:"currentBoard",value:function currentBoard(){if(!this._currentBoard){var e;let t=K()(e=this._provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{var t;let r=this._provider.getCurrentCollectionSelectedCalendarIds(e);return w()(t=n()(r).call(r,(t=>this._trelloIntegrationSrv.getTrelloBoardById(e,t)))).call(t,(e=>e))}));this._currentBoard=_()(t).call(t,(e=>e.id===this._trelloCollectionSettings.global.taskLists.boardId))||t[0],this._selectedBoardMembers=null}return this._currentBoard}},{kind:"get",key:"selectedBoardMembers",value:function selectedBoardMembers(){if(!this.currentBoard)return[];if(!this._selectedBoardMembers){var e,t;let r=this._getAccountMemberId(this.currentBoard.accountId),i=this._trelloIntegrationSrv.getTrelloMemberById(this.currentBoard.accountId,r);this._selectedBoardMembers=n()(e=re()(t=[...this.currentBoard.members]).call(t,((e,t)=>(0,N.Yb)(e,t,i)))).call(e,(e=>TaskListsController_objectSpread({},e)))}return this._selectedBoardMembers}},{kind:"get",key:"taskListsView",value:function taskListsView(){return this._trelloCollectionSettings.global.taskLists.view}},{kind:"get",key:"taskListsViewMode",value:function taskListsViewMode(){if(!this._taskListsViewMode){this._taskListsViewMode=this._trelloCollectionSettings.global.taskLists.viewSettings[this.taskListsView].mode;let e=O.or[this._taskListsViewMode];if(e&&!this._licenseSrv.checkPaidFeatureAvailable(e,!1))switch(this.taskListsView){case O.cT.Kanban:return O.e_.None;case O.cT.List:return O.e_.List}}return this._taskListsViewMode}},{kind:"method",key:"showManageAccountCalendarsDialogAsync",value:async function showManageAccountCalendarsDialogAsync(e){var t;let r=_()(t=this._planywayIntegrationSrv.getConnectedAccounts()).call(t,(e=>{let{accountType:t}=e;return t===se.Qm.Trello}));if(!r)return;this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionAddCalendarDialogOpened,{accountType:se.Qm.Trello,where:O.Zz.TaskLists});let i=await this._dialogSrv.showManageAccountCalendarsDialogAsync(r,e);i?(this._$rootScope.$broadcast(O.FK.CalendarsChanging,r),i.connectedCalendarIds.length>0&&this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarAdded,{accountType:se.Qm.Trello,count:i.connectedCalendarIds.length}),i.disconnectedCalendarIds.length>0&&this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarRemoved,{accountType:se.Qm.Trello,count:i.disconnectedCalendarIds.length})):this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionAddCalendarDialogClosed,{accountType:se.Qm.Trello,where:O.Zz.TaskLists})}},{kind:"get",key:"isTaskListScrolling",value:function isTaskListScrolling(){return this._isTaskListScrolling}},{kind:"get",key:"sortableListsOptions",value:function sortableListsOptions(){return this._sortableListsOptions||(this._sortableListsOptions={autoScroll:!0,handler:[".pw-tasks-lane__list-header",".pw-tasks-lane__list-header *"].join(", "),filter:[".pw-tasks-lane__list"].join(", "),ignore:[".pw-tasks-lane__item *",".pw-input__control"].join(", "),group:$.cT,placeholder:e=>{let t=e.clone().css({opacity:.3,pointerEvents:"none"});return _()(t).call(t,"input").removeAttr("id"),t},hint:e=>{let t=e.clone();return t.addClass("pw-tasks-lane__list--hint"),t.css({height:"auto"}),_()(t).call(t,"input").removeAttr("id"),t}}),this._sortableListsOptions}},{kind:"get",key:"isTaskListDragging",value:function isTaskListDragging(){return this._isTaskListDragging}},{kind:"method",key:"onTaskListDragStart",value:function onTaskListDragStart(e){this.currentBoard.isReadOnly?e.preventDefault():this._isTaskListDragging=!0}},{kind:"method",key:"onTaskListDragEnd",value:function onTaskListDragEnd(e){var t,r;if(this._isTaskListDragging=!1,e.newIndex!==e.oldIndex)switch(e.sender.draggable.dropped=!0,e.action){case"remove":case"receive":break;case"sort":e.preventDefault();let i=this._taskListsMap.get(this.taskLists[e.oldIndex].id);this._tempTaskList={id:i.id,name:i.name,position:i.position,isValid:()=>!0},m()(t=this.taskLists).call(t,e.newIndex,0,m()(r=this.taskLists).call(r,e.oldIndex,1)[0]),this.tempTaskList.position=(0,N.V1)(e.newIndex,this.taskLists),this._telemetrySrv.logSessionEvent(O.cN.TaskListEvents.PositionChanged,{by:O.GW.Mouse}),(async()=>{await this._updateTaskListAsync(this.tempTaskList),this._$scope.$evalAsync((()=>this._tempTaskList=null))})()}}},{kind:"method",key:"onTaskListDragCancel",value:function onTaskListDragCancel(){this._isTaskListDragging=!1}},{kind:"get",key:"taskLists",value:function taskLists(){var e,t;this._taskLists||(this._taskLists=re()(e=De()(Kt()(t=this._taskListsMap).call(t))).call(e,N.H9));return this._taskLists}},{kind:"method",key:"toggleListCollapsed",value:function toggleListCollapsed(e){if(this.isTaskListEditing(e)||this.isTaskListCardCreating(e))return;e.isCollapsed=!e.isCollapsed,e.isCollapsed||e.resetCards();let t=this._trelloCollectionSettings.local.taskLists.lists,r=t[e.id];delete t[e.id],t[e.id]=TaskListsController_objectSpread(TaskListsController_objectSpread({},r),{},{isCollapsed:e.isCollapsed}),this._collectionSettings.local.save()}},{kind:"get",key:"taskListContextMenu",value:function taskListContextMenu(){return this._taskListContextMenu}},{kind:"method",key:"setTaskListContextMenu",value:function setTaskListContextMenu(e){this._taskListContextMenu=e}},{kind:"method",key:"openTaskListContextMenu",value:function openTaskListContextMenu(e,t){t.preventDefault(),t.stopPropagation();let r=this._taskListsMap.get(e);r&&(this._telemetrySrv.logSessionEvent(O.cN.TaskListEvents.ContextMenuOpened,{by:"contextmenu"===t.type?O.AH.RightClick:O.AH.MenuButton}),this.taskListContextMenu.open(t,r))}},{kind:"method",key:"editTaskListByMenu",value:function editTaskListByMenu(e){this.beginTaskListEditing(e)}},{kind:"method",key:"sortTaskListByMenu",value:function sortTaskListByMenu(e,t){this._telemetrySrv.logSessionEvent(O.cN.TaskListEvents.Sorted,{type:t,by:O.GW.ContextMenu}),this._sortTaskListAsync(e,t)}},{kind:"method",key:"archiveTaskListByMenu",value:function archiveTaskListByMenu(e){this._telemetrySrv.logSessionEvent(O.cN.TaskListEvents.Archived,{by:O.GW.ContextMenu}),this._archiveTaskListAsync(e)}},{kind:"method",key:"isTaskListCreateAvailable",value:function isTaskListCreateAvailable(){if(this.currentBoard)return!this.currentBoard.isReadOnly&&(this.taskListsView!==O.cT.List||this.taskListsViewMode===O.e_.List)}},{kind:"get",key:"tempTaskList",value:function tempTaskList(){return this._tempTaskList}},{kind:"method",key:"isTaskListCreating",value:function isTaskListCreating(){return"create"===this._taskListEditingMode}},{kind:"method",key:"beginTaskListCreating",value:function beginTaskListCreating(){this.tempTaskList||this._$scope.$evalAsync((()=>{this._taskListEditingMode="create";let e=(0,N.V1)(this.taskLists.length,[...this.taskLists,{position:$.LA}]);this._tempTaskList={name:this._lastRejectedListName||"",position:e,isValid:()=>{var e,t;return this.isTaskListCreating()&&!(null===(e=this._tempTaskList)||void 0===e||null===(t=e.name)||void 0===t||!Pe()(t).call(t))}},this._$timeout((()=>{var e;let t=_()(e=this._$element).call(e,".pw-js-tasks-list-create-panel")[0];t&&(0,We.Z)(t,{scrollMode:"if-needed",block:"nearest",inline:"nearest",behavior:"smooth"})}),25,!1)}))}},{kind:"method",key:"submitTaskListCreating",value:function submitTaskListCreating(){this._appCommonSrv.isSchedulerBusy()||this.tempTaskList&&(this.tempTaskList.isValid()?(this._telemetrySrv.logSessionEvent(O.cN.TaskListEvents.Created),(async()=>{await this._createTaskListAsync(this.tempTaskList)?(this._tempTaskList=null,this._lastRejectedListName=null,this.beginTaskListCreating(),this._$timeout((()=>{var e;return _()(e=this._$element).call(e,".pw-js-tasks-list-create-panel-input").trigger("focus")}),0,!1)):this._$scope.$evalAsync((()=>{this._tempTaskList=null,this._taskListEditingMode=null}))})()):this.rejectTaskListCreating())}},{kind:"method",key:"rejectTaskListCreating",value:function rejectTaskListCreating(){this.tempTaskList&&(this._lastRejectedListName=this.tempTaskList.name,this._$scope.$evalAsync((()=>{this._tempTaskList=null,this._taskListEditingMode=null})))}},{kind:"method",key:"isTaskListEditing",value:function isTaskListEditing(e){var t;return"edit"===this._taskListEditingMode&&(!e||(null===(t=this.tempTaskList)||void 0===t?void 0:t.id)===e.id)}},{kind:"method",key:"beginTaskListEditing",value:function beginTaskListEditing(e){e.isCollapsed&&this.toggleListCollapsed(e),this._$scope.$evalAsync((()=>{this._taskListEditingMode="edit",this._tempTaskList={id:e.id,name:e.name,position:e.position,isValid:()=>{var t,r;return this.isTaskListEditing(e)&&!(null===(t=this._tempTaskList)||void 0===t||null===(r=t.name)||void 0===r||!Pe()(r).call(r))}}}))}},{kind:"method",key:"submitTaskListEditing",value:function submitTaskListEditing(){this._$scope.$evalAsync((()=>this._taskListEditingMode=null)),this.tempTaskList&&this.tempTaskList.isValid()&&(this._telemetrySrv.logSessionEvent(O.cN.TaskListEvents.NameChanged,{by:O.GW.ContextMenu}),(async()=>{await this._updateTaskListAsync(this.tempTaskList),this._$scope.$evalAsync((()=>this._tempTaskList=null))})())}},{kind:"get",key:"taskListLanes",value:function taskListLanes(){var e,t,r;if(0===this.taskLists.length)return[];if(!this._taskListLanes){let i;switch(this.taskListsViewMode){case O.e_.Member:let a=this._getAccountMemberId(this.currentBoard.accountId),s=this._trelloIntegrationSrv.getTrelloMemberById(this.currentBoard.accountId,a);i=[...re()(e=n()(t=this.currentBoard.members).call(t,(e=>TaskListsController_objectSpread({},e)))).call(e,((e,t)=>(0,N.Yb)(e,t,s))),{id:$.$d,fullName:this._$translate.instant("MISC.UNASSIGNED_MEMBER_FULL_NAME")}];break;case O.e_.Label:i=[...n()(r=this.currentBoard.labels).call(r,(e=>TaskListsController_objectSpread(TaskListsController_objectSpread({},e),{},{name:e.name||this._$translate.instant(e.color?O.y_[e.color]:"MISC.LABEL_COLOR_NO_COLOR")}))),{id:$.$d,color:"default",name:this._$translate.instant("MISC.NO_LABEL")}];break;case O.e_.List:i=this.currentBoard.lists;break;case O.e_.None:i=[{id:$.$d}]}this._taskListLanes=n()(i).call(i,(e=>{var t,r;let i;switch(this.taskListsViewMode){case O.e_.Member:case O.e_.Label:case O.e_.List:i=null===(t=this._trelloCollectionSettings.local.taskLists.lanes[this.taskListsView][e.id])||void 0===t?void 0:t.isCollapsed}let a={id:e.id,resource:e,isCollapsed:null!==(r=i)&&void 0!==r&&r,resetCardsCount:()=>a._cardsCount=null,_cardsCount:null};return c()(a,"cardsCount",{get:()=>{if(null===a._cardsCount){a._cardsCount=0;for(let e of this.taskLists)for(let t of e.cards)if(this._isTaskListCardVisible(t))switch(this.taskListsViewMode){case O.e_.Member:t.memberIds.has(a.id)&&a._cardsCount++;break;case O.e_.Label:t.labelIds.has(a.id)&&a._cardsCount++;break;case O.e_.List:t.listId===a.id&&a._cardsCount++;break;case O.e_.None:a._cardsCount++}}return a._cardsCount}}),a}))}return this._taskListLanes}},{kind:"method",key:"toggleLaneCollapsed",value:function toggleLaneCollapsed(e){if(this.isTaskLaneCardCreating(e))return;e.isCollapsed=!e.isCollapsed;let t=this._trelloCollectionSettings.local.taskLists.lanes[this.taskListsView],r=t[e.id];delete t[e.id],t[e.id]=TaskListsController_objectSpread(TaskListsController_objectSpread({},r),{},{isCollapsed:e.isCollapsed}),this._collectionSettings.local.save()}},{kind:"method",key:"getLaneCardFilter",value:function getLaneCardFilter(e){switch(this.taskListsViewMode){case O.e_.Member:return t=>t.memberIds.has(e);case O.e_.Label:return t=>t.labelIds.has(e);case O.e_.List:return t=>t.listId===e;default:return()=>!0}}},{kind:"method",key:"onCardInView",value:function onCardInView(e,t){e?(t.$resume(),t.$broadcast("$$rebind::card")):t.$suspend()}},{kind:"get",key:"sortableCardsOptions",value:function sortableCardsOptions(){return this._sortableCardsOptions||(this._sortableCardsOptions={connectWith:[".pw-tasks-lane__items"].join(", "),filter:[".pw-tasks-lane__item"].join(", "),ignore:[".pw-tasks-card--temp-card",".pw-tasks-card--temp-card *",".pw-tasks-card__check-items",".pw-tasks-card__check-items *","input"].join(", "),autoScroll:!0,disableSorting:!1,restrictedSorting:()=>{switch(this.taskListsViewMode){case O.e_.Member:case O.e_.Label:return this.taskListsView===O.cT.List;case O.e_.List:case O.e_.None:return!1}},getRestrictedSortingTarget:(e,t)=>{var r,i;let a;switch(this.taskListsView){case O.cT.Kanban:a=ae()(t.sortable.element).attr("data-list-id");break;case O.cT.List:a=ae()(e.list.draggedElement).attr("data-list-id")}let s=_()(r=t.element.closest(".pw-tasks-lane")).call(r,`[data-list-id='${a}']`),n=t.element.attr("data-lane-id"),o=_()(i=this.taskListLanes).call(i,(e=>e.id===n)),l=this._calendarCardsSrv.getCalendarCardById(e.list.draggedElement.attr("data-account-id"),se.eT.TrelloCard,e.list.draggedElement.attr("data-id")),d=(e=>{let t=0;if(!o)return t;let r=this._taskListsMap.get(a),i=w()(e=r.cards).call(e,this.getLaneCardFilter(n));for(let e of i){if(e.position>l.providerCard.position)return t;t++}return t})(),c={element:ae()(_()(s).call(s,".pw-tasks-lane__item:not(.pw-tasks-lane__item--drop-anchor):not(.pw-tasks-lane__item--placeholder)")[d]),direction:"prev"};return c.element[0]||(c={element:_()(s).call(s,".pw-tasks-lane__item").last(),direction:"next"}),c},group:$.dl,placeholder:e=>{let t=e.clone();return t.addClass("pw-tasks-lane__item--placeholder"),t.css({width:e.width()}),_()(t).call(t,"input").removeAttr("id"),t},hint:e=>{let t=e.clone();return t.addClass("pw-tasks-lane__item--hint"),t.css({width:e.width()}),_()(t).call(t,"input").removeAttr("id"),t}}),this._sortableCardsOptions}},{kind:"get",key:"isCardDragging",value:function isCardDragging(){return this._isCardDragging}},{kind:"method",key:"onCardDragStart",value:function onCardDragStart(e){if(this.currentBoard.isReadOnly)return void e.preventDefault();this._loadedCardsMap.get(e.item.data("id")).isReadOnly?e.preventDefault():this._isCardDragging=!0}},{kind:"method",key:"onCardDragMoveHint",value:function onCardDragMoveHint(e){var t,r,i,a,s;let n=ae()(e.elementUnderCursor),o=n.closest(".pw-tasks-lane__list"),l=n.closest(".pw-tasks-lane"),d=l.attr("data-resource-id");if(l.addClass("pw-tasks-lane--disabled"),this.taskListsView===O.cT.List)switch(this.taskListsViewMode){case O.e_.Member:case O.e_.Label:let s=ae()(e.sender.draggedElement).closest(".pw-tasks-lane__list").attr("data-list-id");return o=_()(l).call(l,`[data-list-id='${s}']`),_()(t=this._$element).call(t,".pw-tasks-lane__items--target").removeClass("pw-tasks-lane__items--target"),_()(r=ae()(o)).call(r,".pw-tasks-lane__items").addClass("pw-tasks-lane__items--target"),_()(i=this._$element).call(i,".pw-tasks-lane--target").removeClass("pw-tasks-lane--target"),void(_()(l).call(l,".pw-tasks-lane__item--placeholder")[0]&&ae()(l).index()!==ae()(e.sender.draggedElement).closest(".pw-tasks-lane").index()&&l.addClass("pw-tasks-lane--target"));case O.e_.List:return o=_()(l).call(l,`.pw-tasks-lane__items[data-list-id=${d}]`),_()(a=this._$element).call(a,".pw-tasks-lane__items").removeClass("pw-tasks-lane__items--target"),void ae()(o).addClass("pw-tasks-lane__items--target")}if(0===o.length)return;let c=_()(o).call(o,".pw-tasks-lane__items");0!==c.length&&(_()(s=this._$element).call(s,".pw-tasks-lane__items").removeClass("pw-tasks-lane__items--target"),c.addClass("pw-tasks-lane__items--target"))}},{kind:"method",key:"onCardDragEnd",value:function onCardDragEnd(e,t,r){var i,a,s,n,o,l,d,c,h,u,p;if(this._isCardDragging=!1,_()(i=this._$element).call(i,".pw-tasks-lane--target").removeClass("pw-tasks-lane--target"),_()(a=this._$element).call(a,".pw-tasks-lane--disabled").removeClass("pw-tasks-lane--disabled"),_()(s=this._$element).call(s,".pw-tasks-lane__items--target").removeClass("pw-tasks-lane__items--target"),this._$rootScope.$broadcast(O.FK.CardDragEnded),e.newIndex===e.oldIndex)return;e.sender.draggable.dropped=!0;let C=this._taskListsMap.get(t);if(C)switch(e.action){case"remove":let i=e.item.data("id");m()(n=C.cards).call(n,Fe()(o=C.cards).call(o,(e=>{let{id:t}=e;return t===i})),1);break;case"receive":{e.preventDefault();let i,a,s,n=this._loadedCardsMap.get(e.item.data("id"));switch(this.taskListsViewMode){case O.e_.Member:case O.e_.Label:switch(this.taskListsView){case O.cT.Kanban:s=e.newIndex;break;case O.cT.List:s=(()=>{let e=0;if(C.cards.length>0)for(let t of C.cards){if(t.position>n.position)return e;e++}return e})()}break;case O.e_.List:case O.e_.None:s=e.newIndex}switch(this.taskListsViewMode){case O.e_.Member:a={position:n.position},n.memberIds.has(r)||(i=O.cN.CardEvents.MemberChanged,r===$.$d?(n.members=[],a.memberIds=new(Te())([])):(n.members=[r],a.memberIds=new(Te())([r])));break;case O.e_.Label:a={position:n.position},n.labelIds.has(r)||(i=O.cN.CardEvents.LabelChanged,r===$.$d?(n.labels=[],a.labelIds=new(Te())([])):(n.labels=[r],a.labelIds=new(Te())([r])));case O.e_.List:case O.e_.None:}switch(this.taskListsViewMode){case O.e_.Member:case O.e_.Label:switch(this.taskListsView){case O.cT.List:n.listId!==t&&(i||(i=O.cN.CardEvents.ListChanged),n.listId=t,a.listId=t);break;case O.cT.Kanban:i||(i=O.cN.CardEvents.ListChanged),n.listId=t;let e=w()(l=C.cards).call(l,this.getLaneCardFilter(r));m()(e).call(e,s,0,n);let o=(0,N.V1)(s,e);n.position=o,m()(d=C.cards).call(d,s,0,n),re()(c=C.cards).call(c,compareTaskListCards),a=TaskListsController_objectSpread(TaskListsController_objectSpread({},a),{},{listId:t,position:o})}break;case O.e_.List:case O.e_.None:i=O.cN.CardEvents.ListChanged,m()(h=C.cards).call(h,s,0,n),n.listId=t,a={listId:t,position:(0,N.V1)(s,C.cards)}}this._logCalendarCardEvent(n.calendarCard,{event:i,data:{by:O.AH.Mouse}}),this._setCalendarCardPropertiesAsync(n.calendarCard,a);break}case"sort":{let t,i,a;switch(e.preventDefault(),this.taskListsViewMode){case O.e_.Member:case O.e_.Label:switch(this.taskListsView){case O.cT.Kanban:{var v,f,y;i=O.cN.CardEvents.PositionChanged;let s=w()(v=C.cards).call(v,this.getLaneCardFilter(r));t=m()(s).call(s,e.oldIndex,1)[0],m()(s).call(s,e.newIndex,0,t);let n=(0,N.V1)(e.newIndex,s);_()(f=C.cards).call(f,(e=>e.id===t.id)).position=n,re()(y=C.cards).call(y,compareTaskListCards),a={position:n};break}case O.cT.List:return}break;case O.e_.List:case O.e_.None:i=O.cN.CardEvents.PositionChanged,t=m()(u=C.cards).call(u,e.oldIndex,1)[0],m()(p=C.cards).call(p,e.newIndex,0,t),a={position:(0,N.V1)(e.newIndex,C.cards)}}this._logCalendarCardEvent(t.calendarCard,{event:i,data:{by:O.AH.Mouse}}),this._setCalendarCardPropertiesAsync(t.calendarCard,a);break}}}},{kind:"method",key:"onCardDragCancel",value:function onCardDragCancel(){var e,t,r;this._isCardDragging=!1,_()(e=this._$element).call(e,".pw-tasks-lane--target").removeClass("pw-tasks-lane--target"),_()(t=this._$element).call(t,".pw-tasks-lane--disabled").removeClass("pw-tasks-lane--disabled"),_()(r=this._$element).call(r,".pw-tasks-lane__items").removeClass("pw-tasks-lane__items--target"),this._$rootScope.$broadcast(O.FK.CardDragEnded)}},{kind:"method",key:"updateCardByHotkey",value:function updateCardByHotkey(e,t,r,i){var a,s;this.closeCardContextMenu(),null===(a=this.taskListContextMenu)||void 0===a||a.close();let n=null===(s=this._loadedCardsMap.get(t))||void 0===s?void 0:s.calendarCard;(n||(n=this._calendarCardsSrv.getCalendarCardById(e,se.eT.TrelloCheckItem,t),n))&&this._provider.updateCardsByHotkey([n],r,i,O.LP.TaskLists,this._$element)}},{kind:"method",key:"showEditCardDialogAsync",value:async function showEditCardDialogAsync(e,t){var r;let i=null===(r=this._loadedCardsMap.get(e))||void 0===r?void 0:r.calendarCard;i&&!i.isTempCard&&(this._logCalendarCardEvent(i,{event:O.cN.CardEvents.EditDialogOpened}),await this._dialogSrv.showEditCardDialogAsync(i,{cardElement:t,openerContext:this._editCardDialogOpenerContext})?this._incrementActionCounter():this._logCalendarCardEvent(i,{event:O.cN.CardEvents.EditDialogClosed}))}},{kind:"get",key:"cardContextMenu",value:function cardContextMenu(){return this._cardContextMenu}},{kind:"method",key:"setCardContextMenu",value:function setCardContextMenu(e,t){this._cardContextMenu||(this._cardContextMenu={}),t.where=O.a6.TaskLists,t.applyRecurringActionToHead=!0,t.forceConfirm=!0,this._cardContextMenu[e]=t}},{kind:"method",key:"openCardContextMenu",value:function openCardContextMenu(e,t,r){var i;let a=null===(i=this._loadedCardsMap.get(t))||void 0===i?void 0:i.calendarCard;if(a||(a=this._calendarCardsSrv.getCalendarCardById(e,se.eT.TrelloCheckItem,t),a)){if(a.cardType===se.eT.TrelloCheckItem){var s;let e=null===(s=this._loadedCardsMap.get(a.providerCard.parentId))||void 0===s?void 0:s.calendarCard;if(!e)return;this._logCalendarCardEvent(e,{event:O.cN.CardEvents.CheckItemContextMenuOpened,data:{by:"contextmenu"===r.type?O.AH.RightClick:O.AH.MenuButton}})}else this._logCalendarCardEvent(a,{event:O.cN.CardEvents.ContextMenuOpened,data:{by:"contextmenu"===r.type?O.AH.RightClick:O.AH.MenuButton}});this.cardContextMenu[a.providerType].open(r,a)}}},{kind:"method",key:"closeCardContextMenu",value:function closeCardContextMenu(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(e=rr()(this.cardContextMenu)).call(e,(e=>{t.closeNested?e.closeNested():e.close()}))}},{kind:"method",key:"isTaskListCardCreateAvailable",value:function isTaskListCardCreateAvailable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.currentBoard.isReadOnly)return!1;if(t.nextCard){var r;if(t.nextCard.isTempCard)return!1;let i=u()(r=e.cards).call(r,t.nextCard);if(i>0&&e.cards[i-1].isTempCard)return!1}else if(this.isTaskListCardCreating(e)&&this.isTaskLaneCardCreating(t.taskLane))return!1;return!0}},{kind:"method",key:"isTaskListCardCreating",value:function isTaskListCardCreating(e){return!(!this._tempCalendarCard||!this._loadedCardsMap.has(this._tempCalendarCard.id))&&(!e||this._tempCalendarCard.providerCard.listId===e.id)}},{kind:"method",key:"isTaskLaneCardCreating",value:function isTaskLaneCardCreating(e){if(!this._tempCalendarCard||!this._loadedCardsMap.has(this._tempCalendarCard.id))return!1;if(!e)return!0;switch(this.taskListsViewMode){case O.e_.Member:return this._tempCalendarCard.providerCard.memberIds.has(e.id);case O.e_.Label:return this._tempCalendarCard.providerCard.labelIds.has(e.id);case O.e_.List:case O.e_.None:return!0}}},{kind:"method",key:"getTaskLaneDefaultList",value:function getTaskLaneDefaultList(e){var t,r;if(this.taskListsViewMode===O.e_.List)return _()(t=this.taskLists).call(t,(t=>t.id===e.id));{let e=this.currentBoard.defaultListId&&_()(r=this.taskLists).call(r,(e=>e.id===this.currentBoard.defaultListId));return e||(e=this.taskLists[0]),e}}},{kind:"method",key:"beginCardCreating",value:function beginCardCreating(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._tempCalendarCard)return;let i=w()(t=e.cards).call(t,(e=>!e.isTempCard)),a=i.length;switch(this.taskListsView){case O.cT.Kanban:i=w()(i).call(i,this.getLaneCardFilter(r.taskLane.id)),a=r.nextCard?u()(i).call(i,r.nextCard):i.length;break;case O.cT.List:if(this.taskListsViewMode===O.e_.List)a=r.nextCard?u()(i).call(i,r.nextCard):i.length}let s=(0,N.V1)(a,[...Ie()(i).call(i,0,a),{position:$.LA},...Ie()(i).call(i,a)]);this._$scope.$evalAsync((()=>{var t,i,a;let n={boardId:this.currentBoard.id,listId:e.id,position:s};switch(this.taskListsViewMode){case O.e_.Member:n.memberIds=new(Te())([r.taskLane.id]);break;case O.e_.Label:n.labelIds=new(Te())([r.taskLane.id]);break;case O.e_.List:case O.e_.None:n.labelIds=null===(t=this._lastRejectedCardProperties)||void 0===t?void 0:t.labelIds,n.memberIds=null===(i=this._lastRejectedCardProperties)||void 0===i?void 0:i.memberIds}this._tempCalendarCard=this._calendarCardsSrv.createTempCalendarCard(this.currentBoard.accountId,se.eT.TrelloCard,{title:(null===(a=this._lastRejectedCardProperties)||void 0===a?void 0:a.title)||"",providerCard:n})}))}},{kind:"method",key:"submitCardCreating",value:function submitCardCreating(){this._appCommonSrv.isSchedulerBusy()||this._tempCalendarCard&&this._loadedCardsMap.has(this._tempCalendarCard.id)&&(this._tempCalendarCard.title||this._tempCalendarCard.hasDates?(this._logCalendarCardEvent(this._tempCalendarCard,{event:O.cN.CardEvents.Added}),(async()=>{let e=this._taskListsMap.get(this._tempCalendarCard.providerCard.listId);if(e){var t;let i=Fe()(t=e.cards).call(t,(e=>e.isTempCard))===e.cards.length-1;if(await this._createCardAsync(this._tempCalendarCard)){var r;let t={taskLane:_()(r=this.taskListLanes).call(r,(e=>this.isTaskLaneCardCreating(e)))};return this._tempCalendarCard=null,this._tempCheckItem=null,this._lastRejectedCardProperties=null,this._incrementActionCounter(),void(i&&(this.beginCardCreating(e,t),this._$timeout((()=>{var e;return _()(e=this._$element).call(e,".pw-js-tasks-list-card-create-input").trigger("focus")}),0,!1)))}}this._$scope.$evalAsync((()=>{this._tempCalendarCard=null,this._tempCheckItem=null}))})()):this.rejectCardCreating())}},{kind:"method",key:"rejectCardCreating",value:function rejectCardCreating(){this._tempCalendarCard&&this._loadedCardsMap.has(this._tempCalendarCard.id)&&(this._lastRejectedCardProperties={title:this._tempCalendarCard.title,isCompleted:this._tempCalendarCard.providerCard.isCompleted,isAllDay:this._tempCalendarCard.isAllDay,start:this._tempCalendarCard.start,end:this._tempCalendarCard.end,labelIds:this._tempCalendarCard.providerCard.labelIds,memberIds:this._tempCalendarCard.providerCard.memberIds,priority:this._tempCalendarCard.providerCard.priority},this._calendarCardsSrv.deleteCalendarCardAsync(this._tempCalendarCard),this._$scope.$evalAsync((()=>this._tempCalendarCard=null)))}},{kind:"method",key:"toggleCheckItemsExpanded",value:function toggleCheckItemsExpanded(e){e.isCheckItemsExpanded=!e.isCheckItemsExpanded,0===e.checkItems.length&&this.beginCheckItemCreating(e)}},{kind:"method",key:"onCheckItemNameMouseDown",value:function onCheckItemNameMouseDown(e){0!==e.button&&e.preventDefault()}},{kind:"get",key:"tempCheckItem",value:function tempCheckItem(){return this._tempCheckItem}},{kind:"set",key:"tempCheckItem",value:function tempCheckItem(e){this._tempCheckItem=e}},{kind:"get",key:"isAddCheckItemBusy",value:function isAddCheckItemBusy(){return this._isAddCheckItemBusy}},{kind:"method",key:"isCheckItemCreating",value:function isCheckItemCreating(e){return!!this.tempCheckItem&&(!e||this._tempCheckItem.cardId===e)}},{kind:"method",key:"beginCheckItemCreating",value:function beginCheckItemCreating(e){this._tempCheckItem||this._checkCalendarCardEditAvailable(e)&&this._$scope.$evalAsync((()=>{var t,r,i,a,s;e.resetCheckItems(),this._tempCheckItem={id:$.$d,name:(null===(t=this._lastRejectedCheckItemProperties)||void 0===t?void 0:t.name)||"",start:null===(r=this._lastRejectedCheckItemProperties)||void 0===r?void 0:r.start,end:null===(i=this._lastRejectedCheckItemProperties)||void 0===i?void 0:i.end,isAllDay:null===(a=this._lastRejectedCheckItemProperties)||void 0===a?void 0:a.isAllDay,memberIds:(null===(s=this._lastRejectedCheckItemProperties)||void 0===s?void 0:s.memberIds)||[],cardId:e.id,listId:e.listId}}))}},{kind:"method",key:"rejectCheckItemCreating",value:function rejectCheckItemCreating(){this._tempCheckItem&&(this._lastRejectedCheckItemProperties={name:this._tempCheckItem.name,isAllDay:this._tempCheckItem.isAllDay,start:this._tempCheckItem.start,end:this._tempCheckItem.end,memberIds:this._tempCheckItem.memberIds},this._$scope.$evalAsync((()=>{var e;null===(e=this._loadedCardsMap.get(this._tempCheckItem.cardId))||void 0===e||e.resetCheckItems(),this._tempCheckItem=null})))}},{kind:"method",key:"submitCheckItemCreatingAsync",value:async function submitCheckItemCreatingAsync(e){var t;if(this.isAddCheckItemBusy)return;if(!this.isCheckItemCreating(null===(t=e)||void 0===t?void 0:t.id))return;if(!this._tempCheckItem.name&&!this._tempCheckItem.start&&!this._tempCheckItem.end&&0===this._tempCheckItem.memberIds.length)return void this.rejectCheckItemCreating();if(!e&&!(e=this._loadedCardsMap.get(this._tempCheckItem.cardId)))return;let r=e.calendarCard;try{var i,a,s,n,o;this._isAddCheckItemBusy=!0;let t,l=re()(i=this._calendarCardsSrv.getCalendarCardChecklists(r)||[]).call(i,N.Fo);l.length?t=l[l.length-1].id:(this._logCalendarCardEvent(r,{event:O.cN.CardEvents.ChecklistAdded}),({id:t}=await this._calendarCardsSrv.createCalendarCardChecklistAsync(r))),this._tempCheckItem.start&&this._tempCheckItem.end?this._logCalendarCardEvent(r,{event:O.cN.CardEvents.Scheduled,data:{cardType:se.eT.TrelloCheckItem,cardRole:se.D.Card,isAllDay:this._tempCheckItem.isAllDay,start:this._tempCheckItem.start,end:this._tempCheckItem.end,by:O.AH.HotAction}}):this._logCalendarCardEvent(r,{event:O.cN.CardEvents.CheckItemAdded});let d=await this._calendarCardsSrv.createCalendarCardCheckItemAsync(r,t,{name:this._tempCheckItem.name||this._$translate.instant("MISC.NO_TITLE"),position:this._tempCheckItem.position}),c={isAllDay:null!==(a=this._tempCheckItem.isAllDay)&&void 0!==a?a:null,start:null!==(s=this._tempCheckItem.start)&&void 0!==s?s:null,end:null!==(n=this._tempCheckItem.end)&&void 0!==n?n:null,memberIds:null!==(o=this._tempCheckItem.memberIds)&&void 0!==o?o:null};this._tempCheckItem=null,this._lastRejectedCheckItemProperties=null,this._isAddCheckItemBusy=!1,this.beginCheckItemCreating(e),this._$timeout((()=>{var e;return _()(e=this._$element).call(e,".pw-js-tasks-list-temp-check-item-name").trigger("focus")}),0,!1),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(r,t,d.id,c)}catch(e){this._isAddCheckItemBusy=!1,this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{e.resetCheckItems()}}},{kind:"get",key:"_userSettings",value:function _userSettings(){return this._settingsSrv.user}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[O.lP.Trello],global:this._collectionSettings.global.settings.provider[O.lP.Trello]}}},{kind:"method",key:"_getAccountMemberId",value:function _getAccountMemberId(e){return this._planywayIntegrationSrv.getConnectedAccountById(e).trelloMemberId}},{kind:"method",key:"_incrementActionCounter",value:function _incrementActionCounter(){switch(this._appCommonSrv.getSchedulerMode()){case O.ud.Board:this._onboardingSrv.incrementActionCounter(O.Us.BoardEdit);break;case O.ud.Calendar:this._onboardingSrv.incrementActionCounter(O.Us.CalendarEdit);break;case O.ud.Timeline:this._onboardingSrv.incrementActionCounter(O.Us.TimelineEdit);break;case O.ud.TimeTracking:this._onboardingSrv.incrementActionCounter(O.Us.TimeTrackingEdit)}}},{kind:"method",key:"_convertFromTrelloList",value:function _convertFromTrelloList(e){var t,r;let i=this._trelloCollectionSettings.local.taskLists.lists,a={id:e.id,name:e.name,position:e.position,isCollapsed:null!==(t=null===(r=i[e.id])||void 0===r?void 0:r.isCollapsed)&&void 0!==t&&t,resetCards:()=>{a._cards=null;for(let e of this.taskListLanes)e.resetCardsCount()},_cards:null};return c()(a,"cards",{get:()=>{var e,t,r,i;a._cards||(a._cards=re()(e=w()(t=De()(Kt()(r=this._loadedCardsMap).call(r))).call(t,(e=>e.listId===a.id&&this._isTaskListCardVisible(e)))).call(e,compareTaskListCards),_()(i=this._$element).call(i,`[data-list-id='${a.id}']`).each(((e,t)=>{var r;return null===(r=ae()(t).scope())||void 0===r?void 0:r.$broadcast("$$rebind::card")})));return a._cards}}),a}},{kind:"method",key:"_createTaskListAsync",value:async function _createTaskListAsync(e){try{this._appCommonSrv.setSchedulerBusy(!0);let t=await this._trelloIntegrationSrv.createTrelloListAsync(this.currentBoard.accountId,this.currentBoard.id,e);return this._taskListsMap.set(t.id,this._convertFromTrelloList(t)),this._taskLists=null,this._incrementActionCounter(),!0}catch(e){return this._$log.error("Trello create list error:"),this._$log.error(e),this._telemetrySrv.logError("Trello create list error",e,{class:this.constructor.name,method:this._createTaskListAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.TASK_LIST_CREATE_ERROR"),O.k$.Error),!1}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_updateTaskListAsync",value:async function _updateTaskListAsync(e){let t=this._taskListsMap.get(e.id),r={name:t.name,position:t.position},i={name:e.name,position:e.position};if(!(0,N.h0)(r,i))try{this._appCommonSrv.setSchedulerBusy(!0),y()(t,i),this._taskLists=null,await this._trelloIntegrationSrv.updateTrelloListAsync(this.currentBoard.accountId,e.id,i),this._incrementActionCounter()}catch(e){y()(t,r),this._taskLists=null,this._$log.error("Trello update list error:"),this._$log.error(e),this._telemetrySrv.logError("Trello update list error",e,{class:this.constructor.name,method:this._updateTaskListAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.TASK_LIST_UPDATE_ERROR"),O.k$.Error)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_sortTaskListAsync",value:async function _sortTaskListAsync(e,t){var r,i,a;const s=re()(r=w()(i=De()(Kt()(a=this._loadedCardsMap).call(a))).call(i,(t=>t.listId===e.id))).call(r,((e,t)=>e.position-t.position));switch(t){case O.uS.DateCreatedNewest:re()(s).call(s,((e,t)=>(0,N.A5)(t.id,e.id)));break;case O.uS.DateCreatedOldest:re()(s).call(s,((e,t)=>(0,N.A5)(e.id,t.id)));break;case O.uS.CardName:re()(s).call(s,((e,t)=>(0,N.A5)(e.title,t.title)));break;case O.uS.StartDate:re()(s).call(s,((e,t)=>e.hasDates||t.hasDates?e.hasDates?t.hasDates?e.start-t.start:-1:1:0));break;case O.uS.EndDate:re()(s).call(s,((e,t)=>e.hasDates||t.hasDates?e.hasDates?t.hasDates?e.end-t.end:-1:1:0))}try{this._appCommonSrv.setSchedulerBusy(!0),await(0,se.qd)(s,((e,t)=>this._calendarCardsSrv.updateCalendarCardPropertiesAsync(e.calendarCard,{position:$.LA*(t+1)})),5)}catch(e){this._$log.error("Trello sort list error:"),this._$log.error(e),this._telemetrySrv.logError("Trello sort list error",e,{class:this.constructor.name,method:this._sortTaskListAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.TASK_LIST_SORT_ERROR"),O.k$.Error)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_archiveTaskListAsync",value:async function _archiveTaskListAsync(e){if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.ARCHIVE_TRELLO_LIST_TITLE"),this._$translate.instant("DIALOGS.ARCHIVE_TRELLO_LIST_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.ARCHIVE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._appCommonSrv.setSchedulerBusy(!0),await this._trelloIntegrationSrv.archiveTrelloListAsync(this.currentBoard.accountId,e.id);for(let t of e.cards){this._loadedCardsMap.delete(t.id),t.calendarCard.providerCard.isArchived=!0,this._calendarCardsSrv.updateCalendarCardAsync(t.calendarCard);let e=[...t.calendarCard.providerCard.trelloCustomFieldCards,...t.calendarCard.providerCard.trelloCheckItemCards,...t.calendarCard.providerCard.trelloTimeRecordCards];for(let t of e)t.providerCard.isArchived=!0,this._calendarCardsSrv.updateCalendarCardAsync(t)}this._taskListsMap.delete(e.id),this._taskLists=null}catch(e){this._$log.error("Trello archive list error:"),this._$log.error(e),this._telemetrySrv.logError("Trello archive list error",e,{class:this.constructor.name,method:this._archiveTaskListAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.TASK_LIST_ARCHIVE_ERROR"),O.k$.Error)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_addOrUpdateCard",value:function _addOrUpdateCard(e){let t=this._loadedCardsMap.get(e.id);switch(e.cardType){case se.eT.TrelloCheckItem:if(t)return void this._deleteCard(e);let r=this._loadedCardsMap.get(e.providerCard.parentId);if(!r)return;r.resetCheckItems();break;case se.eT.TrelloTimeRecord:t&&this._deleteCard(e);break;case se.eT.TrelloCard:let i=this._taskListsMap.get(e.providerCard.listId);if(e.providerCard.isArchived)return void this._deleteCard(e);if(e.isTempCard||(e=e.clone()),t&&(!i||t.listId!==e.providerCard.listId)){let r=this._taskListsMap.get(t.listId);r&&r.resetCards(),this._checkItemsRenderedCardIds.delete(e.id)}this._loadedCardsMap.set(e.id,this._convertFromCalendarCard(e)),i&&i.resetCards();break;default:t&&this._deleteCard(e)}}},{kind:"method",key:"_deleteCard",value:function _deleteCard(e){let t=this._loadedCardsMap.get(e.id);if(!t)return;this._checkItemsRenderedCardIds.delete(e.id),this._loadedCardsMap.delete(e.id);let r=this._taskListsMap.get(t.listId);r&&r.resetCards()}},{kind:"method",key:"_checkCalendarCardEditAvailable",value:function _checkCalendarCardEditAvailable(e){if(e.cardRole===se.D.Milestone)if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.Milestones,!0))return!1;if(e.recurrenceRule&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.RecurringCards,!0))return!1;if(e.cardType===se.eT.TrelloCheckItem)if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.AdvancedChecklists,!0))return!1;return!0}},{kind:"method",key:"_setCalendarCardPropertiesAsync",value:async function _setCalendarCardPropertiesAsync(e,t){try{await this._calendarCardsSrv.updateCalendarCardPropertiesAsync(e,t),this._incrementActionCounter()}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}}},{kind:"method",key:"_createCardAsync",value:async function _createCardAsync(e){try{this._appCommonSrv.setSchedulerBusy(!0);let t=await this._calendarCardsSrv.createCalendarCardAsync(e);return this._$rootScope.$broadcast(O.FK.CardCreated,{calendarCard:t}),!0}catch(e){return this._$log.error("Trello create card from task list error:"),this._$log.error(e),this._telemetrySrv.logError("Trello create card from task list error",e,{class:this.constructor.name,method:this._createCardAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.CREATE_TRELLO_CARD_ERROR"),O.k$.Error),!1}finally{this._appCommonSrv.setSchedulerBusy(!1),this._calendarCardsSrv.deleteCalendarCardAsync(e)}}},{kind:"method",key:"_updateCardContextMenu",value:function _updateCardContextMenu(){var e,t,r;if(null===(e=this.cardContextMenu)||void 0===e||null===(t=e[O.lP.Trello])||void 0===t||!t.pwData)return;let i=null===(r=this._loadedCardsMap.get(this.cardContextMenu[O.lP.Trello].pwData.id))||void 0===r?void 0:r.calendarCard;i?this._$scope.$evalAsync((()=>this.cardContextMenu[O.lP.Trello].pwData=i)):this.closeCardContextMenu()}},{kind:"method",key:"_logCalendarCardEvent",value:function _logCalendarCardEvent(e,t){this._telemetrySrv.logSessionEvent(t.event,TaskListsController_objectSpread({accountId:e.accountId,calendarId:e.calendarId,cardType:e.cardType,cardRole:e.cardRole,isAllDay:e.isAllDay,start:e.start,end:e.end,isNewCard:e.isTempCard,memberIds:e.providerCard.memberIds,isAssignedToMe:e.providerCard.memberIds.has(this._getAccountMemberId(e.accountId)),recurrenceRule:e.recurrenceRule,priority:e.providerCard.priority,where:O.a6.TaskLists,by:O.AH.TaskLists,durationMinutes:e.providerCard.durationMinutes},t.data))}},{kind:"method",key:"_convertFromCalendarCard",value:function _convertFromCalendarCard(e){let t={id:e.id,accountType:se.Qm.Trello,accountId:e.accountId,calendarId:e.calendarId,cardType:e.cardType,cardRole:e.cardRole,calendarCard:e,cardBoard:this.currentBoard,cardBoardMembers:this.selectedBoardMembers,isTempCard:e.isTempCard,isReadOnly:e.isReadOnly,cardNumber:e.providerCard.cardNumber,listId:e.providerCard.listId,position:e.providerCard.position,isSingleDate:e.isSingleDate,priority:e.providerCard.priority,changeDates:(r,i,a,s)=>{if(t.isAllDay===r&&(0,N.rs)(t.start,i)&&(0,N.rs)(t.end,a))return;if(!this._checkCalendarCardEditAvailable(t))return void s(t.isAllDay,t.start,t.end);let n,o={isAllDay:r,start:i,end:a};if(t.hasDates)if(t.isAllDay!==r)n=r?O.cN.CardEvents.IsAllDaySet:O.cN.CardEvents.IsAllDayUnset;else if((0,N.rs)(t.start,i)){if((0,N.rs)(t.end,a))return;n=O.cN.CardEvents.EndChanged}else n=O.cN.CardEvents.StartChanged;else n=O.cN.CardEvents.Scheduled,o.by=O.AH.HotAction;if(this._logCalendarCardEvent(e,{event:n,data:o}),!t.hasDates||t.isAllDay!==r){let e,i=this._planywayNotificationsSrv.getDefaultReminders(r);i.length>0&&(e=!0),t.notifications=i,t.isSubscribed=e}t.isAllDay=r,t.start=i,t.end=a},removeDatesAsync:async()=>{try{this._logCalendarCardEvent(e,{event:O.cN.CardEvents.DatesRemoved}),await this._calendarCardsSrv.removeCalendarCardAsync(e)}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}},isMemberSelected:t=>e.providerCard.memberIds.has(t.id),toggleMemberAsync:async t=>{await this._provider.toggleCardsMemberAsync([e],t.id,{applyRecurringActionToHead:!0,telemetry:{where:O.a6.TaskLists,by:O.AH.TaskLists}})},resetCheckItems(){this._checkItems=null}};return c()(t,"title",{get:()=>e.title,set:t=>{e.title=t}}),c()(t,"isCompleted",{get:()=>t.hasDates&&e.providerCard.isCompleted}),c()(t,"hasDates",{get:()=>(0,N.qb)(t.start)&&(0,N.qb)(t.end)}),c()(t,"isAllDay",{get:()=>{var r;return this._dirtyCardIsAllDay.has(t.id)?this._dirtyCardIsAllDay.get(t.id):null===(r=e.isAllDay)||void 0===r||r},set:e=>{t.isAllDay!==e&&this._dirtyCardIsAllDay.set(t.id,e)}}),c()(t,"start",{get:()=>this._dirtyCardStart.has(t.id)?this._dirtyCardStart.get(t.id):e.start,set:e=>{e&&!(0,N.rs)(t.start,e)&&this._dirtyCardStart.set(t.id,e)}}),c()(t,"end",{get:()=>this._dirtyCardEnd.has(t.id)?this._dirtyCardEnd.get(t.id):e.end,set:async r=>{if(r&&(!(0,N.rs)(t.end,r)||this._dirtyCardIsAllDay.has(t.id)||this._dirtyCardStart.has(t.id)))try{this._dirtyCardEnd.set(t.id,r),await this._setCalendarCardPropertiesAsync(e,{isAllDay:t.isAllDay,start:t.start,end:r,notifications:t.notifications,isSubscribed:t.isSubscribed})}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardIsAllDay.delete(t.id),this._dirtyCardStart.delete(t.id),this._dirtyCardEnd.delete(t.id)}}}),c()(t,"shortDate",{get:()=>{if(t.hasDates)return(0,N.kC)(t.start,t.end)}}),c()(t,"estimationHours",{get:()=>{let t=e.providerCard.estimationHours;if(t)return`${kendo.toString(t)}h`}}),c()(t,"totalTimeRecordDuration",{get:()=>{let t=e.providerCard.totalTimeRecordDurationHours;if(t)return`${kendo.toString(t)}h`}}),c()(t,"labelsCount",{get:()=>t.labels.length}),c()(t,"labels",{get:()=>{var r,i,a,s;t._labels||(t._labels=n()(r=re()(i=w()(a=n()(s=De()(e.providerCard.labelIds)).call(s,(t=>this._trelloIntegrationSrv.getTrelloLabelById(e.accountId,t)))).call(a,(t=>t&&e.providerCard.boardId===t.boardId))).call(i,N.G4)).call(r,(e=>TaskListsController_objectSpread(TaskListsController_objectSpread({},e),{},{name:e.name||this._$translate.instant(e.color?O.y_[e.color]:"MISC.LABEL_COLOR_NO_COLOR")}))),t._labelIds=null);return t._labels},set:e=>{t._labels=e,t._labelIds=null}}),c()(t,"labelIds",{get:()=>{var e;t._labelIds||(t._labelIds=new(Te())(t.labelsCount>0?n()(e=t.labels).call(e,(e=>{let{id:t}=e;return t})):[$.$d]));return t._labelIds}}),c()(t,"membersCount",{get:()=>t.members.length}),c()(t,"members",{get:()=>{var r,i;t._members||(t._members=n()(r=w()(i=this.currentBoard.members).call(i,(t=>e.providerCard.memberIds.has(t.id)))).call(r,(e=>TaskListsController_objectSpread({},e))));return t._members},set:e=>{t._members=e,t._memberIds=null}}),c()(t,"memberIds",{get:()=>{var e;t._memberIds||(t._memberIds=new(Te())(t.membersCount>0?n()(e=t.members).call(e,(e=>{let{id:t}=e;return t})):[$.$d]));return t._memberIds}}),c()(t,"checkItems",{get:()=>{if(!t._checkItems){var r;let i=this._calendarCardsSrv.getCalendarCardChecklists(e)||[];t._checkItems=re()(r=K()(i).call(i,(t=>{var r,i;return n()(r=w()(i=t.checkItems).call(i,(e=>{switch(this._collectionSettings.global.settings.filters.cardsVisibility){case O.Vh.Completed:return e.isCompleted;case O.Vh.Incompleted:return!e.isCompleted;default:return!0}}))).call(r,(r=>this._convertFromTrelloCheckItem(r,t,e)))}))).call(r,this._compareCardCheckItems),this.isCheckItemCreating(t.id)&&t._checkItems.push(this._convertFromTrelloCheckItem(this._tempCheckItem,void 0,e))}return t._checkItems}}),c()(t,"checkItemCountCompleted",{get:()=>{let e=0;for(let r of t.checkItems)!r.isTempCheckItem&&r.isCompleted&&e++;return e}}),c()(t,"checkItemCountTotal",{get:()=>{let e=0;for(let r of t.checkItems)r.isTempCheckItem||e++;return e}}),c()(t,"hasVisibleCheckItems",{get:()=>t.checkItems.length>0}),c()(t,"isCheckItemsExpanded",{get:()=>{var e,r;if(!t.hasVisibleCheckItems)return!1;return null!==(e=null===(r=this._trelloCollectionSettings.local.taskLists.cards[t.id])||void 0===r?void 0:r.isCheckItemsExpanded)&&void 0!==e&&e},set:e=>{e&&this._checkItemsRenderedCardIds.add(t.id);let r=this._trelloCollectionSettings.local.taskLists.cards,i=r[t.id];delete r[t.id],r[t.id]=TaskListsController_objectSpread(TaskListsController_objectSpread({},i),{},{isCheckItemsExpanded:e}),this._collectionSettings.local.save()}}),c()(t,"isCheckItemsRendered",{get:()=>this._checkItemsRenderedCardIds.has(t.id)}),t.isCheckItemsExpanded&&this._checkItemsRenderedCardIds.add(t.id),t}},{kind:"method",key:"_isTaskListCardVisible",value:function _isTaskListCardVisible(e){var t;return!!e.isTempCard||(!e.hasDates||!this._trelloCollectionSettings.global.taskLists.filters.onlyUnscheduled)&&(!!this._calendarCardsSrv.isCalendarCardVisible(e.calendarCard)||!!ee()(t=e.calendarCard.providerCard.trelloCheckItemCards).call(t,(e=>this._calendarCardsSrv.isCalendarCardVisible(e))))}},{kind:"get",key:"_editCardDialogOpenerContext",value:function _editCardDialogOpenerContext(){return this._editCardDialogOpenerContextLazy||(this._editCardDialogOpenerContextLazy={setupCompactDialogPosition:e=>{switch(this._appCommonSrv.getLayoutOrientation()){case LayoutOrientation.VerticalReverse:e.addPanelPosition(this._$mdPanel.xPosition.OFFSET_START,this._$mdPanel.yPosition.CENTER);break;case LayoutOrientation.Vertical:e.addPanelPosition(this._$mdPanel.xPosition.OFFSET_END,this._$mdPanel.yPosition.CENTER)}},reattachCardElement:e=>{var t;return _()(t=this._$element).call(t,`.pw-tasks-card[data-id="${e.data("id")}"]`)},telemetryWhere:O.a6.TaskLists}),this._editCardDialogOpenerContextLazy}},{kind:"method",key:"_compareCardCheckItems",value:function _compareCardCheckItems(e,t){let r=(0,N.Fo)(e.checklist,t.checklist);return 0===r&&(r=(0,N.ke)(e,t)),r}},{kind:"method",key:"_isCheckItemValid",value:function _isCheckItemValid(e){var t;return!(null==e||null===(t=e.name)||void 0===t||!Pe()(t).call(t))}},{kind:"method",key:"_convertFromTrelloCheckItem",value:function _convertFromTrelloCheckItem(e,t,r){let i=TaskListsController_objectSpread(TaskListsController_objectSpread({},e),{},{checklist:t,cardId:r.id,accountType:se.Qm.Trello,accountId:r.accountId,calendarId:r.calendarId,cardType:se.eT.TrelloCheckItem,cardRole:se.D.Card,listId:r.providerCard.listId,changeDates:(e,t,a,s)=>{if(i.isAllDay!==e||!(0,N.rs)(i.start,t)||!(0,N.rs)(i.end,a))if(this._licenseSrv.checkPaidFeatureAvailable(O.ZV.AdvancedChecklists,!0))if(i.isTempCheckItem)i.isAllDay=e,i.start=t,i.end=a;else{let s,n;if(i.hasDates)if(i.isAllDay!==e)s=e?O.cN.CardEvents.CheckItemIsAllDaySet:O.cN.CardEvents.CheckItemIsAllDayUnset;else if((0,N.rs)(i.start,t)){if((0,N.rs)(i.end,a))return;s=O.cN.CardEvents.CheckItemEndChanged}else s=O.cN.CardEvents.CheckItemStartChanged;else s=O.cN.CardEvents.Scheduled,n={cardType:se.eT.TrelloCheckItem,cardRole:se.D.Card,isAllDay:e,start:t,end:a,by:O.AH.HotAction};this._logCalendarCardEvent(r,{event:s,data:n}),i.isAllDay=e,i.start=t,i.end=a}else s(i.isAllDay,i.start,i.end)},removeDatesAsync:async()=>{if(i.hasDates)try{i.isTempCheckItem?(e.isAllDay=null,e.start=null,e.end=null):(this._logCalendarCardEvent(r,{event:O.cN.CardEvents.CheckItemDatesRemoved}),this._dirtyCardCheckItemStart.set(i.id,null),this._dirtyCardCheckItemEnd.set(i.id,null),i.isTempCheckItem||await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(r,i.checklist.id,i.id,{isAllDay:null,start:null,end:null}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemStart.delete(i.id),this._dirtyCardCheckItemEnd.delete(i.id)}},isMemberSelected:t=>{let r=this._dirtyCardCheckItemMembers.has(i.id)?this._dirtyCardCheckItemMembers.get(i.id):e.memberIds;return Z()(r).call(r,t.id)},toggleMemberAsync:async t=>{var a;if(!Z()(a=e.memberIds).call(a,t.id)&&!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.AdvancedChecklists,!0))return!1;try{if(i.isTempCheckItem){var s;e.memberIds=Z()(s=e.memberIds).call(s,t.id)?[]:[t.id],this.submitCheckItemCreatingAsync()}else{let a=this._dirtyCardCheckItemMembers.has(i.id)?this._dirtyCardCheckItemMembers.get(i.id):e.memberIds;Z()(a).call(a,t.id)?(a=[],this._logCalendarCardEvent(r,{event:O.cN.CardEvents.CheckItemMemberUnassigned})):(a=[t.id],this._logCalendarCardEvent(r,{event:O.cN.CardEvents.CheckItemMemberAssigned})),this._dirtyCardCheckItemMembers.set(i.id,a),i._checkItemMembers=null,await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(r,i.checklist.id,i.id,{memberIds:a})}}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{var n;if(this._dirtyCardCheckItemMembers.delete(i.id),i._checkItemMembers=null,i.isTempCheckItem)null===(n=this._taskListsMap.get(this._tempCheckItem.listId))||void 0===n||n.resetCards()}}});return c()(i,"isTempCheckItem",{get:()=>e===this._tempCheckItem}),c()(i,"isBusy",{get:()=>this.isAddCheckItemBusy&&(i.isTempCheckItem||!i.checklist)}),c()(i,"isCompleted",{get:()=>this._dirtyCardCheckItemCompleted.has(i.id)?this._dirtyCardCheckItemCompleted.get(i.id):e.isCompleted,set:async e=>{if(i.isCompleted!==e)try{this._logCalendarCardEvent(r,{event:e?O.cN.CardEvents.CheckItemMarkedCompleted:O.cN.CardEvents.CheckItemMarkedIncompleted}),this._dirtyCardCheckItemCompleted.set(i.id,e),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(r,i.checklist.id,i.id,{isCompleted:e})}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemCompleted.delete(i.id)}}}),c()(i,"name",{get:()=>this._dirtyCardCheckItemNames.has(i.id)?this._dirtyCardCheckItemNames.get(i.id):e.name,set:async t=>{if((t||i.isTempCheckItem)&&i.name!==t)try{i.isTempCheckItem?e.name=t:(this._logCalendarCardEvent(r,{event:O.cN.CardEvents.CheckItemNameChanged}),this._hasChanges=!0,this._dirtyCardCheckItemNames.set(i.id,t),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(r,i.checklist.id,i.id,{name:t}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{this._dirtyCardCheckItemNames.delete(i.id)}}}),c()(i,"hasDates",{get:()=>(0,N.qb)(i.start)&&(0,N.qb)(i.end)}),c()(i,"isAllDay",{get:()=>{var t;return this._dirtyCardCheckItemIsAllDay.has(i.id)?this._dirtyCardCheckItemIsAllDay.get(i.id):null===(t=e.isAllDay)||void 0===t||t},set:e=>{i.isAllDay!==e&&this._dirtyCardCheckItemIsAllDay.set(i.id,e)}}),c()(i,"start",{get:()=>this._dirtyCardCheckItemStart.has(i.id)?this._dirtyCardCheckItemStart.get(i.id):e.start,set:e=>{e&&!(0,N.rs)(i.start,e)&&this._dirtyCardCheckItemStart.set(i.id,e)}}),c()(i,"end",{get:()=>this._dirtyCardCheckItemEnd.has(i.id)?this._dirtyCardCheckItemEnd.get(i.id):e.end,set:async t=>{if(t&&(!(0,N.rs)(i.end,t)||this._dirtyCardCheckItemIsAllDay.has(i.id)||this._dirtyCardCheckItemStart.has(i.id)))try{i.isTempCheckItem?(e.isAllDay=i.isAllDay,e.start=i.start,e.end=t,this.submitCheckItemCreatingAsync()):(this._dirtyCardCheckItemEnd.set(i.id,t),await this._calendarCardsSrv.updateCalendarCardCheckItemAsync(r,i.checklist.id,i.id,{isAllDay:i.isAllDay,start:i.start,end:t}))}catch(e){this._$log.error("Planyway card updating error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),O.k$.Error)}finally{var a;if(this._dirtyCardCheckItemIsAllDay.delete(i.id),this._dirtyCardCheckItemStart.delete(i.id),this._dirtyCardCheckItemEnd.delete(i.id),i.isTempCheckItem)null===(a=this._taskListsMap.get(this._tempCheckItem.listId))||void 0===a||a.resetCards()}}}),c()(i,"shortDate",{get:()=>{if(i.hasDates)return(0,N.kC)(i.start,i.end)}}),c()(i,"membersCount",{get:()=>(this._dirtyCardCheckItemMembers.has(i.id)?this._dirtyCardCheckItemMembers.get(i.id):e.memberIds).length}),c()(i,"members",{get:()=>{if(!i._checkItemMembers){var t,r;let a=this._dirtyCardCheckItemMembers.has(i.id)?this._dirtyCardCheckItemMembers.get(i.id):e.memberIds;i._checkItemMembers=n()(t=w()(r=this.currentBoard.members).call(r,(e=>Z()(a).call(a,e.id)))).call(t,(e=>TaskListsController_objectSpread({},e)))}return i._checkItemMembers}}),i}}]}}));var nr=r(96115),or=r.n(nr);function WorkPanelController_getDecoratorsApi(){WorkPanelController_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!WorkPanelController_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=WorkPanelController_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:WorkPanelController_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=WorkPanelController_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function WorkPanelController_createElementDescriptor(e){var t,r=WorkPanelController_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function WorkPanelController_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function WorkPanelController_hasDecorators(e){return e.decorators&&e.decorators.length}function WorkPanelController_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function WorkPanelController_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function WorkPanelController_toPropertyKey(e){var t=function WorkPanelController_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const lr="toggleExpand";let dr=function WorkPanelController_decorate(e,t,r,i){var a,s=WorkPanelController_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function WorkPanelController_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(WorkPanelController_isDataDescriptor(a.descriptor)||WorkPanelController_isDataDescriptor(i.descriptor)){if(WorkPanelController_hasDecorators(a)||WorkPanelController_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(WorkPanelController_hasDecorators(a)){if(WorkPanelController_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}WorkPanelController_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,WorkPanelController_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,N.SG)(["$rootScope","$scope","$log","$translate","appCommonSrv","collectionSrv","dialogSrv","licenseSrv","notificationSrv","planywayIntegrationSrv","platformSrv","reportSrv","settingsSrv","telemetrySrv","trelloIntegrationSrv"])],(function(e){return{F:class WorkPanelController{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p,m,C){e(this),this._$rootScope=t,this._$scope=r,this._$log=i,this._$translate=a,this._appCommonSrv=s,this._collectionSrv=n,this._dialogSrv=o,this._licenseSrv=l,this._notificationSrv=d,this._planywayIntegrationSrv=c,this._platformSrv=h,this._reportSrv=u,this._settingsSrv=p,this._telemetrySrv=m,this._trelloIntegrationSrv=C;const reloadSelectedBoards=()=>{this._currentBoard=null,this._isTaskListsAvailable=void 0,this._isCreateBoardCalloutAvailable=!0,this._isAddBoardCalloutAvailable=!1;for(let e of this._provider.getCurrentCollectionConnectedAccounts()){if(!this._provider.isCurrentCollectionAccountReady(e.accountId)){this._isCreateBoardCalloutAvailable=!1,this._isAddBoardCalloutAvailable=!1;break}this._trelloIntegrationSrv.getTrelloBoards(e.accountId).length>0&&(this._isCreateBoardCalloutAvailable=!1,this._isAddBoardCalloutAvailable=!0)}};reloadSelectedBoards(),this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",reloadSelectedBoards),this._trelloIntegrationSrv.addTrelloBoardEventListener("deleted",reloadSelectedBoards),this._$scope.$on(O.FK.CollectionAccountReady,reloadSelectedBoards),this._$scope.$on(O.FK.CollectionChanged,reloadSelectedBoards),this._$scope.$on(O.FK.CalendarsChanged,reloadSelectedBoards),this._$scope.$on(O.FK.TrelloBoardSelectionChanged,reloadSelectedBoards);const onSourceChanged=()=>{this._availableTaskListsViews=null,this._availableTaskListViewModes=null};this._$scope.$on(O.FK.CollectionChanging,onSourceChanged),this._$scope.$on(O.FK.ChangeSchedulerViewRequested,onSourceChanged),this._$scope.$on(O.FK.AccountAdded,onSourceChanged),this._$scope.$on(O.FK.AccountDeleted,onSourceChanged),this._$scope.$on("$destroy",(()=>{this._trelloIntegrationSrv.removeTrelloBoardEventListener("updated",reloadSelectedBoards),this._trelloIntegrationSrv.removeTrelloBoardEventListener("deleted",reloadSelectedBoards)}))}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloWorkPanelCtrl"}},{kind:"field",key:"_provider",value:()=>(0,B.VH)(O.lP.Trello)},{kind:"get",key:"isTaskListsAvailable",value:function isTaskListsAvailable(){return void 0===this._isTaskListsAvailable&&(this._isTaskListsAvailable=this._provider.hasCurrentCollectionSelectedCalendars()),this._isTaskListsAvailable}},{kind:"get",key:"isCreateBoardCalloutAvailable",value:function isCreateBoardCalloutAvailable(){return this._isCreateBoardCalloutAvailable}},{kind:"get",key:"isAddBoardCalloutAvailable",value:function isAddBoardCalloutAvailable(){return this._isAddBoardCalloutAvailable}},{kind:"get",key:"calloutImageUrl",value:function calloutImageUrl(){return this._calloutImageUrl||(this._calloutImageUrl=this._platformSrv.getPlatformUrl(or())),this._calloutImageUrl}},{kind:"get",key:"currentBoard",value:function currentBoard(){if(!this._currentBoard){var e;let t=this._trelloCollectionSettings.global.taskLists.boardId,r=K()(e=this._provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{var t;return n()(t=this._provider.getCurrentCollectionSelectedCalendarIds(e)).call(t,(t=>({accountId:e,id:t})))})),i=_()(r).call(r,(e=>e.id===t))||r[0];this.currentBoard=this._trelloIntegrationSrv.getTrelloBoardById(i.accountId,i.id)}return this._currentBoard}},{kind:"set",key:"currentBoard",value:function currentBoard(e){if(this._currentBoard===e)return;let t=this._currentBoard&&e;this._currentBoard=e,t&&(this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.TaskListsBoardSwitched),this._trelloCollectionSettings.global.taskLists.boardId=this._currentBoard.id,this._collectionSettings.global.saveAsync(),this._$rootScope.$broadcast(O.FK.TaskListsBoardChanged))}},{kind:"method",key:"addBoardToCollectionAsync",value:async function addBoardToCollectionAsync(e){let t=this._provider.getCurrentCollectionConnectedAccounts(),r=_()(t).call(t,(e=>e.isPrimary))||t[0];this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionAddCalendarDialogOpened,{accountType:r.accountType,where:O.Zz.TaskLists});let i=await this._dialogSrv.showManageAccountCalendarsDialogAsync(r,e);i?(this._$rootScope.$broadcast(O.FK.CalendarsChanging,r),i.connectedCalendarIds.length>0&&this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarAdded,{accountType:r.accountType,count:i.connectedCalendarIds.length}),i.disconnectedCalendarIds.length>0&&this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarRemoved,{accountType:r.accountType,count:i.disconnectedCalendarIds.length})):this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionAddCalendarDialogClosed,{accountType:r.accountType,where:O.Zz.TaskLists})}},{kind:"method",key:"createBoardAsync",value:async function createBoardAsync(e){let t=this._provider.getCurrentCollectionConnectedAccounts(),r=_()(t).call(t,(e=>e.isPrimary))||t[0];this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.CreateBoardDialogOpened,{where:O.bs.TaskLists}),await this._dialogSrv.showBoardDialogAsync(e,{account:r})||this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.CreateBoardDialogClosed,{where:O.bs.TaskLists})}},{kind:"get",key:"setCalendarHandler",value:function setCalendarHandler(){return this._setCalendarHandler||(this._setCalendarHandler=e=>this.currentBoard=e),this._setCalendarHandler}},{kind:"method",key:"isToolbarButtonAvailable",value:function isToolbarButtonAvailable(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ee()(t).call(t,(e=>e!==lr))}},{kind:"get",key:"isBoardMode",value:function isBoardMode(){return this._appCommonSrv.getSchedulerMode(!0)===O.ud.Board}},{kind:"get",key:"taskListsView",value:function taskListsView(){return this._trelloCollectionSettings.global.taskLists.view}},{kind:"get",key:"availableTaskListsViews",value:function availableTaskListsViews(){return this._availableTaskListsViews||(this._availableTaskListsViews=[{value:O.cT.Kanban,icon:"kanban-outline",title:"MISC.KANBAN"},{value:O.cT.List,icon:"list-outline",title:"MISC.LIST"}]),this._availableTaskListsViews}},{kind:"get",key:"selectedTaskListsView",value:function selectedTaskListsView(){var e;return _()(e=this.availableTaskListsViews).call(e,(e=>e.value===this.taskListsView))}},{kind:"set",key:"selectedTaskListsView",value:function selectedTaskListsView(e){this.selectedTaskListsView!==e.value&&(this._availableTaskListViewModes=null,this._trelloCollectionSettings.global.taskLists.view=e.value,this._collectionSettings.global.saveAsync(),this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.TaskListsViewModeChanged,{taskListsView:e.value}),this._$rootScope.$broadcast(O.FK.TaskListsViewChanged))}},{kind:"method",key:"onViewMenuOpen",value:function onViewMenuOpen(){this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.TaskListsViewModeMenuOpened)}},{kind:"get",key:"taskListsViewMode",value:function taskListsViewMode(){let taskListsViewMode=this._trelloCollectionSettings.global.taskLists.viewSettings[this.taskListsView].mode,e=O.or[taskListsViewMode];if(e&&!this._licenseSrv.checkPaidFeatureAvailable(e,!1))switch(this.taskListsView){case O.cT.Kanban:return O.e_.None;case O.cT.List:return O.e_.List}return taskListsViewMode}},{kind:"get",key:"availableTaskListViewModes",value:function availableTaskListViewModes(){if(!this._availableTaskListViewModes){switch(this.taskListsView){case O.cT.Kanban:this._availableTaskListViewModes=[{value:O.e_.Member,icon:"icons-16:timeline-members-outline",title:this._$translate.instant("MENU.MEMBER")},{value:O.e_.Label,icon:"icons-16:timeline-labels-outline",title:this._$translate.instant("MENU.LABEL")},{value:O.e_.None,icon:"icons-16:timeline-no-grouping-outline",title:this._$translate.instant("MENU.NO_GROUPING")}];break;case O.cT.List:this._availableTaskListViewModes=[{value:O.e_.Member,icon:"icons-16:timeline-members-outline",title:this._$translate.instant("MENU.MEMBER")},{value:O.e_.Label,icon:"icons-16:timeline-labels-outline",title:this._$translate.instant("MENU.LABEL")},{value:O.e_.List,icon:"icons-16:timeline-lists-outline",title:this._$translate.instant("MENU.LIST")}]}for(let e of this._availableTaskListViewModes)e.subtitle=this._$translate.instant("MENU.GROUP_BY")}return this._availableTaskListViewModes}},{kind:"get",key:"selectedTaskListViewMode",value:function selectedTaskListViewMode(){var e;return null===(e=this.availableTaskListViewModes)||void 0===e?void 0:_()(e).call(e,(e=>e.value===this.taskListsViewMode))}},{kind:"set",key:"selectedTaskListViewMode",value:function selectedTaskListViewMode(e){if(this.selectedTaskListViewMode===e)return;let t=O.or[e.value];t&&!this._licenseSrv.checkPaidFeatureAvailable(t,!0)||(this._trelloCollectionSettings.global.taskLists.viewSettings[this.taskListsView].mode=e.value,this._$rootScope.$broadcast(O.FK.TaskListsViewChanged),this._collectionSettings.global.saveAsync(),this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.ViewModeChanged,{where:O.gV.TaskListToolbar}))}},{kind:"method",key:"onViewModeMenuOpen",value:function onViewModeMenuOpen(){this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.ViewModeMenuOpened,{where:O.gV.TaskListToolbar})}},{kind:"get",key:"isOnlyUnscheduledShown",value:function isOnlyUnscheduledShown(){return this._trelloCollectionSettings.global.taskLists.filters.onlyUnscheduled}},{kind:"set",key:"isOnlyUnscheduledShown",value:function isOnlyUnscheduledShown(e){this.isOnlyUnscheduledShown!==e&&(this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.TaskListsFiltersChanged,{taskListsOnlyUnscheduled:e}),this._trelloCollectionSettings.global.taskLists.filters.onlyUnscheduled=e,this._collectionSettings.global.saveAsync(),this._$scope.$broadcast(O.FK.FiltersChanged))}},{kind:"method",key:"exportAsync",value:async function exportAsync(e){var t;if(!this._licenseSrv.checkPaidFeatureAvailable(O.ZV.ExportToFile,!0))return;this._telemetrySrv.logSessionEvent(O.cN.GeneralEvents.ReportBuilt,{type:O.C2.BoardCards,fileType:e});const r=_()(t=this._reportSrv.availableReports).call(t,(e=>e.type===O.C2.BoardCards));await r.buildAsync(e,{calendarId:this.currentBoard.id,isOnlyUnscheduledShown:this.isOnlyUnscheduledShown})}},{kind:"method",key:"showShareBoardDialogAsync",value:function showShareBoardDialogAsync(e){this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.MembersDialogOpened,{where:O.JM.Toolbar}),this._dialogSrv.showBoardShareDialogAsync({accountId:e.accountId,trelloBoard:e,where:O.JM.Toolbar})}},{kind:"method",key:"canEditBoard",value:function canEditBoard(e){return!e.isReadOnly}},{kind:"method",key:"editBoardAsync",value:async function editBoardAsync(e,t){var r;if(!t.isDataLoaded)try{this._appCommonSrv.setSchedulerBusy(!0),await this._trelloIntegrationSrv.loadBoardDataAsync(t.accountId,t.id),t=this._trelloIntegrationSrv.getTrelloBoardById(t.accountId,t.id)}finally{this._appCommonSrv.setSchedulerBusy(!1)}this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.EditBoardDialogOpened,{where:O.bs.Toolbar}),await this._dialogSrv.showBoardDialogAsync(e,{account:_()(r=this._provider.getCurrentCollectionConnectedAccounts()).call(r,(e=>e.accountId===this.currentBoard.accountId)),board:t})||this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.EditBoardDialogClosed,{where:O.bs.Toolbar})}},{kind:"method",key:"canStartGoogleSync",value:function canStartGoogleSync(e){if(!Xt()(this._settingsSrv).connect)return!1;if(e.isReadOnly)return!1;let t=this._trelloIntegrationSrv.getGoogleSyncStatus(e.accountId,e.id);return t&&t===se.wR.NotSynced}},{kind:"method",key:"isGoogleSyncBusy",value:function isGoogleSyncBusy(e){return this._trelloIntegrationSrv.isGoogleSyncBusy(e.accountId,e.id)}},{kind:"method",key:"canRestartGoogleSync",value:function canRestartGoogleSync(e){if(!Xt()(this._settingsSrv).connect)return!1;if(e.isReadOnly)return!1;let t=this._trelloIntegrationSrv.getGoogleSyncStatus(e.accountId,e.id);return t&&t!==se.wR.NotSynced&&t!==se.wR.Ok}},{kind:"method",key:"startGoogleSyncAsync",value:async function startGoogleSyncAsync(e){this.canStartGoogleSync(e)&&!this.isGoogleSyncBusy(e)&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.GoogleSync,!0)&&(this._telemetrySrv.logSessionEvent(O.cN.GoogleSyncEvents.SyncWithGoogleEnableGoogleSyncClicked,{where:O.MJ.BoardMenu}),await this._dialogSrv.showGoogleSyncStartDialogAsync(e.accountId,e.id))}},{kind:"method",key:"restartGoogleSyncAsync",value:async function restartGoogleSyncAsync(e){this.canRestartGoogleSync(e)&&!this.isGoogleSyncBusy(e)&&this._licenseSrv.checkPaidFeatureAvailable(O.ZV.GoogleSync,!0)&&(await this._trelloIntegrationSrv.stopGoogleSyncAsync(e.accountId,e.id),await this._dialogSrv.showGoogleSyncStartDialogAsync(e.accountId,e.id))}},{kind:"method",key:"canStopGoogleSync",value:function canStopGoogleSync(e){if(!Xt()(this._settingsSrv).connect)return!1;let t=this._trelloIntegrationSrv.getGoogleSyncStatus(e.accountId,e.id);return t&&t!==se.wR.NotSynced}},{kind:"method",key:"stopGoogleSyncAsync",value:async function stopGoogleSyncAsync(e){if(!this.canStopGoogleSync(e)||this.isGoogleSyncBusy(e))return;await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.GOOGLE_SYNC_STOP_TITLE"),this._$translate.instant("DIALOGS.GOOGLE_SYNC_STOP_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.YES"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]})&&await this._trelloIntegrationSrv.stopGoogleSyncAsync(e.accountId,e.id)}},{kind:"get",key:"canExportByUrl",value:function canExportByUrl(){return Xt()(this._settingsSrv).connect}},{kind:"method",key:"exportByUrlAsync",value:function exportByUrlAsync(e){this._dialogSrv.showExportDialogAsync(e)}},{kind:"get",key:"canRemoveBoardFromCollection",value:function canRemoveBoardFromCollection(){return!this._collectionSrv.isCurrentCollectionReadOnly}},{kind:"method",key:"removeBoardFromCollection",value:function removeBoardFromCollection(e){var t;let r=_()(t=this._provider.getCurrentCollectionConnectedAccounts()).call(t,(t=>t.accountId===e.accountId)),i=this._provider.getCurrentCollectionConnectedCalendar(r.accountId,e.id);i.isConnected=!1,this._provider.setCurrentCollectionConnectedCalendars(r.accountId,[i]),this._$rootScope.$broadcast(O.FK.CalendarsChanging,r),this._telemetrySrv.logSessionEvent(O.cN.CollectionEvents.CollectionCalendarRemoved,{accountType:se.Qm.Trello,count:1})}},{kind:"method",key:"canRemoveBoard",value:function canRemoveBoard(e){var t;if(e.isReadOnly)return!1;let{trelloMemberId:r}=this._planywayIntegrationSrv.getConnectedAccountById(e.accountId);return(null===(t=e.memberships.get(r))||void 0===t?void 0:t.memberType)===O.IM.Admin}},{kind:"method",key:"removeBoardAsync",value:async function removeBoardAsync(e){if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.REMOVE_TRELLO_BOARD_TITLE"),this._$translate.instant("DIALOGS.REMOVE_TRELLO_BOARD_CONFIRM"),{buttons:[{text:this._$translate.instant("BUTTONS.YES"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this._appCommonSrv.setSchedulerBusy(!0),await this._trelloIntegrationSrv.closeTrelloBoardAsync(e.accountId,e.id),this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.BoardRemoved,{where:O.bs.TaskLists}),this._boards=null,this._notifyTrelloBoardsSelectionChanged()}catch(e){this._$log.error("Trello remove board error:"),this._$log.error(e),this._telemetrySrv.logError("Trello remove board error",e,{class:this.constructor.name,method:this.removeBoardAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.REMOVE_BOARD_ERROR"),O.k$.Error)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"expandWorkPanel",value:function expandWorkPanel(){this._appCommonSrv.setExpandedLayoutPanel(O.sF.WorkPanel),this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.LayoutPanelExpanded,{expandedLayoutPanel:O.sF.WorkPanel,by:O.UR.ToolbarButton})}},{kind:"method",key:"collapseWorkPanel",value:function collapseWorkPanel(){this._appCommonSrv.setExpandedLayoutPanel(null),this._telemetrySrv.logSessionEvent(O.cN.CalendarEvents.LayoutPanelCollapsed,{collapsedLayoutPanel:O.sF.WorkPanel,by:O.UR.ToolbarButton})}},{kind:"get",key:"isWorkPanelExpanded",value:function isWorkPanelExpanded(){return this._appCommonSrv.getExpandedLayoutPanel()===O.sF.WorkPanel}},{kind:"get",key:"isWorkPanelWidthCompact",value:function isWorkPanelWidthCompact(){return this._isWorkPanelWidthCompact}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[O.lP.Trello],global:this._collectionSettings.global.settings.provider[O.lP.Trello]}}},{kind:"method",key:"_notifyTrelloBoardsSelectionChanged",value:function _notifyTrelloBoardsSelectionChanged(){this._$rootScope.$broadcast(O.FK.CardsReloaded),this._$rootScope.$broadcast(O.FK.TrelloBoardSelectionChanged),this._$rootScope.$broadcast(O.FK.ChangeSchedulerViewRequested),this._$rootScope.$broadcast(O.FK.WorkPanelReloaded);for(let e of[O.y.Calendars,O.y.Labels,O.y.Lists,O.y.Members])this._$rootScope.$broadcast(O.FK.TimelineResourcesReloaded,{resourcesType:e})}}]}}));var cr=r(18752),hr=r.n(cr);function CalendarIconDirective_getDecoratorsApi(){CalendarIconDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CalendarIconDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CalendarIconDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CalendarIconDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CalendarIconDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CalendarIconDirective_createElementDescriptor(e){var t,r=CalendarIconDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CalendarIconDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CalendarIconDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function CalendarIconDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CalendarIconDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CalendarIconDirective_toPropertyKey(e){var t=function CalendarIconDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let ur=function CalendarIconDirective_decorate(e,t,r,i){var a,s=CalendarIconDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CalendarIconDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CalendarIconDirective_isDataDescriptor(a.descriptor)||CalendarIconDirective_isDataDescriptor(i.descriptor)){if(CalendarIconDirective_hasDecorators(a)||CalendarIconDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CalendarIconDirective_hasDecorators(a)){if(CalendarIconDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CalendarIconDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CalendarIconDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class CalendarIconDirective{constructor(){e(this),this.templateUrl=hr(),this.restrict="E",this.controller=z.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={calendarId:"@",accountId:"@",_iconSize:"@?iconSize",_showAbbreviation:"@?showAbbreviation"}}}return{F:CalendarIconDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloBoardIcon"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new CalendarIconDirective}}]}}));var pr=r(11673),mr=r.n(pr);function CalendarPickerDirective_getDecoratorsApi(){CalendarPickerDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CalendarPickerDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CalendarPickerDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CalendarPickerDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CalendarPickerDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CalendarPickerDirective_createElementDescriptor(e){var t,r=CalendarPickerDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CalendarPickerDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CalendarPickerDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function CalendarPickerDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CalendarPickerDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CalendarPickerDirective_toPropertyKey(e){var t=function CalendarPickerDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Cr=function CalendarPickerDirective_decorate(e,t,r,i){var a,s=CalendarPickerDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CalendarPickerDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CalendarPickerDirective_isDataDescriptor(a.descriptor)||CalendarPickerDirective_isDataDescriptor(i.descriptor)){if(CalendarPickerDirective_hasDecorators(a)||CalendarPickerDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CalendarPickerDirective_hasDecorators(a)){if(CalendarPickerDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CalendarPickerDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CalendarPickerDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class CalendarPickerDirective{constructor(){e(this),this.templateUrl=mr(),this.restrict="E",this.controller=Q.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={account:"<",calendars:"=",filterText:"<"}}}return{F:CalendarPickerDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloCalendarsPicker"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new CalendarPickerDirective}}]}}));var vr=r(70527),fr=r.n(vr);function CardContextMenuDirective_getDecoratorsApi(){CardContextMenuDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!CardContextMenuDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=CardContextMenuDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:CardContextMenuDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=CardContextMenuDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function CardContextMenuDirective_createElementDescriptor(e){var t,r=CardContextMenuDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function CardContextMenuDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function CardContextMenuDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function CardContextMenuDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function CardContextMenuDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function CardContextMenuDirective_toPropertyKey(e){var t=function CardContextMenuDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let yr=function CardContextMenuDirective_decorate(e,t,r,i){var a,s=CardContextMenuDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function CardContextMenuDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(CardContextMenuDirective_isDataDescriptor(a.descriptor)||CardContextMenuDirective_isDataDescriptor(i.descriptor)){if(CardContextMenuDirective_hasDecorators(a)||CardContextMenuDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(CardContextMenuDirective_hasDecorators(a)){if(CardContextMenuDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}CardContextMenuDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,CardContextMenuDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class CardContextMenuDirective{constructor(){e(this),this.templateUrl=fr(),this.restrict="E",this.controller=ge.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={onSetContextMenu:"<",_source:"<source"}}}return{F:CardContextMenuDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloCardContextMenu"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new CardContextMenuDirective}}]}}));var gr=r(12372),_r=r.n(gr);class CardEditorDirective{static get directiveName(){return"pwTrelloCardEditor"}static create(){return new CardEditorDirective}constructor(){this.templateUrl=_r(),this.restrict="E",this.controller=xt.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={calendarCard:"<",cardTypes:"<?",isDetailed:"<?",isDense:"<?",hasChanges:"<?",_forceDetailedMode:"<forceDetailedMode",_dialogOpenerContext:"<dialogOpenerContext",_scrollToCommentId:"<scrollToCommentId"}}link(e){e.$ctrl.initialize()}}var kr=r(98605),br=r.n(kr);function MainToolbarFiltersMenuDirective_getDecoratorsApi(){MainToolbarFiltersMenuDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!MainToolbarFiltersMenuDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=MainToolbarFiltersMenuDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:MainToolbarFiltersMenuDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=MainToolbarFiltersMenuDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function MainToolbarFiltersMenuDirective_createElementDescriptor(e){var t,r=MainToolbarFiltersMenuDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function MainToolbarFiltersMenuDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function MainToolbarFiltersMenuDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function MainToolbarFiltersMenuDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function MainToolbarFiltersMenuDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function MainToolbarFiltersMenuDirective_toPropertyKey(e){var t=function MainToolbarFiltersMenuDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Tr=function MainToolbarFiltersMenuDirective_decorate(e,t,r,i){var a,s=MainToolbarFiltersMenuDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function MainToolbarFiltersMenuDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(MainToolbarFiltersMenuDirective_isDataDescriptor(a.descriptor)||MainToolbarFiltersMenuDirective_isDataDescriptor(i.descriptor)){if(MainToolbarFiltersMenuDirective_hasDecorators(a)||MainToolbarFiltersMenuDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(MainToolbarFiltersMenuDirective_hasDecorators(a)){if(MainToolbarFiltersMenuDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}MainToolbarFiltersMenuDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,MainToolbarFiltersMenuDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class MainToolbarFiltersMenuDirective{constructor(){e(this),this.templateUrl=br(),this.restrict="E",this.controller=Ht.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={filtersMenuOpened:"<",filtersSearchString:"<",_registerFilterProvider:"&registerFilterProvider"}}}return{F:MainToolbarFiltersMenuDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloMainToolbarFiltersMenu"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new MainToolbarFiltersMenuDirective}}]}}));var Sr=r(75341),Ir=r.n(Sr);function MainToolbarRightDirective_getDecoratorsApi(){MainToolbarRightDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!MainToolbarRightDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=MainToolbarRightDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:MainToolbarRightDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=MainToolbarRightDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function MainToolbarRightDirective_createElementDescriptor(e){var t,r=MainToolbarRightDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function MainToolbarRightDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function MainToolbarRightDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function MainToolbarRightDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function MainToolbarRightDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function MainToolbarRightDirective_toPropertyKey(e){var t=function MainToolbarRightDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let wr=function MainToolbarRightDirective_decorate(e,t,r,i){var a,s=MainToolbarRightDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function MainToolbarRightDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(MainToolbarRightDirective_isDataDescriptor(a.descriptor)||MainToolbarRightDirective_isDataDescriptor(i.descriptor)){if(MainToolbarRightDirective_hasDecorators(a)||MainToolbarRightDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(MainToolbarRightDirective_hasDecorators(a)){if(MainToolbarRightDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}MainToolbarRightDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,MainToolbarRightDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class MainToolbarRightDirective{constructor(){e(this),this.templateUrl=Ir(),this.restrict="E",this.controller=Zt.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={}}}return{F:MainToolbarRightDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloMainToolbarRight"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new MainToolbarRightDirective}}]}}));var Dr=r(28472),Er=r.n(Dr);class MembersPanelDirective{static get directiveName(){return"pwTrelloMembersPanel"}static create(){return new MembersPanelDirective}constructor(){this.templateUrl=Er(),this.restrict="E",this.controller=Wt.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={board:"<"}}}var Ar=r(46033),Lr=r.n(Ar);function SchedulerToolbarViewSettingsMenuDirective_getDecoratorsApi(){SchedulerToolbarViewSettingsMenuDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!SchedulerToolbarViewSettingsMenuDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=SchedulerToolbarViewSettingsMenuDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:SchedulerToolbarViewSettingsMenuDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=SchedulerToolbarViewSettingsMenuDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function SchedulerToolbarViewSettingsMenuDirective_createElementDescriptor(e){var t,r=SchedulerToolbarViewSettingsMenuDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function SchedulerToolbarViewSettingsMenuDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function SchedulerToolbarViewSettingsMenuDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function SchedulerToolbarViewSettingsMenuDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function SchedulerToolbarViewSettingsMenuDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function SchedulerToolbarViewSettingsMenuDirective_toPropertyKey(e){var t=function SchedulerToolbarViewSettingsMenuDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Rr=function SchedulerToolbarViewSettingsMenuDirective_decorate(e,t,r,i){var a,s=SchedulerToolbarViewSettingsMenuDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function SchedulerToolbarViewSettingsMenuDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(SchedulerToolbarViewSettingsMenuDirective_isDataDescriptor(a.descriptor)||SchedulerToolbarViewSettingsMenuDirective_isDataDescriptor(i.descriptor)){if(SchedulerToolbarViewSettingsMenuDirective_hasDecorators(a)||SchedulerToolbarViewSettingsMenuDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(SchedulerToolbarViewSettingsMenuDirective_hasDecorators(a)){if(SchedulerToolbarViewSettingsMenuDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}SchedulerToolbarViewSettingsMenuDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,SchedulerToolbarViewSettingsMenuDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class SchedulerToolbarViewSettingsMenuDirective{constructor(){e(this),this.templateUrl=Lr(),this.restrict="E",this.controller=Yt.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={}}}return{F:SchedulerToolbarViewSettingsMenuDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloSchedulerToolbarViewSettingsMenu"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new SchedulerToolbarViewSettingsMenuDirective}}]}}));var xr=r(64991),Pr=r.n(xr);function SidebarPanelDirective_getDecoratorsApi(){SidebarPanelDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!SidebarPanelDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=SidebarPanelDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:SidebarPanelDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=SidebarPanelDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function SidebarPanelDirective_createElementDescriptor(e){var t,r=SidebarPanelDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function SidebarPanelDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function SidebarPanelDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function SidebarPanelDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function SidebarPanelDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function SidebarPanelDirective_toPropertyKey(e){var t=function SidebarPanelDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Mr=function SidebarPanelDirective_decorate(e,t,r,i){var a,s=SidebarPanelDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function SidebarPanelDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(SidebarPanelDirective_isDataDescriptor(a.descriptor)||SidebarPanelDirective_isDataDescriptor(i.descriptor)){if(SidebarPanelDirective_hasDecorators(a)||SidebarPanelDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(SidebarPanelDirective_hasDecorators(a)){if(SidebarPanelDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}SidebarPanelDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,SidebarPanelDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class SidebarPanelDirective{constructor(){e(this),this.templateUrl=Pr(),this.restrict="E",this.controller=Qt.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={}}}return{F:SidebarPanelDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloSidebarPanel"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new SidebarPanelDirective}}]}}));var Br=r(5466),Or=r.n(Br);function TaskListCardDirective_getDecoratorsApi(){TaskListCardDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!TaskListCardDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=TaskListCardDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:TaskListCardDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=TaskListCardDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function TaskListCardDirective_createElementDescriptor(e){var t,r=TaskListCardDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function TaskListCardDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function TaskListCardDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function TaskListCardDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function TaskListCardDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function TaskListCardDirective_toPropertyKey(e){var t=function TaskListCardDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let $r=function TaskListCardDirective_decorate(e,t,r,i){var a,s=TaskListCardDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function TaskListCardDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(TaskListCardDirective_isDataDescriptor(a.descriptor)||TaskListCardDirective_isDataDescriptor(i.descriptor)){if(TaskListCardDirective_hasDecorators(a)||TaskListCardDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(TaskListCardDirective_hasDecorators(a)){if(TaskListCardDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}TaskListCardDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,TaskListCardDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class TaskListCardDirective{constructor(){e(this),this.templateUrl=Or(),this.restrict="E",this.controller=Jt.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={_card:"=card",_isTaskListCardCreating:"<isTaskListCardCreating",_tempCheckItem:"=tempCheckItem",_beginCheckItemCreating:"&onBeginCheckItemCreating",onOpenCardContextMenu:"&"}}}return{F:TaskListCardDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloTaskListCard"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new TaskListCardDirective}}]}}));var Nr=r(77117),Fr=r.n(Nr);function TaskListContextMenuDirective_getDecoratorsApi(){TaskListContextMenuDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!TaskListContextMenuDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=TaskListContextMenuDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:TaskListContextMenuDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=TaskListContextMenuDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function TaskListContextMenuDirective_createElementDescriptor(e){var t,r=TaskListContextMenuDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function TaskListContextMenuDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function TaskListContextMenuDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function TaskListContextMenuDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function TaskListContextMenuDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function TaskListContextMenuDirective_toPropertyKey(e){var t=function TaskListContextMenuDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let jr=function TaskListContextMenuDirective_decorate(e,t,r,i){var a,s=TaskListContextMenuDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function TaskListContextMenuDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(TaskListContextMenuDirective_isDataDescriptor(a.descriptor)||TaskListContextMenuDirective_isDataDescriptor(i.descriptor)){if(TaskListContextMenuDirective_hasDecorators(a)||TaskListContextMenuDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(TaskListContextMenuDirective_hasDecorators(a)){if(TaskListContextMenuDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}TaskListContextMenuDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,TaskListContextMenuDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class TaskListContextMenuDirective{constructor(){e(this),this.templateUrl=Fr(),this.restrict="E",this.controller=er.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={onSetContextMenu:"&",onEditTaskList:"&",onSortTaskList:"&",onArchiveTaskList:"&"}}}return{F:TaskListContextMenuDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloTaskListContextMenu"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new TaskListContextMenuDirective}}]}}));var zr=r(98274),Ur=r.n(zr);function TaskListsDirective_getDecoratorsApi(){TaskListsDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!TaskListsDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=TaskListsDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:TaskListsDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=TaskListsDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function TaskListsDirective_createElementDescriptor(e){var t,r=TaskListsDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function TaskListsDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function TaskListsDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function TaskListsDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function TaskListsDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function TaskListsDirective_toPropertyKey(e){var t=function TaskListsDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Gr=function TaskListsDirective_decorate(e,t,r,i){var a,s=TaskListsDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function TaskListsDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(TaskListsDirective_isDataDescriptor(a.descriptor)||TaskListsDirective_isDataDescriptor(i.descriptor)){if(TaskListsDirective_hasDecorators(a)||TaskListsDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(TaskListsDirective_hasDecorators(a)){if(TaskListsDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}TaskListsDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,TaskListsDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class TaskListsDirective{constructor(t,r,i,a,s){e(this),this._$rootScope=t,this._$window=r,this._$timeout=i,this._$mdMenu=a,this._appCommonSrv=s,this.templateUrl=Ur(),this.restrict="E",this.controller=sr.controllerName,this.controllerAs="$ctrl",this.scope={}}}return{F:TaskListsDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloTasksLists"}},{kind:"method",decorators:[(0,N.SG)(["$rootScope","$window","$timeout","$mdMenu","appCommonSrv"])],static:!0,key:"create",value:function create(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new TaskListsDirective(...t)}},{kind:"method",key:"link",value:function link(e,t){const r=ae()("body");t.on("click",".pw-tasks-card",(t=>{let r=ae()(t.target),i=r.closest(".pw-tasks-card");i[0]&&(r.closest(".pw-js-tasks-list-item-check-items")[0]||r.closest(".pw-js-tasks-list-item-date-time-picker-range")[0]||e.$ctrl.showEditCardDialogAsync(i.data("id"),i))}));let i,a,s=!1;t.on("contextmenu",".pw-tasks-lane__list-header",(t=>{let r=ae()(t.target);if(r.is("input:focus"))return;let i=r.closest(".pw-tasks-lane__list-header");if(!i[0])return;if(t.preventDefault(),t.stopPropagation(),s)return;s=!0,this._$timeout((()=>s=!1),250,!1);let a=i.data("list-id");e.$ctrl.openTaskListContextMenu(a,t)})),t.on("contextmenu",".pw-tasks-card, .pw-tasks-card__check-item",(t=>{let r=ae()(t.target);if(r.is("input:focus"))return;let i=r.closest(".pw-tasks-card__check-item"),a=r.closest(".pw-tasks-card");if((!i[0]||i.is(".pw-js-tasks-list-check-item-create-panel"))&&(!a[0]||a.is(".pw-js-tasks-list-card-create-panel")))return;if(t.preventDefault(),t.stopPropagation(),s)return;s=!0,this._$timeout((()=>s=!1),250,!1);let n=i.data("id")||a.data("id"),o=i.data("account-id")||a.data("account-id");e.$ctrl.openCardContextMenu(o,n,t)})),t.on("mousedown",".pw-js-tasks-list-create-panel, .pw-js-tasks-list-card-create-panel, .pw-js-tasks-list-edit-panel, .pw-js-tasks-list-check-item-create-panel",(e=>{ae()(e.target).is("input, textarea")||e.preventDefault()})),t.on("keydown",".pw-js-tasks-list-create-panel",(t=>{switch(t.stopPropagation(),t.which){case O.VD.Enter:case O.VD.Enter2:e.$ctrl.submitTaskListCreating();break;case O.VD.Escape:e.$ctrl.rejectTaskListCreating()}})),t.on("keydown",".pw-js-tasks-list-edit-panel",(t=>{switch(t.stopPropagation(),t.which){case O.VD.Enter:case O.VD.Enter2:case O.VD.Escape:e.$ctrl.submitTaskListEditing()}})),t.on("keydown",".pw-js-tasks-list-card-create-panel",(t=>{switch(t.stopPropagation(),t.which){case O.VD.Enter:case O.VD.Enter2:e.$ctrl.submitCardCreating();break;case O.VD.Escape:e.$ctrl.rejectCardCreating()}})),t.on("keydown",".pw-js-tasks-list-temp-check-item-name:focus",(i=>{switch(i.stopPropagation(),i.which){case O.VD.Enter:case O.VD.Enter2:_()(t).call(t,".pw-js-tasks-list-temp-check-item-name").trigger("blur"),e.$ctrl.isCheckItemCreating()&&e.$ctrl.submitCheckItemCreatingAsync();break;case O.VD.Escape:_()(r).call(r,"> .md-open-menu-container.md-active")[0]?this._$mdMenu.hide():(_()(t).call(t,".pw-js-tasks-list-temp-check-item-name").trigger("blur"),e.$ctrl.isCheckItemCreating()&&e.$ctrl.rejectCheckItemCreating())}})),t.on("keydown",".pw-js-tasks-list-check-item-name:focus",(e=>{switch(e.stopPropagation(),e.which){case O.VD.Enter:case O.VD.Enter2:case O.VD.Escape:_()(t).call(t,".pw-js-tasks-list-check-item-name").trigger("blur")}}));let n,o,l,d=!1,c=!1;const onDocumentMousedown=s=>{let c=ae()(s.target);if(!c.closest(".md-dialog-container, .md-panel")[0]){if(e.$ctrl.isTaskListCreating()&&!c.closest(".pw-js-tasks-list-create-panel")[0]&&!c.closest(".md-panel-outer-wrapper")[0])return i=c,void(a=()=>e.$ctrl.submitTaskListCreating());if(e.$ctrl.isTaskListEditing()&&!c.closest(".pw-js-tasks-list-edit-panel")[0])return i=c,void(a=()=>e.$ctrl.submitTaskListEditing());if(e.$ctrl.isTaskListCardCreating()&&!c.closest(".pw-js-tasks-list-card-create-panel")[0]&&!c.closest(".pw-js-tasks-list-check-items-create-panel")[0]&&!c.closest(".pw-date-time-picker-range__content")[0]&&!c.closest(".pw-date-time-picker-range__time-picker")[0]&&!c.closest(".k-timepicker-list")[0]&&!c.closest(".pw-menu-trello-members-content")[0]&&!_()(r).call(r,"> .md-open-menu-container.md-active, > .k-animation-container > .k-list-container.k-state-border-up")[0])return i=c,void(a=()=>e.$ctrl.submitCardCreating());if(e.$ctrl.isCheckItemCreating()&&!c.closest(".pw-js-tasks-list-check-item-create-panel")[0]&&!c.closest(".pw-date-time-picker-range__content")[0]&&!c.closest(".pw-date-time-picker-range__time-picker")[0]&&!c.closest(".k-timepicker-list")[0]&&!c.closest(".pw-menu-trello-members-content")[0]&&!_()(r).call(r,"> .md-open-menu-container.md-active, > .k-animation-container > .k-list-container.k-state-border-up")[0])return i=c,void(a=()=>e.$ctrl.submitCheckItemCreatingAsync());i=null,e.$ctrl.isBusy||0!==c.closest(t).length&&0===c.closest(".pw-js-not-grabbable").length&&0===c.closest(".md-button").length&&(s.which===O.Jm.Middle&&s.preventDefault(),_()(t).call(t,".pw-js-tasks-list-check-item-name").trigger("blur"),l&&l[0]||(l=_()(t).call(t,".pw-js-tasks-list-scrollable-container")),d=!0,t.addClass("pw-task-lists--grab"),n={x:s.pageX,y:s.pageY},o={top:l.scrollTop(),left:l.scrollLeft()})}},onDocumentDragstart=()=>{i=null},onDocumentMousemove=e=>{if(d){if(0===e.buttons)return d=!1,c=!1,void t.removeClass("pw-task-lists--grab pw-task-lists--grabbing");e.preventDefault(),c||(c=!0,t.addClass("pw-task-lists--grabbing")),l.scrollTop(o.top-(e.pageY-n.y)),l.scrollLeft(o.left-(e.pageX-n.x))}},onDocumentMouseup=e=>{i&&(e.target!==i[0]&&i.trigger("click"),i=null),a&&(a(),a=null),(d||c)&&(d=!1,c=!1,t.removeClass("pw-task-lists--grab pw-task-lists--grabbing"))},onDocumentKeydown=r=>{if(O.gD.has(r.keyCode)){if(ae()(r.target).is("input, textarea"))return;let i=_()(t).call(t,".pw-tasks-card__check-item:hover"),a=_()(t).call(t,".pw-tasks-card:hover");if(0===a.length&&0===i.length||a.is(".pw-js-tasks-list-card-create-panel")||i.is(".pw-js-tasks-list-check-item-create-panel")||0!==_()(i).call(i,".pw-js-tasks-list-check-item-name:focus").length)return;r.preventDefault(),r.stopPropagation();let s=a.data("id")||i.data("id"),n=a.data("account-id")||i.data("account-id");e.$ctrl.updateCardByHotkey(n,s,r.keyCode,{altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,metaKey:r.metaKey})}};this._$window.document.addEventListener("mousedown",onDocumentMousedown,!0),this._$window.document.addEventListener("pwMouseDown",onDocumentMousedown,!0),this._$window.document.addEventListener("dragstart",onDocumentDragstart,!0),this._$window.document.addEventListener("pwDragStart",onDocumentDragstart,!0),this._$window.document.addEventListener("mousemove",onDocumentMousemove,!0),this._$window.document.addEventListener("pwMouseMove",onDocumentMousemove,!0),this._$window.document.addEventListener("mouseup",onDocumentMouseup,!0),this._$window.document.addEventListener("pwMouseUp",onDocumentMouseup,!0),this._$window.document.addEventListener("keydown",onDocumentKeydown,!0),e.$on("$destroy",(()=>{this._$window.document.removeEventListener("mousedown",onDocumentMousedown,!0),this._$window.document.removeEventListener("pwMouseDown",onDocumentMousedown,!0),this._$window.document.removeEventListener("dragstart",onDocumentDragstart,!0),this._$window.document.removeEventListener("pwDragStart",onDocumentDragstart,!0),this._$window.document.removeEventListener("mousemove",onDocumentMousemove,!0),this._$window.document.removeEventListener("pwMouseMove",onDocumentMousemove,!0),this._$window.document.removeEventListener("mouseup",onDocumentMouseup,!0),this._$window.document.removeEventListener("pwMouseUp",onDocumentMouseup,!0),this._$window.document.removeEventListener("keydown",onDocumentKeydown,!0)}))}}]}}));var Vr=r(92776),Kr=r.n(Vr);function WorkPanelDirective_getDecoratorsApi(){WorkPanelDirective_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!WorkPanelDirective_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,M.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=WorkPanelDirective_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:WorkPanelDirective_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=WorkPanelDirective_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function WorkPanelDirective_createElementDescriptor(e){var t,r=WorkPanelDirective_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function WorkPanelDirective_coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function WorkPanelDirective_hasDecorators(e){return e.decorators&&e.decorators.length}function WorkPanelDirective_isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function WorkPanelDirective_optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function WorkPanelDirective_toPropertyKey(e){var t=function WorkPanelDirective_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let Hr=function WorkPanelDirective_decorate(e,t,r,i){var a,s=WorkPanelDirective_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function WorkPanelDirective_coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=_()(t).call(t,isSameElement)))if(WorkPanelDirective_isDataDescriptor(a.descriptor)||WorkPanelDirective_isDataDescriptor(i.descriptor)){if(WorkPanelDirective_hasDecorators(a)||WorkPanelDirective_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(WorkPanelDirective_hasDecorators(a)){if(WorkPanelDirective_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}WorkPanelDirective_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,WorkPanelDirective_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}(null,(function(e){class WorkPanelDirective{constructor(){e(this),this.templateUrl=Kr(),this.restrict="E",this.controller=dr.controllerName,this.controllerAs="$ctrl",this.scope={},this.bindToController={_isWorkPanelWidthCompact:"=isWorkPanelWidthCompact"}}}return{F:WorkPanelDirective,d:[{kind:"get",static:!0,key:"directiveName",value:function directiveName(){return"pwTrelloWorkPanel"}},{kind:"method",decorators:[(0,N.SG)([])],static:!0,key:"create",value:function create(){return new WorkPanelDirective}}]}}));const Zr={services:[F],controllers:[j.Z,z,Q,ge,xt,jt,zt.l,Ht,Zt,Wt,Yt,Qt,Jt,er,sr,dr],directives:[ur,Cr,yr,CardEditorDirective,Tr,wr,MembersPanelDirective,Rr,Mr,$r,jr,Gr,Hr]}},16785:(e,t,r)=>{r.d(t,{Z:()=>q});var i=r(40024),a=r.n(i),s=r(99595),n=r.n(s),o=r(57445),l=r.n(o),d=r(51791),c=r.n(d),h=r(90143),u=r.n(h),p=r(56626),m=r.n(p),C=r(67552),v=r.n(C),f=r(62079),y=r.n(f),g=r(52020),_=r.n(g),k=r(88546),b=r.n(k),T=r(66775),S=r.n(T),I=r(2201),w=r.n(I),D=r(26171),E=r(26881),A=r(86981),L=r.n(A),R=r(88946),x=r.n(R),P=r(76555),M=r.n(P),B=r(73324),O=r.n(B),$=r(91829),N=r.n($),F=r(59863),j=r.n(F),z=r(84705),U=r.n(z),G=r(35820),V=r.n(G),K=r(82617),H=r(20115),Z=r(8937),W=r(29704),Y=r(56777);r(43611);function ownKeys(e,t){var r=y()(e);if(_()){var i=_()(e);t&&(i=O()(i).call(i,(function(t){return b()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?n()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,D.Z)(e,t,a[t])})):S()?w()(e,S()(a)):n()(i=ownKeys(Object(a))).call(i,(function(t){l()(e,t,b()(a,t))}))}return e}function _getDecoratorsApi(){_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;n()(r=["method","field"]).call(r,(function(r){n()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;n()(r=["method","field"]).call(r,(function(r){n()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}l()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(n()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),n()(e).call(e,(function(e){if(!_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==c()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];u()(n).call(n,c()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var h=0;h<d.length;h++)this.addElementPlacement(d[h],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return l()(t,m(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return x()(t=(0,E.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:v()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:x()(e).call(e,this.fromElementDescriptor,this)};return l()(t,m(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _createElementDescriptor(e){var t,r=_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function _coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let q=function _decorate(e,t,r,i){var a,s=_getDecoratorsApi();if(i)for(var n=0;n<i.length;n++)s=i[n](s);var o=t((function initialize(e){s.initializeInstanceElements(e,l.elements)}),r),l=s.decorateClass(function _coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=L()(t).call(t,isSameElement)))if(_isDataDescriptor(a.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(a)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(_hasDecorators(a)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}_coalesceGetterSetter(a,i)}else t.push(a)}return t}(x()(a=o.d).call(a,_createElementDescriptor)),e);return s.initializeClassElements(o.F,l.elements),s.runClassFinishers(o.F,l.finishers)}([(0,W.SG)(["$rootScope","$scope","$log","$translate","$window","$mdDialog","appCommonSrv","dialogSrv","notificationSrv","planywayIntegrationSrv","settingsSrv","telemetrySrv","trelloCardsSrv","trelloIntegrationSrv","account","board"])],(function(e){return{F:class BoardDialogController{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p,m,C,v){var f,y,g,_,k,b,T,S,I,w,D,E,A,R,P,B,$;let F,j,z,U,G,V,H,Z,Y,q,X;if(e(this),this._$rootScope=t,this._$scope=r,this._$log=i,this._$translate=a,this._$window=s,this._$mdDialog=n,this._appCommonSrv=o,this._dialogSrv=l,this._notificationSrv=d,this._planywayIntegrationSrv=c,this._settingsSrv=h,this._telemetrySrv=u,this._trelloCardsSrv=p,this._trelloIntegrationSrv=m,this._account=C,this._board=v,v){var Q,J,ee,te,re;if(this._name=v.name,this._organizationId=v.organizationId,F=L()(Q=this.permissionLevels).call(Q,(e=>e.name===v.permissionLevel)),v.color)j=L()(re=this.backgrounds).call(re,(e=>e.color===v.color));({dateSyncType:z,dueLinkType:U,dueLinkTypeAllDay:G,defaultCardIsAllDay:V,defaultCardDuration:H,defaultCardPosition:Z,defaultListId:Y,defaultLimitArchivedCards:q}=v),X=x()(J=M()(ee=O()(te=v.customFields).call(te,(e=>e.type===K.vK.Date))).call(ee,W.y9)).call(J,(e=>{var t;return _objectSpread(_objectSpread({},e),{},{isSelected:N()(t=this._trelloCollectionSettings.global.customFieldsAsCards).call(t,e.id)})}))}else({dateSyncType:z,dueLinkType:U,dueLinkTypeAllDay:G,defaultCardIsAllDay:V,defaultCardDuration:H,defaultCardPosition:Z,defaultListId:Y,defaultLimitArchivedCards:q}=this._trelloIntegrationSrv.getDefaultBoardSettings());this._permissionLevel=null!==(f=F)&&void 0!==f?f:this.permissionLevels[0],this._background=null!==(y=j)&&void 0!==y?y:this.backgrounds[0],this._selectedDateSyncType=null!==(g=L()(_=this.dateSyncTypes).call(_,(e=>e.value===z)))&&void 0!==g?g:this.dateSyncTypes[0],this._selectedDueLinkType=null!==(k=L()(b=this.dueLinkTypes).call(b,(e=>e.value===U)))&&void 0!==k?k:this.dueLinkTypes[0],this._selectedDueLinkTypeAllDay=null!==(T=L()(S=this.dueLinkTypesAllDay).call(S,(e=>e.value===G)))&&void 0!==T?T:this.dueLinkTypesAllDay[0],this._selectedDefaultCardDuration=null!==(I=L()(w=this.defaultCardDurations).call(w,(e=>V===e.isAllDay&&e.value===H)))&&void 0!==I?I:this.defaultCardDurations[2],this._selectedDefaultCardPosition=null!==(D=L()(E=this.defaultCardPositions).call(E,(e=>{let{value:t}=e;return Z===t})))&&void 0!==D?D:this.defaultCardPositions[1],this._selectedDefaultList=null!==(A=L()(R=this.boardLists).call(R,(e=>e.id===Y)))&&void 0!==A?A:this.boardLists[0],this._selectedDefaultLimitArchivedCards=null!==(P=L()(B=this.defaultLimitArchivedCards).call(B,(e=>{let{value:t}=e;return q===t})))&&void 0!==P?P:this.defaultLimitArchivedCards[2],this._customFieldsAsCards=null!==($=X)&&void 0!==$?$:[]}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloBoardDialogCtrl"}},{kind:"field",key:"_provider",value:()=>(0,Y.VH)(Z.lP.Trello)},{kind:"field",key:"_isCustomFieldsCollapsed",value:()=>!0},{kind:"get",key:"isBusy",value:function isBusy(){return this._isBusy}},{kind:"set",key:"isBusy",value:function isBusy(e){this._$scope.$evalAsync((()=>this._isBusy=e))}},{kind:"get",key:"isNewBoard",value:function isNewBoard(){return!this._board}},{kind:"get",key:"canEditBoard",value:function canEditBoard(){var e;if(this.isNewBoard)return!0;if(this._board.isReadOnly)return!1;let{trelloMemberId:t}=this._planywayIntegrationSrv.getConnectedAccountById(this._account.accountId);return(null===(e=this._board.memberships.get(t))||void 0===e?void 0:e.memberType)===Z.IM.Admin}},{kind:"get",key:"organizations",value:function organizations(){var e,t;this._organizations||(this._organizations=x()(e=O()(t=this._trelloIntegrationSrv.getTrelloOrganizations(this._account.accountId)).call(t,(e=>{switch(e.type){case"guest":return!this.isNewBoard;case"real":return!0;default:return!1}}))).call(e,(e=>{let t;switch(e.type){case"guest":t="icons-16:member-outline";break;case"real":t="icons-16:trello"}return _objectSpread(_objectSpread({},e),{},{icon:t})})),this._$scope.$evalAsync((()=>{this._organization=null,this._permissionLevels=null})));return this._organizations}},{kind:"get",key:"permissionLevels",value:function permissionLevels(){return this._permissionLevels||(this._permissionLevels=[],this._permissionLevels.push({name:Z.Jz.Private,title:this._$translate.instant("DIALOGS.BOARD_PRIVATE_TITLE"),subtitle:this._$translate.instant("DIALOGS.BOARD_PRIVATE_SUBTITLE"),isAvailable:!this.organization||this.organization.canCreatePrivateBoards}),this.organization&&this._permissionLevels.push({name:Z.Jz.Organization,title:this._$translate.instant("DIALOGS.BOARD_ORGANIZATION_TITLE"),subtitle:this._$translate.instant("DIALOGS.BOARD_ORGANIZATION_SUBTITLE",{organizationName:this.organization.name}),isAvailable:this.organization.canCreateOrganizationBoards}),this._permissionLevels.push({name:Z.Jz.Public,title:this._$translate.instant("DIALOGS.BOARD_PUBLIC_TITLE"),subtitle:this._$translate.instant("DIALOGS.BOARD_PUBLIC_SUBTITLE"),isAvailable:!this.organization||this.organization.canCreatePublicBoards})),this._permissionLevels}},{kind:"get",key:"organization",value:function organization(){var e,t;this._organization||(this._organization=this._organizationId?L()(e=this.organizations).call(e,(e=>e.id===this._organizationId)):L()(t=this.organizations).call(t,(e=>"real"===e.type&&!e.boardsLimitReached&&!e.boardsCreationRestricted)));return this._organization}},{kind:"set",key:"organization",value:function organization(e){this._$scope.$evalAsync((()=>{this._organization=e,this._organizationId=e.id,this._permissionLevels=null}))}},{kind:"get",key:"name",value:function name(){return this._name}},{kind:"set",key:"name",value:function name(e){this._name!==e&&(this._name=e)}},{kind:"get",key:"permissionLevel",value:function permissionLevel(){return this._permissionLevel}},{kind:"set",key:"permissionLevel",value:function permissionLevel(e){this._permissionLevel!==e&&(this._permissionLevel=e)}},{kind:"get",key:"backgrounds",value:function backgrounds(){return this._backgrounds||(this._backgrounds=Z.xt),this._backgrounds}},{kind:"get",key:"background",value:function background(){return this._background}},{kind:"set",key:"background",value:function background(e){this._background!==e&&(this._background=e)}},{kind:"field",key:"onChangeBackground",value(){return e=>{this._$scope.$evalAsync((()=>{var t;return this.background=L()(t=this.backgrounds).call(t,(t=>t.color===e))}))}}},{kind:"get",key:"canEditBoardSettings",value:function canEditBoardSettings(){return!!this.isNewBoard||!this._board.isReadOnly}},{kind:"get",key:"dateSyncHelpUrl",value:function dateSyncHelpUrl(){return`${H.gO}/getting-started-guide/planyway-settings#board-settings`}},{kind:"get",key:"isDateSyncTypesAvailable",value:function isDateSyncTypesAvailable(){return j()(this._settingsSrv).trelloBoardSettingsMigrator}},{kind:"get",key:"dateSyncTypes",value:function dateSyncTypes(){return this._dateSyncTypes||(this._dateSyncTypes=[{label:this._$translate.instant("BUTTONS.SYNC_START_AND_DUE"),value:K.nV.StartAndDue},{label:this._$translate.instant("BUTTONS.SYNC_ONLY_DUE"),value:K.nV.Due}]),this._dateSyncTypes}},{kind:"get",key:"selectedDateSyncType",value:function selectedDateSyncType(){return this._selectedDateSyncType}},{kind:"set",key:"selectedDateSyncType",value:function selectedDateSyncType(e){this._selectedDateSyncType=e}},{kind:"get",key:"isDueLinkTypesAvailable",value:function isDueLinkTypesAvailable(){return this.selectedDateSyncType.value===K.nV.Due}},{kind:"get",key:"selectedDueLinkType",value:function selectedDueLinkType(){return this._selectedDueLinkType}},{kind:"set",key:"selectedDueLinkType",value:function selectedDueLinkType(e){this._selectedDueLinkType=e}},{kind:"get",key:"selectedDueLinkTypeAllDay",value:function selectedDueLinkTypeAllDay(){return this._selectedDueLinkTypeAllDay}},{kind:"set",key:"selectedDueLinkTypeAllDay",value:function selectedDueLinkTypeAllDay(e){this._selectedDueLinkTypeAllDay=e}},{kind:"get",key:"dueLinkTypes",value:function dueLinkTypes(){return this._dueLinkTypes||(this._dueLinkTypes=[{title:this._$translate.instant("DIALOGS.START_TIME"),value:K.PL.DueStart},{title:this._$translate.instant("DIALOGS.END_TIME"),value:K.PL.DueEnd},{title:this._$translate.instant("DIALOGS.NOT_LINKED"),value:K.PL.NotLinked}]),this._dueLinkTypes}},{kind:"get",key:"dueLinkTypesAllDay",value:function dueLinkTypesAllDay(){return this._dueLinkTypesAllDay||(this._dueLinkTypesAllDay=[{title:this._$translate.instant("DIALOGS.START_DATE"),value:K.PL.DueStart},{title:this._$translate.instant("DIALOGS.END_DATE"),value:K.PL.DueEnd},{title:this._$translate.instant("DIALOGS.NOT_LINKED"),value:K.PL.NotLinked}]),this._dueLinkTypesAllDay}},{kind:"get",key:"selectedDefaultCardDuration",value:function selectedDefaultCardDuration(){return this._selectedDefaultCardDuration}},{kind:"set",key:"selectedDefaultCardDuration",value:function selectedDefaultCardDuration(e){this._selectedDefaultCardDuration=e}},{kind:"get",key:"defaultCardDurations",value:function defaultCardDurations(){return this._defaultCardDurations||(this._defaultCardDurations=[{title:this._$translate.instant("DIALOGS.FIFTEEN_MINUTES"),isAllDay:!1,value:15},{title:this._$translate.instant("DIALOGS.HALF_HOUR"),isAllDay:!1,value:30},{title:this._$translate.instant("DIALOGS.ONE_HOUR"),isAllDay:!1,value:60},{title:this._$translate.instant("DIALOGS.ONE_DAY"),isAllDay:!0,value:1}]),this._defaultCardDurations}},{kind:"get",key:"boardLists",value:function boardLists(){var e;this._boardLists||(this.isNewBoard?this._boardLists=[]:this._boardLists=x()(e=this._board.lists).call(e,(e=>_objectSpread({},e))));return this._boardLists}},{kind:"get",key:"selectedDefaultList",value:function selectedDefaultList(){return this._selectedDefaultList}},{kind:"set",key:"selectedDefaultList",value:function selectedDefaultList(e){this._selectedDefaultList=e}},{kind:"get",key:"selectedDefaultCardPosition",value:function selectedDefaultCardPosition(){return this._selectedDefaultCardPosition}},{kind:"set",key:"selectedDefaultCardPosition",value:function selectedDefaultCardPosition(e){this._selectedDefaultCardPosition=e}},{kind:"get",key:"defaultCardPositions",value:function defaultCardPositions(){return this._defaultCardPositions||(this._defaultCardPositions=[{title:this._$translate.instant("DIALOGS.CARD_POSITION_SETTINGS_TOP"),value:K.XL.Top},{title:this._$translate.instant("DIALOGS.CARD_POSITION_SETTINGS_BOTTOM"),value:K.XL.Bottom}]),this._defaultCardPositions}},{kind:"get",key:"selectedDefaultLimitArchivedCards",value:function selectedDefaultLimitArchivedCards(){return this._selectedDefaultLimitArchivedCards}},{kind:"set",key:"selectedDefaultLimitArchivedCards",value:function selectedDefaultLimitArchivedCards(e){this._selectedDefaultLimitArchivedCards=e}},{kind:"get",key:"defaultLimitArchivedCards",value:function defaultLimitArchivedCards(){return this._defaultLimitArchivedCards||(this._defaultLimitArchivedCards=[{value:100},{value:500},{value:1500},{value:3e3},{value:5e3},{value:1e4}]),this._defaultLimitArchivedCards}},{kind:"get",key:"customFieldsAsCards",value:function customFieldsAsCards(){return this._customFieldsAsCards}},{kind:"get",key:"isCustomFieldsCollapsed",value:function isCustomFieldsCollapsed(){return this._isCustomFieldsCollapsed}},{kind:"method",key:"toggleCustomFieldsCollapsed",value:function toggleCustomFieldsCollapsed(){this._isCustomFieldsCollapsed=!this._isCustomFieldsCollapsed}},{kind:"get",key:"canCreateBoard",value:function canCreateBoard(){var e;return!(null===(e=this.name)||void 0===e||!U()(e).call(e))}},{kind:"method",key:"createBoardAsync",value:async function createBoardAsync(){if(!this.isBusy)try{this.isBusy=!0;let e={name:this.name,permissionLevel:this.permissionLevel.name,color:this.background.color};this.organization&&(e.organizationId=this.organization.id);let t=await this._trelloIntegrationSrv.createTrelloBoardAsync(this._account.accountId,e);await this._trelloIntegrationSrv.saveBoardSettingsAsync(this._account.accountId,t.id,{color:this.background.color,dateSyncType:this.selectedDateSyncType.value,dueLinkType:this.selectedDueLinkType.value,dueLinkTypeAllDay:this.selectedDueLinkTypeAllDay.value,defaultCardIsAllDay:this.selectedDefaultCardDuration.isAllDay,defaultCardDuration:this.selectedDefaultCardDuration.value,defaultCardPosition:this.selectedDefaultCardPosition.value,defaultLimitArchivedCards:this.selectedDefaultLimitArchivedCards.value});let r=this._provider.getCurrentCollectionConnectedCalendar(this._account.accountId,t.id);r.isConnected=!0,r.isSelected=!0,this._provider.setCurrentCollectionConnectedCalendars(this._account.accountId,[r]),this._$rootScope.$broadcast(Z.FK.CalendarsChanging,this._account),this._telemetrySrv.logSessionEvent(Z.cN.CalendarEvents.BoardCreated,{color:this.background.color,dateSyncType:this.selectedDateSyncType.value,dueLinkType:this.selectedDueLinkType.value,dueLinkTypeAllDay:this.selectedDueLinkTypeAllDay.value,defaultCardIsAllDay:this.selectedDefaultCardDuration.isAllDay,defaultCardDuration:this.selectedDefaultCardDuration.value,defaultCardPosition:this.selectedDefaultCardPosition.value,defaultLimitArchivedCards:this.selectedDefaultLimitArchivedCards.value}),this._$mdDialog.hide(!0)}catch(e){this._$log.error("Trello create board error:"),this._$log.error(e),this._telemetrySrv.logError("Trello create board error",e,{class:this.constructor.name,method:this.createBoardAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.CREATE_BOARD_ERROR"),Z.k$.Error)}finally{this.isBusy=!1}}},{kind:"method",key:"editBoardAsync",value:async function editBoardAsync(){if(!this.isBusy)try{this.isBusy=!0;let c=this._board.dateSyncType!==this.selectedDateSyncType.value||this._board.dueLinkType!==this.selectedDueLinkType.value||this._board.dueLinkTypeAllDay!==this.selectedDueLinkTypeAllDay.value;if(this.canEditBoardSettings&&c){let n={dateSyncType:this.selectedDateSyncType.value,dueLinkType:this.selectedDueLinkType.value,dueLinkTypeAllDay:this.selectedDueLinkTypeAllDay.value};var e,t,r,i,a,s;if(this._trelloCardsSrv.isBoardSettingsMigrationRequired(this._account.accountId,this._board.id,n)?(this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.CardDatesMigrationRequested,{oldDateSyncType:this._board.dateSyncType,newDateSyncType:this.selectedDateSyncType.value}),c=await new(V())((e=>{this._dialogSrv.showBoardSettingsMigratorDialogAsync({accountId:this._account.accountId,boardId:this._board.id,onConfirm:e})})),this._telemetrySrv.logSessionEvent(c?Z.cN.SettingsEvents.CardDatesMigrationConfirmed:Z.cN.SettingsEvents.CardDatesMigrationRejected,{oldDateSyncType:this._board.dateSyncType,newDateSyncType:this.selectedDateSyncType.value})):c=!0,!1===c)return this._selectedDateSyncType=null!==(e=L()(t=this.dateSyncTypes).call(t,(e=>e.value===this._board.dateSyncType)))&&void 0!==e?e:this.dateSyncTypes[0],this._selectedDueLinkType=null!==(r=L()(i=this.dueLinkTypes).call(i,(e=>e.value===this._board.dueLinkType)))&&void 0!==r?r:this.dueLinkTypes[0],void(this._selectedDueLinkTypeAllDay=null!==(a=L()(s=this.dueLinkTypesAllDay).call(s,(e=>e.value===this._board.dueLinkTypeAllDay)))&&void 0!==a?a:this.dueLinkTypesAllDay[0]);if(null===c)return void this._$mdDialog.hide(!1)}let h=!1;if(this.canEditBoard){let e={};this._board.name!==this.name&&(e.name=this.name,h=!0),this._board.permissionLevel!==this.permissionLevel.name&&this.permissionLevel.isAvailable&&(e.permissionLevel=this.permissionLevel.name,h=!0),h&&(await this._trelloIntegrationSrv.updateTrelloBoardAsync(this._account.accountId,this._board.id,e),this._telemetrySrv.logSessionEvent(Z.cN.CalendarEvents.BoardEdited))}let u=!1,p=!1,m=!1;if(this.canEditBoardSettings){var n,o,l;this._board.color!==this.background.color&&(this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.BoardColorChanged,{oldColor:this._board.color,newColor:this.background.color}),u=!0),c&&(this._board.dateSyncType!==this.selectedDateSyncType.value&&this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.DatesSyncTypeChanged,{dateSyncType:this.selectedDateSyncType.value}),this._board.dueLinkType!==this.selectedDueLinkType.value&&this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.DueLinkChanged,{dueLinkType:this.selectedDueLinkType.value}),this._board.dueLinkTypeAllDay!==this.selectedDueLinkTypeAllDay.value&&this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.DueLinkAllDayChanged,{dueLinkTypeAllDay:this.selectedDueLinkTypeAllDay.value}),u=!0),this._board.defaultCardDuration!==this.selectedDefaultCardDuration.value&&(this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.DefaultDurationChanged,{defaultCardIsAllDay:this.selectedDefaultCardDuration.isAllDay,defaultCardDuration:this.selectedDefaultCardDuration.value}),u=!0),this._board.defaultListId!==(null===(n=this.selectedDefaultList)||void 0===n?void 0:n.id)&&(this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.DefaultListChanged),u=!0,p=!0),this._board.defaultCardPosition!==this.selectedDefaultCardPosition.value&&(this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.DefaultCardPositionChanged,{defaultCardPosition:this.selectedDefaultCardPosition.value}),u=!0),this._board.defaultLimitArchivedCards!==this.selectedDefaultLimitArchivedCards.value&&(this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.DefaultLimitArchivedCardsChanged,{defaultLimitArchivedCards:this.selectedDefaultLimitArchivedCards.value}),u=!0);let e=x()(o=O()(l=this.customFieldsAsCards).call(l,(e=>e.isSelected))).call(o,(e=>e.id));var d;if((0,W.cO)(e,this._trelloCollectionSettings.global.customFieldsAsCards)||(this._trelloCollectionSettings.global.customFieldsAsCards=e,m=!0),u)await this._trelloIntegrationSrv.saveBoardSettingsAsync(this._account.accountId,this._board.id,{color:this.background.color,dateSyncType:this.selectedDateSyncType.value,dueLinkType:this.selectedDueLinkType.value,dueLinkTypeAllDay:this.selectedDueLinkTypeAllDay.value,defaultCardIsAllDay:this.selectedDefaultCardDuration.isAllDay,defaultCardDuration:this.selectedDefaultCardDuration.value,defaultListId:null===(d=this.selectedDefaultList)||void 0===d?void 0:d.id,defaultCardPosition:this.selectedDefaultCardPosition.value,defaultLimitArchivedCards:this.selectedDefaultLimitArchivedCards.value}),this._$rootScope.$broadcast(Z.FK.SettingsChanged);p&&this._$rootScope.$broadcast(Z.FK.TimelineResourcesReloaded,{resourcesType:Z.y.Lists}),m&&(this._$rootScope.$broadcast(Z.FK.SettingsChanged),await this._collectionSettings.global.saveAsync(),this._telemetrySrv.logSessionEvent(Z.cN.SettingsEvents.CustomFieldsAsCardsChanged))}this._$mdDialog.hide(h||u||p||m)}catch(e){this._$log.error("Trello update board error:"),this._$log.error(e),this._telemetrySrv.logError("Trello update board error",e,{class:this.constructor.name,method:this.editBoardAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_BOARD_ERROR"),Z.k$.Error)}finally{this.isBusy=!1}}},{kind:"method",key:"cancelDialog",value:function cancelDialog(){this._$mdDialog.cancel()}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[Z.lP.Trello],global:this._collectionSettings.global.settings.provider[Z.lP.Trello]}}}]}}))},42940:(e,t,r)=>{r.d(t,{G:()=>q});var i=r(40024),a=r.n(i),s=r(99595),n=r.n(s),o=r(51791),l=r.n(o),d=r(90143),c=r.n(d),h=r(56626),u=r.n(h),p=r(67552),m=r.n(p),C=r(62079),v=r.n(C),f=r(52020),y=r.n(f),g=r(73324),_=r.n(g),k=r(88546),b=r.n(k),T=r(66775),S=r.n(T),I=r(2201),w=r.n(I),D=r(26171),E=r(26881),A=r(88946),L=r.n(A),R=r(57445),x=r.n(R),P=r(86981),M=r.n(P),B=r(31082),O=r.n(B),$=r(53706),N=r.n($),F=r(54847),j=r.n(F),z=r(89221),U=r.n(z),G=r(19755),V=r.n(G),K=r(90869),H=r.n(K),Z=r(8937),W=r(29704),Y=r(56777);r(43611);function ownKeys(e,t){var r=v()(e);if(y()){var i=y()(e);t&&(i=_()(i).call(i,(function(t){return b()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?n()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,D.Z)(e,t,a[t])})):S()?w()(e,S()(a)):n()(i=ownKeys(Object(a))).call(i,(function(t){x()(e,t,b()(a,t))}))}return e}function _getDecoratorsApi(){_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;n()(r=["method","field"]).call(r,(function(r){n()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;n()(r=["method","field"]).call(r,(function(r){n()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}x()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(n()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),n()(e).call(e,(function(e){if(!_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==l()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];c()(n).call(n,l()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),d=this.toElementFinisherExtras((0,a[s])(o)||o);e=d.element,this.addElementPlacement(e,t),d.finisher&&i.push(d.finisher);var h=d.extras;if(h){for(var u=0;u<h.length;u++)this.addElementPlacement(h[u],t);r.push.apply(r,h)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return x()(t,u(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return L()(t=(0,E.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:m()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:L()(e).call(e,this.fromElementDescriptor,this)};return x()(t,u(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _createElementDescriptor(e){var t,r=_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function _coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let q=function _decorate(e,t,r,i){var a,s=_getDecoratorsApi();if(i)for(var n=0;n<i.length;n++)s=i[n](s);var o=t((function initialize(e){s.initializeInstanceElements(e,l.elements)}),r),l=s.decorateClass(function _coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=M()(t).call(t,isSameElement)))if(_isDataDescriptor(a.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(a)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(_hasDecorators(a)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}_coalesceGetterSetter(a,i)}else t.push(a)}return t}(L()(a=o.d).call(a,_createElementDescriptor)),e);return s.initializeClassElements(o.F,l.elements),s.runClassFinishers(o.F,l.finishers)}([(0,W.SG)(["$scope","$log","$translate","dialogSrv","notificationSrv","telemetrySrv","trelloIntegrationSrv","mdPanelRef","accountId","boardId","calendarCard"])],(function(e){return{F:class EditLabelsDialogController{constructor(t,r,i,a,s,n,o,l,d,c,h){e(this),this._$scope=t,this._$log=r,this._$translate=i,this._dialogSrv=a,this._notificationSrv=s,this._telemetrySrv=n,this._trelloIntegrationSrv=o,this._mdPanelRef=l,this._accountId=d,this._boardId=c,this._calendarCard=h}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloEditLabelDialogCtrl"}},{kind:"field",key:"_provider",value:()=>(0,Y.VH)(Z.lP.Trello)},{kind:"get",key:"isBusy",value:function isBusy(){return this._isBusy}},{kind:"set",key:"isBusy",value:function isBusy(e){this._$scope.$evalAsync((()=>this._isBusy=e))}},{kind:"get",key:"labels",value:function labels(){if(!this._labels){let e=this._trelloIntegrationSrv.getTrelloBoardById(this._accountId,this._boardId).labels;this._labels=L()(e).call(e,(t=>{let r=_objectSpread(_objectSpread({},t),{},{deleteAsync:async()=>{if(await this._dialogSrv.showConfirmAsync(this._$translate.instant("DIALOGS.DELETE_LABEL_TITLE"),this._$translate.instant("DIALOGS.DELETE_LABEL_CONFIRM",{name:H()(r.name||r.colorName,36)}),{buttons:[{text:this._$translate.instant("BUTTONS.DELETE"),isPrimary:!0,isDangerous:!0,dialogResult:!0}]}))try{this.isBusy=!0,this._telemetrySrv.logSessionEvent(Z.cN.CalendarEvents.LabelDeleted),this._$scope.$evalAsync((()=>this._labels=null)),await this._trelloIntegrationSrv.deleteTrelloLabelAsync(this._accountId,t.id)}catch(e){this._$log.error("Trello delete label error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.DELETE_TRELLO_LABEL_ERROR"),Z.k$.Error)}finally{this.isBusy=!1,this._$scope.$evalAsync((()=>this._labels=null))}}});return x()(r,"color",{get:()=>t.color,set:async r=>{if(t.color!==r&&!M()(e).call(e,(e=>e.color===r&&e.name===t.name))){t.color=r;try{this._telemetrySrv.logSessionEvent(Z.cN.CalendarEvents.LabelEdited),await this._trelloIntegrationSrv.updateTrelloLabelAsync(this._accountId,t.id,{color:r})}catch(e){this._$log.error("Trello update label color error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_TRELLO_LABEL_ERROR"),Z.k$.Error)}finally{this._$scope.$evalAsync((()=>this._labels=null))}}}}),x()(r,"colorName",{get:()=>this._$translate.instant(r.color?Z.y_[r.color]:"MISC.LABEL_COLOR_NO_COLOR")}),x()(r,"name",{get:()=>t.name,set:async r=>{if(t.name!==r&&!M()(e).call(e,(e=>e.color===t.color&&e.name===r))){t.name=r;try{this._telemetrySrv.logSessionEvent(Z.cN.CalendarEvents.LabelEdited),await this._trelloIntegrationSrv.updateTrelloLabelAsync(this._accountId,t.id,{name:r})}catch(e){this._$log.error("Trello update label name error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_TRELLO_LABEL_ERROR"),Z.k$.Error)}finally{this._$scope.$evalAsync((()=>this._labels=null))}}}}),r}))}return this._labels}},{kind:"get",key:"colors",value:function colors(){var e;this._colors||(this._colors=L()(e=O()(Z.Xh)).call(e,(e=>({value:e,name:this._$translate.instant(Z.y_[e])}))),this._colors.push({value:null,color:this._$translate.instant("MISC.LABEL_COLOR_NO_COLOR")}));return this._colors}},{kind:"method",key:"onLabelNameKeydown",value:function onLabelNameKeydown(e){switch(e.which){case Z.VD.Enter:case Z.VD.Enter2:V()(e.target).trigger("blur")}}},{kind:"method",key:"onAddLabelMenuOpen",value:function onAddLabelMenuOpen(){this._telemetrySrv.logSessionEvent(Z.cN.CalendarEvents.LabelEditDialogAddMenuOpened)}},{kind:"get",key:"newLabel",value:function newLabel(){if(!this._newLabel){var e;let t=N()(e=this.labels).call(e,((e,t)=>{let{color:r}=t;return e.set(r,(e.get(r)||0)+1),e}),new(j())),r=Math.min(...U()(t).call(t)),i=t.keyOf(r);this._newLabel={color:i}}return this._newLabel}},{kind:"method",key:"createNewLabelAsync",value:async function createNewLabelAsync(){try{this.isBusy=!0,this._telemetrySrv.logSessionEvent(Z.cN.CalendarEvents.LabelCreated);let e=this._trelloIntegrationSrv.getOrCreateTrelloLabel(this._accountId,this._boardId,{color:this.newLabel.color,name:this.newLabel.name});e.isTempLabel&&(e=await this._trelloIntegrationSrv.createTrelloLabelAsync(this._accountId,e.id)),this._provider.toggleCardsLabelAsync([this._calendarCard],e.id,{applyRecurringActionToHead:!0,telemetry:{by:Z.AH.EditLabelsDialog}}),this._newLabel=null}catch(e){this._$log.error("Create Trello label error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.CREATE_TRELLO_LABEL_ERROR"),Z.k$.Error)}finally{this.isBusy=!1,this._$scope.$evalAsync((()=>this._labels=null))}}},{kind:"method",key:"cancelDialog",value:function cancelDialog(){this._mdPanelRef.close()}}]}}))},27582:(e,t,r)=>{r.d(t,{l:()=>I});var i=r(40024),a=r.n(i),s=r(88946),n=r.n(s),o=r(99595),l=r.n(o),d=r(57445),c=r.n(d),h=r(51791),u=r.n(h),p=r(90143),m=r.n(p),C=r(56626),v=r.n(C),f=r(67552),y=r.n(f),g=r(26881),_=r(86981),k=r.n(_),b=r(29704),T=r(8937),S=r(20115);function _getDecoratorsApi(){_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;l()(r=["method","field"]).call(r,(function(r){l()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}c()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(l()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),l()(e).call(e,(function(e){if(!_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==u()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];m()(n).call(n,u()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return c()(t,v(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return n()(t=(0,g.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:y()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:n()(e).call(e,this.fromElementDescriptor,this)};return c()(t,v(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _createElementDescriptor(e){var t,r=_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function _coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let I=function _decorate(e,t,r,i){var a,s=_getDecoratorsApi();if(i)for(var o=0;o<i.length;o++)s=i[o](s);var l=t((function initialize(e){s.initializeInstanceElements(e,d.elements)}),r),d=s.decorateClass(function _coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=k()(t).call(t,isSameElement)))if(_isDataDescriptor(a.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(a)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(_hasDecorators(a)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}_coalesceGetterSetter(a,i)}else t.push(a)}return t}(n()(a=l.d).call(a,_createElementDescriptor)),e);return s.initializeClassElements(l.F,d.elements),s.runClassFinishers(l.F,d.finishers)}([(0,b.SG)(["$sce","$scope","$log","$translate","$mdDialog","appCommonSrv","notificationSrv","platformSrv","settingsSrv","telemetrySrv","trelloIntegrationSrv","accountId","boardId","onSyncStarted"])],(function(e){return{F:class GoogleSyncStartDialogController{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p,m){var C,v,f,y;e(this),this._$sce=t,this._$scope=r,this._$log=i,this._$translate=a,this._$mdDialog=s,this._appCommonSrv=n,this._notificationSrv=o,this._platformSrv=l,this._settingsSrv=d,this._telemetrySrv=c,this._trelloIntegrationSrv=h,this._accountId=u,this._boardId=p,this._onSyncStarted=m,this.syncOnlyMemberCards=k()(C=this.syncOnlyMemberCardsOptions).call(C,(e=>e.value===this._trelloUserSettings.local.googleSyncOnlyMyCards)),this.setEventColorByLabel=k()(v=this.setEventColorByLabelOptions).call(v,(e=>e.value===this._trelloUserSettings.local.googleSyncSetEventColorByLabel)),this.syncCompletedCards=k()(f=this.syncCompletedCardsOptions).call(f,(e=>e.value===this._trelloUserSettings.local.googleSyncCompletedCards)),this.syncAsFree=k()(y=this.syncAsFreeOptions).call(y,(e=>e.value===this._trelloUserSettings.local.googleSyncAsFree))}},d:[{kind:"get",static:!0,key:"controllerName",value:function controllerName(){return"trelloGoogleSyncStartDialogCtrl"}},{kind:"field",key:"_googleAuthCode",value:void 0},{kind:"field",key:"_googleRedirectUrl",value:void 0},{kind:"get",key:"isAuthorized",value:function isAuthorized(){return!!this._googleAuthCode}},{kind:"get",key:"syncOnlyMemberCardsOptions",value:function syncOnlyMemberCardsOptions(){return this._syncOnlyMemberCardsOptions||(this._syncOnlyMemberCardsOptions=[{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_SYNC_CARDS_ALL_CARDS"),value:!1},{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_SYNC_CARDS_ONLY_MY_CARDS"),value:!0}]),this._syncOnlyMemberCardsOptions}},{kind:"get",key:"syncOnlyMemberCards",value:function syncOnlyMemberCards(){return this._syncOnlyMemberCards||this.syncOnlyMemberCardsOptions[0]}},{kind:"set",key:"syncOnlyMemberCards",value:function syncOnlyMemberCards(e){this._syncOnlyMemberCards=e}},{kind:"get",key:"setEventColorByLabelOptions",value:function setEventColorByLabelOptions(){return this._setEventColorByLabelOptions||(this._setEventColorByLabelOptions=[{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_SET_EVENT_COLORS_DEFAULT"),value:!1},{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_SET_EVENT_COLORS_BY_LABEL"),value:!0}]),this._setEventColorByLabelOptions}},{kind:"get",key:"setEventColorByLabel",value:function setEventColorByLabel(){return this._setEventColorByLabel||this.setEventColorByLabelOptions[0]}},{kind:"set",key:"setEventColorByLabel",value:function setEventColorByLabel(e){this._setEventColorByLabel=e}},{kind:"get",key:"syncCompletedCardsOptions",value:function syncCompletedCardsOptions(){return this._syncCompletedCardsOptions||(this._syncCompletedCardsOptions=[{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_COMPLETED_CARDS_EXCLUDE"),value:!1},{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_COMPLETED_CARDS_MARK"),value:!0}]),this._syncCompletedCardsOptions}},{kind:"get",key:"syncCompletedCards",value:function syncCompletedCards(){return this._syncCompletedCards||this.syncCompletedCardsOptions[0]}},{kind:"set",key:"syncCompletedCards",value:function syncCompletedCards(e){this._syncCompletedCards=e}},{kind:"get",key:"syncAsFreeOptions",value:function syncAsFreeOptions(){return this._syncAsFreeOptions||(this._syncAsFreeOptions=[{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_AVAILABILITY_BUSY"),value:!1},{title:this._$translate.instant("DIALOGS.GOOGLE_SYNC_START_AVAILABILITY_FREE"),value:!0}]),this._syncAsFreeOptions}},{kind:"get",key:"syncAsFree",value:function syncAsFree(){return this._syncAsFree||this.syncAsFreeOptions[0]}},{kind:"set",key:"syncAsFree",value:function syncAsFree(e){this._syncAsFree=e}},{kind:"get",key:"authorizeLabel",value:function authorizeLabel(){return this._$sce.trustAsHtml(this._$translate.instant("MISC.AUTHORIZE_GOOGLE_LABEL"))}},{kind:"get",key:"syncProviders",value:function syncProviders(){return this._syncProviders||(this._syncProviders=[{type:T.lP.Google,icon:"icons-24:google-outline",text:this.authorizeButtonText}]),this._syncProviders}},{kind:"get",key:"authorizeConsent",value:function authorizeConsent(){return this._$sce.trustAsHtml(this._$translate.instant("MISC.AUTHORIZE_GOOGLE_CONSENT",{btnText:this.authorizeButtonText,termsOfUseUrl:S.lQ,privacyPolicyUrl:S.hO}))}},{kind:"get",key:"authorizeButtonText",value:function authorizeButtonText(){return this._$translate.instant("BUTTONS.CONNECT_WITH_GOOGLE")}},{kind:"method",key:"startSyncAsync",value:async function startSyncAsync(){if(this.isAuthorized){this._trelloUserSettings.local.googleSyncOnlyMyCards=this.syncOnlyMemberCards.value,this._trelloUserSettings.local.googleSyncSetEventColorByLabel=this.setEventColorByLabel.value,this._trelloUserSettings.local.googleSyncCompletedCards=this.syncCompletedCards.value,this._trelloUserSettings.local.googleSyncAsFree=this.syncAsFree.value,this._userSettings.local.save();try{this._$mdDialog.hide(),await this._trelloIntegrationSrv.startGoogleSyncAsync(this._accountId,this._boardId,{googleAuthCode:this._googleAuthCode,googleRedirectUrl:this._googleRedirectUrl,syncOnlyMemberCards:this.syncOnlyMemberCards.value,setEventColorByLabel:this.setEventColorByLabel.value,syncCompletedCards:this.syncCompletedCards.value,syncAsFree:this.syncAsFree.value})}finally{this._onSyncStarted()}}}},{kind:"method",key:"onAuthorize",value:function onAuthorize(e){this._$scope.$evalAsync((()=>{this._googleAuthCode=e.googleAuthCode,this._googleRedirectUrl=e.googleRedirectUrl}))}},{kind:"method",key:"cancelDialog",value:function cancelDialog(){this._$mdDialog.cancel()}},{kind:"get",key:"_userSettings",value:function _userSettings(){return this._settingsSrv.user}},{kind:"get",key:"_trelloUserSettings",value:function _trelloUserSettings(){return{local:this._userSettings.local.settings.provider[T.lP.Trello],global:this._userSettings.global.settings.provider[T.lP.Trello]}}}]}}))},39790:(e,t,r)=>{r.d(t,{Jd:()=>getTrelloCardId,Ms:()=>isMemberRequired,Pv:()=>toggleMember,fb:()=>ue,iG:()=>toggleLabel,xZ:()=>isMultipleMembersSupported});var i=r(40024),a=r.n(i),s=r(99595),n=r.n(s),o=r(57445),l=r.n(o),d=r(51791),c=r.n(d),h=r(56626),u=r.n(h),p=r(67552),m=r.n(p),C=r(62079),v=r.n(C),f=r(52020),y=r.n(f),g=r(88546),_=r.n(g),k=r(66775),b=r.n(k),T=r(2201),S=r.n(T),I=r(26171),w=r(26881),D=r(23513),E=r.n(D),A=r(88946),L=r.n(A),R=r(45181),x=r.n(R),P=r(53706),M=r.n(P),B=r(86981),O=r.n(B),$=r(91829),N=r.n($),F=r(73324),j=r.n(F),z=r(10349),U=r.n(z),G=r(76555),V=r.n(G),K=r(58218),H=r.n(K),Z=r(13464),W=r.n(Z),Y=r(90143),q=r.n(Y),X=r(27525),Q=r.n(X),J=r(35704),ee=r.n(J),te=r(98235),re=r.n(te),ie=r(27885),ae=r(82617),se=r(14587),ne=r(46930),oe=r(8937),le=r(20115),de=r(29704),ce=r(48764).Buffer;function ownKeys(e,t){var r=v()(e);if(y()){var i=y()(e);t&&(i=j()(i).call(i,(function(t){return _()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?n()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,I.Z)(e,t,a[t])})):b()?S()(e,b()(a)):n()(i=ownKeys(Object(a))).call(i,(function(t){l()(e,t,_()(a,t))}))}return e}function _getDecoratorsApi(){_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;n()(r=["method","field"]).call(r,(function(r){n()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;n()(r=["method","field"]).call(r,(function(r){n()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}l()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(n()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),n()(e).call(e,(function(e){if(!_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==c()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];q()(n).call(n,c()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,a[s])(o)||o);e=l.element,this.addElementPlacement(e,t),l.finisher&&i.push(l.finisher);var d=l.extras;if(d){for(var h=0;h<d.length;h++)this.addElementPlacement(d[h],t);r.push.apply(r,d)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return l()(t,u(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return L()(t=(0,w.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:m()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:L()(e).call(e,this.fromElementDescriptor,this)};return l()(t,u(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _createElementDescriptor(e){var t,r=_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function _coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const he=new Date("2999-01-01T00:00:00.000Z");let ue=function _decorate(e,t,r,i){var a,s=_getDecoratorsApi();if(i)for(var n=0;n<i.length;n++)s=i[n](s);var o=t((function initialize(e){s.initializeInstanceElements(e,l.elements)}),r),l=s.decorateClass(function _coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=O()(t).call(t,isSameElement)))if(_isDataDescriptor(a.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(a)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(_hasDecorators(a)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}_coalesceGetterSetter(a,i)}else t.push(a)}return t}(L()(a=o.d).call(a,_createElementDescriptor)),e);return s.initializeClassElements(o.F,l.elements),s.runClassFinishers(o.F,l.finishers)}(null,(function(e){class CalendarCard{constructor(t,r,i){e(this),this._id=t,this._accountId=r,this.cardType=i,this.labelIds=new(E()),this.memberIds=new(E()),this._trelloCustomFieldCards=[],this._trelloCheckItemCards=[],this._trelloTimeRecordCards=[],this._lastDataVersionId=0}}return{F:CalendarCard,d:[{kind:"get",key:"id",value:function id(){return this._id}},{kind:"get",key:"accountId",value:function accountId(){return this._accountId}},{kind:"set",key:"accountId",value:function accountId(e){this._accountId=e}},{kind:"get",key:"calendarId",value:function calendarId(){return this.boardId}},{kind:"get",key:"cardType",value:function cardType(){return this._cardType}},{kind:"set",key:"cardType",value:function cardType(e){this._cardType=e}},{kind:"get",key:"cardRole",value:function cardRole(){return this.customData.cardRole}},{kind:"set",key:"cardRole",value:function cardRole(e){this.customData.cardRole=e}},{kind:"get",key:"title",value:function title(){return this._title||""}},{kind:"set",key:"title",value:function title(e){this._title=e}},{kind:"get",key:"description",value:function description(){return this._description||""}},{kind:"set",key:"description",value:function description(e){this._description=e}},{kind:"get",key:"isAllDay",value:function isAllDay(){return this._isAllDay}},{kind:"set",key:"isAllDay",value:function isAllDay(e){this._isAllDay=e}},{kind:"get",key:"start",value:function start(){return this._start}},{kind:"set",key:"start",value:function start(e){this._start=e?new Date(e):void 0,this._previousStart=this._start,this._durationMinutes=null}},{kind:"get",key:"previousStart",value:function previousStart(){return this._previousStart}},{kind:"get",key:"end",value:function end(){return this.cardRole===ae.D.Milestone?this._start:this._end}},{kind:"set",key:"end",value:function end(e){this._end=e?new Date(e):void 0,this._previousEnd=this._end,this._durationMinutes=null}},{kind:"get",key:"previousEnd",value:function previousEnd(){return this.cardRole===ae.D.Milestone?this._previousStart:this._previousEnd}},{kind:"get",key:"hasPlanywayDates",value:function hasPlanywayDates(){return this._hasPlanywayDates}},{kind:"get",key:"dateSyncType",value:function dateSyncType(){return this._dateSyncType}},{kind:"get",key:"dueLinkType",value:function dueLinkType(){return this._dueLinkType}},{kind:"get",key:"dueLinkTypeAllDay",value:function dueLinkTypeAllDay(){return this._dueLinkTypeAllDay}},{kind:"get",key:"hasDates",value:function hasDates(){return(0,de.qb)(this.start)&&(0,de.qb)(this.end)}},{kind:"get",key:"recurrenceRule",value:function recurrenceRule(){if(this.hasDates&&this.cardRole!==ae.D.Milestone)return this._recurrenceRule}},{kind:"set",key:"recurrenceRule",value:function recurrenceRule(e){this._recurrenceRule=e,e&&(this.customData.defaultSortOrder=Number.POSITIVE_INFINITY,this.customData.membersSortOrder=Number.POSITIVE_INFINITY,this.customData.calendarsSortOrder=Number.POSITIVE_INFINITY,this.customData.listsSortOrder=Number.POSITIVE_INFINITY,this.customData.labelsSortOrder=Number.POSITIVE_INFINITY)}},{kind:"get",key:"recurrenceException",value:function recurrenceException(){if(this.hasDates&&this.cardRole!==ae.D.Milestone)return this._recurrenceException}},{kind:"set",key:"recurrenceException",value:function recurrenceException(e){this._recurrenceException=e}},{kind:"get",key:"exceptionDates",value:function exceptionDates(){return this._exceptionDates||[]}},{kind:"set",key:"exceptionDates",value:function exceptionDates(e){var t;this._exceptionDates=e||[],this._recurrenceException=this._exceptionDates.length>0?L()(t=this._exceptionDates).call(t,de.wd).join():void 0}},{kind:"get",key:"recurrenceId",value:function recurrenceId(){return this._recurrenceId}},{kind:"set",key:"recurrenceId",value:function recurrenceId(e){this._recurrenceId=e}},{kind:"get",key:"exceptionDate",value:function exceptionDate(){return(0,de.HE)(this.originalStart)}},{kind:"get",key:"originalStart",value:function originalStart(){return this._originalStart}},{kind:"set",key:"originalStart",value:function originalStart(e){this._originalStart=e}},{kind:"get",key:"isTempCard",value:function isTempCard(){var e;return x()(e=this.id).call(e,le.$d)}},{kind:"get",key:"isReadOnly",value:function isReadOnly(){return this._isReadOnly}},{kind:"set",key:"isReadOnly",value:function isReadOnly(e){this._isReadOnly=e}},{kind:"get",key:"isSingleDate",value:function isSingleDate(){return this.cardRole===ae.D.Milestone||this.cardType===ae.eT.TrelloCustomField}},{kind:"get",key:"cardUrl",value:function cardUrl(){switch(this.cardType){case ae.eT.TrelloCard:return`https://trello.com/c/${this.shortId||this.id}`;case ae.eT.TrelloCustomField:case ae.eT.TrelloCheckItem:case ae.eT.TrelloTimeRecord:return`https://trello.com/c/${this.parentShortId||this.parentId}`}}},{kind:"get",decorators:[(0,de.lv)()],key:"shortId",value:function shortId(){return this._shortId}},{kind:"get",decorators:[(0,de.lv)()],key:"cardNumber",value:function cardNumber(){return this._cardNumber}},{kind:"set",key:"cardNumber",value:function cardNumber(e){this._cardNumber=e}},{kind:"get",decorators:[(0,de.lv)()],key:"boardId",value:function boardId(){return this._boardId}},{kind:"set",key:"boardId",value:function boardId(e){this._boardId=e}},{kind:"get",decorators:[(0,de.lv)()],key:"listId",value:function listId(){return this._listId}},{kind:"set",key:"listId",value:function listId(e){this._listId=e}},{kind:"get",key:"position",value:function position(){return this._position||0}},{kind:"set",key:"position",value:function position(e){this._position=e}},{kind:"get",decorators:[(0,de.lv)()],key:"due",value:function due(){if(this.hasDates)return this._due}},{kind:"get",key:"realDue",value:function realDue(){return this.hasDates?this._realDue:null}},{kind:"get",decorators:[(0,de.lv)()],key:"isArchived",value:function isArchived(){return this._isArchived}},{kind:"set",key:"isArchived",value:function isArchived(e){this._isArchived=e}},{kind:"get",decorators:[(0,de.lv)()],key:"isCompleted",value:function isCompleted(){return this._isCompleted}},{kind:"set",key:"isCompleted",value:function isCompleted(e){this._isCompleted=e}},{kind:"get",decorators:[(0,de.lv)()],key:"isSubscribed",value:function isSubscribed(){return this._isSubscribed}},{kind:"set",key:"isSubscribed",value:function isSubscribed(e){this._isSubscribed=e}},{kind:"get",decorators:[(0,de.lv)()],key:"labelIds",value:function labelIds(){return this._labelIds}},{kind:"set",key:"labelIds",value:function labelIds(e){let t=!1;if(this._labelIds&&this._labelIds.size===e.size){for(let r of this._labelIds)if(!e.has(r)){t=!0;break}}else t=!0;t&&(this._labelIds=e,0===this._labelIds.size&&this._labelIds.add(le.$d))}},{kind:"get",decorators:[(0,de.lv)()],key:"memberIds",value:function memberIds(){return this._memberIds}},{kind:"set",key:"memberIds",value:function memberIds(e){let t=!1;if(this._memberIds&&this._memberIds.size===e.size){for(let r of this._memberIds)if(!e.has(r)){t=!0;break}}else t=!0;t&&(this._memberIds=e,0===this._memberIds.size&&this._memberIds.add(le.$d))}},{kind:"get",decorators:[(0,de.lv)()],key:"hasMembers",value:function hasMembers(){return this.memberIds.size>0&&(1!==this.memberIds.size||!this.memberIds.has(le.$d))}},{kind:"get",decorators:[(0,de.lv)()],key:"badges",value:function badges(){return this._badges||(this._badges={attachments:0,checkItems:0,checkItemsChecked:0,comments:0}),this._badges}},{kind:"get",decorators:[(0,de.lv)()],key:"durationMinutes",value:function durationMinutes(){return this._durationMinutes||(this._durationMinutes=(0,de.CX)(this.start,this.end)),this._durationMinutes}},{kind:"set",key:"durationMinutes",value:function durationMinutes(e){this._durationMinutes=e}},{kind:"get",decorators:[(0,de.lv)()],key:"estimationHours",value:function estimationHours(){return this.customData.estimationHours}},{kind:"set",key:"estimationHours",value:function estimationHours(e){this.customData.estimationHours=e}},{kind:"get",decorators:[(0,de.lv)()],key:"totalTimeRecordDurationHours",value:function totalTimeRecordDurationHours(){var e;let t=M()(e=this.trelloTimeRecordCards).call(e,((e,t)=>e+t.providerCard.durationMinutes),0);return(0,de.QV)(t/60,2)}},{kind:"get",decorators:[(0,de.lv)()],key:"priority",value:function priority(){return this._priority||0}},{kind:"set",key:"priority",value:function priority(e){this._priority=e}},{kind:"get",decorators:[(0,de.lv)()],key:"notifications",value:function notifications(){return this.customData.notifications}},{kind:"set",key:"notifications",value:function notifications(e){this.customData.notifications=e}},{kind:"get",key:"canHaveLinks",value:function canHaveLinks(){return this.cardType===ae.eT.TrelloCard&&!this.recurrenceRule&&!this.recurrenceId}},{kind:"get",key:"links",value:function links(){return this.customData.links}},{kind:"set",key:"links",value:function links(e){this.customData.links=e}},{kind:"get",key:"customData",value:function customData(){return this._customData||(this._customData={}),this._customData.cardRole||(this._customData.cardRole=ae.D.Card),"number"!=typeof this._customData.defaultSortOrder&&(this._customData.defaultSortOrder=Number.POSITIVE_INFINITY),"number"!=typeof this._customData.membersSortOrder&&(this._customData.membersSortOrder=Number.POSITIVE_INFINITY),"number"!=typeof this._customData.calendarsSortOrder&&(this._customData.calendarsSortOrder=Number.POSITIVE_INFINITY),"number"!=typeof this._customData.listsSortOrder&&(this._customData.listsSortOrder=Number.POSITIVE_INFINITY),"number"!=typeof this._customData.labelsSortOrder&&(this._customData.labelsSortOrder=Number.POSITIVE_INFINITY),this._customData.customFieldCardsData||(this._customData.customFieldCardsData=[]),this._customData.checkItemCardsData||(this._customData.checkItemCardsData=[]),this._customData.notifications||(this._customData.notifications=[]),this._customData.links||(this._customData.links=[]),this._customData}},{kind:"get",key:"sourceCardId",value:function sourceCardId(){return this._sourceCardId}},{kind:"set",key:"sourceCardId",value:function sourceCardId(e){this._sourceCardId=e}},{kind:"get",key:"trelloCustomFieldCards",value:function trelloCustomFieldCards(){return this._trelloCustomFieldCards}},{kind:"set",key:"trelloCustomFieldCards",value:function trelloCustomFieldCards(e){this._trelloCustomFieldCards=e}},{kind:"get",key:"trelloCheckItemCards",value:function trelloCheckItemCards(){return this._trelloCheckItemCards}},{kind:"set",key:"trelloCheckItemCards",value:function trelloCheckItemCards(e){this._trelloCheckItemCards=e}},{kind:"get",key:"trelloTimeRecordCards",value:function trelloTimeRecordCards(){return this._trelloTimeRecordCards}},{kind:"set",key:"trelloTimeRecordCards",value:function trelloTimeRecordCards(e){this._trelloTimeRecordCards=e}},{kind:"get",decorators:[(0,de.lv)()],key:"parentId",value:function parentId(){return this._parentId}},{kind:"set",key:"parentId",value:function parentId(e){this._parentId=e}},{kind:"get",decorators:[(0,de.lv)()],key:"parentShortId",value:function parentShortId(){return this._parentShortId}},{kind:"get",decorators:[(0,de.lv)()],key:"trelloCustomFieldId",value:function trelloCustomFieldId(){return this._trelloCustomFieldId}},{kind:"get",decorators:[(0,de.lv)()],key:"defaultSortOrder",value:function defaultSortOrder(){return this.customData.defaultSortOrder}},{kind:"set",key:"defaultSortOrder",value:function defaultSortOrder(e){this.customData.defaultSortOrder=e}},{kind:"get",decorators:[(0,de.lv)()],key:"membersSortOrder",value:function membersSortOrder(){return this.customData.membersSortOrder}},{kind:"set",key:"membersSortOrder",value:function membersSortOrder(e){this.customData.membersSortOrder=e}},{kind:"get",decorators:[(0,de.lv)()],key:"calendarsSortOrder",value:function calendarsSortOrder(){return this.customData.calendarsSortOrder}},{kind:"set",key:"calendarsSortOrder",value:function calendarsSortOrder(e){this.customData.calendarsSortOrder=e}},{kind:"get",decorators:[(0,de.lv)()],key:"listsSortOrder",value:function listsSortOrder(){return this.customData.listsSortOrder}},{kind:"set",key:"listsSortOrder",value:function listsSortOrder(e){this.customData.listsSortOrder=e}},{kind:"get",decorators:[(0,de.lv)()],key:"labelsSortOrder",value:function labelsSortOrder(){return this.customData.labelsSortOrder}},{kind:"set",key:"labelsSortOrder",value:function labelsSortOrder(e){this.customData.labelsSortOrder=e}},{kind:"get",key:"customFieldCardsData",value:function customFieldCardsData(){return this.customData.customFieldCardsData}},{kind:"set",key:"customFieldCardsData",value:function customFieldCardsData(e){this.customData.customFieldCardsData=e}},{kind:"get",key:"checkItemCardsData",value:function checkItemCardsData(){return this.customData.checkItemCardsData}},{kind:"set",key:"checkItemCardsData",value:function checkItemCardsData(e){this.customData.checkItemCardsData=e}},{kind:"get",key:"lastChangeId",value:function lastChangeId(){return this._lastChangeId}},{kind:"set",key:"lastChangeId",value:function lastChangeId(e){return this._lastChangeId=e}},{kind:"get",key:"lastDataVersionId",value:function lastDataVersionId(){return this._lastDataVersionId}},{kind:"method",static:!0,key:"fromSourceCard",value:function fromSourceCard(e,t,r,i){let a=new CalendarCard(e,t,r);if(!i)return a;switch(r){case ae.eT.TrelloCheckItem:case ae.eT.TrelloCustomField:case ae.eT.TrelloTimeRecord:return a}const{trelloCard:s,cardBoard:n}=i;a.isReadOnly=n.isReadOnly;let o,{description:l,descriptionCardData:d}=CalendarCard._deserializeDescriptionCardData(s.desc);if(d&&(a._needMigrateDescriptionCardData=!0),n.cardDataCustomFieldId){var c;let e=null===(c=s.customFieldItems)||void 0===c?void 0:O()(c).call(c,(e=>e.idCustomField===n.cardDataCustomFieldId));var h;if(null!=e&&e.value)o=CalendarCard._deserializeCustomFieldCardData(null===(h=e.value)||void 0===h?void 0:h.text)}let u,p=d;if(o&&(!p||o.dataVersionId>p.dataVersionId)&&(p=o),p){if(a._lastDataVersionId=p.dataVersionId,a.recurrenceRule=p.recurrenceRule,a.exceptionDates=p.exceptionDates,a._recurrenceId=p.recurrenceId,a._originalStart=p.originalStart,a.priority=p.priority,a._customData=p.customData,a.customData.originalCardId){a.customData.originalCardId===s.id||(a.checkItemCardsData=[],a.links=[])}else a.customData.originalCardId=e;a._sourceCardId=p.recurrenceId,u=CalendarCard._correctCardData(s.start,s.due,n,p)}else u=CalendarCard._correctCardData(s.start,s.due,n);s.due&&(a._due=new Date(s.due)),u?(a._hasPlanywayDates=u.hasPlanywayDates,a.isAllDay=u.isAllDay,a.start=u.start,a.end=u.end,a._dateSyncType=u.dateSyncType,a._dueLinkType=u.dueLinkType,a._dueLinkTypeAllDay=u.dueLinkTypeAllDay,a._realDue=u.realDue,a._offsetDue=u.offsetDue):(a._hasPlanywayDates=!1,a._dateSyncType=n.dateSyncType);let m=s.shortLink;if(!m){let e=s.shortUrl.match(/\/c\/(\w+)/);e&&(m=e[1])}return a._shortId=m,a._cardNumber=s.idShort,a._boardId=s.idBoard,a._listId=s.idList,a._position=s.pos,a.title=s.name,a.description=l,a.isArchived=s.closed,a.isCompleted=s.dueComplete,a.isSubscribed=s.subscribed,a.labelIds=new(E())(s.idLabels),a.memberIds=new(E())(s.idMembers),a._badges={attachments:s.badges.attachments,checkItems:s.badges.checkItems,checkItemsChecked:s.badges.checkItemsChecked,comments:s.badges.comments},a.lastChangeId=new Date(s.dateLastActivity).getTime(),a._lastCard=CalendarCard._getLastCard(a),a}},{kind:"method",key:"toSourceCard",value:function toSourceCard(e){const{cardBoard:t,includeFields:r=[]}=e;let i={id:this.id};if(N()(r).call(r,"cardData"))if(this._dateSyncType=t.dateSyncType,this._dueLinkType=void 0,this._dueLinkTypeAllDay=void 0,this._realDue=void 0,this._offsetDue=void 0,this.hasDates){switch(this._dateSyncType){case ae.nV.StartAndDue:this._dueLinkType=ae.PL.DueStart,this._dueLinkTypeAllDay=ae.PL.DueEnd,this.isAllDay?i.start=(0,de.D0)(this.start,8):i.start="";break;case ae.nV.Due:this._dueLinkType=t.dueLinkType,this._dueLinkTypeAllDay=t.dueLinkTypeAllDay}if(this.isAllDay)switch(this._dueLinkTypeAllDay){case ae.PL.DueStart:this._correctAllDayDueDateAsStartDate(t);break;case ae.PL.DueEnd:this._correctAllDayDueDateAsEndDate(t);break;case ae.PL.NotLinked:this._correctAllDayDueDateAsNotLinked()}else switch(this._dueLinkType){case ae.PL.DueStart:this._correctDueDateAsStartDate();break;case ae.PL.DueEnd:this._correctDueDateAsEndDate();break;case ae.PL.NotLinked:this._correctDueDateAsNotLinked()}this._realDue&&(this._due=new Date(this._realDue),i.due=this.due.toISOString())}else{if(this._dateSyncType===ae.nV.StartAndDue)i.start="";i.due=""}let a={name:()=>i.name=this.title,idBoard:()=>i.idBoard=this.boardId,idList:()=>i.idList=this.listId,pos:()=>i.pos=this.position||ae.XL.Bottom,desc:()=>{t.cardDataCustomFieldId&&!this._needMigrateDescriptionCardData?i.desc=this.description:N()(r).call(r,"cardData")||(i.desc=this._serializeDescriptionCardData())},closed:()=>i.closed=this.isArchived,dueComplete:()=>i.dueComplete=this.isCompleted,subscribed:()=>i.subscribed=this.isSubscribed,idLabels:()=>{var e;return i.idLabels=j()(e=U()(this.labelIds)).call(e,(e=>e!==le.$d))},idMembers:()=>{var e;return i.idMembers=j()(e=U()(this.memberIds)).call(e,(e=>e!==le.$d&&e!==le.iF))},idCardSource:()=>{if(this.isTempCard&&this.sourceCardId){i.idCardSource=this.sourceCardId;let e=["attachments","checklists","comments","customFields","stickers"];N()(r).call(r,"idMembers")||e.push("members"),N()(r).call(r,"idLabels")||e.push("labels"),i.keepFromSource=e}},cardData:()=>{t.cardDataCustomFieldId?(i.cardDataCustomFieldValue=this._serializeCustomFieldCardData(),this._needMigrateDescriptionCardData&&(this._needMigrateDescriptionCardData=!1,i.desc=this.description)):i.desc=this._serializeDescriptionCardData()}};for(let e of r){let t=a[e];t&&t()}return this._lastCard=CalendarCard._getLastCard(this),i}},{kind:"method",key:"incrementDataVersion",value:function incrementDataVersion(){this._lastDataVersionId+=1}},{kind:"method",key:"duplicate",value:function duplicate(){let e=this.clone();return e.isCompleted=!1,e._id=le.$d,e._shortId=void 0,this.recurrenceRule?e.exceptionDates=[]:this.recurrenceId&&(e._recurrenceId=void 0,e._originalStart=void 0),e._trelloCheckItemCards=[],e.checkItemCardsData=[],e._trelloTimeRecordCards=[],e.links=[],e._sourceCardId=this.id,e._lastCard=CalendarCard._getLastCard(e),e}},{kind:"method",key:"clone",value:function clone(){var e,t,r;let i=new CalendarCard(this.id,this.accountId,this.cardType);return this.hasDates&&(i.isAllDay=this.isAllDay,i.start=this.start,i.end=this.end),i.title=this.title,i.description=this.description,i.recurrenceRule=this.recurrenceRule,i.exceptionDates=[...this.exceptionDates],i.recurrenceId=this.recurrenceId,i.originalStart=this.originalStart,i.isReadOnly=this._isReadOnly,i._shortId=this.shortId,i._cardNumber=this._cardNumber,i._boardId=this.boardId,i._listId=this.listId,i._position=this.position,i._trelloCustomFieldCards=L()(e=this.trelloCustomFieldCards).call(e,(e=>e.clone())),i._trelloCheckItemCards=L()(t=this.trelloCheckItemCards).call(t,(e=>e.clone())),i._trelloTimeRecordCards=L()(r=this.trelloTimeRecordCards).call(r,(e=>e.clone())),i._parentId=this.parentId,i._parentShortId=this.parentShortId,i._trelloCustomFieldId=this.trelloCustomFieldId,i._sync=this._sync,i._due=this.due,i.isArchived=this.isArchived,i.isCompleted=this.isCompleted,i.isSubscribed=this.isSubscribed,i.labelIds=new(E())(this.labelIds),i.memberIds=new(E())(this.memberIds),i._badges=_objectSpread({},this.badges),i._hasPlanywayDates=this.hasPlanywayDates,i._dateSyncType=this._dateSyncType,i._dueLinkType=this._dueLinkType,i._dueLinkTypeAllDay=this._dueLinkTypeAllDay,i._realDue=this._realDue,i._offsetDue=this._offsetDue,i.priority=this.priority,i._customData=_objectSpread({},this.customData),i._sourceCardId=i.sourceCardId,i._needMigrateDescriptionCardData=this._needMigrateDescriptionCardData,i.lastChangeId=this.lastChangeId,i._lastDataVersionId=this.lastDataVersionId,i._lastCard=this._lastCard,i}},{kind:"method",key:"equals",value:function equals(e){if(!e)return!1;function toCardObject(e){var t,r;return{id:e.id,cardType:e.cardType,title:e.title,description:e.description,isAllDay:e.isAllDay,start:e.start,end:e.end,recurrenceRule:e.recurrenceRule,exceptionDates:e.exceptionDates,cardNumber:e.cardNumber,boardId:e.boardId,listId:e.listId,position:e.position,isArchived:e.isArchived,isCompleted:e.isCompleted,isSubscribed:e.isSubscribed,labelIds:V()(t=U()(e.labelIds)).call(t),memberIds:V()(r=U()(e.memberIds)).call(r),badges:e.badges,durationMinutes:e.durationMinutes,estimationHours:e.estimationHours,priority:e.priority,notifications:e.notifications,hasPlanywayDates:e.hasPlanywayDates,dateSyncType:e._dateSyncType,dueLinkType:e._dueLinkType,dueLinkTypeAllDay:e._dueLinkTypeAllDay,realDue:e._realDue,offsetDue:e._offsetDue,customData:e.customData}}let t=toCardObject(this),r=toCardObject(e),i=(0,de.h0)(t,r);return i}},{kind:"method",key:"getCompareId",value:function getCompareId(){var e,t;if(this.cardType===ae.eT.TrelloCard){let r=j()(e=L()(t=this.trelloTimeRecordCards).call(t,(e=>e.providerCard.lastChangeId))).call(e,(e=>e));return Math.max(this.lastChangeId,...r)}return 0}},{kind:"method",key:"addTrelloCustomFieldCard",value:function addTrelloCustomFieldCard(e){var t,r;if(this.deleteTrelloCustomFieldCard(e.id),!e.date)return;let i=new ne.fb(e.id,this.accountId,oe.lP.Trello,ae.eT.TrelloCustomField),{providerCard:a}=i;i.title=this.title,i.description=this.description,i.isAllDay=null!==(t=e.isAllDay)&&void 0!==t?t:this.isAllDay,i.start=i.isAllDay?(0,de.$Y)(e.date):e.date,i.end=i.isAllDay?(0,de.$Y)(e.date):e.date,a.isReadOnly=this.isReadOnly,a._cardNumber=this._cardNumber,a._boardId=this.boardId,a._listId=this.listId,a._parentId=this.id,a._parentShortId=this.shortId,a._trelloCustomFieldId=e.customFieldId,a._due=e.date,a.isArchived=this.isArchived,a.isCompleted=null!==(r=e.isCompleted)&&void 0!==r&&r,a.labelIds=new(E())(this.labelIds),a.memberIds=new(E())(this.memberIds),a.customData.defaultSortOrder=e.defaultSortOrder,a.customData.membersSortOrder=e.membersSortOrder,a.customData.calendarsSortOrder=e.calendarsSortOrder,a.customData.listsSortOrder=e.listsSortOrder,a.customData.labelsSortOrder=e.labelsSortOrder;let s=a._toCustomFieldCardData();return s&&this.customFieldCardsData.push(s),this.trelloCustomFieldCards.push(i),i}},{kind:"method",key:"addTrelloCustomFieldCardFromTrello",value:function addTrelloCustomFieldCardFromTrello(e){var t,r;let i=O()(t=this.customFieldCardsData).call(t,(t=>t.id===e.id||t.customFieldId===e.customFieldId))||{},a=null===(r=e.value)||void 0===r?void 0:r.date,s=_objectSpread(_objectSpread({},i),{},{id:e.id,customFieldId:e.idCustomField,date:a&&new Date(a)});return this.addTrelloCustomFieldCard(s)}},{kind:"method",key:"updateTrelloCustomFieldCard",value:function updateTrelloCustomFieldCard(e,t){var r;let i=O()(r=this.trelloCustomFieldCards).call(r,(t=>t.id===e));if(!i)return{customFieldCardUpdated:!1};let a=!1,{providerCard:s}=i;s.boardId===this.boardId&&s.listId===this.listId||(s.boardId=this.boardId,s.listId=this.listId,a=!0),i.title!==this.title&&(i.title=this.title,a=!0),i.description!==this.description&&(i.description=this.description,a=!0),s.isArchived!==this.isArchived&&(s.isArchived=this.isArchived,a=!0),(0,de.cO)(U()(s.labelIds),U()(this.labelIds))||(s.labelIds=new(E())(this.labelIds),a=!0),(0,de.cO)(U()(s.memberIds),U()(this.memberIds))||(s.memberIds=new(E())(this.memberIds),a=!0);let n=!1,o=!1;if(void 0!==t.isAllDay&&i.isAllDay!==t.isAllDay&&(i.isAllDay=t.isAllDay,o=!0),void 0!==t.date){let e=i.isAllDay?(0,de.$Y)(t.date):t.date;(0,de.rs)(i.start,e)&&(0,de.rs)(i.end,e)||(e?(i.start=e,i.end=e,s._due=t.date):(i.isAllDay=null,i.start=null,i.end=null,s._due=null),n=!0)}void 0!==t.isCompleted&&s.isCompleted!==t.isCompleted&&(s.isCompleted=t.isCompleted,o=!0),void 0!==t.defaultSortOrder&&s.defaultSortOrder!==t.defaultSortOrder&&(s.customData.defaultSortOrder=t.defaultSortOrder,o=!0),void 0!==t.membersSortOrder&&s.membersSortOrder!==t.membersSortOrder&&(s.customData.membersSortOrder=t.membersSortOrder,o=!0),void 0!==t.calendarsSortOrder&&s.calendarsSortOrder!==t.calendarsSortOrder&&(s.customData.calendarsSortOrder=t.calendarsSortOrder,o=!0),void 0!==t.listsSortOrder&&s.listsSortOrder!==t.listsSortOrder&&(s.customData.listsSortOrder=t.listsSortOrder,o=!0),void 0!==t.labelsSortOrder&&s.labelsSortOrder!==t.labelsSortOrder&&(s.customData.labelsSortOrder=t.labelsSortOrder,o=!0),this.deleteTrelloCustomFieldCard(i.id);let l=s._toCustomFieldCardData();return l&&this.customFieldCardsData.push(l),this.trelloCustomFieldCards.push(i),{customFieldCardUpdated:a||n||o,customFieldCard:i,customFieldUpdated:n,parentCardUpdated:o}}},{kind:"method",key:"deleteTrelloCustomFieldCard",value:function deleteTrelloCustomFieldCard(e){var t,r;let i,a=W()(t=this.trelloCustomFieldCards).call(t,(t=>t.id===e));var s;-1!==a&&(i=this.trelloCustomFieldCards[a].trelloCustomFieldId,q()(s=this.trelloCustomFieldCards).call(s,a,1));this.customFieldCardsData=j()(r=this.customFieldCardsData).call(r,(t=>t.id!==e&&t.customFieldId!==i))}},{kind:"method",key:"addTrelloCheckItemCard",value:function addTrelloCheckItemCard(e,t,r){var i,a,s,n,o,l,d,c;const{syncWithTrello:h,correctRealDue:u=!0}=r;this.deleteTrelloCheckItemCard(e.id);let p=new ne.fb(e.id,this.accountId,oe.lP.Trello,ae.eT.TrelloCheckItem),{providerCard:m}=p;if(p.title=e.name,p.description=this.description,m.isReadOnly=this.isReadOnly,m._cardNumber=this._cardNumber,m._boardId=this.boardId,m._listId=this.listId,m._parentId=this.id,m._parentShortId=this.shortId,m.isArchived=this.isArchived,m.isCompleted=e.isCompleted,m.labelIds=new(E())(this.labelIds),m.memberIds=new(E())(null===(i=e.memberIds)||void 0===i?void 0:j()(i).call(i,(e=>{var r;return Q()(r=t.members).call(r,(t=>t.id===e))}))),m._dateSyncType=null!==(a=null!==(s=e.dateSyncType)&&void 0!==s?s:this._dateSyncType)&&void 0!==a?a:t.dateSyncType,m._dueLinkType=null!==(n=null!==(o=e.dueLinkType)&&void 0!==o?o:this._dueLinkType)&&void 0!==n?n:t.dueLinkType,m._dueLinkTypeAllDay=null!==(l=null!==(d=e.dueLinkTypeAllDay)&&void 0!==d?d:this._dueLinkTypeAllDay)&&void 0!==l?l:t.dueLinkTypeAllDay,e.start&&e.end){var C;p.isAllDay=null!==(C=e.isAllDay)&&void 0!==C?C:t.defaultCardIsAllDay;let r=p.isAllDay?m._dueLinkTypeAllDay:m._dueLinkType;p.start=e.start,r===ae.PL.DueStart&&(m._due=p.isAllDay?(0,de.nT)(p.start):p.start),p.end=e.end,r!==ae.PL.DueEnd&&r!==ae.PL.NotLinked||(m._due=p.isAllDay?(0,de.nT)(p.end):p.end)}m._sync=null!==(c=e.sync)&&void 0!==c?c:h,m.customData.defaultSortOrder=e.defaultSortOrder,m.customData.membersSortOrder=e.membersSortOrder,m.customData.calendarsSortOrder=e.calendarsSortOrder,m.customData.listsSortOrder=e.listsSortOrder,m.customData.labelsSortOrder=e.labelsSortOrder;let v=m._toCheckItemCardData(t,u);return v&&this.checkItemCardsData.push(v),this.trelloCheckItemCards.push(p),p}},{kind:"method",key:"addTrelloCheckItemCardFromTrello",value:function addTrelloCheckItemCardFromTrello(e,t,r){var i;let a,s=O()(i=this.checkItemCardsData).call(i,(t=>t.id===e.id)),n=(!s||s.sync)&&r.syncWithTrello,o=_objectSpread(_objectSpread({},s),{},{id:e.id,name:e.name,isCompleted:"complete"===e.state,sync:n});if(n){let r=CalendarCard._correctCheckItemCardData(e.due,t,s);r?(o.isAllDay=r.isAllDay,o.start=r.start,o.end=r.end,o.dueLinkType=r.dueLinkType,o.dueLinkTypeAllDay=r.dueLinkTypeAllDay,a=r.realDue):(o.isAllDay=void 0,o.start=void 0,o.end=void 0,o.dueLinkType=void 0,o.dueLinkTypeAllDay=void 0),o.memberIds=e.idMember?[e.idMember]:[]}let l=this.addTrelloCheckItemCard(o,t,{syncWithTrello:n,correctRealDue:!1});return l._realDue=a,l}},{kind:"method",key:"updateTrelloCheckItemCard",value:function updateTrelloCheckItemCard(e,t,r,i){var a,s,n;let o=O()(a=this.trelloCheckItemCards).call(a,(t=>t.id===e));if(!o)return{checkItemCardUpdated:!1};let l=!1,{providerCard:d}=o;d.boardId===this.boardId&&d.listId===this.listId||(d.boardId=this.boardId,d.listId=this.listId,l=!0),o.description!==this.description&&(o.description=this.description,l=!0),d.isArchived!==this.isArchived&&(d.isArchived=this.isArchived,l=!0),(0,de.cO)(U()(d.labelIds),U()(this.labelIds))||(d.labelIds=new(E())(this.labelIds),l=!0);let c=!1;void 0!==t.name&&o.title!==t.name&&(o.title=t.name,c=!0),void 0!==t.isCompleted&&d.isCompleted!==t.isCompleted&&(d.isCompleted=t.isCompleted,c=!0);let h=!1;void 0!==t.isAllDay&&o.isAllDay!==t.isAllDay&&(o.isAllDay=t.isAllDay,h=!0);let u=o.isAllDay?r.dueLinkTypeAllDay:r.dueLinkType;void 0===t.start||(0,de.rs)(o.start,t.start)||(o.start=t.start,u===ae.PL.DueStart&&(d._due=o.isAllDay?(0,de.nT)(o.start):o.start),h=!0),void 0===t.end||(0,de.rs)(o.end,t.end)||(o.end=t.end,u!==ae.PL.DueEnd&&u!==ae.PL.NotLinked||(d._due=o.isAllDay?(0,de.nT)(o.end):o.end),h=!0);let p=null===(s=t.memberIds)||void 0===s?void 0:j()(s).call(s,(e=>{var t;return Q()(t=r.members).call(t,(t=>t.id===e))}));void 0===p||(0,de.cO)(j()(n=U()(d.memberIds)).call(n,(e=>e!==le.$d)),p)||(d.memberIds=new(E())(p),c=!0,h=!0),d._sync!==i.syncWithTrello&&(d._sync=i.syncWithTrello,h=!0),void 0!==t.defaultSortOrder&&d.defaultSortOrder!==t.defaultSortOrder&&(d.customData.defaultSortOrder=t.defaultSortOrder,h=!0),void 0!==t.membersSortOrder&&d.membersSortOrder!==t.membersSortOrder&&(d.customData.membersSortOrder=t.membersSortOrder,h=!0),void 0!==t.calendarsSortOrder&&d.calendarsSortOrder!==t.calendarsSortOrder&&(d.customData.calendarsSortOrder=t.calendarsSortOrder,h=!0),void 0!==t.listsSortOrder&&d.listsSortOrder!==t.listsSortOrder&&(d.customData.listsSortOrder=t.listsSortOrder,h=!0),void 0!==t.labelsSortOrder&&d.labelsSortOrder!==t.labelsSortOrder&&(d.customData.labelsSortOrder=t.labelsSortOrder,h=!0),this.deleteTrelloCheckItemCard(o.id);let m=d._toCheckItemCardData(r,!0);return m&&this.checkItemCardsData.push(m),this.trelloCheckItemCards.push(o),{checkItemCardUpdated:l||c||h,checkItemCard:o,checkItemUpdated:c,parentCardUpdated:h}}},{kind:"method",key:"deleteTrelloCheckItemCard",value:function deleteTrelloCheckItemCard(e){var t,r;let i=W()(t=this.trelloCheckItemCards).call(t,(t=>t.id===e));var a;-1!==i&&q()(a=this.trelloCheckItemCards).call(a,i,1);this.checkItemCardsData=j()(r=this.checkItemCardsData).call(r,(t=>t.id!==e))}},{kind:"method",key:"addTrelloTimeRecordCard",value:function addTrelloTimeRecordCard(e,t){var r,i;if(this.deleteTrelloTimeRecordCard(e.id),!e.from||!e.to)return;let a=new ne.fb(e.id,this.accountId,oe.lP.Trello,ae.eT.TrelloTimeRecord),{providerCard:s}=a;switch(a.title=e.comment,a.description=this.description,a.isAllDay=null===(r=e.isDuration)||void 0===r||r,a.start=e.from,a.end=e.to,s.isReadOnly=this.isReadOnly,s._cardNumber=this._cardNumber,s._boardId=this.boardId,s._listId=this.listId,s._parentId=this.id,s._parentShortId=this.shortId,s.isArchived=this.isArchived,s.isCompleted=!1,s.labelIds=new(E())(this.labelIds),s.memberIds=new(E())(e.memberId&&Q()(i=t.members).call(i,(t=>t.id===e.memberId))?[e.memberId]:[]),a.isAllDay?this._dueLinkTypeAllDay:this._dueLinkType){case ae.PL.DueStart:s._due=a.isAllDay?(0,de.nT)(a.start):a.start;break;case ae.PL.DueEnd:case ae.PL.NotLinked:s._due=a.isAllDay?(0,de.nT)(a.end):a.end}return e.lastModifiedDate&&(s.lastChangeId=new Date(e.lastModifiedDate).getTime()),this.trelloTimeRecordCards.push(a),a}},{kind:"method",key:"updateTrelloTimeRecordCard",value:function updateTrelloTimeRecordCard(e,t,r){var i;let a=O()(i=this.trelloTimeRecordCards).call(i,(t=>t.id===e));if(!a)return{timeRecordCardUpdated:!1};let s=!1,{providerCard:n}=a;n.boardId===this.boardId&&n.listId===this.listId||(n.boardId=this.boardId,n.listId=this.listId,s=!0),a.description!==this.description&&(a.description=this.description,s=!0),n.isArchived!==this.isArchived&&(n.isArchived=this.isArchived,s=!0),(0,de.cO)(U()(n.labelIds),U()(this.labelIds))||(n.labelIds=new(E())(this.labelIds),s=!0);let o=!1;switch(void 0!==t.comment&&a.title!==t.comment&&(a.title=t.comment,o=!0),void 0===t.from||(0,de.rs)(a.start,t.from)||(a.start=t.from,o=!0),void 0===t.to||(0,de.rs)(a.end,t.to)||(a.end=t.to,o=!0),a.isAllDay?this._dueLinkTypeAllDay:this._dueLinkType){case ae.PL.DueStart:n._due=a.isAllDay?(0,de.nT)(a.start):a.start;break;case ae.PL.DueEnd:case ae.PL.NotLinked:n._due=a.isAllDay?(0,de.nT)(a.end):a.end}if(void 0!==t.memberId){var l,d;let e=Q()(l=r.members).call(l,(e=>e.id===t.memberId))?[t.memberId]:[];(0,de.cO)(j()(d=U()(n.memberIds)).call(d,(e=>e!==le.$d)),e)||(n.memberIds=new(E())(e),o=!0)}return this.deleteTrelloTimeRecordCard(a.id),this.trelloTimeRecordCards.push(a),{timeRecordCardUpdated:s||o,timeRecordCard:a,timeRecordUpdated:o,parentCardUpdated:o}}},{kind:"method",key:"deleteTrelloTimeRecordCard",value:function deleteTrelloTimeRecordCard(e){var t;let r=W()(t=this.trelloTimeRecordCards).call(t,(t=>t.id===e));var i;-1!==r&&q()(i=this.trelloTimeRecordCards).call(i,r,1)}},{kind:"method",static:!0,key:"_deserializeCardData",value:function _deserializeCardData(e){if(!N()(e).call(e,"{")){let t=ce.from(e,"base64"),r=ie.ZP.inflate(t);e=ce.from(r).toString()}let t=JSON.parse(e);if(t){let e;var r,i;if(t.customData)e=_objectSpread(_objectSpread({},t.customData),{},{customFieldCardsData:null===(r=t.customData.customFieldCardsData)||void 0===r?void 0:L()(r).call(r,(e=>_objectSpread({},e))),checkItemCardsData:null===(i=t.customData.checkItemCardsData)||void 0===i?void 0:L()(i).call(i,(e=>{var t,r;return _objectSpread(_objectSpread({},e),{},{sync:null!==(t=e.sync)&&void 0!==t&&t,start:(0,de.HE)(e.start,e.isAllDay),end:(0,de.HE)(e.end,e.isAllDay),dateSyncType:e.dateSyncType||ae.nV.Due,dueLinkTypeAllDay:e.dueLinkTypeAllDay||e.dueLinkType,memberIds:null===(r=e.memberIds)||void 0===r?void 0:ee()(r).call(r,0,1)})}))});return{version:t.version,dataVersionId:t.dataVersionId||0,isAllDay:t.isAllDay,start:(0,de.HE)(t.start,t.isAllDay),end:(0,de.HE)(t.end,t.isAllDay),dateSyncType:t.dateSyncType||ae.nV.Due,dueLinkType:t.dueLinkType,dueLinkTypeAllDay:t.dueLinkTypeAllDay||t.dueLinkType,offsetDue:t.offsetDue?new Date(t.offsetDue):null,recurrenceRule:t.recurrenceRule,exceptionDates:fromCardDataRecurrenceException(t.recurrenceException,t.isAllDay),recurrenceId:t.recurrenceId,originalStart:t.originalStart,priority:t.priority,customData:e}}}},{kind:"method",static:!0,key:"_deserializeDescriptionCardData",value:function _deserializeDescriptionCardData(e){let t=(0,de.zD)(e);if(t.data)try{let e=CalendarCard._deserializeCardData(t.data);if(e)return{descriptionCardData:e,description:t.description}}catch{}return{description:t.description}}},{kind:"method",static:!0,key:"_deserializeCustomFieldCardData",value:function _deserializeCustomFieldCardData(e){let t=(0,de.gI)(e);if(t)try{return CalendarCard._deserializeCardData(t)}catch{}}},{kind:"method",static:!0,key:"_correctCardData",value:function _correctCardData(e,t,r,i){let a,s,n,o,l,d,c,h,u,p="v4"===(null==i?void 0:i.version)&&(0,de.qb)(i.start)&&(0,de.qb)(i.end)&&"boolean"==typeof i.isAllDay&&ae.nV.hasValue(i.dateSyncType)&&ae.PL.hasValue(i.dueLinkType)&&ae.PL.hasValue(i.dueLinkTypeAllDay);if(p){switch(d=i.dateSyncType,d){case ae.nV.StartAndDue:if(!e&&!t)return;if(c=i.dueLinkType,h=i.dueLinkTypeAllDay,i.recurrenceRule){l=i.isAllDay,u=l?h:c;break}if(e)l=!0;else{if(!i.isAllDay){l=!1,u=c;break}l=r.defaultCardIsAllDay}t&&(n=new Date(t)),e?(a=(0,de.$Y)(e),s=(0,de.$Y)(t||e),t&&(o=new Date(t))):(l?(s=(0,de.$Y)(t),a=(0,de.E4)(s,1-r.defaultCardDuration)):(a=new Date(t),s=(0,de.mH)(a,r.defaultCardDuration)),o=new Date(t));break;case ae.nV.Due:if(!t)return;l=i.isAllDay,c=i.dueLinkType,h=i.dueLinkTypeAllDay,u=l?h:c}if(u)switch(u){case ae.PL.DueStart:case ae.PL.DueEnd:if(n=new Date(t),l)if(r.defaultCardIsAllDay){if(i.recurrenceRule)a=new Date(i.start),s=new Date(i.end);else{let e=(0,de.i2)(i.start,i.end);u===ae.PL.DueStart?(a=(0,de.$Y)(t),s=(0,de.E4)(a,e)):(s=(0,de.$Y)(t),a=(0,de.E4)(s,-e))}o=new Date(t)}else{let e=(0,de.i2)(i.offsetDue,t);i.recurrenceRule?(a=new Date(i.start),s=new Date(i.end)):(a=(0,de.E4)(i.start,e),s=(0,de.E4)(i.end,e)),o=(0,de.E4)(i.offsetDue,e)}else{let e=(0,de.CX)(i.offsetDue,t);i.recurrenceRule?(a=new Date(i.start),s=new Date(i.end)):(a=(0,de.mH)(i.start,e),s=(0,de.mH)(i.end,e)),o=new Date(t)}break;case ae.PL.NotLinked:a=new Date(i.start),s=new Date(i.end)}}else switch(d=r.dateSyncType,d){case ae.nV.StartAndDue:if(!e&&!t)return;if(e){l=!0;let r=t||e;a=(0,de.$Y)(e),s=(0,de.$Y)(r)}else l=r.defaultCardIsAllDay,l?(s=(0,de.$Y)(t),a=(0,de.E4)(s,1-r.defaultCardDuration)):(a=new Date(t),s=(0,de.mH)(a,r.defaultCardDuration));t&&(n=new Date(t),o=new Date(t)),c=ae.PL.DueStart,h=ae.PL.DueEnd;break;case ae.nV.Due:if(!t)return;l=r.defaultCardIsAllDay,c=r.dueLinkType,h=r.dueLinkTypeAllDay,u=l?h:c,u===ae.PL.DueStart?l?(a=(0,de.$Y)(t),s=(0,de.E4)(a,r.defaultCardDuration-1)):(a=new Date(t),s=(0,de.mH)(a,r.defaultCardDuration)):l?(s=(0,de.$Y)(t),a=(0,de.E4)(s,1-r.defaultCardDuration)):(s=new Date(t),a=(0,de.mH)(s,-r.defaultCardDuration)),n=new Date(t),u!==ae.PL.NotLinked&&(o=new Date(t))}return s<a&&(a=new Date(s)),{hasPlanywayDates:p,isAllDay:l,start:a,end:s,dateSyncType:d,dueLinkType:c,dueLinkTypeAllDay:h,realDue:n,offsetDue:o}}},{kind:"method",static:!0,key:"_getLastCard",value:function _getLastCard(e){let t=e.clone();return t._lastCard=void 0,t}},{kind:"method",key:"_serializeCardData",value:function _serializeCardData(){var e,t,r,i,a;this.customFieldCardsData=j()(e=this.customFieldCardsData).call(e,(e=>{var t;return Q()(t=this.trelloCustomFieldCards).call(t,(t=>t.id===e.id||t.trelloCustomFieldId===e.customFieldId))})),this.checkItemCardsData=j()(t=this.checkItemCardsData).call(t,(e=>{var t;return Q()(t=this.trelloCheckItemCards).call(t,(t=>t.id===e.id))}));let s=function toCalendarRecurrenceException(e,t){if(e&&e.length>0)return L()(e).call(e,(e=>t?(0,de.tC)(e):e.toISOString()))}(this.exceptionDates,this.isAllDay);if(!(this.hasDates||this._dueLinkType||this._dueLinkTypeAllDay||this._offsetDue||this.recurrenceRule||s||this.recurrenceId||this._originalStart||this.cardRole!==ae.D.Card||0!==this.priority||this.defaultSortOrder!==Number.POSITIVE_INFINITY||this.membersSortOrder!==Number.POSITIVE_INFINITY||this.calendarsSortOrder!==Number.POSITIVE_INFINITY||this.listsSortOrder!==Number.POSITIVE_INFINITY||this.labelsSortOrder!==Number.POSITIVE_INFINITY||0!==this.links.length||0!==this.customFieldCardsData.length||0!==this.checkItemCardsData.length||0!==this.notifications.length||this.estimationHours))return;let n=_objectSpread(_objectSpread({},this.customData),{},{originalCardId:this.isTempCard?void 0:this.id,customFieldCardsData:L()(r=this.customData.customFieldCardsData).call(r,(e=>_objectSpread({},e))),checkItemCardsData:L()(i=this.customData.checkItemCardsData).call(i,(e=>_objectSpread(_objectSpread({},e),{},{start:e.isAllDay?(0,de.tC)(e.start):e.start,end:e.isAllDay?(0,de.tC)(e.end):e.end}))),estimationHours:null!==(a=this.customData.estimationHours)&&void 0!==a?a:void 0}),o={version:"v4",dataVersionId:this.lastDataVersionId,isAllDay:this.isAllDay,start:this.isAllDay?(0,de.tC)(this.start):this.start,end:this.isAllDay?(0,de.tC)(this.end):this.end,dateSyncType:this._dateSyncType,dueLinkType:this._dueLinkType,dueLinkTypeAllDay:this._dueLinkTypeAllDay,offsetDue:this._offsetDue,recurrenceRule:this.recurrenceRule,recurrenceException:s,recurrenceId:this.recurrenceId,originalStart:this._originalStart,priority:this.priority,customData:n},l=H()(o,((e,t)=>{if(null!==t&&t!==Number.POSITIVE_INFINITY)return t})),d=ce.from(l),c=ie.ZP.deflate(d);return ce.from(c).toString("base64")}},{kind:"method",key:"_serializeDescriptionCardData",value:function _serializeDescriptionCardData(){let e=this._serializeCardData();return e?`${this.description}‌\n\n---\n[Planyway Data - do not delete this link](https://planyway.com?cardData=${e})`:this.description}},{kind:"method",key:"_serializeCustomFieldCardData",value:function _serializeCustomFieldCardData(){let e=this._serializeCardData();return e?`Do not edit (${e})`:""}},{kind:"method",key:"_getLastOccurrenceDate",value:function _getLastOccurrenceDate(){if(!this.recurrenceRule)return;let e,t=(0,de._q)(this.start),r=new se.Ci(_objectSpread(_objectSpread({},se.Ci.parseString(this.recurrenceRule)),{},{dtstart:t}));if(r.origOptions.count||r.origOptions.until)if(e=r.before((0,de._q)(r.origOptions.until)||he,!0),e){let r=(0,de.i2)(t,e);e=(0,de.E4)(this.start,r)}else e=new Date(this.start);else e=new Date(he);if((this.isAllDay?this._dueLinkTypeAllDay:this._dueLinkType)!==ae.PL.DueStart)if(this.isAllDay){let t=(0,de.i2)(this.start,this.end);e=(0,de.E4)(e,t)}else{let t=(0,de.CX)(this.start,this.end);e=(0,de.mH)(e,t)}return e}},{kind:"method",key:"_correctDueDateAsStartDate",value:function _correctDueDateAsStartDate(){let e=this._getLastOccurrenceDate();this._realDue=new Date(e||this.start),this._offsetDue=new Date(this._realDue)}},{kind:"method",key:"_correctAllDayDueDateAsStartDate",value:function _correctAllDayDueDateAsStartDate(e){let t=this._getLastOccurrenceDate();if(e&&e.defaultCardIsAllDay||!this._lastCard||this._dueLinkTypeAllDay!==this._lastCard._dueLinkTypeAllDay||!this._lastCard.isAllDay||!this._lastCard._realDue||!this._lastCard._offsetDue||this._lastCard.recurrenceRule||t)this._realDue=(0,de.nT)(t||this.start),this._offsetDue=new Date(this._realDue);else{let e=(0,de.i2)(this._lastCard.start,this.start);this._realDue=(0,de.E4)(this._lastCard._realDue,e),this._offsetDue=(0,de.E4)(this._lastCard._offsetDue,e)}}},{kind:"method",key:"_correctDueDateAsEndDate",value:function _correctDueDateAsEndDate(){let e=this._getLastOccurrenceDate();this._realDue=new Date(e||this.end),this._offsetDue=new Date(this._realDue)}},{kind:"method",key:"_correctAllDayDueDateAsEndDate",value:function _correctAllDayDueDateAsEndDate(e){let t=this._getLastOccurrenceDate();if(e&&e.defaultCardIsAllDay||!this._lastCard||this._dueLinkTypeAllDay!==this._lastCard._dueLinkTypeAllDay||!this._lastCard.isAllDay||!this._lastCard._realDue||!this._lastCard._offsetDue||this._lastCard.recurrenceRule||t)this._realDue=(0,de.nT)(t||this.end),this._offsetDue=new Date(this._realDue);else{let e=(0,de.i2)(this._lastCard.end,this.end);this._realDue=(0,de.E4)(this._lastCard._realDue,e),this._offsetDue=(0,de.E4)(this._lastCard._offsetDue,e)}}},{kind:"method",key:"_correctDueDateAsNotLinked",value:function _correctDueDateAsNotLinked(){let e=this._getLastOccurrenceDate();(this.isTempCard||!this._lastCard||!this._lastCard.hasDates||this._lastCard.recurrenceRule&&!e)&&(this._realDue=new Date(e||this.end))}},{kind:"method",key:"_correctAllDayDueDateAsNotLinked",value:function _correctAllDayDueDateAsNotLinked(){let e=this._getLastOccurrenceDate();(this.isTempCard||!this._lastCard||!this._lastCard.hasDates||this._lastCard.recurrenceRule&&!e)&&(this._realDue=(0,de.nT)(e||this.end))}},{kind:"method",key:"_toCustomFieldCardData",value:function _toCustomFieldCardData(){if(this.hasDates)return{id:this.id,customFieldId:this.trelloCustomFieldId,isAllDay:this.isAllDay,isCompleted:this.isCompleted,defaultSortOrder:this.defaultSortOrder,membersSortOrder:this.membersSortOrder,calendarsSortOrder:this.calendarsSortOrder,listsSortOrder:this.listsSortOrder,labelsSortOrder:this.labelsSortOrder}}},{kind:"method",static:!0,key:"_correctCheckItemCardData",value:function _correctCheckItemCardData(e,t,r){let i,a,s,n,o,l,d,c;if(r&&(0,de.qb)(r.start)&&(0,de.qb)(r.end)&&"boolean"==typeof r.isAllDay&&ae.nV.hasValue(r.dateSyncType)&&ae.PL.hasValue(r.dueLinkType)&&ae.PL.hasValue(r.dueLinkTypeAllDay))switch(n=r.isAllDay,l=r.dueLinkType,d=r.dueLinkTypeAllDay,c=n?d:l,c){case ae.PL.DueStart:case ae.PL.DueEnd:if(!e)return;if(s=new Date(e),n){let t=(0,de.i2)(r.start,r.end);c===ae.PL.DueStart?(i=(0,de.$Y)(e),a=(0,de.E4)(i,t)):(a=(0,de.$Y)(e),i=(0,de.E4)(a,-t))}else{let t=(0,de.CX)(r.start,r.end);c===ae.PL.DueStart?(i=new Date(e),a=(0,de.mH)(i,t)):(a=new Date(e),i=(0,de.mH)(a,-t))}break;case ae.PL.NotLinked:if(null===e)return;i=new Date(r.start),a=new Date(r.end)}else{if(!e)return;let r;switch(o=t.dateSyncType,n=t.defaultCardIsAllDay,r=t.defaultCardDuration,o){case ae.nV.StartAndDue:l=ae.PL.DueStart,d=ae.PL.DueEnd;break;case ae.nV.Due:l=t.dueLinkType,d=t.dueLinkTypeAllDay}c=n?d:l,c===ae.PL.DueStart?n?(i=(0,de.$Y)(e),a=(0,de.E4)(i,r-1)):(i=new Date(e),a=(0,de.mH)(i,r)):n?(a=(0,de.$Y)(e),i=(0,de.E4)(a,1-r)):(a=new Date(e),i=(0,de.mH)(a,-r)),s=new Date(e)}return a<i&&(i=new Date(a)),{isAllDay:n,start:i,end:a,dueLinkType:l,dueLinkTypeAllDay:d,realDue:s}}},{kind:"method",key:"_toCheckItemCardData",value:function _toCheckItemCardData(e,t){if(this._dueLinkType=void 0,this._dueLinkTypeAllDay=void 0,t&&(this._realDue=void 0),this.hasDates){switch(e.dateSyncType){case ae.nV.StartAndDue:this._dueLinkType=ae.PL.DueStart,this._dueLinkTypeAllDay=ae.PL.DueEnd;break;case ae.nV.Due:this._dueLinkType=e.dueLinkType,this._dueLinkTypeAllDay=e.dueLinkTypeAllDay}if(t)if(this.isAllDay)switch(this._dueLinkTypeAllDay){case ae.PL.DueStart:this._correctAllDayCheckItemDueDateAsStartDate(e);break;case ae.PL.DueEnd:this._correctAllDayCheckItemDueDateAsEndDate(e);break;case ae.PL.NotLinked:this._correctAllDayCheckItemDueDateAsNotLinked()}else switch(this._dueLinkType){case ae.PL.DueStart:this._correctCheckItemDueDateAsStartDate();break;case ae.PL.DueEnd:this._correctCheckItemDueDateAsEndDate();break;case ae.PL.NotLinked:this._correctCheckItemDueDateAsNotLinked()}}if(this._lastCard=CalendarCard._getLastCard(this),this.hasDates||this.hasMembers){var r;let e={id:this.id,sync:this._sync,memberIds:j()(r=U()(this.memberIds)).call(r,(e=>e!==le.$d)),defaultSortOrder:this.defaultSortOrder,membersSortOrder:this.membersSortOrder,calendarsSortOrder:this.calendarsSortOrder,listsSortOrder:this.listsSortOrder,labelsSortOrder:this.labelsSortOrder};return this.hasDates&&(e.isAllDay=this.isAllDay,e.start=this.start,e.end=this.end,e.dueLinkType=this._dueLinkType,e.dueLinkTypeAllDay=this._dueLinkTypeAllDay),e}}},{kind:"method",key:"_correctCheckItemDueDateAsStartDate",value:function _correctCheckItemDueDateAsStartDate(){this._realDue=new Date(this.start)}},{kind:"method",key:"_correctAllDayCheckItemDueDateAsStartDate",value:function _correctAllDayCheckItemDueDateAsStartDate(e){if(e&&e.defaultCardIsAllDay||!this._lastCard||this._dueLinkTypeAllDay!==this._lastCard._dueLinkTypeAllDay||!this._lastCard.isAllDay||!this._lastCard._realDue)this._realDue=(0,de.nT)(this.start);else{let e=(0,de.i2)(this._lastCard.start,this.start);this._realDue=(0,de.E4)(this._lastCard._realDue,e)}}},{kind:"method",key:"_correctCheckItemDueDateAsEndDate",value:function _correctCheckItemDueDateAsEndDate(){this._realDue=new Date(this.end)}},{kind:"method",key:"_correctAllDayCheckItemDueDateAsEndDate",value:function _correctAllDayCheckItemDueDateAsEndDate(e){if(e&&e.defaultCardIsAllDay||!this._lastCard||this._dueLinkTypeAllDay!==this._lastCard._dueLinkTypeAllDay||!this._lastCard.isAllDay||!this._lastCard._realDue)this._realDue=(0,de.nT)(this.end);else{let e=(0,de.i2)(this._lastCard.end,this.end);this._realDue=(0,de.E4)(this._lastCard._realDue,e)}}},{kind:"method",key:"_correctCheckItemDueDateAsNotLinked",value:function _correctCheckItemDueDateAsNotLinked(){(this.isTempCard||!this._lastCard||!this._lastCard.hasDates||!this._lastCard._sync&&this._sync)&&(this._realDue=this.end)}},{kind:"method",key:"_correctAllDayCheckItemDueDateAsNotLinked",value:function _correctAllDayCheckItemDueDateAsNotLinked(){(this.isTempCard||!this._lastCard||!this._lastCard.hasDates||!this._lastCard._sync&&this._sync)&&(this._realDue=(0,de.nT)(this.end))}}]}}));function fromCardDataRecurrenceException(e,t){return re()(e)?L()(e).call(e,(e=>(0,de.HE)(e,t))):e?j()(r=L()(i=e.split(",")).call(i,de.RF)).call(r,(e=>(0,de.qb)(e))):void 0;var r,i}function getTrelloCardId(e){return e}function toggleLabel(e,t){let{providerCard:r}=e,i=new(E())(r.labelIds);return i.has(t)?i.delete(t):i.add(t),0===i.size?i.add(le.$d):i.size>1&&i.delete(le.$d),i}function isMemberRequired(e){return e.cardType===ae.eT.TrelloTimeRecord}function isMultipleMembersSupported(e){switch(e.cardType){case ae.eT.TrelloCheckItem:case ae.eT.TrelloTimeRecord:return!1;default:return!0}}function toggleMember(e,t){let{providerCard:r}=e,i=new(E())(r.memberIds);return isMultipleMembersSupported(e)?i.has(t)?(!isMemberRequired(e)||i.size>1)&&i.delete(t):i.add(t):i.has(t)?isMemberRequired(e)||(i=new(E())):i=new(E())([t]),0===i.size?i.add(le.$d):i.size>1&&i.delete(le.$d),i}},79243:(e,t,r)=>{r.d(t,{g4:()=>getExtraStyle,vA:()=>v});var i=r(82617);const a='<g fill="none"><path d="M9.348 3.723l-.707-.707-3.813 3.812L3.5 5.5l-.707.707 2.035 2.036 4.52-4.52z" fill="\\#8b8e93"/><path fill-rule="evenodd" clip-rule="evenodd" d="M6 12A6 6 0 106 0a6 6 0 000 12zm0-1A5 5 0 106 1a5 5 0 000 10z" fill="\\#8b8e93"/></g>',s='<g fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 12A6 6 0 106 0a6 6 0 000 12zm3.348-8.277l-.707-.707-3.813 3.812L3.5 5.5l-.707.707 2.035 2.036 4.52-4.52z" fill="\\#8b8e93"/></g>',n='<path d="M1.5 2a.5.5 0 000 1h5a.5.5 0 000-1h-5z" fill="\\#8e8e93"/><path fill-rule="evenodd" clip-rule="evenodd" d="M11 9a1 1 0 01-1 1H2a1 1 0 01-1-1V6a1 1 0 011-1h8a1 1 0 011 1v3zm-1 0H2V6h8v3z" fill="\\#8b8e93"/>',o="\n# if (!hiddenElements.cardNumber) { #\n# if (data.providerCard.cardNumber) { #\n    #: '\\#' + data.providerCard.cardNumber + ' ' #\n# } #\n# } #\n",l=`\n# var cardMembers = cardProvider.getCardMembers(data); #\n# if (cardMembers.length > 0 && (!hiddenElements.membersIcon || data.cardRole === '${i.D.Milestone}')) { #\n<div class="pw-card__icons">\n    # if (cardMembers.length === 1) { #\n    # var cardMember = cardMembers[0]; #\n    # if (cardMember.avatarUrlSmall) {#\n    <div class="pw-card__members pw-member-avatar">\n    # } else { #\n    # var memberColorHash = cardProvider.getCardMemberBackground(cardMember.id) #\n    <div class="pw-card__members pw-member-avatar pw-member-avatar_#= memberColorHash #">\n    # } #\n        # if (cardMember.avatarUrlSmall) { #\n        <img\n            class="pw-member-avatar__image"\n            src="#= cardMember.avatarUrlSmall #"\n        >\n        # } else { #\n        <svg\n            class="pw-member-avatar__initials"\n            viewBox="0 0 26 26"\n        >\n            <text\n                x="13"\n                y="18"\n                text-anchor="middle"\n            >\n                #: cardMember.initials #\n            </text>\n        </svg>\n        # } #\n    </div>\n    # } else if (cardMembers.length > 1) { #\n    <div class="pw-card__members mdi mdi-account-multiple"></div>\n    # } #\n</div>\n# } #\n`,d='\n# if (!hiddenElements.estimation) { #\n# var estimation = cardProvider.getCardEstimation(data) #\n# if (estimation) { #\n<span class="pw-card__estimation">\n    <svg width="12px" height="12px" class="pw-card__estimation-icon"><path d="M2.5 1v3l2.25 2L2.5 8v3h7V8L7.25 6 9.5 4V1h-7zm6 7.33V10h-5V8.33L6 6l2.5 2.33zM6 6L3.5 3.67V2h5v1.67L6 6z" fill="\\#8b8e93"/></svg>\n    #: estimation #\n</span>\n# } #\n# } #\n',c='\n# if (!hiddenElements.timeTracking) { #\n# var totalTimeRecordDuration = cardProvider.getCardTotalTimeRecordDuration(data) #\n# if (totalTimeRecordDuration) { #\n    # var isCardUnderestimated = cardProvider.isCardUnderestimated(data) #\n    # if (isCardUnderestimated) { #\n    <span class="pw-card__time-tracking pw-card__time-tracking--underestimated">\n    # } else { #\n    <span class="pw-card__time-tracking">\n    # } #\n        <svg width="12px" height="12px" class="pw-card__time-tracking-icon"><path d="M4 .5c0-.28.22-.5.5-.5h3a.5.5 0 010 1h-3A.5.5 0 014 .5zM6.5 4.5a.5.5 0 00-1 0v2a.5.5 0 001 0v-2z" fill="\\#8b8e93"/><path fill-rule="evenodd" clip-rule="evenodd" d="M6 11.5a5 5 0 004.1-7.87l.72-.74a.5.5 0 10-.7-.7l-.68.68A4.98 4.98 0 001 6.5a5 5 0 005 5zm0-1c2.3 0 4-1.7 4-4s-1.7-4-4-4-4 1.7-4 4 1.7 4 4 4z" fill="\\#8b8e93"/></svg>\n        #: totalTimeRecordDuration #\n    </span>\n# } #\n# } #\n',h='\n# if (!hiddenElements.checkItems) { #\n# var badges = data.providerCard.badges #\n# if (badges.checkItems > 0) { #\n<span class="pw-card__check-items">\n    <svg width="7" height="9" class="pw-card__check-items-icon"><path d="M2 1a.5.5 0 1 0-1 0v5.167c0 .486.193.953.537 1.296S2.347 8 2.833 8H6c.333-.333 0-1 0-1H2.833c-.221 0-.433-.088-.589-.244S2 6.388 2 6.167V1z"/><path d="M2.625 1.125c0 .621-.504 1.125-1.125 1.125S.375 1.746.375 1.125.879 0 1.5 0s1.125.504 1.125 1.125zM7 7.5c0 .621-.504 1.125-1.125 1.125S4.75 8.121 4.75 7.5s.504-1.125 1.125-1.125S7 6.879 7 7.5zm0-3c0 .621-.504 1.125-1.125 1.125S4.75 5.121 4.75 4.5s.504-1.125 1.125-1.125S7 3.879 7 4.5z"/><path d="M5.5 4v1h-4V4h4z"/></svg>\n    #: badges.checkItemsChecked #/#: badges.checkItems #\n</span>\n# } #\n# } #\n',u='\n# if (!hiddenElements.calendar) { #\n# var calendarName = cardProvider.getCardCalendarName(data) #\n# if (calendarName) { #\n<div class="pw-card__calendar">\n    #: calendarName #\n</div>\n# } #\n# } #\n',p='\n# if (!hiddenElements.taskList) { #\n# var taskListName = cardProvider.getCardTaskListName(data) #\n# if (taskListName) { #\n<div class="pw-card__task-list">\n    #: taskListName #\n</div>\n# } #\n# } #\n',m=`\n# var hiddenElements = data.$ctrl.hiddenCardElements; #\n# var cardProvider = data.$ctrl.getCardProvider(data); #\n# var labels = cardProvider.getCardLabelsColors(data); #\n\n# if (data.cardType !== '${i.eT.TrelloTimeRecord}') { #\n\x3c!-- Приоритет для карточек, поддерживающих его --\x3e\n<div class="pw-card__priority"></div>\n# } #\n\n# if (data.cardRole !== '${i.D.Milestone}' && labels && labels.length > 0) { #\n\x3c!-- Список лейблов, не являющихся вехами --\x3e\n<div class="pw-card__labels">\n    # for (var i = 0; i < labels.length; i++) { #\n    <div class="pw-card__label #= 'pw-card__label-' + labels[i] #"></div>\n    # } #\n</div>\n# } #\n\n# if (data.cardType === '${i.eT.TrelloTimeRecord}') { #\n\x3c!-- Карточки, созданные на основе записи времени --\x3e\n<div class="pw-card__content pw-js-card-content">\n    ${l}\n\n    <div class="pw-card__title pw-js-card-title">\n        # if (data.title) { #\n        <span class="pw-card__title-text">\n            ${o}\n\n            #: data.title #\n        </span>\n\n        <span class="pw-card__sub-title">\n            <span><&nbsp#: cardProvider.getCardParentTitle(data) || data.noTitle #</span>\n        </span>\n        # } else { #\n        <span class="pw-card__sub-title">\n            <span>#:cardProvider.getCardParentTitle(data) || data.noTitle #</span>\n        </span>\n        # } #\n\n        # if (data.timeDurationText) { #\n        <span class="pw-card__time pw-card__time-duration pw-js-card-time-duration">#: data.timeDurationText #</span>\n        # } #\n    </div>\n\n    <div class="pw-card__details">\n        # if (data.timeText) { #\n        <span class="pw-card__time pw-js-card-time">#: data.timeText #</span>\n        # } #\n\n        ${u}\n        # if (!hiddenElements.calendar && !hiddenElements.taskList && data.accountId && data.calendarId) { #\n        <p class="pw-card__divider"> /</p>\n        # } #\n        ${p}\n    </div>\n</div>\n# } else { #\n\x3c!-- Карточки Trello и карточки, созданные на основе пользовательских полей и элементов чек-листов --\x3e\n<div class="pw-card__complete-icon pw-js-card-complete-button">\n    <svg width="12px" height="12px">${s}</svg>\n    <svg width="12px" height="12px">${a}</svg>\n</div>\n\n<div class="pw-card__content pw-js-card-content">\n    ${l}\n\n    <div class="pw-card__title pw-js-card-title">\n        \x3c!-- Нет переносов для правильной работы text-decoration: line-through --\x3e\n        <span class="pw-card__title-text">${o} #: data.title || data.noTitle #</span>\n\n        # if (data.cardType === '${i.eT.TrelloCheckItem}') { #\n        <span class="pw-card__sub-title">\n            <span><&nbsp#: cardProvider.getCardParentTitle(data) || data.noTitle #</span>\n        </span>\n        # } #\n\n        # if (data.cardType === '${i.eT.TrelloCustomField}') { #\n        <span class="pw-card__sub-title">\n            <div class="pw-card__custom-field-icon">\n                <svg width="12px" height="12px">${n}</svg>\n            </div>\n\n            <span>#: cardProvider.getCardCustomFieldName(data) #</span>\n        </span>\n        # } #\n    </div>\n\n    <div class="pw-card__details">\n        # if (data.timeText) { #\n        <span class="pw-card__time pw-js-card-time">#: data.timeText #</span>\n        # } #\n\n        ${h}\n\n        # if (data.cardType === '${i.eT.TrelloCard}') { #\n        <div class="pw-card__tracking">${d}${c}</div>\n        # } #\n\n            ${u}\n            # if (!hiddenElements.calendar && !hiddenElements.taskList && data.accountId && data.calendarId) { #\n            <p class="pw-card__divider"> /</p>\n            # } #\n            ${p}\n        </div>\n    </div>\n# } #\n`,C=`\n# var hiddenElements = data.$ctrl.hiddenCardElements; #\n# var cardProvider = data.$ctrl.getCardProvider(data); #\n# var labels = cardProvider.getCardLabelsColors(data); #\n\n# if (data.cardType !== '${i.eT.TrelloTimeRecord}') { #\n\x3c!-- Приоритет для карточек, поддерживающих его --\x3e\n<div class="pw-card__priority"></div>\n# } #\n\n# if (data.cardRole !== '${i.D.Milestone}' && labels && labels.length > 0) { #\n\x3c!-- Список лейблов для карточек, не являющихся вехами --\x3e\n<div class="pw-card__labels">\n    # for (var i = 0; i < labels.length; i++) { #\n    <div class="pw-card__label #= 'pw-card__label-' + labels[i] #"></div>\n    # } #\n</div>\n# } #\n\n# if (data.cardType === '${i.eT.TrelloTimeRecord}') { #\n\x3c!-- Карточки, созданнае на основе записи времени --\x3e\n# if (data.timeShortText) { #\n<span class="pw-card__time pw-card__time-short pw-js-card-time-short">#: data.timeShortText #</span>\n# } #\n\n<div class="pw-card__content pw-js-card-content">\n    ${l}\n\n    <div class="pw-card__title pw-js-card-title">\n        # if (data.title) { #\n        <span class="pw-card__title-text">\n            ${o}\n\n            #: data.title #\n        </span>\n\n        <span class="pw-card__sub-title">\n            <span><&nbsp#: cardProvider.getCardParentTitle(data) || data.noTitle #</span>\n        </span>\n        # } else { #\n        <span class="pw-card__sub-title">\n            <span>#:cardProvider.getCardParentTitle(data) || data.noTitle #</span>\n        </span>\n        # } #\n\n        # if (data.timeDurationText) { #\n        <span class="pw-card__time pw-card__time-duration pw-js-card-time-duration">#: data.timeDurationText #</span>\n        # } #\n    </div>\n\n    # if (!hiddenElements.calendar || !hiddenElements.taskList || !hiddenElements.dates || !hiddenElements.estimation || !hiddenElements.timeTracking || !hiddenElements.checkItems) { #\n    <div class="pw-card__details">\n        # if (!hiddenElements.dates && data.timeDateText) { #\n        <span class="pw-card__time pw-js-card-time-date">#: data.timeDateText #</span>\n        # } else { #\n        # if (data.timeText) { #\n        <span class="pw-card__time pw-js-card-time">#: data.timeText #</span>\n        # } #\n        # } #\n\n        # if (data.cardType === '${i.eT.TrelloCard}') { #\n        <div class="pw-card__tracking">${d}${c}</div>\n        # } #\n\n        ${u}\n        # if (!hiddenElements.calendar && !hiddenElements.taskList && data.accountId && data.calendarId) { #\n        <p class="pw-card__divider"> /</p>\n        # } #\n        ${p}\n    </div>\n    # } #\n</div>\n# } else { #\n\x3c!-- Карточки Trello и карточки, созданные на основе пользовательских полей и элементов чек-листов --\x3e\n<div class="pw-card__complete-icon pw-js-card-complete-button">\n    <svg width="12px" height="12px">${s}</svg>\n    <svg width="12px" height="12px">${a}</svg>\n</div>\n\n# if (data.timeShortText) { #\n<span class="pw-card__time pw-card__time-short pw-js-card-time-short">#: data.timeShortText #</span>\n# } #\n\n<div class="pw-card__content pw-js-card-content">\n    ${l}\n\n    <div class="pw-card__title pw-js-card-title">\n        \x3c!-- Нет переносов для правильной работы text-decoration: line-through --\x3e\n        <span class="pw-card__title-text">${o} #: data.title || data.noTitle #</span>\n\n        # if (data.cardType === '${i.eT.TrelloCheckItem}') { #\n        <span class="pw-card__sub-title">\n            <span><&nbsp#: cardProvider.getCardParentTitle(data) || data.noTitle #</span>\n        </span>\n        # } #\n\n        # if (data.cardType === '${i.eT.TrelloCustomField}') { #\n        <span class="pw-card__sub-title">\n            <div class="pw-card__custom-field-icon">\n                <svg width="12px" height="12px">${n}</svg>\n            </div>\n\n            <span>#: cardProvider.getCardCustomFieldName(data) #</span>\n        </span>\n        # } #\n    </div>\n\n    # if (!hiddenElements.calendar || !hiddenElements.taskList || !hiddenElements.dates || !hiddenElements.estimation || !hiddenElements.timeTracking || !hiddenElements.checkItems) { #\n    <div class="pw-card__details">\n        # if (!hiddenElements.dates && data.timeDateText) { #\n        <span class="pw-card__time pw-js-card-time-date">#: data.timeDateText #</span>\n        # } else { #\n        # if (data.timeText) { #\n        <span class="pw-card__time pw-js-card-time">#: data.timeText #</span>\n        # } #\n        # } #\n\n        ${h}\n\n        # if (data.cardType === '${i.eT.TrelloCard}') { #\n        <div class="pw-card__tracking">${d}${c}</div>\n        # } #\n\n        ${u}\n        # if (!hiddenElements.calendar && !hiddenElements.taskList && data.accountId && data.calendarId) { #\n        <p class="pw-card__divider"> /</p>\n        # } #\n        ${p}\n    </div>\n    # } #\n</div>\n# } #\n`,getExtraStyle=()=>"",v={hourSlot:kendo.template(m,{useWithBlock:!1}),daySlot:kendo.template(C,{useWithBlock:!1})}},53802:(e,t,r)=>{r.d(t,{Fr:()=>o});var i=r(84705),a=r.n(i);const s=a()('\n<div class="pw-calendar-icon pw-calendar-icon--trello-board pw-calendar-icon--trello-board_#= data.resourceData.calendarColor #">\n    # if (data.resourceData.boardImageUrl) { #\n    <img\n        class="pw-calendar-icon__image"\n        src="#= data.resourceData.boardImageUrl #"\n    >\n    # } #\n</div>\n').call('\n<div class="pw-calendar-icon pw-calendar-icon--trello-board pw-calendar-icon--trello-board_#= data.resourceData.calendarColor #">\n    # if (data.resourceData.boardImageUrl) { #\n    <img\n        class="pw-calendar-icon__image"\n        src="#= data.resourceData.boardImageUrl #"\n    >\n    # } #\n</div>\n'),n=a()('\n<div class="pw-timeline-resource__label-point pw-timeline-resource__label-point--color_#= data.resourceData.color #"></div>\n<div class="pw-timeline-resource__name pw-timeline-resource__label-name pw-timeline-resource__label-name--color_#= data.resourceData.color #">\n    #: data.name #\n</div>\n').call('\n<div class="pw-timeline-resource__label-point pw-timeline-resource__label-point--color_#= data.resourceData.color #"></div>\n<div class="pw-timeline-resource__name pw-timeline-resource__label-name pw-timeline-resource__label-name--color_#= data.resourceData.color #">\n    #: data.name #\n</div>\n'),o={resourceIcon:kendo.template(s,{useWithBlock:!1}),labelIcon:kendo.template(n,{useWithBlock:!1})}},43077:(e,t,r)=>{function getMemberIconTemplate(e,t){return`\n        <pw-member-avatar\n            account-id="${e}"\n            member-id="${t}"\n            member-type="Trello"\n            avatar-size="small"\n            show-name-tooltip="false"\n        ></pw-member-avatar>\n    `}function getBoardIconTemplate(e,t){return`\n        <pw-trello-board-icon\n            account-id="${e}"\n            calendar-id="${t}"\n            icon-size="small"\n        ></pw-trello-board-icon>\n    `}function getLabelIconTemplate(e){return`\n        <div class="pw-menu-resources-item__label pw-menu-resources-item__label--color_${e}"></div>\n    `}function getListIconTemplate(e,t){return`\n        <pw-trello-board-icon\n            account-id="${e}"\n            calendar-id="${t}"\n            icon-size="small"\n        ></pw-trello-board-icon>\n    `}r.d(t,{L0:()=>getLabelIconTemplate,TG:()=>getMemberIconTemplate,rg:()=>getBoardIconTemplate,rn:()=>getListIconTemplate})},35002:(e,t,r)=>{r.d(t,{p:()=>We});var i=r(40024),a=r.n(i),s=r(57445),n=r.n(s),o=r(51791),l=r.n(o),d=r(56626),c=r.n(d),h=r(67552),u=r.n(h),p=r(52020),m=r.n(p),C=r(88546),v=r.n(C),f=r(66775),y=r.n(f),g=r(2201),_=r.n(g),k=r(26171),b=r(41266),T=r(26881),S=r(89221),I=r.n(S),w=r(99595),D=r.n(w),E=r(54847),A=r.n(E),L=r(23513),R=r.n(L),x=r(35820),P=r.n(x),M=r(88946),B=r.n(M),O=r(29898),$=r.n(O),N=r(91829),F=r.n(N),j=r(73324),z=r.n(j),U=r(27525),G=r.n(U),V=r(55243),K=r.n(V),H=r(40703),Z=r.n(H),W=r(76555),Y=r.n(W),q=r(86981),X=r.n(q),Q=r(10349),J=r.n(Q),ee=r(91993),te=r.n(ee),re=r(62079),ie=r.n(re),ae=r(39290),se=r.n(ae),ne=r(90143),oe=r.n(ne),le=r(59863),de=r.n(le),ce=r(49804),he=r.n(ce),ue=r(68052),pe=r.n(ue),me=r(57647),Ce=r.n(me),ve=r(8571),fe=r.n(ve),ye=r(45181),ge=r.n(ye),_e=r(35704),ke=r.n(_e),be=r(98235),Te=r.n(be),Se=r(31082),Ie=r.n(Se),we=r(99166),De=r(17673),Ee=r(82617),Ae=r(56777),Le=(r(43611),r(20115)),Re=r(8937),xe=r(29704),Pe=r(46930),Me=r(54840);const Be=["cardDataCustomFieldValue"],Oe=["cardDataCustomFieldValue"],$e=["isCompleted","isAllDay","start","end","defaultSortOrder","membersSortOrder","calendarsSortOrder","listsSortOrder","labelsSortOrder"],Ne=["title","isCompleted","isAllDay","start","end","memberIds","defaultSortOrder","membersSortOrder","calendarsSortOrder","listsSortOrder","labelsSortOrder"],Fe=["title","isAllDay","start","end","durationMinutes","memberIds"],je=["cardDataCustomFieldValue"],ze=["lastBoardModifiedDate"],Ue=["lastBoardModifiedDate"],Ge=["lastBoardModifiedDate"];function ownKeys(e,t){var r=ie()(e);if(m()){var i=m()(e);t&&(i=z()(i).call(i,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?D()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,k.Z)(e,t,a[t])})):y()?_()(e,y()(a)):D()(i=ownKeys(Object(a))).call(i,(function(t){n()(e,t,v()(a,t))}))}return e}function _getDecoratorsApi(){_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;D()(r=["method","field"]).call(r,(function(r){D()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;D()(r=["method","field"]).call(r,(function(r){D()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}n()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(D()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),D()(e).call(e,(function(e){if(!_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==l()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];oe()(n).call(n,l()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),d=this.toElementFinisherExtras((0,a[s])(o)||o);e=d.element,this.addElementPlacement(e,t),d.finisher&&i.push(d.finisher);var c=d.extras;if(c){for(var h=0;h<c.length;h++)this.addElementPlacement(c[h],t);r.push.apply(r,c)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return n()(t,c(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return B()(t=(0,T.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:u()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:B()(e).call(e,this.fromElementDescriptor,this)};return n()(t,c(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _createElementDescriptor(e){var t,r=_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function _coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const Ve=["name","pos","idList","idBoard","dateLastActivity","desc","start","due","idShort","shortLink","closed","dueComplete","subscribed","idLabels","idMembers","badges"].join(),Ke=["commentCard","copyCommentCard"].join(),He=["boardId"],Ze={boardId:"idBoard",listId:"idList",position:"pos",title:"name",isCompleted:"dueComplete",isArchived:"closed",isSubscribed:"subscribed",memberIds:"idMembers",labelIds:"idLabels",description:"desc",cardType:"cardData",isAllDay:"cardData",start:"cardData",end:"cardData",recurrenceRule:"cardData",recurrenceException:"cardData",exceptionDates:"cardData",recurrenceId:"cardData",originalStart:"cardData",estimationHours:"cardData",priority:"cardData",notifications:"cardData",links:"cardData",defaultSortOrder:"cardData",membersSortOrder:"cardData",calendarsSortOrder:"cardData",listsSortOrder:"cardData",labelsSortOrder:"cardData",customFieldCardsData:"cardData",checkItemCardsData:"cardData"};let We=function _decorate(e,t,r,i){var a,s=_getDecoratorsApi();if(i)for(var n=0;n<i.length;n++)s=i[n](s);var o=t((function initialize(e){s.initializeInstanceElements(e,l.elements)}),r),l=s.decorateClass(function _coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=X()(t).call(t,isSameElement)))if(_isDataDescriptor(a.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(a)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(_hasDecorators(a)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}_coalesceGetterSetter(a,i)}else t.push(a)}return t}(B()(a=o.d).call(a,_createElementDescriptor)),e);return s.initializeClassElements(o.F,l.elements),s.runClassFinishers(o.F,l.finishers)}([(0,xe.SG)(["$rootScope","$log","$interval","$timeout","$window","$translate","appCommonSrv","collectionSrv","notificationSrv","planywayIntegrationSrv","platformSrv","settingsSrv","telemetrySrv","trelloIntegrationSrv"])],(function(e){return{F:class TrelloCardsService{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p,m){e(this),this._$rootScope=t,this._$log=r,this._$interval=i,this._$timeout=a,this._$window=s,this._$translate=n,this._appCommonSrv=o,this._collectionSrv=l,this._planywayIntegrationSrv=c,this._platformSrv=h,this._notificationSrv=d,this._settingsSrv=u,this._telemetrySrv=p,this._trelloIntegrationSrv=m,this._trelloIntegrationSrv.addTrelloBoardEventListener("updated",((e,t)=>{const r=e.accountId,i=this._cache.get(r);if(null===e.migrationProgress){if(null!==t.oldValue.migrationProgress&&i.loadedBoardIds.has(e.id)&&i.loadedBoardIds.set(e.id,!0),i.loadedBoardIds.has(e.id)){if(i.loadCalendarCardsPromise)return;this._requestReloadCalendarCards(r),this._reloadBoardsFilters(r),this._$rootScope.$broadcast(Re.FK.CardsReloaded)}}else for(let t of I()(a=i.calendarCards).call(a)){var a;t.calendarId!==e.id||t.isReadOnly||(t.providerCard.isReadOnly=!0,i.calendarCards.update(t))}})),this._trelloIntegrationSrv.addTrelloBoardEventListener("deleted",(e=>{const t=e.accountId,r=this._cache.get(t);if(r.loadedBoardIds.has(e.id)){if(r.loadedBoardIds.delete(e.id),r.loadCalendarCardsPromise)return;this._requestReloadCalendarCards(t),this._reloadBoardsFilters(t),this._$rootScope.$broadcast(Re.FK.CardsReloaded)}})),this._$rootScope.$on(Re.FK.FiltersChanged,(()=>{var e;D()(e=this.provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{const t=this._cache.get(e);t.ignoreFiltersCardIds.clear(),t.boardsFilters=null}))}))}},d:[{kind:"get",static:!0,key:"serviceName",value:function serviceName(){return"trelloCardsSrv"}},{kind:"field",key:"provider",value:()=>(0,Ae.VH)(Re.lP.Trello)},{kind:"field",key:"_cache",value:()=>new(A())},{kind:"field",key:"_initializedCollectionId",value:()=>null},{kind:"field",key:"_calendarCardsListeners",value:()=>({added:new(R()),updated:new(R()),deleted:new(R()),cleared:new(R())})},{kind:"get",key:"isCurrentCollectionInitialized",value:function isCurrentCollectionInitialized(){return this._initializedCollectionId===this._currentCollectionId}},{kind:"method",key:"initCurrentCollectionAsync",value:async function initCurrentCollectionAsync(e){var t,r;this._initializedCollectionId=null;for(let e of I()(i=this._cache).call(i)){var i;e.destroy()}this._cache.clear(),D()(t=this.provider.getCurrentCollectionConnectedAccountIds()).call(t,(e=>this._resetAccountCache(e))),await P().all(B()(r=this.provider.getCurrentCollectionConnectedAccountIds()).call(r,(async t=>{this.reloadCalendars(t),await this.loadCalendarCardsAsync(t,e)}))),this._initializedCollectionId=this._currentCollectionId}},{kind:"method",key:"addTrelloAccountAsync",value:async function addTrelloAccountAsync(e){this._resetAccountCache(e),this.reloadCalendars(e),await this.loadCalendarCardsAsync(e),this._initializedCollectionId=this._currentCollectionId}},{kind:"method",key:"removeTrelloAccount",value:function removeTrelloAccount(e){var t;null===(t=this._cache.get(e))||void 0===t||t.destroy(),this._cache.delete(e)}},{kind:"method",key:"reloadCalendars",value:function reloadCalendars(e){const t=this._cache.get(e);let r=this.provider.getCurrentCollectionSelectedCalendarIds(e);for(let e of $()(i=t.loadedBoardIds).call(i)){var i;F()(r).call(r,e)||t.hiddenBoardIds.set(e)}for(let e of r)t.loadedBoardIds.has(e)?t.hiddenBoardIds.delete(e):(t.loadedBoardIds.set(e,!0),t.trackBoardsUpdatesRequested=!0,t.reloadBoardsDataRequested=!0);this._requestReloadCalendarCards(e),this._reloadBoardsFilters(e)}},{kind:"method",key:"isTrelloBoardBusy",value:function isTrelloBoardBusy(e,t){var r;return null!==(r=this._cache.get(e).busyBoardIds.get(t))&&void 0!==r&&r}},{kind:"method",key:"needReloadCalendarCards",value:function needReloadCalendarCards(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D()(e=this.provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{const r=this._cache.get(e);for(let e of $()(i=r.loadedBoardIds).call(i)){var i;r.loadedBoardIds.set(e,!0)}r.trackBoardsUpdatesRequested=!0,t.reloadAdditionalData&&(r.reloadBoardsDataRequested=!0),this._requestReloadCalendarCards(e),this._reloadBoardsFilters(e)}))}},{kind:"method",key:"loadCalendarCardsAsync",value:async function loadCalendarCardsAsync(e,t){const r=this._cache.get(e);if(r.reloadCalendarCardsRequested){r.reloadCalendarCardsRequested=!1,t=t||this._appCommonSrv.getCancellationToken(`getCalendarCards_${e}`);try{r.loadCalendarCardsPromise=this._loadCalendarCardsAsync(e,t),await r.loadCalendarCardsPromise}catch(e){this._$log.error("Planyway get Trello cards error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway get Trello cards error",e,{class:this.constructor.name,method:this.loadCalendarCardsAsync.name})}finally{r.loadCalendarCardsPromise=null}}}},{kind:"method",key:"getCalendarCards",value:function getCalendarCards(e){var t,r;const i=this._cache.get(e);return z()(t=I()(r=i.calendarCards).call(r)).call(t,(e=>!i.hiddenBoardIds.has(e.providerCard.boardId)))}},{kind:"method",key:"getCalendarCardByIdAsync",value:async function getCalendarCardByIdAsync(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this._cache.get(e),{cardType:a}=r;switch(i.loadCalendarCardsPromise&&await i.loadCalendarCardsPromise,a){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:return this.getCalendarCardById(e,t,{cardType:a})}let s,n=this.getCalendarCardById(e,t,{cardType:a});if(n)return n;if(t===Le.$d)return;try{s=await this._trelloIntegrationSrv.restAsync(e,Re.Tu.Get,`/cards/${t}`,"Get Trello card",{fields:Ve,customFieldItems:!0,checklists:"all",attachments:!0})}catch(e){return this._$log.error("Planyway Trello card loading error:"),void this._$log.error(e)}if(i.deletedCardIds.has(s.id))return;if(!i.boardsTimeRecords.has(s.idBoard)){let t=await this.provider.callRecordsApiAsync(e,"getCardRecords","Planyway get Trello card time records",{boardId:s.idBoard,cardId:s.id});this._updateTimeRecordsCache(e,s.idBoard,B()(t).call(t,(t=>this._adjustTimeRecord(e,t))))}let o=this._trelloIntegrationSrv.getTrelloBoardById(e,s.idBoard);if(o){var l;if(s.customFieldItems)if(this._updateCustomFieldItemsCache(e,s.id,s.customFieldItems),s.customFieldItems.length>0)G()(l=s.customFieldItems).call(l,(e=>{var t;return!G()(t=o.customFields).call(t,(t=>t.id===e.idCustomField))}))&&(await this._trelloIntegrationSrv.loadBoardDataAsync(e,s.idBoard),o=this._trelloIntegrationSrv.getTrelloBoardById(e,s.idBoard));if(s.checklists&&this._updateChecklistsCache(e,s.id,s.checklists),s.attachments&&this._updateAttachmentsCache(e,s.id,s.attachments),n=this._createCalendarCardFromTrelloCard(e,s),i.loadedBoardIds.has(n.providerCard.boardId)){i.calendarCards.add(n);for(let e of n.providerCard.trelloCustomFieldCards)i.calendarCards.add(e);for(let e of n.providerCard.trelloCheckItemCards)i.calendarCards.add(e);for(let e of n.providerCard.trelloTimeRecordCards)i.calendarCards.add(e)}return n}}},{kind:"method",key:"getCalendarCardById",value:function getCalendarCardById(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this._cache.get(e),{cardType:a}=r;switch(a){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:return i.calendarCards.get(t)}return i.calendarCards.get(i.cardShortIds.get(t)||t)}},{kind:"method",key:"createCalendarCardAsync",value:async function createCalendarCardAsync(e){var t,r;const i=e.accountId,a=this._cache.get(i);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let s=null;e.title||(e.title=this._$translate.instant("MISC.NO_TITLE"));let n=e.providerCard.boardId;if(!e.providerCard.listId){let t=await this._getDefaultListIdAsync(i,n);if(!t)throw new Error("Cannot find Trello list for creating new card!");e.providerCard.boardId=n,e.providerCard.listId=t}let o=await P().all(B()(t=e.providerCard.labelIds).call(t,(e=>this._trelloIntegrationSrv.createTrelloLabelAsync(i,e))));var l,d;(e.providerCard.labelIds=new(R())(B()(r=z()(o).call(o,(e=>e))).call(r,(e=>e.id))),e.providerCard.sourceCardId)?e.providerCard.links=[]:e.providerCard.links=B()(l=z()(d=this.getCalendarCardLinks(e)||[]).call(d,(e=>!e.linkError))).call(l,(e=>({cardId:e.toCardId,type:e.linkType})));let c=this._trelloIntegrationSrv.getTrelloBoardById(i,n),h=e.toSourceCard({cardBoard:c,includeFields:["name","idList","pos","desc","closed","dueComplete","idLabels","idMembers","subscribed","idCardSource","cardData"]}),{cardDataCustomFieldValue:u}=h,p=(0,b.Z)(h,Be),m=await this._trelloIntegrationSrv.restAsync(i,Re.Tu.Post,"/cards","Create Trello card",p),C=!1;switch(p.pos){case Ee.XL.Top:for(let e of I()(v=a.calendarCards).call(v)){var v;if(e.cardType===Ee.eT.TrelloCard&&!e.providerCard.isArchived&&e.providerCard.listId===m.idList&&e.providerCard.position<m.pos){C=!0;break}}break;case Ee.XL.Bottom:for(let e of I()(f=a.calendarCards).call(f)){var f;if(e.cardType===Ee.eT.TrelloCard&&!e.providerCard.isArchived&&e.providerCard.listId===m.idList&&e.providerCard.position>m.pos){C=!0;break}}break;default:p.pos&&Math.abs(p.pos-m.pos)>K()&&(C=!0)}C&&await this._reloadListCardPositionsAsync(i,m.idList),s=m.id;let y=_objectSpread({},this.getCalendarCardCustomFieldValues(e));c.cardDataCustomFieldId&&(y[c.cardDataCustomFieldId]=u);let g,_,k=this._updateCustomFieldValuesAsync({id:s,accountId:i,cardType:e.cardType,providerCard:{boardId:n}},y,{waitForUpdate:!0}),T=new(A()),S=(async()=>{if(g=this.getCalendarCardChecklists(e),g)for(let[l,d]of Z()(t=Y()(g).call(g,xe.Fo)).call(t)){var t;let{id:c}=await this.createCalendarCardChecklistAsync({id:s,accountId:i,cardType:e.cardType},{name:d.name,position:Le.LA*(l+1)});for(let[t,l]of Z()(r=Y()(a=d.checkItems).call(a,xe.ke)).call(r)){var r,a,n,o;let d=X()(n=e.providerCard.trelloCheckItemCards).call(n,(e=>e.id===l.id)),{id:h}=await this.createCalendarCardCheckItemAsync({id:s,accountId:i,cardType:e.cardType,providerCard:{badges:m.badges}},c,{name:l.name,due:null==d?void 0:d.providerCard.realDue,memberIds:d&&z()(o=J()(d.providerCard.memberIds)).call(o,(e=>e!==Le.$d)),position:Le.LA*(t+1),isCompleted:l.isCompleted});T.set(l.id,h)}}})(),w=new(A()),D=(async()=>{if(_=this.getCalendarCardTimeRecords(e),_)for(let t of Y()(_).call(_,xe.EA)){let r=await this.createCalendarCardTimeRecordAsync({id:s,accountId:i,cardType:e.cardType,providerCard:{boardId:n}},{comment:t.comment,isDuration:t.isDuration,from:t.from,to:t.to,durationMinutes:t.durationMinutes,memberId:t.memberId});w.set(t.id,r.id)}})(),E=(async()=>{let t=this.getCalendarCardAttachments(e);if(t)for(let a of te()(r=Y()(t).call(t,xe.X_)).call(r)){var r;await this.createCalendarCardAttachmentAsync({id:s,accountId:i,cardType:e.cardType,providerCard:{badges:m.badges}},a)}})(),L=(async()=>{let t=this.getCalendarCardComments(e);if(t)for(let a of te()(r=Y()(t).call(t,xe.Pk)).call(r)){var r;await this.createCalendarCardCommentAsync({id:s,accountId:i,cardType:e.cardType,providerCard:{badges:m.badges}},a)}})(),x=(async()=>{for(let t of e.providerCard.links)await this._linkCalendarCardsAsync(i,t.cardId,s,Re.XP[t.type])})();if(await P().all([k,S,D,E,L,x]),this._updateBoardCardsLastModifiedDate(i,m.idBoard,m.dateLastActivity),a.cardsCustomFieldItems.has(e.providerCard.sourceCardId)||a.cardsChecklists.has(e.providerCard.sourceCardId)||a.cardsAttachments.has(e.providerCard.sourceCardId)){let e=await this._trelloIntegrationSrv.restAsync(i,Re.Tu.Get,`/cards/${s}`,"Get Trello card",{customFieldItems:!0,checklists:"all",attachments:!0});e.customFieldItems&&this._updateCustomFieldItemsCache(i,e.id,e.customFieldItems),e.checklists&&this._updateChecklistsCache(i,e.id,e.checklists),e.attachments&&this._updateAttachmentsCache(i,e.id,e.attachments)}m.customFieldItems=a.cardsCustomFieldItems.get(s)||[],m.checklists=a.cardsChecklists.get(s)||[];let M=this._createCalendarCardFromTrelloCard(i,m);for(let e of M.providerCard.trelloCustomFieldCards)a.calendarCards.add(e);let O=!1;if(g){var $;M.providerCard.trelloCheckItemCards=[],M.providerCard.checkItemCardsData=[];let e=F()($=c.premiumFeatures).call($,Re.GC.AdvancedChecklists);for(let t of g)for(let r of t.checkItems){let t=M.providerCard.addTrelloCheckItemCard(_objectSpread(_objectSpread({},r),{},{id:T.get(r.id)}),c,{syncWithTrello:e});(t.hasDates||t.providerCard.hasMembers)&&(O=!0)}}for(let e of M.providerCard.trelloCheckItemCards)a.calendarCards.add(e);if(_){M.providerCard.trelloTimeRecordCards=[];for(let e of _){M.providerCard.addTrelloTimeRecordCard(_objectSpread(_objectSpread({},e),{},{id:w.get(e.id)}),c)&&(O=!0)}}for(let e of M.providerCard.trelloTimeRecordCards)a.calendarCards.add(e);return a.loadedBoardIds.has(M.providerCard.boardId)?(a.calendarCards.delete(e),a.calendarCards.add(M),a.ignoreFiltersCardIds.add(M.id),O&&await this.updateCalendarCardPropertiesAsync(M,{trelloCheckItemCards:M.providerCard.trelloCheckItemCards,checkItemCardsData:M.providerCard.checkItemCardsData})):a.calendarCards.delete(e),M}},{kind:"method",key:"createTempCalendarCard",value:function createTempCalendarCard(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this._cache.get(e),{cardType:a}=r;let s,n,o,l=new Pe.fb(Le.$d,e,Re.lP.Trello,a);switch(t.cardRole&&(l.cardRole=t.cardRole),l.providerCard.sourceCardId=t.providerCard.sourceCardId,a){case Ee.eT.TrelloCard:case Ee.eT.TrelloCheckItem:if(s=t.providerCard.boardId,l.providerCard.boardId=s,n=t.providerCard.listId,o=t.providerCard.position,(!n||!o)&&s){let t=this._trelloIntegrationSrv.getTrelloBoardById(e,s);var d,c,h;if(!n)if(n=t.defaultListId&&(null===(d=X()(c=t.lists).call(c,(e=>e.id===t.defaultListId)))||void 0===d?void 0:d.id),!n)n=null===(h=t.lists[0])||void 0===h?void 0:h.id;o||(o=t.defaultCardPosition)}l.providerCard.listId=n,l.providerCard.position=o,l.title=t.title||"",l.description=t.description||"",l.providerCard.isArchived=t.providerCard.isArchived,l.providerCard.isCompleted=t.providerCard.isCompleted,l.providerCard.isSubscribed=t.providerCard.isSubscribed,t.providerCard.labelIds&&(l.providerCard.labelIds=t.providerCard.labelIds),t.providerCard.memberIds&&(l.providerCard.memberIds=t.providerCard.memberIds),t.recurrenceRule?l.recurrenceRule=t.recurrenceRule:t.recurrenceId&&(l.recurrenceId=t.recurrenceId,l.originalStart=t.originalStart),(0,xe.qb)(t.start)&&(0,xe.qb)(t.end)&&(l.isAllDay=t.isAllDay,l.start=t.start,l.end=t.end),void 0!==t.providerCard.estimationHours&&(l.providerCard.estimationHours=t.providerCard.estimationHours),void 0!==t.providerCard.priority&&(l.providerCard.priority=t.providerCard.priority),t.providerCard.notifications&&(l.providerCard.notifications=t.providerCard.notifications),t.providerCard.links&&(l.providerCard.links=t.providerCard.links);break;case Ee.eT.TrelloCustomField:throw new Error(`Unsupported method for card type: ${a}`);case Ee.eT.TrelloTimeRecord:if(t.providerCard.parentId){l.providerCard.parentId=t.providerCard.parentId;let r=this.getCalendarCardById(e,t.providerCard.parentId);r&&(l.providerCard.boardId=r.providerCard.boardId,l.providerCard.listId=r.providerCard.listId,l.description=r.description,l.providerCard.labelIds=r.providerCard.labelIds)}else l.providerCard.boardId=t.providerCard.boardId||this.provider.getCurrentCollectionSelectedCalendarIds(e)[0];l.title=t.title,l.isAllDay=t.isAllDay,l.start=t.start,l.end=t.end,l.providerCard.memberIds=t.providerCard.memberIds&&!t.providerCard.memberIds.has(Le.$d)?t.providerCard.memberIds:new(R())([this._getAccountMemberId(e)])}return i.calendarCards.add(l),l}},{kind:"method",key:"changeCalendarCardType",value:function changeCalendarCardType(e,t,r,i,a){Re.EJ.has(t)&&Re.EJ.has(r)?(e.cardType=r,i===a?this._cache.get(i).calendarCards.update(e):(e.accountId=a,this._cache.get(i).calendarCards.delete(e),this._cache.get(a).calendarCards.add(e))):Re.EJ.has(t)?this._cache.get(i).calendarCards.delete(e):Re.EJ.has(r)&&(e.cardType=r,e.accountId=a,this._cache.get(a).calendarCards.add(e))}},{kind:"method",key:"updateCalendarCardAsync",value:async function updateCalendarCardAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.accountId,i=this._cache.get(r),{waitForUpdate:a,includeTrelloFields:s=[],customFieldValues:n={}}=t;if(0!==s.length||0!==ie()(n).length){switch(e.cardType){case Ee.eT.TrelloCustomField:throw new Error(`Unsupported method for card type: ${e.cardType}`);case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:if(e.isTempCard)return void i.calendarCards.update(e);throw new Error(`Unsupported method for card type: ${e.cardType}`)}try{var o,l;if(F()(s).call(s,"idBoard")){this._appCommonSrv.setSchedulerBusy(!0);let t=this._trelloIntegrationSrv.getTrelloBoardById(r,e.providerCard.boardId);if(!e.providerCard.listId){let t=await this._getDefaultListIdAsync(r,e.providerCard.boardId);if(!t)throw new Error("Cannot find Trello list for moving card!");e.providerCard.listId=t}if(F()(s).call(s,"pos")||(e.providerCard.position=t.defaultCardPosition),e.isTempCard){let i=new(R());for(let a of e.providerCard.labelIds){var d;if(a===Le.$d)continue;let e=this._trelloIntegrationSrv.getTrelloLabelById(r,a),s=X()(d=t.labels).call(d,(t=>t.color===e.color&&t.name===e.name));s&&i.add(s.id)}e.providerCard.labelIds=i;let a=new(R());for(let r of e.providerCard.memberIds){var c;r!==Le.$d&&(G()(c=t.members).call(c,(e=>e.id===r))&&a.add(r))}e.providerCard.memberIds=a}else{let t=await this._trelloIntegrationSrv.restAsync(r,Re.Tu.Put,`/cards/${e.id}`,"Move Trello card",{idBoard:e.providerCard.boardId,idList:e.providerCard.listId,position:e.providerCard.position});this._updateBoardCardsLastModifiedDate(r,t.idBoard,t.dateLastActivity),e.providerCard.cardNumber=t.idShort,e.providerCard.labelIds=new(R())(t.idLabels),e.providerCard.memberIds=new(R())(t.idMembers),e.providerCard.lastChangeId=new Date(t.dateLastActivity).getTime(),await(0,Ee.qd)([...e.providerCard.trelloTimeRecordCards],(t=>this.moveCalendarCardTimeRecordAsync({id:e.id,accountId:r,cardType:e.cardType,providerCard:{boardId:t.providerCard.boardId}},t.id,e)),5)}}else if(F()(s).call(s,"idList")){let t=this._trelloIntegrationSrv.getTrelloBoardById(r,e.providerCard.boardId);F()(s).call(s,"pos")||(e.providerCard.position=t.defaultCardPosition)}if(e.isTempCard)return i.loadedBoardIds.has(e.providerCard.boardId)?i.calendarCards.update(e):i.calendarCards.delete(e),void await this._updateCustomFieldValuesAsync(e,n,{waitForUpdate:a});let t=this._trelloIntegrationSrv.getTrelloBoardById(r,e.providerCard.boardId);F()(s).call(s,"cardData")&&e.providerCard.incrementDataVersion();let p=await P().all(B()(o=e.providerCard.labelIds).call(o,(e=>this._trelloIntegrationSrv.createTrelloLabelAsync(r,e))));e.providerCard.labelIds=new(R())(B()(l=z()(p).call(p,(e=>e))).call(l,(e=>e.id)));let m=e.toSourceCard({cardBoard:t,includeFields:s}),{cardDataCustomFieldValue:C}=m,v=(0,b.Z)(m,Oe);const f=e.clone();t.cardDataCustomFieldId&&F()(s).call(s,"cardData")&&(n[t.cardDataCustomFieldId]=C);let y=this._updateCustomFieldValuesAsync(e,n,{waitForUpdate:a});const updateCustomFieldCards=e=>{for(let t of e.providerCard.trelloCustomFieldCards){let r=!1;(F()(s).call(s,"idBoard")||F()(s).call(s,"idList"))&&(t.providerCard.boardId=e.providerCard.boardId,t.providerCard.listId=e.providerCard.listId,r=!0),F()(s).call(s,"name")&&(t.title=e.title,r=!0),F()(s).call(s,"desc")&&(t.description=e.description,r=!0),F()(s).call(s,"closed")&&(t.providerCard.isArchived=e.providerCard.isArchived,r=!0),(F()(s).call(s,"idLabels")||F()(s).call(s,"idBoard"))&&(t.providerCard.labelIds=new(R())(e.providerCard.labelIds),r=!0),(F()(s).call(s,"idMembers")||F()(s).call(s,"idBoard"))&&(t.providerCard.memberIds=new(R())(e.providerCard.memberIds),r=!0),F()(s).call(s,"subscribed")&&(t.providerCard.isSubscribed=e.providerCard.isSubscribed,r=!0),i.calendarCards.has(t.id)?r&&i.calendarCards.update(t):i.calendarCards.add(t)}for(let[s,l]of se()(n)){var r,a,o;if(s===t.cardDataCustomFieldId)continue;let n=X()(r=t.customFields).call(r,(e=>e.id===s));if((null==n?void 0:n.type)!==Ee.vK.Date)continue;let d=null===(a=i.cardsCustomFieldItems.get(e.id))||void 0===a?void 0:X()(a).call(a,(e=>e.idCustomField===s));if(d&&d.id)if(G()(o=e.providerCard.trelloCustomFieldCards).call(o,(e=>e.id===d.id))){let{customFieldCardUpdated:t,customFieldCard:r}=e.providerCard.updateTrelloCustomFieldCard(d.id,{date:l});t&&(r.hasDates?i.calendarCards.update(r):(e.providerCard.deleteTrelloCustomFieldCard(d.id),i.calendarCards.delete(d.id)))}else{let t=e.providerCard.addTrelloCustomFieldCard({id:d.id,customFieldId:d.idCustomField,date:l});t&&i.calendarCards.add(t)}}},updateCheckItemCards=e=>{for(let a of e.providerCard.trelloCheckItemCards){let n=!1;var r;if((F()(s).call(s,"idBoard")||F()(s).call(s,"idList"))&&(a.providerCard.boardId=e.providerCard.boardId,a.providerCard.listId=e.providerCard.listId,n=!0),F()(s).call(s,"desc")&&(a.description=e.description,n=!0),F()(s).call(s,"closed")&&(a.providerCard.isArchived=e.providerCard.isArchived,n=!0),(F()(s).call(s,"idLabels")||F()(s).call(s,"idBoard"))&&(a.providerCard.labelIds=new(R())(e.providerCard.labelIds),n=!0),F()(s).call(s,"idBoard"))a.providerCard.memberIds=z()(r=a.providerCard.memberIds).call(r,(e=>{var r;return G()(r=t.members).call(r,(t=>t.id===e))})),n=!0;F()(s).call(s,"subscribed")&&(a.providerCard.isSubscribed=e.providerCard.isSubscribed,n=!0),i.calendarCards.has(a.id)?n&&i.calendarCards.update(a):i.calendarCards.add(a)}},updateTimeRecordCards=e=>{for(let a of e.providerCard.trelloTimeRecordCards){let n=!1;var r;if((F()(s).call(s,"idBoard")||F()(s).call(s,"idList"))&&(a.providerCard.boardId=e.providerCard.boardId,a.providerCard.listId=e.providerCard.listId,n=!0),F()(s).call(s,"desc")&&(a.description=e.description,n=!0),F()(s).call(s,"closed")&&(a.providerCard.isArchived=e.providerCard.isArchived,n=!0),(F()(s).call(s,"idLabels")||F()(s).call(s,"idBoard"))&&(a.providerCard.labelIds=new(R())(e.providerCard.labelIds),n=!0),F()(s).call(s,"idBoard"))a.providerCard.memberIds=z()(r=a.providerCard.memberIds).call(r,(e=>{var r;return G()(r=t.members).call(r,(t=>t.id===e))})),n=!0;F()(s).call(s,"subscribed")&&(a.providerCard.isSubscribed=e.providerCard.isSubscribed,n=!0),i.calendarCards.has(a.id)?n&&i.calendarCards.update(a):i.calendarCards.add(a)}};a||(i.loadedBoardIds.has(e.providerCard.boardId)?(i.calendarCards.update(e),updateCustomFieldCards(e),updateCheckItemCards(e),updateTimeRecordCards(e)):i.calendarCards.delete(e)),await y;let g=await this._trelloIntegrationSrv.restAsync(r,Re.Tu.Put,`/cards/${e.id}`,"Update Trello card",v,a?3:9),_=!1;switch(v.pos){case Ee.XL.Top:for(let e of I()(h=i.calendarCards).call(h)){var h;if(e.cardType===Ee.eT.TrelloCard&&!e.providerCard.isArchived&&e.providerCard.listId===g.idList&&e.providerCard.position<g.pos&&e.id!==g.id){_=!0;break}}break;case Ee.XL.Bottom:for(let e of I()(u=i.calendarCards).call(u)){var u;if(e.cardType===Ee.eT.TrelloCard&&!e.providerCard.isArchived&&e.providerCard.listId===g.idList&&e.providerCard.position>g.pos&&e.id!==g.id){_=!0;break}}break;default:v.pos&&Math.abs(v.pos-g.pos)>K()&&(_=!0)}if(_&&await this._reloadListCardPositionsAsync(r,g.idList),this._updateBoardCardsLastModifiedDate(r,g.idBoard,g.dateLastActivity),F()(s).call(s,"idBoard"))if(await this._trelloIntegrationSrv.loadBoardDataAsync(r,e.providerCard.boardId),t=this._trelloIntegrationSrv.getTrelloBoardById(r,e.providerCard.boardId),t.customFields.length>0){let{customFieldItems:t}=await this._trelloIntegrationSrv.restAsync(r,Re.Tu.Get,`/cards/${e.id}`,"Get Trello card",{customFieldItems:!0});this._updateCustomFieldItemsCache(r,g.id,t)}else{for(let t of e.providerCard.trelloCustomFieldCards)i.calendarCards.delete(t.id);i.cardsCustomFieldItems.delete(e.id),i.cardsCustomFieldValues.delete(e.id)}g.customFieldItems=i.cardsCustomFieldItems.get(g.id)||[],g.checklists=i.cardsChecklists.get(g.id)||[];let k=this._createCalendarCardFromTrelloCard(r,g);if(F()(s).call(s,"idBoard")&&k.providerCard.trelloCustomFieldCards.length>0)for(let e of k.providerCard.trelloCustomFieldCards)i.calendarCards.has(e.id)?i.calendarCards.update(e):i.calendarCards.add(e);let T=i.calendarCards.get(e.id);if(!T||F()(s).call(s,"cardData")&&T.providerCard.lastDataVersionId>k.providerCard.lastDataVersionId)return;a||!f.equals(k)?i.loadedBoardIds.has(k.providerCard.boardId)?(i.calendarCards.update(k),updateCustomFieldCards(k),updateCheckItemCards(k),updateTimeRecordCards(e)):i.calendarCards.delete(k):e.providerCard.lastChangeId=new Date(g.dateLastActivity).getTime()}catch(e){if(this._telemetrySrv.logError("Trello update card error",e,{class:this.constructor.name,method:this.updateCalendarCardAsync.name}),a)throw e;this._$log.error("Trello update card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),Re.k$.Error)}finally{F()(s).call(s,"idBoard")&&this._appCommonSrv.setSchedulerBusy(!1)}}else i.loadedBoardIds.has(e.providerCard.boardId)?i.calendarCards.update(e):i.calendarCards.delete(e)}},{kind:"method",key:"updateCalendarCardPropertiesAsync",value:async function updateCalendarCardPropertiesAsync(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.accountId,a=this._cache.get(i);let s,n,{immediateUpdate:o=!1}=r;switch(G()(He).call(He,(e=>e in t))&&(o=!0),e.cardType){case Ee.eT.TrelloCustomField:{if(s=a.calendarCards.get(e.providerCard.parentId),!s)return;let{isCompleted:r,isAllDay:i,start:l,end:d,defaultSortOrder:c,membersSortOrder:h,calendarsSortOrder:u,listsSortOrder:p,labelsSortOrder:m}=t;n=(0,b.Z)(t,$e),await this._updateCustomFieldCardAsync(e.id,s,{isCompleted:r,isAllDay:i,date:l,defaultSortOrder:c,membersSortOrder:h,calendarsSortOrder:u,listsSortOrder:p,labelsSortOrder:m},{immediateUpdate:o});break}case Ee.eT.TrelloCheckItem:{var l;s=a.calendarCards.get(e.providerCard.parentId);let{title:r,isCompleted:i,isAllDay:d,start:c,end:h,memberIds:u,defaultSortOrder:p,membersSortOrder:m,calendarsSortOrder:C,listsSortOrder:v,labelsSortOrder:f}=t;if(n=(0,b.Z)(t,Ne),e.isTempCard)break;if(!s)return;await this._updateCheckItemCardAsync(e.id,s,{name:r,isCompleted:i,isAllDay:d,start:c,end:h,memberIds:u&&z()(l=J()(u)).call(l,(e=>e!==Le.$d)),defaultSortOrder:p,membersSortOrder:m,calendarsSortOrder:C,listsSortOrder:v,labelsSortOrder:f},{immediateUpdate:o});break}case Ee.eT.TrelloTimeRecord:{var d;s=a.calendarCards.get(e.providerCard.parentId);let{title:r,isAllDay:i,start:l,end:c,durationMinutes:h,memberIds:u}=t,p=(0,b.Z)(t,Fe);if((l||c)&&(void 0===i&&(i=e.isAllDay),void 0!==h||i||(h=(0,xe.CX)(l||e.start,c||e.end))),n=p,e.isTempCard)break;if(!s)return;await this._updateTimeRecordCardAsync(e.id,s,{comment:r,isDuration:i,from:l,to:c,durationMinutes:h,memberId:u&&z()(d=J()(u)).call(d,(e=>e!==Le.$d))[0]},{immediateUpdate:o});break}}if(s&&(n&&ie()(n).length>0&&this.updateCalendarCardPropertiesAsync(s,n,{immediateUpdate:o}),!e.isTempCard))return;let c=a.cardsUpdateBuffers.get(e.id);c||(c={changes:{}},o||a.cardsUpdateBuffers.set(e.id,c)),c.changes||(c.changes={});for(let[e,r]of se()(t))void 0!==r&&(c.changes[e]=r);return c.processUpdatePromise||(c.processUpdatePromise=this._processCardUpdateBufferAsync(i,e.id,c,{immediateUpdate:o})),c.processUpdatePromise}},{kind:"method",key:"removeCalendarCardAsync",value:async function removeCalendarCardAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.accountId,i=this._cache.get(r);switch(e.cardType){case Ee.eT.TrelloCustomField:{let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;return this._deleteCustomFieldCardAsync(e.id,t)}case Ee.eT.TrelloCheckItem:{var a;if(e.isTempCard)break;let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;let r=null===(a=i.cardsChecklists.get(t.id))||void 0===a?void 0:X()(a).call(a,(t=>{var r;return G()(r=t.checkItems).call(r,(t=>t.id===e.id))}));if(!r)return;return this.updateCalendarCardCheckItemAsync(t,r.id,e.id,{start:null,end:null})}case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let{waitForRemove:s}=t;try{if(e.isTempCard)return e.isAllDay=null,e.start=null,e.end=null,e.recurrenceRule=void 0,e.exceptionDates=void 0,void i.calendarCards.update(e);let t=this._trelloIntegrationSrv.getTrelloBoardById(r,e.providerCard.boardId);e.isAllDay=null,e.start=null,e.end=null,e.recurrenceRule=void 0,e.exceptionDates=void 0;let a=e.toSourceCard({cardBoard:t,includeFields:["cardData"]}),{cardDataCustomFieldValue:n}=a,o=(0,b.Z)(a,je);const l=e.clone();s||(i.loadedBoardIds.has(e.providerCard.boardId)?i.calendarCards.update(e):i.calendarCards.delete(e)),t.cardDataCustomFieldId&&await this._updateCustomFieldValuesAsync(e,{[t.cardDataCustomFieldId]:n},{waitForUpdate:s});let d=await this._trelloIntegrationSrv.restAsync(r,Re.Tu.Put,`/cards/${e.id}`,"Remove Trello card",o,s?3:9);this._updateBoardCardsLastModifiedDate(r,d.idBoard,d.dateLastActivity),d.customFieldItems=i.cardsCustomFieldItems.get(d.id)||[],d.checklists=i.cardsChecklists.get(d.id)||[];let c=this._createCalendarCardFromTrelloCard(r,d);s||!l.equals(c)?i.loadedBoardIds.has(c.providerCard.boardId)?i.calendarCards.update(c):i.calendarCards.delete(c):e.providerCard.lastChangeId=new Date(d.dateLastActivity).getTime()}catch(e){if(this._telemetrySrv.logError("Trello remove card error",e,{class:this.constructor.name,method:this.removeCalendarCardAsync.name}),s)throw e;this._$log.error("Trello remove card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.REMOVE_TRELLO_CARD_ERROR"),Re.k$.Error)}}},{kind:"method",key:"deleteCalendarCardAsync",value:async function deleteCalendarCardAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.accountId,i=this._cache.get(r);switch(e.cardType){case Ee.eT.TrelloCustomField:throw new Error(`Unsupported method for card type: ${e.cardType}`);case Ee.eT.TrelloCheckItem:{var a;if(e.isTempCard)break;let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;let r=null===(a=i.cardsChecklists.get(t.id))||void 0===a?void 0:X()(a).call(a,(t=>{var r;return G()(r=t.checkItems).call(r,(t=>t.id===e.id))}));if(!r)return;return this.deleteCalendarCardCheckItemAsync(t,r.id,e.id)}case Ee.eT.TrelloTimeRecord:{if(e.isTempCard)break;let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;return this.deleteCalendarCardTimeRecordAsync(t,e.id)}}let{waitForDelete:s}=t;try{if(e.isTempCard)return void i.calendarCards.delete(e);await(0,Ee.qd)(e.providerCard.trelloTimeRecordCards,(t=>{try{let{lastBoardModifiedDate:i}=this.provider.callRecordsApiAsync(r,"deleteRecord","Planyway delete Trello time record",{boardId:e.providerCard.boardId,id:t.id});this._updateBoardRecordsLastModifiedDate(r,e.providerCard.boardId,i)}catch(e){if(e.code!==Ee.T.RecordNotFound)throw e}}),5);let t=i.boardsTimeRecords.get(e.providerCard.boardId);(null==t?void 0:t.length)>0&&this._updateTimeRecordsCache(r,e.providerCard.boardId,z()(t).call(t,(t=>t.cardId!==e.id)));for(let t of e.providerCard.links)await this._unlinkCalendarCardsAsync(r,t.cardId,e.id,Re.XP[t.type]);s||i.calendarCards.delete(e),i.deletedCardIds.add(e.id),await this._trelloIntegrationSrv.restAsync(r,Re.Tu.Delete,`/cards/${e.id}`,"Delete Trello card",null,s?3:9),s&&i.calendarCards.delete(e)}catch(e){if(this._telemetrySrv.logError("Trello delete card error",e,{class:this.constructor.name,method:this.deleteCalendarCardAsync.name}),s)throw e;this._$log.error("Trello delete card error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.DELETE_TRELLO_CARD_ERROR"),Re.k$.Error)}}},{kind:"method",key:"createRecurrenceGapAsync",value:function createRecurrenceGapAsync(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cardType:i}=r;switch(i){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${i}`)}}},{kind:"method",key:"addExceptionToRecurrentAsync",value:function addExceptionToRecurrentAsync(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cardType:i}=r;switch(i){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${i}`)}let a=this.getCalendarCardById(e,t.recurrenceId,{cardType:i});if(a)return a.addExceptionDate(t.exceptionDate),this.updateCalendarCardPropertiesAsync(a,{exceptionDates:a.exceptionDates})}},{kind:"method",key:"removeExceptionsFromRecurrentAsync",value:function removeExceptionsFromRecurrentAsync(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cardType:i,fromDate:a}=r;switch(i){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${i}`)}let s=this.getCalendarCardById(e,t.id,{cardType:i});if(s)return s.deleteExceptionDates(a),this.updateCalendarCardPropertiesAsync(s,{recurrenceRule:s.recurrenceRule,exceptionDates:s.exceptionDates})}},{kind:"method",key:"deleteRecurrenceExceptionsAsync",value:async function deleteRecurrenceExceptionsAsync(e){var t,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=e.accountId,s=this._cache.get(a),{cardType:n,fromDate:o}=i;switch(n){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${n}`)}let l=z()(t=I()(r=s.calendarCards).call(r)).call(t,(t=>t.recurrenceId===e.id&&!(o&&t.exceptionDate<o)));for(let e of l)s.calendarCards.delete(e);for(;l.length>0;){var d;await P().all(B()(d=oe()(l).call(l,0,5)).call(d,(async e=>{try{await this._trelloIntegrationSrv.restAsync(a,Re.Tu.Delete,`/cards/${e.id}`,"Delete Trello card recurrence exception",null,9)}catch(e){this._$log.error("Trello delete card recurrence exception error:"),this._$log.error(e)}})))}}},{kind:"method",key:"addCalendarCardEventListener",value:function addCalendarCardEventListener(e,t){let r=this._calendarCardsListeners[e];if(!r)throw new Error(`Unsupported event type: ${e}`);r.add(t)}},{kind:"method",key:"removeCalendarCardEventListener",value:function removeCalendarCardEventListener(e,t){let r=this._calendarCardsListeners[e];if(!r)throw new Error(`Unsupported event type: ${e}`);r.delete(t)}},{kind:"method",key:"isCalendarCardLoaded",value:function isCalendarCardLoaded(e){const t=e.accountId,r=this._cache.get(t);return r.loadedBoardIds.has(e.providerCard.boardId)&&!r.hiddenBoardIds.has(e.providerCard.boardId)}},{kind:"method",key:"isCalendarCardVisible",value:function isCalendarCardVisible(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e.accountId,a=this._cache.get(i),{isForceOnlyMeShown:s,isForceArchivedShown:n}=r;try{if(e.isTempCard)return!0;if(!this.isCalendarCardLoaded(e))return!1;if(!(n||!e.providerCard.isArchived||this._collectionSettings.global.settings.isArchivedCardsShown))return!1;if(e.cardRole===Ee.D.Milestone)if(!this._collectionSettings.global.settings.isMilestonesShown)return!1;if(a.ignoreFiltersCardIds.has(e.id))return!0;let r=this._appCommonSrv.getFiltersCardSearchString();var o;if(r)if(!F()(o=e.title.toLowerCase()).call(o,r)){var l;let t;switch(e.cardType){case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:t=this.getCalendarCardById(i,e.providerCard.parentId)}if(!t||!F()(l=t.title.toLowerCase()).call(l,r))return!1}switch(this._collectionSettings.global.settings.filters.cardsVisibility){case Re.Vh.Completed:switch(e.cardType){case Ee.eT.TrelloCard:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloCustomField:if(!e.providerCard.isCompleted)return!1}break;case Re.Vh.Incompleted:switch(e.cardType){case Ee.eT.TrelloCard:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloCustomField:if(e.providerCard.isCompleted)return!1}}if(this.provider.getCurrentCollectionConnectedCalendar(i,e.providerCard.boardId).showOnlyMyCards&&!e.providerCard.memberIds.has(this._getAccountMemberId(i)))return!1;switch(e.cardType){case Ee.eT.TrelloCustomField:if(!F()(t=this._trelloCollectionSettings.global.customFieldsAsCards).call(t,e.providerCard.trelloCustomFieldId))return!1;break;case Ee.eT.TrelloCheckItem:if(!this._collectionSettings.global.settings.isCheckItemCardsShown)return!1;break;case Ee.eT.TrelloTimeRecord:if(!this._collectionSettings.global.settings.isTimeRecordCardsShown&&this._appCommonSrv.getSchedulerMode()!==Re.ud.TimeTracking)return!1}let m=this._getBoardsFilters(i);if(s){var d,c;let t=new(R())(B()(d=this.provider.getCurrentCollectionConnectedAccountIds()).call(d,(e=>this.provider.getAccountUser(e).id)));if(!G()(c=[...e.providerCard.memberIds]).call(c,(e=>t.has(e))))return!1}else if(m.memberIds.size>0){var h;if(!G()(h=e.providerCard.memberIds).call(h,(e=>e===Le.$d?m.memberIds.has(Le.$d):m.memberIds.has(e))))return!1}if(m.labelHashes.size>0){var u;if(!G()(u=e.providerCard.labelIds).call(u,(t=>{if(t===Le.$d)return m.labelHashes.has(Le.$d);let r=this._trelloIntegrationSrv.getTrelloLabelById(i,t);return!(!r||e.providerCard.boardId!==r.boardId)&&m.labelHashes.has((0,xe.uz)(r))})))return!1}if(m.listIds.size>0){if(!m.listIds.has(e.providerCard.listId))return!1}if(m.customFieldHashes.size>0){let t=!1;if(e.cardType===Ee.eT.TrelloCustomField){let r=this._trelloIntegrationSrv.getTrelloCustomFieldById(i,e.providerCard.trelloCustomFieldId);r&&(t=m.customFieldHashes.has((0,xe.SY)(r)))}if(!t)return!1}if(m.customFilters.size>0){let t=!1;for(let r of I()(p=m.customFilters).call(p)){var p;if(r.targetType===Re.go.CustomField){let a=this._trelloIntegrationSrv.getTrelloCustomFieldById(i,r.targetId);if(!a)continue;let s=this.getCalendarCardCustomFieldValues(e),n=null==s?void 0:s[r.targetId];switch(a.type){case Ee.vK.Checkbox:r.value?n&&(t=!0):n||(t=!0);break;case Ee.vK.List:n===r.value&&(t=!0)}}}if(!t)return!1}return!0}catch(e){return this._$log.error("Planyway apply card filters error:"),this._$log.error(e),!0}}},{kind:"method",key:"isBoardSettingsMigrationRequired",value:function isBoardSettingsMigrationRequired(e,t,r){var i;if(!de()(this._settingsSrv).trelloBoardSettingsMigrator)return!1;const a=this._cache.get(e);return!a.loadedBoardIds.has(t)||G()(i=a.calendarCards).call(i,(e=>!(!e.providerCard.hasPlanywayDates||e.providerCard.isArchived||e.providerCard.boardId!==t)&&(e.providerCard.dateSyncType!==r.dateSyncType||e.providerCard.dueLinkType!==r.dueLinkType||e.providerCard.dueLinkTypeAllDay!==r.dueLinkTypeAllDay)))}},{kind:"method",key:"getBoardsCardsAsync",value:async function getBoardsCardsAsync(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{loadArchived:a,limitArchivedCards:s={}}=i;let n=new(A())(B()(t).call(t,(e=>[e,{boardId:e,trelloCards:[]}])));const loadBoardsCards=async i=>{if(i&&!a)return;let o=B()(t).call(t,(t=>{let r,a;if(i){let i=s[t];if(!i){i=this._trelloIntegrationSrv.getTrelloBoardById(e,t).defaultLimitArchivedCards}r=Math.min(i,500),a=i/r}else r=500,a=10;return{url:`/boards/${t}/cards`,page:1,cardsPageLimit:r,cardsMaxPages:a}}));for(;o.length>0&&!this.provider.invalidAccountIds.has(e);)try{let t=oe()(o).call(o,0,5),a=B()(t).call(t,(e=>{let t={fields:Ve,customFieldItems:!0,checklists:"all",attachments:!0,limit:e.cardsPageLimit};return i?(t.filter="closed",e.lastCardModifiedDate&&(t.before=e.lastCardModifiedDate)):(t.filter="visible",t.sort="-id",e.lastCardId&&(t.before=e.lastCardId)),t})),s=await this._trelloIntegrationSrv.batchAsync(e,B()(t).call(t,(e=>e.url)),`Get Trello board ${i?"archived":"open"} cards`,a,{keepResultPlacement:!0});if(D()(t).call(t,((e,t)=>{let r=s[t];if(!r||r.length<e.cardsPageLimit||e.page===e.cardsMaxPages)return;e.page++;let i=r[r.length-1];e.lastCardId=i.id,e.lastCardModifiedDate=i.dateLastActivity,o.push(e)})),r.isCanceled())return;for(let e of he()(l=z()(s).call(s,(e=>e))).call(l)){var l;n.get(e.idBoard).trelloCards.push(e)}}catch(t){this._platformSrv.isOffline()||this.provider.invalidAccountIds.add(e),this._$log.error("Planyway load board cards error:"),this._$log.error(t)}};return await P().all([loadBoardsCards(!1),loadBoardsCards(!0)]),J()(I()(n).call(n))}},{kind:"method",key:"setCalendarCardIgnoreFilters",value:function setCalendarCardIgnoreFilters(e){this._cache.get(e.accountId).ignoreFiltersCardIds.add(e.id)}},{kind:"method",key:"getCalendarCardCustomFieldValues",value:function getCalendarCardCustomFieldValues(e){var t,r;const i=e.accountId,a=this._cache.get(i);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=a.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}if(!a.cardsCustomFieldValues.has(e.id)){let n=a.cardsCustomFieldItems.get(e.id);if(!n)return;let o=this._trelloIntegrationSrv.getTrelloBoardById(i,e.providerCard.boardId),l={};for(let e of n){var s;if(e.idCustomField===o.cardDataCustomFieldId)continue;let i,a=X()(s=o.customFields).call(s,(t=>t.id===e.idCustomField));if(a){switch(a.type){case Ee.vK.Checkbox:i="true"===(null===(t=e.value)||void 0===t?void 0:t.checked);break;case Ee.vK.Date:i=e.value&&new Date(e.value.date);break;case Ee.vK.List:i=e.idValue;break;case Ee.vK.Number:i=e.value&&pe()(e.value.number);break;case Ee.vK.Text:i=null===(r=e.value)||void 0===r?void 0:r.text}l[e.idCustomField]=i}}a.cardsCustomFieldValues.set(e.id,l)}return a.cardsCustomFieldValues.get(e.id)}},{kind:"method",key:"getCalendarCardChecklists",value:function getCalendarCardChecklists(e){const t=e.accountId,r=this._cache.get(t);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=r.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let i=r.cardsChecklists.get(e.id);if(i)return B()(i).call(i,(e=>{var t;return{id:e.id,name:e.name,position:e.pos,checkItems:B()(t=e.checkItems).call(t,(e=>{var t,i;let a=r.calendarCards.get(e.id);return{id:e.id,name:e.name,position:e.pos,isCompleted:"complete"===e.state,isAllDay:null===(t=null==a?void 0:a.isAllDay)||void 0===t||t,start:null==a?void 0:a.start,end:null==a?void 0:a.end,memberIds:a?z()(i=J()(a.providerCard.memberIds)).call(i,(e=>e!==Le.$d)):[]}}))}}))}},{kind:"method",key:"createCalendarCardChecklistAsync",value:async function createCalendarCardChecklistAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.accountId,i=this._cache.get(r);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloTimeRecord:let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloCheckItem:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let a,s={id:getIncrementalTempId(),idCard:e.id,name:t.name||this._$translate.instant("MISC.CHECKLIST"),pos:t.position||Ce()(),checkItems:[]};if(this._updateChecklistsCache(r,e.id,s),e.isTempCard)a=s;else try{a=await this._trelloIntegrationSrv.restAsync(r,Re.Tu.Post,"/checklists","Create Trello checklist",_objectSpread(_objectSpread({},s),{},{pos:t.position||"bottom"})),this._updateChecklistsCache(r,e.id,a)}finally{var n;this._updateChecklistsCache(r,e.id,z()(n=i.cardsChecklists.get(e.id)||[]).call(n,(e=>e.id!==s.id)))}return{id:a.id,name:a.name,position:a.pos,checkItems:[]}}},{kind:"method",key:"updateCalendarCardChecklistAsync",value:async function updateCalendarCardChecklistAsync(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=e.accountId,s=this._cache.get(a),{immediateUpdate:n=!1}=i;switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloTimeRecord:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloCheckItem:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let o=s.checklistsUpdateBuffers.get(t);o||(o={changes:{}},n||s.checklistsUpdateBuffers.set(t,o)),o.changes||(o.changes={});for(let[e,t]of se()(r))void 0!==t&&(o.changes[e]=t);o.processUpdatePromise||(o.processUpdatePromise=this._processChecklistUpdateBufferAsync(a,e.id,t,o,{immediateUpdate:n})),await o.processUpdatePromise}},{kind:"method",key:"deleteCalendarCardChecklistAsync",value:async function deleteCalendarCardChecklistAsync(e,t){var r,i;const a=e.accountId,s=this._cache.get(a);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloTimeRecord:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloCheckItem:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let n=null===(r=s.cardsChecklists.get(e.id))||void 0===r?void 0:X()(r).call(r,(e=>e.id===t));if(n){this._updateChecklistsCache(a,e.id,z()(i=s.cardsChecklists.get(e.id)).call(i,(e=>e.id!==t)));for(let t of n.checkItems)s.calendarCards.has(t.id)&&this._deleteCheckItemCardAsync(t.id,e);if(e.isTempCard||isIncrementalTempId(t)||await this._trelloIntegrationSrv.restAsync(a,Re.Tu.Delete,`/checklists/${t}`,"Delete Trello checklist"),n.checkItems.length>0){for(let t of n.checkItems)e.providerCard.badges.checkItems-=1,"complete"===t.state&&(e.providerCard.badges.checkItemsChecked-=1);s.calendarCards.has(e.id)&&s.calendarCards.update(e)}}}},{kind:"method",key:"createCalendarCardCheckItemAsync",value:async function createCalendarCardCheckItemAsync(e,t,r){var i,a,s;const n=e.accountId,o=this._cache.get(n);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloTimeRecord:let t=o.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloCheckItem:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let l=null===(i=o.cardsChecklists.get(e.id))||void 0===i?void 0:X()(i).call(i,(e=>e.id===t));if(!l)return;let d,c={id:getIncrementalTempId(),name:r.name,due:null===(a=r.due)||void 0===a?void 0:a.toISOString(),idMember:null===(s=r.memberIds)||void 0===s?void 0:s[0],pos:r.position||Ce()(),state:r.isCompleted?"complete":"incomplete"};if(l.checkItems.push(c),this._updateChecklistsCache(n,e.id,l),e.isTempCard)d=c;else try{var h,u;d=await this._trelloIntegrationSrv.restAsync(n,Re.Tu.Post,`/checklists/${t}/checkItems`,"Create Trello check item",_objectSpread(_objectSpread({},c),{},{due:c.due,idMember:c.idMember,pos:r.position||"bottom",checked:r.isCompleted}));let i=null===(h=o.cardsChecklists.get(e.id))||void 0===h?void 0:X()(h).call(h,(e=>e.id===t));i&&!G()(u=i.checkItems).call(u,(e=>e.id===d.id))&&(i.checkItems.push(d),this._updateChecklistsCache(n,e.id,i))}finally{var p;let r=null===(p=o.cardsChecklists.get(e.id))||void 0===p?void 0:X()(p).call(p,(e=>e.id===t));var m;if(r)r.checkItems=z()(m=r.checkItems).call(m,(e=>e.id!==c.id)),this._updateChecklistsCache(n,e.id,r)}return e instanceof Pe.fb&&(e.providerCard.badges.checkItems+=1,"complete"===d.state&&(e.providerCard.badges.checkItemsChecked+=1),o.calendarCards.has(e.id)&&o.calendarCards.update(e)),{id:d.id,name:d.name,position:d.pos,due:d.due&&new Date(d.due),memberIds:d.idMember?[d.idMember]:[],isCompleted:"complete"===d.state}}},{kind:"method",key:"updateCalendarCardCheckItemAsync",value:async function updateCalendarCardCheckItemAsync(e,t,r,i){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=e.accountId,n=this._cache.get(s),{immediateUpdate:o=!1}=a;switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloTimeRecord:let t=n.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloCheckItem:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let l=n.checklistsUpdateBuffers.get(t);l||(l={changes:{}},o||n.checklistsUpdateBuffers.set(t,l)),l.changes||(l.changes={}),l.changes.checkItems||(l.changes.checkItems={}),l.changes.checkItems[r]||(l.changes.checkItems[r]={});for(let[e,t]of se()(i))void 0!==t&&(l.changes.checkItems[r][e]=t);l.processUpdatePromise||(l.processUpdatePromise=this._processChecklistUpdateBufferAsync(s,e.id,t,l,{immediateUpdate:o})),await l.processUpdatePromise}},{kind:"method",key:"convertCalendarCardCheckItemAsync",value:async function convertCalendarCardCheckItemAsync(e,t,r){var i,a,s;const n=e.accountId,o=this._cache.get(n);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloTimeRecord:let t=o.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloCheckItem:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let l=null===(i=o.cardsChecklists.get(e.id))||void 0===i?void 0:X()(i).call(i,(e=>e.id===t));if(!l)return;let d=X()(a=l.checkItems).call(a,(e=>e.id===r));if(!d)return;l.checkItems=z()(s=l.checkItems).call(s,(e=>e.id!==r)),this._updateChecklistsCache(n,e.id,l);let c=o.calendarCards.get(r);if(c&&this._deleteCheckItemCardAsync(r,e),e.isTempCard||isIncrementalTempId(r))return;let h=await this._trelloIntegrationSrv.restAsync(n,Re.Tu.Post,`/cards/${e.id}/checklist/${t}/checkItem/${r}/convertToCard`,"Convert Trello check item"),u=this._createCalendarCardFromTrelloCard(n,h);return o.calendarCards.add(u),await this.updateCalendarCardPropertiesAsync(u,{isAllDay:c.isAllDay,start:c.start,end:c.end,description:c.description,isCompleted:c.providerCard.isCompleted,labelIds:c.providerCard.labelIds,memberIds:c.providerCard.memberIds,defaultSortOrder:c.providerCard.defaultSortOrder,membersSortOrder:c.providerCard.membersSortOrder,calendarsSortOrder:c.providerCard.calendarsSortOrder,listsSortOrder:c.providerCard.listsSortOrder,labelsSortOrder:c.providerCard.labelsSortOrder}),e instanceof Pe.fb&&(e.providerCard.badges.checkItems-=1,"complete"===d.state&&(e.providerCard.badges.checkItemsChecked-=1),o.calendarCards.has(e.id)&&o.calendarCards.update(e)),u}},{kind:"method",key:"deleteCalendarCardCheckItemAsync",value:async function deleteCalendarCardCheckItemAsync(e,t,r){var i,a,s;const n=e.accountId,o=this._cache.get(n);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloTimeRecord:let t=o.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloCheckItem:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let l=null===(i=o.cardsChecklists.get(e.id))||void 0===i?void 0:X()(i).call(i,(e=>e.id===t));if(!l)return;let d=X()(a=l.checkItems).call(a,(e=>e.id===r));d&&(l.checkItems=z()(s=l.checkItems).call(s,(e=>e.id!==r)),this._updateChecklistsCache(n,e.id,l),o.calendarCards.has(r)&&this._deleteCheckItemCardAsync(r,e),e.isTempCard||isIncrementalTempId(r)||await this._trelloIntegrationSrv.restAsync(n,Re.Tu.Delete,`/checklists/${t}/checkItems/${r}`,"Delete Trello check item"),e instanceof Pe.fb&&(e.providerCard.badges.checkItems-=1,"complete"===d.state&&(e.providerCard.badges.checkItemsChecked-=1),o.calendarCards.has(e.id)&&o.calendarCards.update(e)))}},{kind:"method",key:"getCalendarCardTimeRecords",value:function getCalendarCardTimeRecords(e){var t;const r=e.accountId,i=this._cache.get(r);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}return B()(t=e.providerCard.trelloTimeRecordCards).call(t,(t=>{var i;return{id:t.id,accountId:r,canBeUpdated:!e.isReadOnly,canBeDeleted:!e.isReadOnly,comment:t.title,isDuration:t.isAllDay,from:t.start,to:t.end,durationMinutes:t.providerCard.durationMinutes,memberId:z()(i=J()(t.providerCard.memberIds)).call(i,(e=>e!==Le.$d))[0]}}))}},{kind:"method",key:"getBoardTimeRecordsAsync",value:async function getBoardTimeRecordsAsync(e,t){let r=await this.provider.callRecordsApiAsync(e,"getBoardRecords","Planyway get Trello board time records",{boardId:t});return B()(r).call(r,(t=>this._adjustTimeRecord(e,t)))}},{kind:"method",key:"getTimeRecords",value:function getTimeRecords(){var e;let t=[];return D()(e=this.provider.getCurrentCollectionConnectedAccountIds()).call(e,(e=>{var r,i,a;const s=this._cache.get(e);t=fe()(t).call(t,z()(r=he()(i=J()(I()(a=s.boardsTimeRecords).call(a))).call(i)).call(r,(e=>{let t=s.calendarCards.get(e.cardId);return(null==t?void 0:t.providerCard.boardId)===e.boardId&&(s.loadedBoardIds.has(e.boardId)&&!s.hiddenBoardIds.has(e.boardId))})))})),t}},{kind:"method",key:"createCalendarCardTimeRecordAsync",value:async function createCalendarCardTimeRecordAsync(e,t){const r=e.accountId,i=this._cache.get(r);switch(e.cardType){case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloCustomField:let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let a,s=this._trelloIntegrationSrv.getTrelloBoardById(r,e.providerCard.boardId);if(e.isTempCard)a=_objectSpread({id:getIncrementalTempId(),accountId:r,boardId:e.providerCard.boardId,cardId:e.id},t);else{let i=await this.provider.callRecordsApiAsync(r,"createRecord","Planyway create Trello time record",_objectSpread(_objectSpread({accountId:r,boardId:e.providerCard.boardId,cardId:e.id},t),{},{from:t.isDuration?(0,xe.tC)(t.from):t.from,to:t.isDuration?(0,xe.tC)(t.to):t.to})),{lastBoardModifiedDate:s}=i,n=(0,b.Z)(i,ze);a=this._adjustTimeRecord(r,n),this._updateBoardRecordsLastModifiedDate(r,e.providerCard.boardId,s)}this._updateTimeRecordsCache(r,e.providerCard.boardId,a);let n=i.calendarCards.get(Le.$d);if((null==n?void 0:n.cardType)===Ee.eT.TrelloTimeRecord&&i.calendarCards.delete(n),e instanceof Pe.fb){let t=e.providerCard.addTrelloTimeRecordCard(a,s);t&&(i.calendarCards.add(t),await this.updateCalendarCardPropertiesAsync(e,{trelloTimeRecordCards:e.providerCard.trelloTimeRecordCards}))}return a}},{kind:"method",key:"updateCalendarCardTimeRecordAsync",value:async function updateCalendarCardTimeRecordAsync(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=e.accountId,s=this._cache.get(a),{immediateUpdate:n=!1}=i;switch(e.cardType){case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloCustomField:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}let o=s.timeRecordsUpdateBuffers.get(t);o||(o={changes:{}},s.timeRecordsUpdateBuffers.set(t,o)),o.changes||(o.changes={});for(let[e,t]of se()(r))void 0!==t&&(o.changes[e]=t);o.processUpdatePromise||(o.processUpdatePromise=this._processTimeRecordUpdateBufferAsync(a,e.id,t,o,{immediateUpdate:n})),await o.processUpdatePromise}},{kind:"method",key:"moveCalendarCardTimeRecordAsync",value:async function moveCalendarCardTimeRecordAsync(e,t,r){const i=e.accountId,a=this._cache.get(i),s=e.providerCard.boardId,n=r.providerCard.boardId;let o=a.boardsTimeRecords.get(s),l=X()(o).call(o,(e=>e.id===t));this._updateTimeRecordsCache(i,s,z()(o).call(o,(e=>e!==l)));let d=a.calendarCards.get(t);e instanceof Pe.fb&&e.providerCard.deleteTrelloTimeRecordCard(t);let c=_objectSpread(_objectSpread({},l),{},{boardId:n,cardId:r.id});this._updateTimeRecordsCache(i,n,c);let h=this._trelloIntegrationSrv.getTrelloBoardById(i,n),u=r.providerCard.addTrelloTimeRecordCard(c,h);if(s!==n){let{lastBoardModifiedDate:e}=await this.provider.callRecordsApiAsync(i,"moveRecord","Planyway move Trello time record",{oldBoardId:s,newBoardId:n,id:t,newCardId:r.id});this._updateBoardRecordsLastModifiedDate(i,s,e),this._updateBoardRecordsLastModifiedDate(i,n,e),u.providerCard.lastChangeId=new Date(e).getTime()}else{let{lastBoardModifiedDate:e}=await this.provider.callRecordsApiAsync(i,"updateRecord","Planyway update Trello time record",{boardId:s,id:t,cardId:r.id});this._updateBoardRecordsLastModifiedDate(i,s,e),u.providerCard.lastChangeId=new Date(e).getTime()}a.calendarCards.delete(d,{replacedWith:u}),e instanceof Pe.fb&&await this.updateCalendarCardPropertiesAsync(e,{trelloTimeRecordCards:e.providerCard.trelloTimeRecordCards}),a.calendarCards.add(u),await this.updateCalendarCardPropertiesAsync(r,{trelloTimeRecordCards:r.providerCard.trelloTimeRecordCards})}},{kind:"method",key:"deleteCalendarCardTimeRecordAsync",value:function deleteCalendarCardTimeRecordAsync(e,t){const r=e.accountId,i=this._cache.get(r);switch(e.cardType){case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloCustomField:let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t;break;case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}if(i.calendarCards.has(t))return this._deleteTimeRecordCardAsync(t,e)}},{kind:"method",key:"getCalendarCardAttachments",value:function getCalendarCardAttachments(e){const t=e.accountId,r=this._cache.get(t);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=r.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let i=r.cardsAttachments.get(e.id);if(i){const{trelloMemberId:r}=this._planywayIntegrationSrv.getConnectedAccountById(t);return B()(i).call(i,(t=>{var i;const getAttachmentUrl=i=>{var a;if(i)return(null!==(a=t.mimeType)&&void 0!==a&&ge()(a).call(a,"image/")||Re.ek.has((0,xe.RT)(i)))&&de()(this._settingsSrv).trelloAttachmentsProxy?`${Le.Ao}/planyway/${this._planywayIntegrationSrv.userId}/proxy/trello?${De.stringify({memberId:r,cardId:e.id,attachmentId:t.id,fileName:t.fileName,mimeType:t.mimeType})}`:i};return{id:t.id,type:t.isUpload?Re.sf.File:Re.sf.Link,name:t.name,position:t.pos,file:t.file,url:getAttachmentUrl(t.url),date:new Date(t.date),mimeType:t.mimeType,previews:B()(i=t.previews).call(i,(e=>({id:e.id,url:getAttachmentUrl(e.url),height:e.height,width:e.width})))}}))}}},{kind:"method",key:"createCalendarCardAttachmentAsync",value:async function createCalendarCardAttachmentAsync(e,t,r){var i;const a=e.accountId,s=this._cache.get(a);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let n,o={id:getIncrementalTempId(),name:t.name,pos:Ce()(),file:t.file,url:t.url,date:new Date,isUpload:t.type===Re.sf.File,previews:[]};if(this._updateAttachmentsCache(a,e.id,o),e.isTempCard)n=o;else try{switch(t.type){case Re.sf.File:n=await this._trelloIntegrationSrv.restAsync(a,Re.Tu.PostFile,`/cards/${e.id}/attachments`,"Create Trello attachment",{name:o.name,file:await(0,xe.np)(o.file),mimeType:o.file.type},3,(e=>{let{direction:t,percent:i}=e;"upload"===t&&(null==r||r({id:o.id,isComplete:!1,percent:i}))})),null==r||r({id:o.id,isComplete:!0});break;case Re.sf.Link:n=await this._trelloIntegrationSrv.restAsync(a,Re.Tu.Post,`/cards/${e.id}/attachments`,"Create Trello attachment",{name:o.name,url:o.url})}this._updateAttachmentsCache(a,e.id,n)}finally{var l;this._updateAttachmentsCache(a,e.id,z()(l=s.cardsAttachments.get(e.id)||[]).call(l,(e=>e.id!==o.id)))}return e instanceof Pe.fb&&(e.providerCard.badges.attachments+=1,s.calendarCards.has(e.id)&&s.calendarCards.update(e)),{id:n.id,type:n.isUpload?Re.sf.File:Re.sf.Link,name:n.name,position:n.pos,url:n.url,date:new Date(n.date),mimeType:n.mimeType,previews:B()(i=n.previews).call(i,(e=>({id:e.id,url:e.url,height:e.height,width:e.width})))}}},{kind:"method",key:"updateCalendarCardAttachmentAsync",value:async function updateCalendarCardAttachmentAsync(e,t,r){var i;const a=e.accountId,s=this._cache.get(a);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let n,o=null===(i=s.cardsAttachments.get(e.id))||void 0===i?void 0:X()(i).call(i,(e=>e.id===t));if(!o)return;if(void 0!==r.name&&o.name!==r.name&&(o.name=r.name,n=_objectSpread(_objectSpread({},n),{},{name:o.name})),void 0===r.url||o.url===r.url||o.isUpload||(o.url=r.url,n=_objectSpread(_objectSpread({},n),{},{url:o.url})),!n)return;if(this._updateAttachmentsCache(a,e.id,o),e.isTempCard)return;let l=await this._trelloIntegrationSrv.restAsync(a,Re.Tu.Put,`/cards/${e.id}/attachments/${t}`,"Update Trello attachment",n);this._updateAttachmentsCache(a,e.id,l)}},{kind:"method",key:"deleteCalendarCardAttachmentAsync",value:async function deleteCalendarCardAttachmentAsync(e,t){var r,i;const a=e.accountId,s=this._cache.get(a);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}(null===(r=s.cardsAttachments.get(e.id))||void 0===r?void 0:X()(r).call(r,(e=>e.id===t)))&&(this._updateAttachmentsCache(a,e.id,z()(i=s.cardsAttachments.get(e.id)).call(i,(e=>e.id!==t))),e.isTempCard||isIncrementalTempId(t)||await this._trelloIntegrationSrv.restAsync(a,Re.Tu.Delete,`/cards/${e.id}/attachments/${t}`,"Delete Trello attachment"),e.providerCard.badges.attachments-=1,s.calendarCards.has(e.id)&&s.calendarCards.update(e))}},{kind:"method",key:"getCalendarCardComments",value:function getCalendarCardComments(e){const t=e.accountId,r=this._cache.get(t);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=r.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let i=r.cardsComments.get(e.id);if(i)return B()(i).call(i,(r=>{var i,a;return{id:r.id,comment:r.data.text,memberId:r.idMemberCreator,member:r.memberCreator?this._trelloIntegrationSrv.fromTrelloMember(t,r.memberCreator):this._trelloIntegrationSrv.getTrelloMemberById(t,r.idMemberCreator),sourceMemberId:null===(i=r.member)||void 0===i?void 0:i.id,sourceMember:r.member&&this._trelloIntegrationSrv.fromTrelloMember(t,r.member),sourceCardId:null===(a=r.data.cardSource)||void 0===a?void 0:a.id,creationDate:new Date(r.date),lastEditDate:r.data.dateLastEdited&&new Date(r.data.dateLastEdited),canBeUpdated:this._isCalendarCardCommentCanBeUpdated(e,r),canBeReplied:this._isCalendarCardCommentCanBeReplied(e,r),canBeDeleted:this._isCalendarCardCommentCanBeDeleted(e,r)}}))}},{kind:"method",key:"reloadCalendarCardCommentsAsync",value:async function reloadCalendarCardCommentsAsync(e){const t=e.accountId,r=this._cache.get(t);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=r.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let i=await this._trelloIntegrationSrv.restAsync(t,Re.Tu.Get,`/cards/${e.id}/actions`,"Get Trello comments",{filter:Ke,limit:50});this._updateCommentsCache(t,e.id,i)}},{kind:"method",key:"createCalendarCardCommentAsync",value:async function createCalendarCardCommentAsync(e,t){const r=e.accountId,i=this._cache.get(r);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=i.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let a,s=this._getAccountMemberId(r),n={id:getIncrementalTempId(),idMemberCreator:s,date:(new Date).toISOString(),data:{card:{id:e.id},text:t.comment}};if(this._updateCommentsCache(r,e.id,n),e.isTempCard)a=n;else try{a=await this._trelloIntegrationSrv.restAsync(r,Re.Tu.Post,`/cards/${e.id}/actions/comments`,"Add Trello comment",{text:t.comment}),this._updateCommentsCache(r,e.id,a)}finally{var o;this._updateCommentsCache(r,e.id,z()(o=i.cardsComments.get(e.id)||[]).call(o,(e=>e.id!==n.id)))}return e instanceof Pe.fb&&(e.providerCard.badges.comments+=1,i.calendarCards.has(e.id)&&i.calendarCards.update(e)),{id:a.id,comment:a.data.text,memberId:s,member:this._trelloIntegrationSrv.getTrelloMemberById(r,s),creationDate:new Date(a.date),canBeUpdated:!0,canBeReplied:!1,canBeDeleted:!0}}},{kind:"method",key:"updateCalendarCardCommentAsync",value:async function updateCalendarCardCommentAsync(e,t,r){var i;const a=e.accountId,s=this._cache.get(a);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}let n,o=null===(i=s.cardsComments.get(e.id))||void 0===i?void 0:X()(i).call(i,(e=>e.id===t));if(!o)return;if(void 0!==r.comment&&o.data.text!==r.comment&&(o.data.text=r.comment,n=_objectSpread(_objectSpread({},n),{},{text:o.data.text})),!n)return;if(this._updateCommentsCache(a,e.id,o),e.isTempCard)return;let l=await this._trelloIntegrationSrv.restAsync(a,Re.Tu.Put,`/cards/${e.id}/actions/${t}/comments`,"Update Trello comment",n);this._updateCommentsCache(a,e.id,l)}},{kind:"method",key:"deleteCalendarCardCommentAsync",value:async function deleteCalendarCardCommentAsync(e,t){var r,i;const a=e.accountId,s=this._cache.get(a);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:let t=s.calendarCards.get(e.providerCard.parentId);if(!t)return;e=t}(null===(r=s.cardsComments.get(e.id))||void 0===r?void 0:X()(r).call(r,(e=>e.id===t)))&&(this._updateCommentsCache(a,e.id,z()(i=s.cardsComments.get(e.id)).call(i,(e=>e.id!==t))),e.isTempCard||isIncrementalTempId(t)||await this._trelloIntegrationSrv.restAsync(a,Re.Tu.Delete,`/cards/${e.id}/actions/${t}/comments`,"Delete Trello comment"),e.providerCard.badges.comments-=1,s.calendarCards.has(e.id)&&s.calendarCards.update(e))}},{kind:"method",key:"getCalendarCardLinks",value:function getCalendarCardLinks(e){const t=e.accountId,r=this._cache.get(t);switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}if(!r.cardCachedLinks.has(e.id)){var i;if(!e.providerCard.canHaveLinks)return[];let a=B()(i=e.providerCard.links).call(i,(i=>{var a;let s=r.calendarCards.get(i.cardId),n=null;return s?s.providerCard.canHaveLinks?e.isTempCard||X()(a=s.providerCard.links).call(a,(t=>t.type===Re.XP[i.type]&&t.cardId===e.id))||(n=Re.DB.NoLink):n=Re.DB.LinksDisabled:n=Re.DB.NoCard,{accountId:t,fromCardId:e.id,toCardId:i.cardId,linkType:i.type,linkError:n,linkedCard:s}})),s=r.calendarCards.get(Le.$d);if(null!=s&&s.providerCard.links)for(let t of s.providerCard.links)t.cardId===e.id&&a.push({fromCardId:e.id,toCardId:Le.$d,linkType:Re.XP[t.type],linkError:s.providerCard.canHaveLinks?null:Re.DB.LinksDisabled,linkedCard:s});r.cardCachedLinks.set(e.id,a)}return r.cardCachedLinks.get(e.id)}},{kind:"method",key:"createCalendarCardLinkAsync",value:function createCalendarCardLinkAsync(e,t,r){const i=e.accountId;switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}return P().all([this._linkCalendarCardsAsync(i,e.id,t,r),this._linkCalendarCardsAsync(i,t,e.id,Re.XP[r])])}},{kind:"method",key:"updateCalendarCardLinkAsync",value:function updateCalendarCardLinkAsync(e,t,r,i){const a=e.accountId;switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}return P().all([this._relinkCalendarCardsAsync(a,e.id,t,r,i),this._relinkCalendarCardsAsync(a,t,e.id,Re.XP[r],Re.XP[i])])}},{kind:"method",key:"updateCalendarCardLinkedCardAsync",value:function updateCalendarCardLinkedCardAsync(e,t,r,i){const a=e.accountId;switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}return P().all([this._updateLinkedCalendarCardsAsync(a,e.id,t,r,i),this._unlinkCalendarCardsAsync(a,t,e.id,Re.XP[i]),this._linkCalendarCardsAsync(a,r,e.id,Re.XP[i])])}},{kind:"method",key:"removeCalendarCardLinkAsync",value:function removeCalendarCardLinkAsync(e,t,r){const i=e.accountId;switch(e.cardType){case Ee.eT.TrelloCustomField:case Ee.eT.TrelloCheckItem:case Ee.eT.TrelloTimeRecord:throw new Error(`Unsupported method for card type: ${e.cardType}`)}return P().all([this._unlinkCalendarCardsAsync(i,e.id,t,r),this._unlinkCalendarCardsAsync(i,t,e.id,Re.XP[r])])}},{kind:"get",key:"_userSettings",value:function _userSettings(){return this._settingsSrv.user}},{kind:"get",key:"_trelloUserSettings",value:function _trelloUserSettings(){return{local:this._userSettings.local.settings.provider[Re.lP.Trello],global:this._userSettings.global.settings.provider[Re.lP.Trello]}}},{kind:"get",key:"_collectionSettings",value:function _collectionSettings(){return this._settingsSrv.collection}},{kind:"get",key:"_trelloCollectionSettings",value:function _trelloCollectionSettings(){return{local:this._collectionSettings.local.settings.provider[Re.lP.Trello],global:this._collectionSettings.global.settings.provider[Re.lP.Trello]}}},{kind:"get",key:"_currentCollectionId",value:function _currentCollectionId(){return this._collectionSrv.currentCollectionId}},{kind:"method",key:"_resetAccountCache",value:function _resetAccountCache(e){var t;null===(t=this._cache.get(e))||void 0===t||t.destroy();const r={loadedBoardIds:new(A()),hiddenBoardIds:new(A()),boardsLastModifiedDate:new(A()),boardsCardsLastModifiedDate:new(A()),boardsRecordsLastModifiedDate:new(A()),boardsUpdatesSignalRSubscribed:!1,busyBoardIds:new(A()),calendarCards:new Me.v("id",Pe.fb),deletedCardIds:new(R()),trackBoardsUpdatesRequested:!0,reloadBoardsDataRequested:!1,reloadCalendarCardsRequested:!1,ignoreFiltersCardIds:new(R()),cardsUpdateBuffers:new(A()),cardShortIds:new(A()),cardsCustomFieldItems:new(A()),cardsCustomFieldValues:new(A()),cardsChecklists:new(A()),checklistsUpdateBuffers:new(A()),boardsTimeRecords:new(A()),timeRecordsUpdateBuffers:new(A()),cardsAttachments:new(A()),cardsComments:new(A()),cardCachedLinks:new(A()),destroy:()=>{var t;r.boardsUpdatesSignalRSubscribed&&(null===(t=r.boardsUpdatesSignalRSubscription)||void 0===t||t.destroy(),r.boardsUpdatesSignalRSubscription=null,r.boardsUpdatesSignalRSubscribed=!1);r.boardsUpdatesExpirationInterval&&this._$interval.cancel(r.boardsUpdatesExpirationInterval),r.calendarCards.clear({accountId:e});for(let e in this._calendarCardsListeners)r.calendarCards.removeEventListener(e,this._handleCalendarCardEvent)}};this._cache.set(e,r);for(let e in this._calendarCardsListeners)r.calendarCards.addEventListener(e,this._handleCalendarCardEvent)}},{kind:"field",key:"_handleCalendarCardEvent",value(){var e=this;return function(t){var r,i,a,s;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{event:o,silent:l}=n;if(!l)switch(o){case"added":if(!t.isTempCard&&!e.isCalendarCardLoaded(t))break;D()(r=e._calendarCardsListeners[o]).call(r,(e=>e(t,n)));break;case"updated":case"deleted":D()(i=e._calendarCardsListeners[o]).call(i,(e=>e(t,n)));break;case"cleared":D()(a=e._calendarCardsListeners[o]).call(a,(e=>e(n)))}switch(o){case"added":case"updated":{const r=t.accountId,i=e._cache.get(r);t.cardType===Ee.eT.TrelloCard&&(t.isTempCard||i.cardShortIds.set(t.providerCard.shortId,t.id)),i.cardCachedLinks.clear();break}case"deleted":{const r=t.accountId,i=e._cache.get(r);if(t.cardType===Ee.eT.TrelloCard){t.isTempCard||i.cardShortIds.delete(t.providerCard.shortId);for(let e of t.providerCard.trelloCustomFieldCards)i.calendarCards.delete(e.id);i.cardsCustomFieldItems.delete(t.id),i.cardsCustomFieldValues.delete(t.id);for(let e of t.providerCard.trelloCheckItemCards)i.calendarCards.delete(e.id);i.cardsChecklists.delete(t.id);for(let e of t.providerCard.trelloTimeRecordCards)i.calendarCards.delete(e.id);if(t.isTempCard){let a=i.boardsTimeRecords.get(t.providerCard.boardId);(null==a?void 0:a.length)>0&&e._updateTimeRecordsCache(r,t.providerCard.boardId,z()(a).call(a,(e=>e.cardId!==t.id)))}i.cardsAttachments.delete(t.id),t.isTempCard&&i.cardsComments.delete(t.id)}i.cardCachedLinks.clear();break}case"cleared":D()(s=e.provider.getCurrentCollectionConnectedAccountIds()).call(s,(t=>{const r=e._cache.get(t);r.cardCachedLinks.clear(),r.cardShortIds.clear()}))}}}},{kind:"method",key:"_getAccountMemberId",value:function _getAccountMemberId(e){return this._planywayIntegrationSrv.getConnectedAccountById(e).trelloMemberId}},{kind:"method",key:"_waitActiveRequestsAsync",value:async function _waitActiveRequestsAsync(e){const t=this._cache.get(e);for(;;){var r,i,a,s,n,o;let l=[...this._trelloIntegrationSrv.getRestPromises(e),...B()(r=I()(i=t.cardsUpdateBuffers).call(i)).call(r,(e=>e.processUpdatePromise)),...B()(a=I()(s=t.checklistsUpdateBuffers).call(s)).call(a,(e=>e.processUpdatePromise)),...B()(n=I()(o=t.timeRecordsUpdateBuffers).call(o)).call(n,(e=>e.processUpdatePromise))];if(0===l.length)break;await P().allSettled(l)}}},{kind:"method",key:"_restAsync",value:async function _restAsync(e,t,r){let i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this._telemetrySrv.logRequest(r,e,t,_objectSpread(_objectSpread({},a.query),a.body),a.telemetrySkipOnSuccess),n=200;try{return await this._platformSrv.restAsync(e,t,_objectSpread(_objectSpread({},a),{},{useTrelloAuth:!0}))}catch(e){throw n=e.status,i=e.response,e}finally{this._telemetrySrv.logRequestEnd(s,n,i)}}},{kind:"method",key:"_requestReloadCalendarCards",value:function _requestReloadCalendarCards(e){const t=this._cache.get(e);t.reloadCalendarCardsRequested=!0,t.busyBoardIds.clear()}},{kind:"method",key:"_setTrelloBoardsBusy",value:function _setTrelloBoardsBusy(e,t,r){const i=this._cache.get(e);this._$rootScope.$evalAsync((()=>{for(let e of t)i.busyBoardIds.set(e,r)}))}},{kind:"method",key:"_loadCalendarCardsAsync",value:async function _loadCalendarCardsAsync(e,t){var r;await this._platformSrv.waitOnlineAsync();const i=this._cache.get(e);let a=[];for(let e of $()(s=i.loadedBoardIds).call(s)){var s;i.loadedBoardIds.get(e)&&a.push(e)}const n=z()(a).call(a,(e=>!i.busyBoardIds.has(e)));try{if(this._setTrelloBoardsBusy(e,n,!0),i.trackBoardsUpdatesRequested&&(i.trackBoardsUpdatesRequested=!1,(async t=>{let r=await this._trackBoardsUpdatesAsync(e,J()($()(t=i.loadedBoardIds).call(t)));for(let{boardId:t,lastBoardModifiedDate:i,lastCardsModifiedDate:a,lastRecordsModifiedDate:s}of r)this._updateBoardLastModifiedDate(e,t,i),this._updateBoardCardsLastModifiedDate(e,t,a),this._updateBoardRecordsLastModifiedDate(e,t,s);if(i.boardsUpdatesExpirationInterval&&this._$interval.cancel(i.boardsUpdatesExpirationInterval),i.boardsUpdatesExpirationInterval=this._$interval((()=>{var t;i.boardsUpdatesSignalRSubscription.isSignalRActive&&this._trackBoardsUpdatesAsync(e,J()($()(t=i.loadedBoardIds).call(t)))}),216e5,0,!1),!i.boardsUpdatesSignalRSubscribed){i.boardsUpdatesSignalRSubscribed=!0;const{url:t,token:r}=this.provider.getSignalRConnectionParams(this._planywayIntegrationSrv.getConnectedAccountById(e)),a=(0,we.Z)((async t=>{await this._waitActiveRequestsAsync(e),await this._updateBoardsAsync(e,t)}),1e3);i.boardsUpdatesSignalRSubscription=await this._platformSrv.subscribeSignalRAsync(t,{token:r,messageType:Ee.Wy.BoardUpdated,messageCallback:async t=>{this.provider.invalidAccountIds.has(e)||await a([t])},errorCallback:e=>{this._$log.error("Planyway boards updates SignalR error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway boards updates SignalR error",e,{class:this.constructor.name,method:this._loadCalendarCardsAsync.name})},pollingController:this._platformSrv.buildSignalRPollingController((async()=>{var t;if(this.provider.invalidAccountIds.has(e))return;await this._waitActiveRequestsAsync(e);let r=await this._trackBoardsUpdatesAsync(e,J()($()(t=i.loadedBoardIds).call(t)));await this._updateBoardsAsync(e,r)}),6e4)})}})()),i.reloadBoardsDataRequested&&(i.reloadBoardsDataRequested=!1,await this._trelloIntegrationSrv.loadBoardsDataAsync(e,a)),t.isCanceled())return;let[r]=await P().all([this.getBoardsCardsAsync(e,a,t,{loadArchived:this._collectionSettings.global.settings.isArchivedCardsShown}),this._loadBoardsTimeRecordsAsync(e,a,t)]);if(t.isCanceled())return;for(let e of I()(o=i.calendarCards).call(o)){var o,l;e.isTempCard||(null===(l=i.loadedBoardIds.get(e.providerCard.boardId))||void 0===l||l)&&i.calendarCards.delete(e)}for(let{boardId:a,trelloCards:s}of r){let r=this._trelloIntegrationSrv.getTrelloBoardById(e,a);for(let t of s){if(i.deletedCardIds.has(t.id))continue;var d;if(this._updateBoardCardsLastModifiedDate(e,t.idBoard,t.dateLastActivity),t.customFieldItems)if(this._updateCustomFieldItemsCache(e,t.id,t.customFieldItems),t.customFieldItems.length>0)G()(d=t.customFieldItems).call(d,(e=>{var t;return!G()(t=r.customFields).call(t,(t=>t.id===e.idCustomField))}))&&(await this._trelloIntegrationSrv.loadBoardDataAsync(e,a),r=this._trelloIntegrationSrv.getTrelloBoardById(e,a));t.checklists&&this._updateChecklistsCache(e,t.id,t.checklists),t.attachments&&this._updateAttachmentsCache(e,t.id,t.attachments);let s=this._createCalendarCardFromTrelloCard(e,t);i.calendarCards.add(s);for(let e of s.providerCard.trelloCustomFieldCards)i.calendarCards.add(e);for(let e of s.providerCard.trelloCheckItemCards)i.calendarCards.add(e);for(let e of s.providerCard.trelloTimeRecordCards)i.calendarCards.add(e)}if(t.isCanceled())return;this._$rootScope.$broadcast(Re.FK.CollectionCalendarReady,{accountId:e,calendarId:a})}for(let e of a)i.loadedBoardIds.set(e,!1)}finally{t.isCanceled()||this._setTrelloBoardsBusy(e,n,!1)}null===(r=i.boardsUpdatesSignalRSubscription)||void 0===r||r.reschedulePolling()}},{kind:"method",key:"_updateBoardsAsync",value:async function _updateBoardsAsync(e,t){var r,i;const a=this._cache.get(e);let s=[];for(let{boardId:r,lastBoardModifiedDate:i,lastCardsModifiedDate:n,lastRecordsModifiedDate:o}of t){if(!a.loadedBoardIds.has(r))continue;if(null!==this._trelloIntegrationSrv.getTrelloBoardById(e,r).migrationProgress)continue;let t=this._updateBoardLastModifiedDate(e,r,i,100),l=this._updateBoardCardsLastModifiedDate(e,r,n,100),d=this._updateBoardRecordsLastModifiedDate(e,r,o,100);(t||l||d)&&s.push({boardId:r,isBoardUpdated:t,isCardsUpdated:l,isRecordsUpdated:d})}if(0===s.length)return;const n=this._appCommonSrv.getCancellationToken(`updateBoards_${e}`);let o=B()(r=z()(s).call(s,(e=>e.isBoardUpdated))).call(r,(e=>e.boardId)),l=B()(i=z()(s).call(s,(e=>e.isBoardUpdated||e.isCardsUpdated||e.isRecordsUpdated))).call(i,(e=>e.boardId));if(await this._trelloIntegrationSrv.loadBoardsDataAsync(e,o),n.isCanceled())return;let[d]=await P().all([this.getBoardsCardsAsync(e,l,n,{loadArchived:this._collectionSettings.global.settings.isArchivedCardsShown}),this._loadBoardsTimeRecordsAsync(e,l,n)]);if(!n.isCanceled())for(let{boardId:t,trelloCards:r}of d){if(!a.loadedBoardIds.has(t))continue;let i=new(A());for(let e of I()(c=a.calendarCards).call(c)){var c;e.providerCard.boardId===t&&i.set(e.id,e)}let s=this._trelloIntegrationSrv.getTrelloBoardById(e,t),n=new(A()),o=new(A()),l=new(A()),d=new(A());for(let t of r){if(a.deletedCardIds.has(t.id))continue;var h;if(this._updateBoardCardsLastModifiedDate(e,t.idBoard,t.dateLastActivity),t.customFieldItems)if(o.set(t.id,t.customFieldItems),t.customFieldItems.length>0)G()(h=t.customFieldItems).call(h,(e=>{var t;return!G()(t=s.customFields).call(t,(t=>t.id===e.idCustomField))}))&&(await this._trelloIntegrationSrv.loadBoardDataAsync(e,t.idBoard),s=this._trelloIntegrationSrv.getTrelloBoardById(e,t.idBoard));t.checklists&&l.set(t.id,t.checklists),t.attachments&&d.set(t.id,t.attachments);let r=this._createCalendarCardFromTrelloCard(e,t);n.set(r.id,r);for(let e of r.providerCard.trelloCustomFieldCards)n.set(e.id,e);for(let e of r.providerCard.trelloCheckItemCards)n.set(e.id,e);for(let e of r.providerCard.trelloTimeRecordCards)n.set(e.id,e)}const isCustomFieldItemsUpdated=e=>!(0,xe.cO)(toEquableCustomFieldItems(a.cardsCustomFieldItems.get(e.id)),toEquableCustomFieldItems(o.get(e.id)),!1),isChecklistsUpdated=e=>!(0,xe.cO)(toEquableChecklists(a.cardsChecklists.get(e.id)),toEquableChecklists(l.get(e.id)),!1),isAttachmentsUpdated=e=>!(0,xe.cO)(toEquableAttachments(a.cardsAttachments.get(e.id)),toEquableAttachments(d.get(e.id)),!1),isTimeRecordsUpdated=(e,t)=>{let r=e.providerCard.trelloTimeRecordCards;return r.length!==t.providerCard.trelloTimeRecordCards.length||G()(r).call(r,(e=>!e.equals(n.get(e.id))))};for(let[t,r]of n){let s=i.get(t);if(s){if(s.providerCard.lastChangeId<r.providerCard.lastChangeId&&this._$rootScope.$broadcast(Re.FK.TrelloCardChanged,{calendarCard:r}),s.equals(r)&&!isCustomFieldItemsUpdated(s)&&!isChecklistsUpdated(s)&&!isAttachmentsUpdated(s)&&!isTimeRecordsUpdated(s,r))continue;a.calendarCards.update(r,{hasExternalChanges:!0})}else a.calendarCards.add(r);var u;if(o.has(t)&&this._updateCustomFieldItemsCache(e,t,o.get(t)),l.has(t)&&this._updateChecklistsCache(e,t,l.get(t)),d.has(t))this._updateAttachmentsCache(e,t,[...d.get(t),...z()(u=a.cardsAttachments.get(t)||[]).call(u,(e=>isIncrementalTempId(e.id)))])}for(let e of $()(i).call(i))e===Le.$d||isIncrementalTempId(e)||n.has(e)||a.calendarCards.delete(e)}}},{kind:"method",key:"_trackBoardsUpdatesAsync",value:async function _trackBoardsUpdatesAsync(e,t){let r=[];try{let i=[...t];for(;i.length>0;){let t=await this._callTrackingApiAsync(e,"update","Get Trello boards updates",{boardIds:oe()(i).call(i,0,50)});r.push(...t)}}catch(e){this._$log.error("Planyway get Trello boards updates error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway get Trello boards updates error",e,{class:this.constructor.name,method:this._trackBoardsUpdatesAsync.name})}return r}},{kind:"method",key:"_updateBoardLastModifiedDate",value:function _updateBoardLastModifiedDate(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!r)return!1;const a=this._cache.get(e);"string"==typeof r&&(r=new Date(r));let s=a.boardsLastModifiedDate.get(t);return(!s||(0,xe.GM)(s,r)>i)&&(a.boardsLastModifiedDate.set(t,r),!0)}},{kind:"method",key:"_updateBoardCardsLastModifiedDate",value:function _updateBoardCardsLastModifiedDate(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!r)return!1;const a=this._cache.get(e);"string"==typeof r&&(r=new Date(r));let s=a.boardsCardsLastModifiedDate.get(t);return(!s||(0,xe.GM)(s,r)>i)&&(a.boardsCardsLastModifiedDate.set(t,r),!0)}},{kind:"method",key:"_getBoardsFilters",value:function _getBoardsFilters(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this._cache.get(e);if(!r.boardsFilters||t){let t=new(R())([Le.$d]),d=new(R())([Le.$d]),c=new(R()),h=new(R()),u=new(A());for(let p of $()(i=r.loadedBoardIds).call(i)){var i,a,s,n,o,l;if(r.hiddenBoardIds.has(p))continue;let m=this._trelloIntegrationSrv.getTrelloBoardById(e,p);D()(a=m.members).call(a,(e=>t.add(e.id))),D()(s=m.labels).call(s,(e=>d.add((0,xe.uz)(e)))),D()(n=m.lists).call(n,(e=>c.add(e.id))),D()(o=m.customFields).call(o,(e=>h.add((0,xe.SY)(e)))),D()(l=m.customFilters).call(l,(e=>u.set(e.id,e)))}let p=this._trelloCollectionSettings.global.filters;r.boardsFilters={memberIds:z()(t).call(t,(e=>{var t;return F()(t=p.members).call(t,e)})),labelHashes:z()(d).call(d,(e=>{var t;return F()(t=p.labels).call(t,e)})),listIds:z()(c).call(c,(e=>{var t;return F()(t=p.lists).call(t,e)})),customFieldHashes:z()(h).call(h,(e=>{var t;return F()(t=p.customFields).call(t,e)})),customFilters:z()(u).call(u,(e=>{var t;return F()(t=p.customFilters).call(t,e.id)}))}}return r.boardsFilters}},{kind:"method",key:"_reloadBoardsFilters",value:function _reloadBoardsFilters(e){const t=this._cache.get(e);if(!t.boardsFilters)return;let r=t.boardsFilters,i=this._getBoardsFilters(e,!0);r.cardsVisibility===i.cardsVisibility&&(0,xe.nb)(r.memberIds,i.memberIds)&&(0,xe.nb)(r.labelHashes,i.labelHashes)&&(0,xe.nb)(r.listIds,i.listIds)&&(0,xe.nb)(r.customFieldHashes,i.customFieldHashes)&&(0,xe.kt)(r.customFilters,i.customFilters)||this._$rootScope.$broadcast(Re.FK.FiltersChanged)}},{kind:"method",key:"_getDefaultListIdAsync",value:async function _getDefaultListIdAsync(e,t){let r=this._trelloIntegrationSrv.getTrelloBoardById(e,t),i=r.defaultListId;if(i)try{let r=await this._trelloIntegrationSrv.restAsync(e,Re.Tu.Get,`/lists/${i}`,"Get Trello list");if(!r.closed&&r.idBoard===t)return i}catch(e){this._$log.error("Trello default list getting error:"),this._$log.error(e)}return i=await this._getFirstListIdAsync(e,t),r.defaultListId=i,(async()=>{try{await this._trelloIntegrationSrv.saveBoardSettingsAsync(e,t,{defaultListId:i})}catch(e){this._$log.error("Planyway failed to save default list settings:"),this._$log.error(e)}})(),i}},{kind:"method",key:"_getFirstListIdAsync",value:async function _getFirstListIdAsync(e,t){try{let r=await this._trelloIntegrationSrv.restAsync(e,Re.Tu.Get,`/boards/${t}/lists`,"Get Trello lists",{filter:"open",fields:"id,pos"});if(r.length>0)return r[0].id;let i=await this._trelloIntegrationSrv.createTrelloListAsync(e,t,{name:this._$translate.instant("MISC.NO_TITLE"),position:"top"});if(i)return i.id}catch(e){this._$log.error("Trello first list getting error:"),this._$log.error(e)}}},{kind:"method",key:"_createCalendarCardFromTrelloCard",value:function _createCalendarCardFromTrelloCard(e,t){var r,i;const a=this._cache.get(e);let s=this._trelloIntegrationSrv.getTrelloBoardById(e,t.idBoard),n=Pe.fb.createCard(e,Re.lP.Trello,Ee.eT.TrelloCard,{trelloCard:t,cardBoard:s});if((null===(r=t.customFieldItems)||void 0===r?void 0:r.length)>0)for(let e of t.customFieldItems){var o,l;(null===(o=X()(l=s.customFields).call(l,(t=>t.id===e.idCustomField)))||void 0===o?void 0:o.type)===Ee.vK.Date&&n.providerCard.addTrelloCustomFieldCardFromTrello(e)}if((null===(i=t.checklists)||void 0===i?void 0:i.length)>0){var d;let e=F()(d=s.premiumFeatures).call(d,Re.GC.AdvancedChecklists);for(let r of t.checklists)for(let t of r.checkItems)n.providerCard.addTrelloCheckItemCardFromTrello(t,s,{syncWithTrello:e})}let c=a.boardsTimeRecords.get(n.providerCard.boardId);if((null==c?void 0:c.length)>0)for(let e of c)e.cardId===n.id&&n.providerCard.addTrelloTimeRecordCard(e,s);return n}},{kind:"method",key:"_reloadListCardPositionsAsync",value:async function _reloadListCardPositionsAsync(e,t){let r=this._cache.get(e),i=await this._trelloIntegrationSrv.restAsync(e,Re.Tu.Get,`/lists/${t}/cards`,"Get Trello list card positions",{fields:"id,pos"});for(let e of i){let t=r.calendarCards.get(e.id);"number"==typeof(null==t?void 0:t.providerCard.position)&&Math.abs(e.pos-t.providerCard.position)>K()&&(t.providerCard.position=e.pos,r.calendarCards.update(t))}}},{kind:"method",key:"_processCardUpdateBufferAsync",value:async function _processCardUpdateBufferAsync(e,t,r,i){if(r.processUpdatePromise)return r.processUpdatePromise;const a=this._cache.get(e),{immediateUpdate:s}=i;try{for(s||t===Le.$d||await(0,xe.$U)(200);r.changes;){let i=r.changes;r.changes=null;let a=this.getCalendarCardById(e,t,{cardType:Ee.eT.TrelloCard});if(!a)return;let s=new(R()),n={};for(let e in i){if(ge()(e).call(e,Le.pN)){n[ke()(e).call(e,Le.pN.length)]=i[e];continue}let t=Ze[e];t&&s.add(t),e in a?a[e]=i[e]:e in a.providerCard&&(a.providerCard[e]=i[e])}(i.start||i.end)&&a.correctRecurrenceDates(),await this.updateCalendarCardAsync(a,{waitForUpdate:!1,includeTrelloFields:J()(s),customFieldValues:n})}}finally{a.cardsUpdateBuffers.delete(t)}}},{kind:"method",key:"_callTrackingApiAsync",value:async function _callTrackingApiAsync(e,t,r,i){const{trelloMemberId:a,trelloToken:s}=this._planywayIntegrationSrv.getConnectedAccountById(e);try{let{success:e,data:n,message:o,code:l,details:d}=await this._restAsync(Re.Tu.Post,`${Le.ZC}/trello/${a}/control`,r,{token:s,body:{action:t,data:i},telemetrySkipOnSuccess:!0});if(!e){let e=new Error(o);throw e.code=l,e.details=d,e}return n}catch(e){throw this._$log.error(`Planyway ${r} error:`),this._$log.error(e),this._telemetrySrv.logError(`Planyway ${r} error`,e,{class:this.constructor.name,method:this._callTrackingApiAsync.name}),e}}},{kind:"method",key:"_updateCustomFieldItemsCache",value:function _updateCustomFieldItemsCache(e,t,r){const i=this._cache.get(e);let a;Te()(r)?a=r:(a=i.cardsCustomFieldItems.get(t),a=a?z()(a).call(a,(e=>e.idCustomField!==r.idCustomField)):[],a.push(r)),i.cardsCustomFieldItems.set(t,a),i.cardsCustomFieldValues.delete(t)}},{kind:"method",key:"_updateCustomFieldValuesAsync",value:async function _updateCustomFieldValuesAsync(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.accountId,{waitForUpdate:a}=r;let s=this._trelloIntegrationSrv.getTrelloBoardById(i,e.providerCard.boardId);for(let[r,a]of se()(t)){var n,o;let t=X()(n=s.customFields).call(n,(e=>e.id===r));if(!t)continue;let l=(null===(o=this._cache.get(i).cardsCustomFieldItems.get(e.id))||void 0===o?void 0:X()(o).call(o,(e=>e.idCustomField===r)))||{idModel:e.id,idCustomField:r};switch(t.type){case Ee.vK.Checkbox:l.value=a?{checked:"true"}:"";break;case Ee.vK.Date:l.value=a?{date:a.toISOString()}:"";break;case Ee.vK.List:l.idValue=a;break;case Ee.vK.Number:l.value="number"==typeof a?{number:a.toString()}:"";break;case Ee.vK.Text:l.value=a?{text:a}:""}this._updateCustomFieldItemsCache(i,e.id,l)}if(!e.isTempCard)for(let r of ie()(t))try{var l,d,c,h,u;let t=X()(l=this._cache.get(i).cardsCustomFieldItems.get(e.id)).call(l,(e=>e.idCustomField===r));t=await this._trelloIntegrationSrv.restAsync(i,Re.Tu.Put,`/card/${e.id}/customField/${r}/item`,"Update Trello card custom field",{idValue:null!==(d=null===(c=t)||void 0===c?void 0:c.idValue)&&void 0!==d?d:"",value:null!==(h=null===(u=t)||void 0===u?void 0:u.value)&&void 0!==h?h:""},a?3:9),this._updateCustomFieldItemsCache(i,e.id,t)}catch(e){if(this._telemetrySrv.logError("Trello update custom field error",e,{class:this.constructor.name,method:this._updateCustomFieldValuesAsync.name}),a)throw e;this._$log.error("Trello update custom field error:"),this._$log.error(e),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.UPDATE_CARD_ERROR"),Re.k$.Error)}}},{kind:"method",key:"_updateCustomFieldCardAsync",value:async function _updateCustomFieldCardAsync(e,t,r,i){var a;const s=t.accountId,n=this._cache.get(s),{immediateUpdate:o}=i;let l=null===(a=n.cardsCustomFieldItems.get(t.id))||void 0===a?void 0:X()(a).call(a,(t=>t.id===e));if(!l)return;let{customFieldCardUpdated:d,customFieldCard:c,customFieldUpdated:h,parentCardUpdated:u}=t.providerCard.updateTrelloCustomFieldCard(e,r);d&&n.calendarCards.has(e)&&n.calendarCards.update(c),h&&await this._updateCustomFieldValuesAsync(t,{[l.idCustomField]:c.isAllDay?(0,xe.nT)(r.date):r.date}),u&&await this.updateCalendarCardPropertiesAsync(t,{trelloCustomFieldCards:t.providerCard.trelloCustomFieldCards,customFieldCardsData:t.providerCard.customFieldCardsData},{immediateUpdate:o})}},{kind:"method",key:"_deleteCustomFieldCardAsync",value:async function _deleteCustomFieldCardAsync(e,t){var r;const i=t.accountId,a=this._cache.get(i);let s=null===(r=a.cardsCustomFieldItems.get(t.id))||void 0===r?void 0:X()(r).call(r,(t=>t.id===e));s&&(t.providerCard.deleteTrelloCustomFieldCard(e),a.calendarCards.delete(e),await this._updateCustomFieldValuesAsync(t,{[s.idCustomField]:""}),await this.updateCalendarCardPropertiesAsync(t,{trelloCustomFieldCards:t.providerCard.trelloCustomFieldCards,customFieldCardsData:t.providerCard.customFieldCardsData}))}},{kind:"method",key:"_updateChecklistsCache",value:function _updateChecklistsCache(e,t,r){const i=this._cache.get(e);let a;Te()(r)?a=r:(a=i.cardsChecklists.get(t),a=a?z()(a).call(a,(e=>e.id!==r.id)):[],a.push(r)),i.cardsChecklists.set(t,a)}},{kind:"method",key:"_updateCheckItemCardAsync",value:async function _updateCheckItemCardAsync(e,t,r,i){var a;const s=t.accountId,n=this._cache.get(s),{immediateUpdate:o}=i;let l=null===(a=n.cardsChecklists.get(t.id))||void 0===a?void 0:X()(a).call(a,(t=>{var r;return G()(r=t.checkItems).call(r,(t=>t.id===e))}));l&&await this.updateCalendarCardCheckItemAsync(t,l.id,e,r,{immediateUpdate:o})}},{kind:"method",key:"_deleteCheckItemCardAsync",value:async function _deleteCheckItemCardAsync(e,t){const r=t.accountId,i=this._cache.get(r);t.providerCard.deleteTrelloCheckItemCard(e),i.calendarCards.delete(e),await this.updateCalendarCardPropertiesAsync(t,{trelloCheckItemCards:t.providerCard.trelloCheckItemCards,checkItemCardsData:t.providerCard.checkItemCardsData})}},{kind:"method",key:"_processChecklistUpdateBufferAsync",value:async function _processChecklistUpdateBufferAsync(e,t,r,i,a){if(i.processUpdatePromise)return i.processUpdatePromise;const s=this._cache.get(e),{immediateUpdate:n}=a;try{for(n||t===Le.$d||await(0,xe.$U)(200);i.changes;){var o;let a=i.changes;i.changes=null;let _=null===(o=s.cardsChecklists.get(t))||void 0===o?void 0:X()(o).call(o,(e=>e.id===r));if(!_)return;let k,b,T=s.calendarCards.get(t),S=this._trelloIntegrationSrv.getTrelloBoardById(e,T.providerCard.boardId);for(let e in a)switch(e){case"name":_.name!==a.name&&(_.name=a.name,k=_objectSpread(_objectSpread({},k),{},{name:_.name}));break;case"position":_.pos!==a.position&&(_.pos=a.position,k=_objectSpread(_objectSpread({},k),{},{pos:_.pos}));break;case"checkItems":for(let[e,t]of se()(a.checkItems)){var l;let i,a,o=X()(l=_.checkItems).call(l,(t=>t.id===e));if(o){for(let e in t)switch(e){case"name":o.name!==t.name&&(o.name=t.name,i=_objectSpread(_objectSpread({},i),{},{name:o.name}),a=_objectSpread(_objectSpread({},a),{},{name:t.name}));break;case"isCompleted":"complete"===o.state!==t.isCompleted&&(o.state=t.isCompleted?"complete":"incomplete",i=_objectSpread(_objectSpread({},i),{},{state:o.state}),a=_objectSpread(_objectSpread({},a),{},{isCompleted:t.isCompleted}));break;case"checklistId":r!==t.checklistId&&(i=_objectSpread(_objectSpread({},i),{},{idChecklist:t.checklistId}));break;case"position":o.pos!==t.position&&(o.pos=t.position,i=_objectSpread(_objectSpread({},i),{},{pos:o.pos}),a=_objectSpread(_objectSpread({},a),{},{position:t.position}));break;case"memberIds":o.idMember!==t.memberIds[0]&&(o.idMember=t.memberIds[0]||"",i=_objectSpread(_objectSpread({},i),{},{idMember:o.idMember}),a=_objectSpread(_objectSpread({},a),{},{memberIds:t.memberIds}));break;case"isAllDay":case"start":case"end":case"defaultSortOrder":case"membersSortOrder":case"calendarsSortOrder":case"listsSortOrder":case"labelsSortOrder":a=_objectSpread(_objectSpread({},a),{},{[e]:t[e]})}if(a){var d,c;let e,t=s.calendarCards.get(Le.$d);(null==t?void 0:t.cardType)===Ee.eT.TrelloCheckItem&&(e=t,s.calendarCards.delete(e));let r,l=F()(d=S.premiumFeatures).call(d,Re.GC.AdvancedChecklists),m=!1,C=!1,v=!1;if(G()(c=T.providerCard.trelloCheckItemCards).call(c,(e=>e.id===o.id))?({checkItemCardUpdated:C,checkItemCard:r,parentCardUpdated:v}=T.providerCard.updateTrelloCheckItemCard(o.id,a,S,{syncWithTrello:l})):(r=T.providerCard.addTrelloCheckItemCard(_objectSpread({id:o.id,name:o.name,isCompleted:"complete"===o.state},a),S,{syncWithTrello:l}),m=!0,v=!0),r){if(l){var h;if(void 0!==r.providerCard.realDue){var u;let e=(null===(u=r.providerCard.realDue)||void 0===u?void 0:u.toISOString())||"";o.due!==e&&(o.due=e,i=_objectSpread(_objectSpread({},i),{},{due:o.due}))}if(void 0===(null===(h=i)||void 0===h?void 0:h.idMember)){var p;let e=z()(p=J()(r.providerCard.memberIds)).call(p,(e=>e!==Le.$d))[0]||"";o.idMember!==e&&(o.idMember=e,i=_objectSpread(_objectSpread({},i),{},{idMember:o.idMember}))}}m?s.calendarCards.add(r):C&&s.calendarCards.update(r)}v&&await this.updateCalendarCardPropertiesAsync(T,{trelloCheckItemCards:T.providerCard.trelloCheckItemCards,checkItemCardsData:T.providerCard.checkItemCardsData},{immediateUpdate:n})}i&&(b=_objectSpread(_objectSpread({},b),{},{[e]:i}))}}}if(isIncrementalTempId(r))return;if(k){_=await this._trelloIntegrationSrv.restAsync(e,Re.Tu.Put,`/checklists/${r}`,"Update Trello checklist",k)}if(b){var m,C;for(let[r,i]of se()(b)){let a=await this._trelloIntegrationSrv.restAsync(e,Re.Tu.Put,`/cards/${t}/checkItem/${r}`,"Update Trello check item",i);if(i.idChecklist){var v,f,y;_.checkItems=z()(v=_.checkItems).call(v,(e=>e.id!==r));let n=X()(f=s.cardsChecklists.get(t)).call(f,(e=>e.id===i.idChecklist));n&&!G()(y=n.checkItems).call(y,(e=>e.id===r))&&(n.checkItems.push(a),this._updateChecklistsCache(e,t,n))}else{var g;_.checkItems=[...z()(g=_.checkItems).call(g,(e=>e.id!==r)),a]}}if(G()(m=Ie()(b)).call(m,(e=>void 0!==e.state)))T.providerCard.badges.checkItemsChecked=z()(C=_.checkItems).call(C,(e=>"complete"===e.state)).length,s.calendarCards.update(T)}(k||b)&&this._updateChecklistsCache(e,t,_)}}finally{s.checklistsUpdateBuffers.delete(r)}}},{kind:"method",key:"_loadBoardsTimeRecordsAsync",value:function _loadBoardsTimeRecordsAsync(e,t,r){return(0,Ee.qd)(t,(async t=>{try{if(r.isCanceled())return;let i=await this.getBoardTimeRecordsAsync(e,t);this._updateTimeRecordsCache(e,t,i)}catch(e){this._$log.error("Trello load board time entries error:"),this._$log.error(e),this._telemetrySrv.logError("Trello load board time entries error",e,{class:this.constructor.name,method:this._loadBoardsTimeRecordsAsync.name})}}),5)}},{kind:"method",key:"_adjustTimeRecord",value:function _adjustTimeRecord(e,t){var r;let i,a;return null===(r=t.isDuration)||void 0===r||r?(i=(0,xe.q_)(t.from,this._settingsSrv.user.global.settings.workDayStart),a=(0,xe.mH)(i,t.durationMinutes)):(i=(0,xe.HE)(t.from,!1),a=(0,xe.HE)(t.to,!1)),_objectSpread(_objectSpread({},t),{},{accountId:e,isDuration:!1,from:i,to:a})}},{kind:"method",key:"_updateTimeRecordsCache",value:function _updateTimeRecordsCache(e,t,r){const i=this._cache.get(e);let a;Te()(r)?a=r:(a=i.boardsTimeRecords.get(t),a=a?z()(a).call(a,(e=>e.id!==r.id)):[],a.push(r)),i.boardsTimeRecords.set(t,a)}},{kind:"method",key:"_updateTimeRecordCardAsync",value:async function _updateTimeRecordCardAsync(e,t,r,i){const{immediateUpdate:a}=i;await this.updateCalendarCardTimeRecordAsync(t,e,r,{immediateUpdate:a})}},{kind:"method",key:"_deleteTimeRecordCardAsync",value:async function _deleteTimeRecordCardAsync(e,t){const r=t.accountId,i=this._cache.get(r);if(t.providerCard.deleteTrelloTimeRecordCard(e),i.calendarCards.delete(e),!t.isTempCard){try{let{lastBoardModifiedDate:i}=await this.provider.callRecordsApiAsync(r,"deleteRecord","Planyway delete Trello time record",{boardId:t.providerCard.boardId,id:e});this._updateBoardRecordsLastModifiedDate(r,t.providerCard.boardId,i)}catch(e){if(e.code!==Ee.T.RecordNotFound)throw e}let a=i.boardsTimeRecords.get(t.providerCard.boardId);(null==a?void 0:a.length)>0&&this._updateTimeRecordsCache(r,t.providerCard.boardId,z()(a).call(a,(t=>t.id!==e)))}await this.updateCalendarCardPropertiesAsync(t,{trelloTimeRecordCards:t.providerCard.trelloTimeRecordCards})}},{kind:"method",key:"_processTimeRecordUpdateBufferAsync",value:async function _processTimeRecordUpdateBufferAsync(e,t,r,i,a){if(i.processUpdatePromise)return i.processUpdatePromise;const s=this._cache.get(e),{immediateUpdate:n}=a;try{for(n||t===Le.$d||await(0,xe.$U)(200);i.changes;){let a=i.changes;i.changes=null;let l,d=s.calendarCards.get(t),c=this._trelloIntegrationSrv.getTrelloBoardById(e,d.providerCard.boardId);for(let e in a)switch(e){case"from":case"to":l=_objectSpread(_objectSpread({},l),{},{[e]:a.isDuration?(0,xe.tC)(a[e]):a[e]});break;case"comment":case"isDuration":case"durationMinutes":case"memberId":l=_objectSpread(_objectSpread({},l),{},{[e]:a[e]})}if(l){var o;let t,i=s.calendarCards.get(Le.$d);(null==i?void 0:i.cardType)===Ee.eT.TrelloTimeRecord&&s.calendarCards.delete(i);let h=!1,u=!1,p=!1;if(G()(o=d.providerCard.trelloTimeRecordCards).call(o,(e=>e.id===r))){if(({timeRecordCardUpdated:u,timeRecordCard:t,parentCardUpdated:p}=d.providerCard.updateTrelloTimeRecordCard(r,a,c)),!d.isTempCard){let i=s.boardsTimeRecords.get(d.providerCard.boardId);if((null==i?void 0:i.length)>0){let t=X()(i).call(i,(e=>e.id===r));t&&this._updateTimeRecordsCache(e,d.providerCard.boardId,_objectSpread(_objectSpread({},t),a))}(async()=>{try{let i=await this.provider.callRecordsApiAsync(e,"updateRecord","Planyway update Trello time record",_objectSpread({boardId:d.providerCard.boardId,id:r},l)),{lastBoardModifiedDate:a}=i,s=(0,b.Z)(i,Ge);this._updateBoardRecordsLastModifiedDate(e,d.providerCard.boardId,a),t&&(t.providerCard.lastChangeId=new Date(s.lastModifiedDate).getTime())}catch(e){if(e.code!==Ee.T.RecordNotFound)throw e}})()}}else{let i;if(d.isTempCard)i=_objectSpread({id:r,accountId:e,boardId:d.providerCard.boardId,cardId:d.id},a);else{let t=await this.provider.callRecordsApiAsync(e,"createRecord","Planyway create Trello time record",_objectSpread({boardId:d.providerCard.boardId,cardId:d.id},l)),{lastBoardModifiedDate:r}=t,a=(0,b.Z)(t,Ue);i=this._adjustTimeRecord(e,a),this._updateBoardRecordsLastModifiedDate(e,d.providerCard.boardId,r)}this._updateTimeRecordsCache(e,d.providerCard.boardId,i),t=d.providerCard.addTrelloTimeRecordCard(i,c),h=!0,p=!0}t&&(h?s.calendarCards.add(t):u&&s.calendarCards.update(t)),p&&await this.updateCalendarCardPropertiesAsync(d,{trelloTimeRecordCards:d.providerCard.trelloTimeRecordCards},{immediateUpdate:n})}}}finally{s.timeRecordsUpdateBuffers.delete(r)}}},{kind:"method",key:"_updateBoardRecordsLastModifiedDate",value:function _updateBoardRecordsLastModifiedDate(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!r)return!1;const a=this._cache.get(e);"string"==typeof r&&(r=new Date(r));let s=a.boardsRecordsLastModifiedDate.get(t);return(!s||(0,xe.GM)(s,r)>i)&&(a.boardsRecordsLastModifiedDate.set(t,r),!0)}},{kind:"method",key:"_updateAttachmentsCache",value:function _updateAttachmentsCache(e,t,r){const i=this._cache.get(e);let a;Te()(r)?a=r:(a=i.cardsAttachments.get(t),a=a?z()(a).call(a,(e=>e.id!==r.id)):[],a.push(r)),i.cardsAttachments.set(t,a)}},{kind:"method",key:"_updateCommentsCache",value:function _updateCommentsCache(e,t,r){const i=this._cache.get(e);let a;Te()(r)?a=r:(a=i.cardsComments.get(t),a=a?z()(a).call(a,(e=>e.id!==r.id)):[],a.push(r)),i.cardsComments.set(t,a)}},{kind:"method",key:"_isCalendarCardCommentCanBeUpdated",value:function _isCalendarCardCommentCanBeUpdated(e,t){const r=e.accountId;return t.idMemberCreator===this._getAccountMemberId(r)&&"copyCommentCard"!==t.type}},{kind:"method",key:"_isCalendarCardCommentCanBeReplied",value:function _isCalendarCardCommentCanBeReplied(e,t){const r=e.accountId;return t.idMemberCreator!==this._getAccountMemberId(r)}},{kind:"method",key:"_isCalendarCardCommentCanBeDeleted",value:function _isCalendarCardCommentCanBeDeleted(e,t){const r=e.accountId;if(this._isCalendarCardCommentCanBeUpdated(e,t))return!0;let i=this._trelloIntegrationSrv.getTrelloBoardById(r,e.providerCard.boardId);var a,s;return!!i&&((null===(a=i.memberships.get(this._getAccountMemberId(r)))||void 0===a?void 0:a.memberType)===Re.IM.Admin&&(null===(s=i.memberships.get(t.idMemberCreator))||void 0===s?void 0:s.memberType)!==Re.IM.Admin)}},{kind:"method",key:"_linkCalendarCardsAsync",value:function _linkCalendarCardsAsync(e,t,r,i){var a;const s=this._cache.get(e);if(r===Le.$d)return;let n=s.calendarCards.get(t);return!n||n.isReadOnly||G()(a=n.providerCard.links).call(a,(e=>e.cardId===r&&e.type===i))?void 0:this.updateCalendarCardPropertiesAsync(n,{links:[...n.providerCard.links,{cardId:r,type:i}]})}},{kind:"method",key:"_relinkCalendarCardsAsync",value:function _relinkCalendarCardsAsync(e,t,r,i,a){const s=this._cache.get(e);if(r===Le.$d)return;let n=s.calendarCards.get(t);if(!n)return;if(n.isReadOnly)return;let o=[...n.providerCard.links],l=X()(o).call(o,(e=>e.cardId===r&&e.type===i));return l?(l.type=a,this.updateCalendarCardPropertiesAsync(n,{links:o})):void 0}},{kind:"method",key:"_updateLinkedCalendarCardsAsync",value:function _updateLinkedCalendarCardsAsync(e,t,r,i,a){var s;const n=this._cache.get(e);if(i===Le.$d)return;let o=n.calendarCards.get(t);return o&&!o.isReadOnly?this.updateCalendarCardPropertiesAsync(o,{links:B()(s=o.providerCard.links).call(s,(e=>e.cardId===r&&e.type===a?{cardId:i,type:e.type}:e))}):void 0}},{kind:"method",key:"_unlinkCalendarCardsAsync",value:function _unlinkCalendarCardsAsync(e,t,r,i){var a,s;const n=this._cache.get(e);if(r===Le.$d)return;let o=n.calendarCards.get(t);return o&&!o.isReadOnly&&G()(a=o.providerCard.links).call(a,(e=>e.cardId===r&&e.type===i))?this.updateCalendarCardPropertiesAsync(o,{links:z()(s=o.providerCard.links).call(s,(e=>e.cardId!==r||e.type!==i))}):void 0}}]}}));function isIncrementalTempId(e){return ge()(e).call(e,Le.$d)}let Ye=1e4;function getIncrementalTempId(){return`${Le.$d}_${Ye++}`}function toEquableCustomFieldItem(e){if(e)return{id:e.id,idValue:e.idValue||null,value:e.value||null}}function toEquableCustomFieldItems(e){var t;return e?Y()(t=B()(e).call(e,toEquableCustomFieldItem)).call(t,((e,t)=>e.pos-t.pos)):[]}function toEquableChecklist(e){var t,r,i;if(e)return{id:e.id,name:e.name,pos:e.pos,checkItems:Y()(t=B()(r=z()(i=e.checkItems).call(i,(e=>!isIncrementalTempId(e.id)))).call(r,(e=>({id:e.id,name:e.name,due:e.due,idMember:e.idMember,pos:e.pos,state:e.state})))).call(t,((e,t)=>e.pos-t.pos))}}function toEquableChecklists(e){var t,r;return e?Y()(t=B()(r=z()(e).call(e,(e=>!isIncrementalTempId(e.id)))).call(r,toEquableChecklist)).call(t,((e,t)=>e.pos-t.pos)):[]}function toEquableAttachment(e){if(e)return{id:e.id,name:e.name,pos:e.pos,url:e.url,date:e.date,previews:[...e.previews]}}function toEquableAttachments(e){var t,r;return e?Y()(t=B()(r=z()(e).call(e,(e=>!isIncrementalTempId(e.id)))).call(r,toEquableAttachment)).call(t,((e,t)=>e.pos-t.pos)):[]}},49425:(e,t,r)=>{r.d(t,{P:()=>Ae});var i=r(40024),a=r.n(i),s=r(57445),n=r.n(s),o=r(51791),l=r.n(o),d=r(56626),c=r.n(d),h=r(62079),u=r.n(h),p=r(52020),m=r.n(p),C=r(88546),v=r.n(C),f=r(66775),y=r.n(f),g=r(2201),_=r.n(g),k=r(41266),b=r(26171),T=r(26881),S=r(23513),I=r.n(S),w=r(54847),D=r.n(w),E=r(67552),A=r.n(E),L=r(88946),R=r.n(L),x=r(57170),P=r.n(x),M=r(58218),B=r.n(M),O=r(86981),$=r.n(O),N=r(91829),F=r.n(N),j=r(76555),z=r.n(j),U=r(89221),G=r.n(U),V=r(99595),K=r.n(V),H=r(35820),Z=r.n(H),W=r(8244),Y=r.n(W),q=r(10349),X=r.n(q),Q=r(73324),J=r.n(Q),ee=r(90143),te=r.n(ee),re=r(49804),ie=r.n(re),ae=r(31082),se=r.n(ae),ne=r(13464),oe=r.n(ne),le=r(27525),de=r.n(le),ce=r(90869),he=r.n(ce),ue=r(68949),pe=r(82617),me=r(56777),Ce=(r(43611),r(8937)),ve=r(20115),fe=r(54840),ye=r(29704);const ge=["trelloBoardId","syncStatus"],_e=["syncStatus"];function ownKeys(e,t){var r=u()(e);if(m()){var i=m()(e);t&&(i=J()(i).call(i,(function(t){return v()(e,t).enumerable}))),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,i,a=null!=arguments[t]?arguments[t]:{};t%2?K()(r=ownKeys(Object(a),!0)).call(r,(function(t){(0,b.Z)(e,t,a[t])})):y()?_()(e,y()(a)):K()(i=ownKeys(Object(a))).call(i,(function(t){n()(e,t,v()(a,t))}))}return e}function _getDecoratorsApi(){_getDecoratorsApi=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){var r;K()(r=["method","field"]).call(r,(function(r){K()(t).call(t,(function(t){t.kind===r&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var r,i=e.prototype;K()(r=["method","field"]).call(r,(function(r){K()(t).call(t,(function(t){var a=t.placement;if(t.kind===r&&("static"===a||"prototype"===a)){var s="static"===a?e:i;this.defineClassElement(s,t)}}),this)}),this)},defineClassElement:function(e,t){var r=t.descriptor;if("field"===t.kind){var i=t.initializer;r={enumerable:r.enumerable,writable:r.writable,configurable:r.configurable,value:void 0===i?void 0:i.call(e)}}n()(e,t.key,r)},decorateClass:function(e,t){var r=[],i=[],a={static:[],prototype:[],own:[]};if(K()(e).call(e,(function(e){this.addElementPlacement(e,a)}),this),K()(e).call(e,(function(e){if(!_hasDecorators(e))return r.push(e);var t=this.decorateElement(e,a);r.push(t.element),r.push.apply(r,t.extras),i.push.apply(i,t.finishers)}),this),!t)return{elements:r,finishers:i};var s=this.decorateConstructor(r,t);return i.push.apply(i,s.finishers),s.finishers=i,s},addElementPlacement:function(e,t,r){var i=t[e.placement];if(!r&&-1!==l()(i).call(i,e.key))throw new TypeError("Duplicated element ("+e.key+")");i.push(e.key)},decorateElement:function(e,t){for(var r=[],i=[],a=e.decorators,s=a.length-1;s>=0;s--){var n=t[e.placement];te()(n).call(n,l()(n).call(n,e.key),1);var o=this.fromElementDescriptor(e),d=this.toElementFinisherExtras((0,a[s])(o)||o);e=d.element,this.addElementPlacement(e,t),d.finisher&&i.push(d.finisher);var c=d.extras;if(c){for(var h=0;h<c.length;h++)this.addElementPlacement(c[h],t);r.push.apply(r,c)}}return{element:e,finishers:i,extras:r}},decorateConstructor:function(e,t){for(var r=[],i=t.length-1;i>=0;i--){var a=this.fromClassDescriptor(e),s=this.toClassDescriptor((0,t[i])(a)||a);if(void 0!==s.finisher&&r.push(s.finisher),void 0!==s.elements){e=s.elements;for(var n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)if(e[n].key===e[o].key&&e[n].placement===e[o].placement)throw new TypeError("Duplicated element ("+e[n].key+")")}}return{elements:e,finishers:r}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return n()(t,c(),{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return R()(t=(0,T.Z)(e)).call(t,(function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var r=_toPropertyKey(e.key),i=String(e.placement);if("static"!==i&&"prototype"!==i&&"own"!==i)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+i+'"');var a=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var s={kind:t,key:r,placement:i,descriptor:A()({},a)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(a,"get","The property descriptor of a field descriptor"),this.disallowProperty(a,"set","The property descriptor of a field descriptor"),this.disallowProperty(a,"value","The property descriptor of a field descriptor"),s.initializer=e.initializer),s},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:_optionalCallableProperty(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:R()(e).call(e,this.fromElementDescriptor,this)};return n()(t,c(),{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var r=_optionalCallableProperty(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:r}},runClassFinishers:function(e,t){for(var r=0;r<t.length;r++){var i=(0,t[r])(e);if(void 0!==i){if("function"!=typeof i)throw new TypeError("Finishers must return a constructor.");e=i}}return e},disallowProperty:function(e,t,r){if(void 0!==e[t])throw new TypeError(r+" can't have a ."+t+" property.")}};return e}function _createElementDescriptor(e){var t,r=_toPropertyKey(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var i={kind:"field"===e.kind?"field":"method",key:r,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(i.decorators=e.decorators),"field"===e.kind&&(i.initializer=e.value),i}function _coalesceGetterSetter(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function _hasDecorators(e){return e.decorators&&e.decorators.length}function _isDataDescriptor(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function _optionalCallableProperty(e,t){var r=e[t];if(void 0!==r&&"function"!=typeof r)throw new TypeError("Expected '"+t+"' to be a function");return r}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[a()];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const ke="https://api.trello.com/1",be=["fullName","email","username","initials","avatarUrl"].join(),Te=["name","displayName","logoHash","limits","memberships","prefs","premiumFeatures"].join(),Se=["name","shortUrl","prefs","premiumFeatures","idOrganization","memberships","dateLastView"].join(),Ie={[pe.wR.TrelloAuthError]:"NOTIFICATIONS.PLANYWAY_SYNC_TRELLO_AUTH_ERROR",[pe.wR.StartTrelloAuthError]:"NOTIFICATIONS.PLANYWAY_SYNC_START_TRELLO_AUTH_ERROR",[pe.wR.TrelloBoardError]:"NOTIFICATIONS.PLANYWAY_SYNC_TRELLO_BOARD_ERROR",[pe.wR.StartTrelloBoardError]:"NOTIFICATIONS.PLANYWAY_SYNC_START_TRELLO_BOARD_ERROR",[pe.wR.TrelloLimitError]:"NOTIFICATIONS.PLANYWAY_SYNC_TRELLO_LIMIT_ERROR",[pe.wR.GoogleAuthError]:"NOTIFICATIONS.PLANYWAY_SYNC_GOOGLE_AUTH_ERROR",[pe.wR.StartGoogleAuthError]:"NOTIFICATIONS.PLANYWAY_SYNC_START_GOOGLE_AUTH_ERROR",[pe.wR.GoogleCalendarError]:"NOTIFICATIONS.PLANYWAY_SYNC_GOOGLE_CALENDAR_ERROR",[pe.wR.StartGoogleCalendarError]:"NOTIFICATIONS.PLANYWAY_SYNC_START_GOOGLE_CALENDAR_ERROR",[pe.wR.GoogleGSuiteError]:"NOTIFICATIONS.PLANYWAY_SYNC_GOOGLE_G_SUITE_ERROR",[pe.wR.StartGoogleGSuiteError]:"NOTIFICATIONS.PLANYWAY_SYNC_START_GOOGLE_G_SUITE_ERROR",[pe.wR.PlanywayLicenseExpired]:"NOTIFICATIONS.PLANYWAY_SYNC_LICENSE_EXPIRED_ERROR"},we={[pe.T.GoogleSyncStartFailureNotLicensed]:"NOTIFICATIONS.PLANYWAY_SYNC_START_FAILED_NOT_LICENSED",[pe.T.GoogleSyncStartFailureNotAuthorized]:"NOTIFICATIONS.PLANYWAY_SYNC_START_FAILED_NOT_AUTHORIZED"},De={[Ce.FK.AccountAdding]:Ce.FK.AccountAdded,[Ce.FK.AccountDeleting]:Ce.FK.AccountDeleted,[Ce.FK.CalendarsChanging]:Ce.FK.CalendarsChanged},Ee=36;let Ae=function _decorate(e,t,r,i){var a,s=_getDecoratorsApi();if(i)for(var n=0;n<i.length;n++)s=i[n](s);var o=t((function initialize(e){s.initializeInstanceElements(e,l.elements)}),r),l=s.decorateClass(function _coalesceClassElements(e){for(var t=[],isSameElement=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=$()(t).call(t,isSameElement)))if(_isDataDescriptor(a.descriptor)||_isDataDescriptor(i.descriptor)){if(_hasDecorators(a)||_hasDecorators(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(_hasDecorators(a)){if(_hasDecorators(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}_coalesceGetterSetter(a,i)}else t.push(a)}return t}(R()(a=o.d).call(a,_createElementDescriptor)),e);return s.initializeClassElements(o.F,l.elements),s.runClassFinishers(o.F,l.finishers)}([(0,ye.SG)(["$injector","$rootScope","$log","$window","$timeout","$interval","$translate","appCommonSrv","dialogSrv","notificationSrv","planywayIntegrationSrv","platformSrv","settingsSrv","telemetrySrv","collectionSrv"])],(function(e){return{F:class TrelloIntegrationService{constructor(t,r,i,a,s,n,o,l,d,c,h,u,p,m,C){e(this),this._$injector=t,this._$rootScope=r,this._$log=i,this._$window=a,this._$timeout=s,this._$interval=n,this._$translate=o,this._appCommonSrv=l,this._dialogSrv=d,this._notificationSrv=c,this._planywayIntegrationSrv=h,this._platformSrv=u,this._settingsSrv=p,this._telemetrySrv=m,this._collectionSrv=C,this._initializedAccounts=new(I());const onSourceChanged=async(e,t)=>{if(t&&t.accountType!==pe.Qm.Trello)return;switch(e.name){case Ce.FK.AccountAdding:await this._addTrelloAccountAsync(t.accountId);break;case Ce.FK.AccountDeleting:this._removeTrelloAccount(t.accountId);break;case Ce.FK.CalendarsChanging:await this._initGoogleSyncAsync(t.accountId)}let r=De[e.name];r&&this._$rootScope.$broadcast(r,t)};this._$rootScope.$on(Ce.FK.AccountAdding,onSourceChanged),this._$rootScope.$on(Ce.FK.AccountDeleting,onSourceChanged),this._$rootScope.$on(Ce.FK.CalendarsChanging,onSourceChanged)}},d:[{kind:"get",static:!0,key:"serviceName",value:function serviceName(){return"trelloIntegrationSrv"}},{kind:"field",key:"_provider",value:()=>(0,me.VH)(Ce.lP.Trello)},{kind:"field",key:"_trelloContext",value:void 0},{kind:"field",key:"_cache",value:()=>new(D())},{kind:"field",key:"_initializedCollectionId",value:()=>null},{kind:"field",key:"_isIntegrationBusy",value:()=>!1},{kind:"field",key:"_trelloBoardsListeners",value:()=>({added:new(I()),updated:new(I()),deleted:new(I()),cleared:new(I())})},{kind:"get",key:"_onboardingSrv",value:function _onboardingSrv(){return this._onboardingSrvLazy||(this._onboardingSrvLazy=this._$injector.get("onboardingSrv")),this._onboardingSrvLazy}},{kind:"get",key:"_planywayNotificationsSrv",value:function _planywayNotificationsSrv(){return this._planywayNotificationsSrvLazy||(this._planywayNotificationsSrvLazy=this._$injector.get("planywayNotificationsSrv")),this._planywayNotificationsSrvLazy}},{kind:"get",key:"_trelloCardsSrv",value:function _trelloCardsSrv(){return this._trelloCardsSrvLazy||(this._trelloCardsSrvLazy=this._$injector.get("trelloCardsSrv")),this._trelloCardsSrvLazy}},{kind:"method",key:"isIntegrationBusy",value:function isIntegrationBusy(){return this._isIntegrationBusy}},{kind:"method",key:"reconnectAccountAsync",value:async function reconnectAccountAsync(e){this._telemetrySrv.logSessionEvent(Ce.cN.CollectionEvents.CollectionAddAccountDialogOpened,{where:Ce.Zz.SidebarReconnectAccount});let t=await this._dialogSrv.showAddAccountDialogAsync({account:e});t?t.accountId===e.accountId?this._telemetrySrv.logSessionEvent(Ce.cN.GeneralEvents.AccountReconnected,{accountType:t.accountType}):this._telemetrySrv.logSessionEvent(Ce.cN.GeneralEvents.AccountConnected,{accountType:t.accountType}):this._telemetrySrv.logSessionEvent(Ce.cN.CollectionEvents.CollectionAddAccountDialogClosed,{where:Ce.Zz.SidebarReconnectAccount})}},{kind:"method",key:"getRestPromises",value:function getRestPromises(e){if(!this._initializedAccounts.has(e))return new(I());return this._cache.get(e).restPromises}},{kind:"method",key:"restAsync",value:async function restAsync(e,t,r,i,a){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3,n=arguments.length>6?arguments[6]:void 0;const o=this._cache.get(e);let{trelloToken:l}=this._planywayIntegrationSrv.getConnectedAccountById(e),d={headers:{Authorization:`OAuth oauth_consumer_key="${ve.VW}", oauth_token="${l}"`},query:{},maxRetryCount:s,onProgress:n};switch(t){case Ce.Tu.Get:A()(d.query,a);break;case Ce.Tu.Delete:A()(d.headers,{"Content-Type":"application/json"});break;default:d.body=a}let c=this._telemetrySrv.logRequest(i,t,ke+r,_objectSpread(_objectSpread({},d.query),d.body));d.onRetry=e=>{let{response:t,retries:r}=e;429===t.status&&this._telemetrySrv.logRequestEnd(c,t.status,_objectSpread(_objectSpread({},t),{},{retries:r}),!0)};let h,u,p=200;try{return u=this._platformSrv.restAsync(t,ke+r,d),o&&o.restPromises.add(u),await u}catch(e){throw e.status||this._platformSrv.switchToOffline(),p=e.status,h=e,e}finally{this._telemetrySrv.logRequestEnd(c,p,h),o&&o.restPromises.delete(u)}}},{kind:"method",key:"batchAsync",value:async function batchAsync(e,t,r,i){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},{maxRetryCount:s=3,keepResultPlacement:n}=a;if(i){i.constructor!==Array&&(i=[i]);let e=R()(i).call(i,(e=>{for(let t in e)e[t]=encodeURIComponent(e[t]);return decodeURIComponent(new(P())(e))}));t=R()(t).call(t,((t,r)=>`${t}?${e[r<e.length?r:e.length-1]}`))}let o=await this.restAsync(e,Ce.Tu.Get,`/batch/?urls=${encodeURIComponent(t.join())}`,r,null,s),l=[];for(let e of o){let t=e[200];if(t)l.push(t);else{n&&l.push(null);let t=new Error(`Batch request error, message: ${B()(e.message)}, code: "${e.statusCode}"`);this._$log.error(`${r} batch error:`),this._$log.error(t),this._telemetrySrv.logError(`${r} batch error`,t,{class:this.constructor.name,method:this.batchAsync.name})}}return l}},{kind:"method",key:"fromTrelloBoard",value:function fromTrelloBoard(e,t,r){var i,a,s,n,o,l,d,c,h,u,p,m,C;const v=this._cache.get(e),f=this.getTrelloMember(e).id,y=t.id,g=v.boardStars.get(y),_=v.organizations.get(t.idOrganization);let k=null===(i=$()(a=t.memberships).call(a,(e=>{let{idMember:t}=e;return t===f})))||void 0===i?void 0:i.memberType,b=k&&k!==Ce.IM.Observer,T=b&&(k===Ce.IM.Admin||t.prefs.invitations===Ce.Jv.Members),S="number"==typeof(null==r?void 0:r.migrationProgress),I=!!(t.lists&&t.labels&&t.members&&t.customFields),w={id:y,shortId:t.shortUrl.match(/\/b\/(\w+)/)[1],accountId:e,isReadOnly:!b||S,canWrite:b,canShare:T,permissionLevel:t.prefs.permissionLevel,invitationLevel:t.prefs.invitations,isPublic:t.prefs.permissionLevel===Ce.Jz.Public,isCommentsPublic:"public"===t.prefs.comments,starred:!!g,starredPosition:null==g?void 0:g.pos,name:t.name,boardColor:t.prefs.backgroundColor&&t.prefs.background,boardImageUrls:this._getBoardImageUrls(t.prefs),premiumFeatures:t.premiumFeatures||[],memberships:new(D())(R()(s=t.memberships).call(s,(e=>{var r,i;let{id:a,idMember:s,memberType:n}=e;return n!==Ce.IM.Admin&&null!==(r=t.premiumFeatures)&&void 0!==r&&F()(r).call(r,Ce.GC.SuperAdmins)&&(null==_||null===(i=_.memberships.get(s))||void 0===i?void 0:i.memberType)===Ce.IM.Admin&&(n=Ce.IM.Admin),[s,{membershipId:a,memberType:n}]}))),lists:I?z()(n=R()(o=t.lists).call(o,(e=>({id:e.id,boardId:y,name:e.name,position:e.pos})))).call(n,ye.H9):[],labels:I?z()(l=R()(d=t.labels).call(d,(e=>({id:e.id,boardId:y,name:e.name,color:e.color})))).call(l,ye.G4):[],members:I?z()(c=R()(h=t.members).call(h,(t=>this.fromTrelloMember(e,t)))).call(c,ye.Yb):[],customFields:I?z()(u=R()(p=t.customFields).call(p,(e=>{var t,r;return{id:e.id,boardId:y,name:e.name,type:e.type,position:e.pos,options:e.options&&z()(t=R()(r=e.options).call(r,(e=>({id:e.id,name:e.value.text,color:e.color,position:e.pos})))).call(t,((e,t)=>e.position-t.position))}}))).call(u,ye.y9):[],cardDataCustomFieldId:I?null===(m=$()(C=t.customFields).call(C,(e=>e.type===pe.vK.Text&&ve.UW.test(e.name))))||void 0===m?void 0:m.id:void 0,organizationId:t.idOrganization,lastViewedDate:t.dateLastView&&new Date(t.dateLastView),color:null==r?void 0:r.color,dateSyncType:null==r?void 0:r.dateSyncType,dueLinkType:null==r?void 0:r.dueLinkType,dueLinkTypeAllDay:null==r?void 0:r.dueLinkTypeAllDay,defaultCardIsAllDay:null==r?void 0:r.defaultCardIsAllDay,defaultCardDuration:null==r?void 0:r.defaultCardDuration,defaultCardPosition:null==r?void 0:r.defaultCardPosition,defaultLimitArchivedCards:null==r?void 0:r.defaultLimitArchivedCards,customFilters:(null==r?void 0:r.customFilters)||[],migrationProgress:S?r.migrationProgress:null,isDataLoaded:I};return t.idOrganization&&v.organizations.has(t.idOrganization)?w.organizationId=t.idOrganization:w.organizationId=ve.tl,w}},{kind:"method",key:"fromTrelloMember",value:function fromTrelloMember(e,t){return{id:t.id,accountId:e,userName:t.username,fullName:t.fullName,initials:t.initials,confirmed:t.confirmed,email:t.email,avatarUrlSmall:t.avatarUrl&&`${t.avatarUrl}/30.png`,avatarUrlNormal:t.avatarUrl&&`${t.avatarUrl}/50.png`}}},{kind:"get",key:"isCurrentCollectionInitialized",value:function isCurrentCollectionInitialized(){return this._initializedCollectionId===this._currentCollectionId}},{kind:"method",key:"initCurrentCollectionAsync",value:async function initCurrentCollectionAsync(e){try{var t,r;this._appCommonSrv.setSchedulerBusy(!0),this._initializedCollectionId=null,this._initializedAccounts.clear();for(let e of G()(i=this._cache).call(i)){var i;e.destroy()}this._cache.clear(),K()(t=this._provider.getCurrentCollectionConnectedAccountIds()).call(t,(e=>this._resetAccountCache(e))),await Z().all(R()(r=this._provider.getCurrentCollectionConnectedAccountIds()).call(r,(async t=>{await this._initTrelloConnectAsync(t,e),this._initGoogleSyncAsync(t,e)}))),this._planywayNotificationsSrv.initializeAsync(),this._initializedCollectionId=this._currentCollectionId,this._trelloCardsSrv.initCurrentCollectionAsync(e)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"isCurrentCollectionAccountReady",value:function isCurrentCollectionAccountReady(e){var t;return!!this._initializedAccounts.has(e)&&Y()(t=this._provider.getCurrentCollectionSelectedCalendarIds(e)).call(t,(t=>{var r;return null===(r=this.getTrelloBoardById(e,t))||void 0===r?void 0:r.isDataLoaded}))}},{kind:"method",key:"getTrelloContextAsync",value:function getTrelloContextAsync(){return{}}},{kind:"method",key:"getTrelloContext",value:function getTrelloContext(){return this._trelloContext}},{kind:"method",key:"getTrelloMemberAsync",value:async function getTrelloMemberAsync(e){let t=await this._getTrelloMemberDataAsync(e);return this.fromTrelloMember(e,t)}},{kind:"method",key:"getTrelloMember",value:function getTrelloMember(e){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).member}},{kind:"method",key:"getTrelloOrganizations",value:function getTrelloOrganizations(e){var t,r,i;if(!this._initializedAccounts.has(e))return[];const a=this._cache.get(e);let s={boardsLimitReached:!0,boardsCreationRestricted:!0,canCreatePublicBoards:!1,canCreatePrivateBoards:!1,canCreateOrganizationBoards:!1,canInviteGuests:!1},n=_objectSpread(_objectSpread({},s),{},{id:ve.LI,type:"starred",name:this._$translate.instant("MENU.STARRED_BOARDS"),memberships:new(D())([[this.getTrelloMember(e).id,{memberType:Ce.IM.Normal}]]),boards:[]}),o=_objectSpread(_objectSpread({},s),{},{id:ve.tl,type:"guest",name:this._$translate.instant("MENU.GUEST_BOARDS"),memberships:new(D())([[this.getTrelloMember(e).id,{memberType:Ce.IM.Normal}]]),boards:[],boardsLimitReached:!0,boardsCreationRestricted:!0,canCreatePublicBoards:!1,canCreatePrivateBoards:!1,canCreateOrganizationBoards:!1,canInviteGuests:!1}),l=[n,...R()(t=X()(G()(r=a.organizations).call(r))).call(t,(e=>_objectSpread(_objectSpread(_objectSpread({},s),e),{},{type:"real",boards:[]}))),o];for(let t of this.getTrelloBoards(e))if(t.starred&&n.boards.push(_objectSpread({},t)),t.organizationId===ve.tl)o.boards.push(_objectSpread(_objectSpread({},t),{},{starredPosition:void 0}));else{let e=$()(l).call(l,(e=>e.id===t.organizationId));e&&e.boards.push(_objectSpread(_objectSpread({},t),{},{starredPosition:void 0}))}return z()(i=n.boards).call(i,((e,t)=>e.starredPosition-t.starredPosition)),l}},{kind:"method",key:"getTrelloOrganizationById",value:function getTrelloOrganizationById(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).organizations.get(t)}},{kind:"method",key:"getTrelloBoards",value:function getTrelloBoards(e){var t;if(!this._initializedAccounts.has(e))return[];const r=this._cache.get(e);return G()(t=r.boards).call(t)}},{kind:"method",key:"getTrelloBoardById",value:function getTrelloBoardById(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).boards.get(t)}},{kind:"method",key:"isConnectedTrelloBoardBusy",value:function isConnectedTrelloBoardBusy(e,t){return this._trelloCardsSrv.isTrelloBoardBusy(e,t)}},{kind:"method",key:"getTrelloListById",value:function getTrelloListById(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).lists.get(t)}},{kind:"method",key:"getTrelloLabelById",value:function getTrelloLabelById(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).labels.get(t)}},{kind:"method",key:"getTrelloMemberById",value:function getTrelloMemberById(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).members.get(t)}},{kind:"method",key:"getMemberByUserName",value:function getMemberByUserName(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).membersByUserName.get(t)}},{kind:"method",key:"getTrelloCustomFieldById",value:function getTrelloCustomFieldById(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).customFields.get(t)}},{kind:"method",key:"loadBoardDataAsync",value:function loadBoardDataAsync(e,t){return this.loadBoardsDataAsync(e,[t])}},{kind:"method",key:"loadBoardsDataAsync",value:async function loadBoardsDataAsync(e,t){if(!this._initializedAccounts.has(e))return;await this._platformSrv.waitOnlineAsync();const r=this._cache.get(e);if(!r.boardMigrationProgressSignalRSubscribed){r.boardMigrationProgressSignalRSubscribed=!0;const{url:t,token:i}=this._provider.getSignalRConnectionParams(this._planywayIntegrationSrv.getConnectedAccountById(e)),updateBoardMigrationState=(t,i)=>{let a=this.getTrelloBoardById(e,t);a&&a.migrationProgress!==i.migrationProgress&&(null===a.migrationProgress&&this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.MIGRATE_BOARD_SETTINGS_STARTED",{boardName:he()(a.name,Ee)}),Ce.k$.Info),null===i.migrationProgress&&this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.MIGRATE_BOARD_SETTINGS_SUCCESS",{boardName:he()(a.name,Ee)}),Ce.k$.Success),r.boards.update(_objectSpread(_objectSpread(_objectSpread({},a),i),{},{isReadOnly:!a.canWrite||null!==i.migrationProgress})))};r.boardMigrationProgressSignalRSubscription=await this._platformSrv.subscribeSignalRAsync(t,{token:i,messageType:pe.Wy.BoardMigrationProgress,messageCallback:e=>{let t={migrationProgress:e.migrationProgress};null===e.migrationProgress&&(t=_objectSpread(_objectSpread({},t),{},{dateSyncType:e.dateSyncType,dueLinkType:e.dueLinkType,dueLinkTypeAllDay:e.dueLinkTypeAllDay})),updateBoardMigrationState(e.boardId,t)},errorCallback:e=>{this._$log.error("Planyway boards migration progress SignalR error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway boards migration progress SignalR error",e,{class:this.constructor.name,method:this.loadBoardsDataAsync.name})},pollingController:this._platformSrv.buildSignalRPollingController((async()=>{var t,i,a;if(this._provider.invalidAccountIds.has(e))return;let s=R()(t=J()(i=G()(a=r.boards).call(a)).call(i,(e=>e.isDataLoaded))).call(t,(e=>e.id)),n=await this.getBoardsSettingsAsync(e,s);for(let e in n){let t=n[e];updateBoardMigrationState(e,{migrationProgress:t.migrationProgress,dateSyncType:t.dateSyncType,dueLinkType:t.dueLinkType,dueLinkTypeAllDay:t.dueLinkTypeAllDay})}}),6e4)})}let i=new(D()),[a]=await Z().all([this.getBoardsSettingsAsync(e,t),(async()=>{(0,pe.qd)(t,(async t=>{try{await this.restAsync(e,Ce.Tu.Post,`/boards/${t}/markAsViewed`,"Mark as view Trello board")}catch(e){this._$log.error("Trello mark board as viewed error:"),this._$log.error(e),this._telemetrySrv.logError("Trello mark board as view error",e,{class:this.constructor.name,method:this.loadBoardsDataAsync.name})}}),4);let r=R()(t).call(t,(e=>`/boards/${e}`));for(;r.length>0;){let t=[];for(let e=0;e<4&&r.length>0;e++)t.push(te()(r).call(r,0,20));try{let r=await Z().all(R()(t).call(t,(t=>this.batchAsync(e,t,"Get Trello boards",{fields:Se,lists:"open",labels:"all",labels_limit:1e3,members:"all",customFields:!0}))));for(let e of ie()(r).call(r))i.set(e.id,e)}catch(e){this._$log.error("Trello load boards data error:"),this._$log.error(e),this._telemetrySrv.logError("Trello load boards data error",e,{class:this.constructor.name,method:this.loadBoardsDataAsync.name})}}})()]);for(let s of t)i.has(s)?this._addOrUpdateBoard(e,i.get(s),a[s]):r.boards.delete(s)}},{kind:"method",key:"getDefaultBoardSettings",value:function getDefaultBoardSettings(){return _objectSpread(_objectSpread({},(0,pe.Gw)()),{},{migrationProgress:null})}},{kind:"method",key:"getBoardsSettingsAsync",value:async function getBoardsSettingsAsync(e,t){let r={},i={};for(let a of t){let t=se()(Ce.nl),s=this.getTrelloBoardById(e,a);if(s){let e=s.boardColor||t[(0,ye.fE)(a)];i[a]={color:e,dateSyncType:s.dateSyncType,dueLinkType:s.dueLinkType,dueLinkTypeAllDay:s.dueLinkTypeAllDay,defaultCardIsAllDay:s.defaultCardIsAllDay,defaultCardDuration:s.defaultCardDuration,defaultCardPosition:s.defaultCardPosition,defaultLimitArchivedCards:s.defaultLimitArchivedCards,defaultListId:s.defaultListId,customFilters:s.customFilters,workHoursPerDay:s.workHoursPerDay,migrationProgress:s.migrationProgress},r[a]=_objectSpread(_objectSpread({},this.getDefaultBoardSettings()),{},{color:e})}else{let e=t[(0,ye.fE)(a)],s=_objectSpread(_objectSpread({},this.getDefaultBoardSettings()),{},{color:e});i[a]=s,r[a]=s}}let a=[...t];for(;a.length>0;)try{const{trelloMemberId:t,trelloToken:v}=this._planywayIntegrationSrv.getConnectedAccountById(e);let f=await this._restAsync(Ce.Tu.Post,`${ve.yx}/trello/${t}/boardSettings`,"Get board settings",{token:v,body:{action:"getBoards",data:{boardIds:te()(a).call(a,0,50),defaultBoardsSettings:r}}});if(!f.success){let e=new Error(f.message);throw e.code=f.code,e.details=f.details,e}let y=f.data;for(let e of y){var s,n,o,l,d,c,h,u,p,m,C;let t=r[e.id];i[e.id]={color:null!==(s=e.color)&&void 0!==s?s:t.color,dateSyncType:null!==(n=e.dateSyncType)&&void 0!==n?n:t.dateSyncType,dueLinkType:null!==(o=e.dueLinkType)&&void 0!==o?o:t.dueLinkType,dueLinkTypeAllDay:null!==(l=e.dueLinkTypeAllDay)&&void 0!==l?l:t.dueLinkTypeAllDay,defaultCardIsAllDay:null!==(d=e.defaultCardIsAllDay)&&void 0!==d?d:t.defaultCardIsAllDay,defaultCardDuration:null!==(c=e.defaultCardDuration)&&void 0!==c?c:t.defaultCardDuration,defaultCardPosition:null!==(h=e.defaultCardPosition)&&void 0!==h?h:t.defaultCardPosition,defaultLimitArchivedCards:null!==(u=e.defaultLimitArchivedCards)&&void 0!==u?u:t.defaultLimitArchivedCards,defaultListId:e.defaultListId,customFilters:null!==(p=e.customFilters)&&void 0!==p?p:t.customFilters,workHoursPerDay:null!==(m=e.workHoursPerDay)&&void 0!==m?m:t.workHoursPerDay,migrationProgress:null!==(C=e.migrationProgress)&&void 0!==C?C:null}}}catch(e){this._$log.error("Planyway boards settings loading error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway boards settings loading error",e,{class:this.constructor.name,method:this.getBoardsSettingsAsync.name})}return i}},{kind:"method",key:"saveBoardSettingsAsync",value:async function saveBoardSettingsAsync(e,t,r){if(!this._initializedAccounts.has(e))return;const i=this._cache.get(e),{trelloMemberId:a,trelloToken:s}=this._planywayIntegrationSrv.getConnectedAccountById(e);let n=i.boards.get(t);i.boards.update(_objectSpread(_objectSpread({},n),r));let o=await this._restAsync(Ce.Tu.Post,`${ve.yx}/trello/${a}/boardSettings`,"Set board settings",{token:s,body:{action:"set",data:_objectSpread(_objectSpread({},r),{},{id:t})}});if(!o.success){let e=new Error(o.message);throw e.code=o.code,e.details=o.details,e}}},{kind:"method",key:"migrateBoardSettingsAsync",value:async function migrateBoardSettingsAsync(e,t){const{trelloMemberId:r,trelloToken:i}=this._planywayIntegrationSrv.getConnectedAccountById(e);await this._restAsync(Ce.Tu.Post,`${ve.yx}/trello/${r}/boardSettings`,"Migrate board settings",{token:i,body:{action:"migrate",data:{id:t,timeZone:(0,ye.iT)()}}});let a=this.getTrelloBoardById(e,t);this._cache.get(e).boards.update(_objectSpread(_objectSpread({},a),{},{isReadOnly:!0,migrationProgress:0}))}},{kind:"method",key:"createTrelloBoardAsync",value:async function createTrelloBoardAsync(e,t){if(!this._initializedAccounts.has(e))return;const r=this._cache.get(e),i=this.getTrelloMember(e).id;let a=await this.restAsync(e,Ce.Tu.Post,"/boards","Create Trello board",{name:t.name,idOrganization:t.organizationId,prefs_permissionLevel:t.permissionLevel,prefs_comments:t.isCommentsPublic?"public":"members",prefs_background:t.color,defaultLists:!1});a.memberships=[{idMember:i,memberType:Ce.IM.Admin}];let s=await this.restAsync(e,Ce.Tu.Get,`/organizations/${a.idOrganization}`,"Get Trello organization",{fields:Te}),n=this._fromTrelloOrganization(e,s);r.organizations.set(s.id,n);let o=this.fromTrelloBoard(e,a);return r.boards.add(o),o}},{kind:"method",key:"updateTrelloBoardAsync",value:async function updateTrelloBoardAsync(e,t,r){if(!this._initializedAccounts.has(e))return;const i=this._cache.get(e);let a=i.boards.get(t),s=await this.restAsync(e,Ce.Tu.PutForm,`/boards/${t}`,"Update Trello board",{name:r.name,"prefs/permissionLevel":r.permissionLevel,"prefs/comments":r.isCommentsPublic?"public":"members"}),n=_objectSpread(_objectSpread({},a),{},{name:s.name,permissionLevel:s.prefs.permissionLevel,isPublic:s.prefs.permissionLevel===Ce.Jz.Public,isCommentsPublic:"public"===s.prefs.comments});return i.boards.update(n),this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:this._appCommonSrv.getTimelineResourcesType()}),n}},{kind:"method",key:"closeTrelloBoardAsync",value:async function closeTrelloBoardAsync(e,t){if(!this._initializedAccounts.has(e))return;const r=this._cache.get(e);let i=r.boards.get(t);await this.restAsync(e,Ce.Tu.PutForm,`/boards/${t}/closed`,"Close Trello board",{value:!0});let a=await this.restAsync(e,Ce.Tu.Get,`/organizations/${i.organizationId}`,"Get Trello organization",{fields:Te}),s=this._fromTrelloOrganization(e,a);r.organizations.set(a.id,s),r.boards.delete(t),this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:this._appCommonSrv.getTimelineResourcesType()})}},{kind:"method",key:"addTrelloBoardEventListener",value:function addTrelloBoardEventListener(e,t){let r=this._trelloBoardsListeners[e];if(!r)throw new Error(`Unsupported event type: ${e}`);r.add(t)}},{kind:"method",key:"removeTrelloBoardEventListener",value:function removeTrelloBoardEventListener(e,t){let r=this._trelloBoardsListeners[e];if(!r)throw new Error(`Unsupported event type: ${e}`);r.delete(t)}},{kind:"method",key:"addMemberToBoardAsync",value:async function addMemberToBoardAsync(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal";await this.restAsync(e,Ce.Tu.Put,`/boards/${t}/members/${r}`,"Add Trello member to board",{type:i,allowBillableGuest:!0}),await this.loadBoardDataAsync(e,t),this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Members})}},{kind:"method",key:"inviteMemberToBoardAsync",value:async function inviteMemberToBoardAsync(e,t,r){var i;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal",s=r.split("@")[0],n=await this.restAsync(e,Ce.Tu.Put,`/boards/${t}/members`,"Invite Trello member to board",{email:r,type:a,fullName:s,allowBillableGuest:!0});await this.loadBoardDataAsync(e,t);let o=$()(i=n.members).call(i,(t=>t.fullName===s&&!1===t.confirmed&&"ghost"===t.memberType&&t.idMemberReferrer===this.getTrelloMember(e).id));return null==o?void 0:o.id}},{kind:"method",key:"removeMemberFromBoardAsync",value:async function removeMemberFromBoardAsync(e,t,r){await this.restAsync(e,Ce.Tu.Delete,`/boards/${t}/members/${r}`,"Remove Trello member from board"),await this.loadBoardDataAsync(e,t),this._trelloCardsSrv.needReloadCalendarCards(),this._$rootScope.$broadcast(Ce.FK.CardsReloaded),this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Members})}},{kind:"method",key:"leaveBoardAsync",value:async function leaveBoardAsync(e,t){const r=this._cache.get(e),{trelloMemberId:i}=this._planywayIntegrationSrv.getConnectedAccountById(e);await this.restAsync(e,Ce.Tu.Delete,`/boards/${t}/members/${i}`,"Remove Trello member from board"),r.boards.delete(t),this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:this._appCommonSrv.getTimelineResourcesType()})}},{kind:"method",key:"updateBoardMembershipAsync",value:async function updateBoardMembershipAsync(e,t,r,i){await this.restAsync(e,Ce.Tu.Put,`/boards/${t}/memberships/${r}`,"Update Trello board membership",{type:i}),await this.loadBoardDataAsync(e,t),this._trelloCardsSrv.needReloadCalendarCards(),this._$rootScope.$broadcast(Ce.FK.CardsReloaded),this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Members})}},{kind:"method",key:"searchMembersAsync",value:async function searchMembersAsync(e,t){var r;let i;if(/^([0-9a-f]{24})$/.test(t))try{i=[await this.restAsync(e,Ce.Tu.Get,`/member/${t}`,"Get Trello member by ID")]}catch{i=[]}else i=await this.restAsync(e,Ce.Tu.Get,"/search/members","Search Trello members",{query:t,limit:10});return J()(r=R()(i).call(i,(t=>t.id?_objectSpread(_objectSpread({},this.fromTrelloMember(e,t)),{},{similarity:t.similarity||0}):t.email?{id:t.email,email:t.email,userName:t.email,fullName:t.email,initials:t.email.substr(0,1).toUpperCase(),similarity:t.similarity||0}:void 0))).call(r,(e=>e))}},{kind:"method",key:"createTrelloListAsync",value:async function createTrelloListAsync(e,t,r){if(!this._initializedAccounts.has(e))return;const i=this._cache.get(e);let a=await this.restAsync(e,Ce.Tu.Post,"/lists","Create Trello list",{idBoard:t,name:r.name,pos:r.position}),s=this._fromTrelloList(a);i.lists.set(s.id,s);let n=i.boards.get(t),o=_objectSpread(_objectSpread({},n),{},{lists:[...n.lists,s]});return i.boards.update(o),s}},{kind:"method",key:"updateTrelloListAsync",value:async function updateTrelloListAsync(e,t,r){var i;if(!this._initializedAccounts.has(e))return;const a=this._cache.get(e);let s=await this.restAsync(e,Ce.Tu.Put,`/lists/${t}`,"Update Trello list",{name:r.name,pos:r.position}),n=this._fromTrelloList(s),o=a.boards.get(n.boardId),l=_objectSpread(_objectSpread({},o),{},{lists:[...o.lists]}),d=oe()(i=l.lists).call(i,(e=>e.id===n.id));if(-1!==d){var c;let e=_objectSpread({},l.lists[d]);e.name=n.name,e.position=n.position,te()(c=l.lists).call(c,d,1,e),a.boards.update(l)}let h=a.lists.get(n.id);return h&&(h.name=n.name,h.position=n.position,this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Lists})),n}},{kind:"method",key:"archiveTrelloListAsync",value:async function archiveTrelloListAsync(e,t){var r,i;if(!this._initializedAccounts.has(e))return;const a=this._cache.get(e);await this.restAsync(e,Ce.Tu.Post,`/lists/${t}/archiveAllCards`,"Archive all cards in Trello list"),await this.restAsync(e,Ce.Tu.Put,`/lists/${t}/closed`,"Archive Trello list",{value:!0});let s=null===(r=a.lists.get(t))||void 0===r?void 0:r.boardId;a.lists.delete(t);let n=a.boards.get(s),o=_objectSpread(_objectSpread({},n),{},{lists:J()(i=n.lists).call(i,(e=>e.id!==t))});a.boards.update(o)}},{kind:"method",key:"getOrCreateTrelloLabel",value:function getOrCreateTrelloLabel(e,t,r){const{color:i,name:a}=r;if(!this._initializedAccounts.has(e))return;const s=this._cache.get(e);let n=this.getTrelloBoardById(e,t).labels,o=$()(n).call(n,(e=>e.color===i&&e.name===a));if(o)return o;let l=`${t}-${i}-${a}`;return o=this.getTrelloLabelById(e,l),o||(o={id:l,boardId:t,isTempLabel:!0,color:i,name:a},s.labels.set(l,o)),o}},{kind:"method",key:"createTrelloLabelAsync",value:function createTrelloLabelAsync(e,t){if(t===ve.$d)return;if(!this._initializedAccounts.has(e))return;const r=this._cache.get(e);let i,a=this.getTrelloLabelById(e,t);return a&&!a.isTempLabel?a:(a?a.getLabelPromise||(i=this.restAsync(e,Ce.Tu.Post,"/labels","Create Trello label",{name:a.name||"",color:a.color,idBoard:a.boardId})):(a={id:t,isTempLabel:!0},r.labels.set(t,a),i=this.restAsync(e,Ce.Tu.Get,`/labels/${t}`,"Get Trello label")),a.getLabelPromise||(a.getLabelPromise=(async a=>{let s=await i,n=this._fromTrelloLabel(s);t!==n.id&&(r.labels.delete(t),r.labels.set(n.id,n));let o=_objectSpread({},this.getTrelloBoardById(e,n.boardId));var l;Y()(a=o.labels).call(a,(e=>e.id!==n.id))&&(o.labels=z()(l=[...o.labels,n]).call(l,ye.G4),r.boards.update(o));return n})()),a.getLabelPromise)}},{kind:"method",key:"updateTrelloLabelAsync",value:async function updateTrelloLabelAsync(e,t,r){var i,a;if(t===ve.$d)return;if(!this._initializedAccounts.has(e))return;const s=this._cache.get(e);let n=_objectSpread({},this.getTrelloBoardById(e,this.getTrelloLabelById(e,t).boardId)),o=await this.restAsync(e,Ce.Tu.Put,`/labels/${t}`,"Update Trello label",{color:null===r.color?"null":r.color,name:r.name}),l=this._fromTrelloLabel(o);return s.labels.set(t,l),n.labels=z()(i=[...J()(a=n.labels).call(a,(e=>e.id!==t)),l]).call(i,ye.G4),s.boards.update(n),this._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Labels}),l}},{kind:"method",key:"deleteTrelloLabelAsync",value:async function deleteTrelloLabelAsync(e,t){var r;if(t===ve.$d)return;if(!this._initializedAccounts.has(e))return;const i=this._cache.get(e);let a=_objectSpread({},this.getTrelloBoardById(e,this.getTrelloLabelById(e,t).boardId));await this.restAsync(e,Ce.Tu.Delete,`/labels/${t}`,"Delete Trello label"),i.labels.delete(t),a.labels=J()(r=a.labels).call(r,(e=>e.id!==t)),i.boards.update(a)}},{kind:"method",key:"isGoogleSyncBusy",value:function isGoogleSyncBusy(e,t){var r;if(!this._initializedAccounts.has(e))return!1;return null!==(r=this._cache.get(e).isGoogleSyncBusy.get(t))&&void 0!==r&&r}},{kind:"method",key:"getGoogleSyncStatus",value:function getGoogleSyncStatus(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).googleSyncStatus.get(t)}},{kind:"method",key:"getGoogleSyncOptions",value:function getGoogleSyncOptions(e,t){if(!this._initializedAccounts.has(e))return;return this._cache.get(e).googleSyncOptions.get(t)}},{kind:"method",key:"startGoogleSyncAsync",value:async function startGoogleSyncAsync(e,t,r){if(!this._initializedAccounts.has(e))return;const i=this._cache.get(e),{trelloMemberId:a,trelloToken:s}=this._planywayIntegrationSrv.getConnectedAccountById(e);let n=this.getTrelloBoardById(e,t).name;const o=this._appCommonSrv.getCancellationToken(`startSync_${e}_${t}`);try{this._setGoogleSyncBusy(e,t,!0);let l=await this._restAsync(Ce.Tu.Post,`${ve.nS}/trello/${a}/control`,"Start Google Sync",{token:s,body:{action:"start",data:_objectSpread({trelloBoardId:t,timeZone:(0,ye.iT)()},r)}});if(o.isCanceled())return;if(!l.success)return void this._notificationSrv.showNotification(we[l.code]?this._$translate.instant(we[l.code],{boardName:he()(n,Ee)}):this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_START_FAILED_WITH_MESSAGE",{message:l.message,boardName:he()(n,Ee)}),Ce.k$.Error);this._telemetrySrv.logSessionEvent(Ce.cN.GoogleSyncEvents.SyncStarted,_objectSpread({},r));let d=0;for(;d<5;){if(await(0,ye.$U)(1e3*(0===d?10:5)),d+=1,o.isCanceled())return;try{if(!await this._loadGoogleSyncStatusAsync(e,t)||o.isCanceled())return;let r=i.googleSyncStatus.get(t);if(r)switch(r){case pe.wR.NotSynced:break;case pe.wR.Ok:return this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_STARTED",{boardName:he()(n,Ee)}),Ce.k$.Success),void this._setGoogleSyncBusy(e,t,!1);default:let r=this._getGoogleSyncErrorMessage(e,t);return r&&this._notificationSrv.showNotification(r,Ce.k$.Error),void this._setGoogleSyncBusy(e,t,!1)}}catch(e){this._$log.error("Planyway poll sync status error:"),this._$log.error(e)}}this._setGoogleSyncBusy(e,t,!1),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_START_LONGER_THEN_USUAL",{boardName:he()(n,Ee)}),Ce.k$.Warning)}catch(r){this._setGoogleSyncBusy(e,t,!1),this._$log.error("Planyway start Google Sync error:"),this._$log.error(r),this._telemetrySrv.logError("Planyway start Google Sync error",r,{class:this.constructor.name,method:this.startGoogleSyncAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_START_FAILED",{boardName:he()(n,Ee)}),Ce.k$.Error)}}},{kind:"method",key:"stopGoogleSyncAsync",value:async function stopGoogleSyncAsync(e,t){if(!this._initializedAccounts.has(e))return;const r=this._cache.get(e),{trelloMemberId:i,trelloToken:a}=this._planywayIntegrationSrv.getConnectedAccountById(e);let s=this.getTrelloBoardById(e,t).name;const n=this._appCommonSrv.getCancellationToken(`stopSync_${e}_${t}`);try{this._setGoogleSyncBusy(e,t,!0);let o=await this._restAsync(Ce.Tu.Post,`${ve.nS}/trello/${i}/control`,"Stop Google Sync",{token:a,body:{action:"stop",data:{trelloBoardId:t}}});if(n.isCanceled())return;if(!o.success)return void this._notificationSrv.showNotification(we[o.code]?this._$translate.instant(we[o.code],{boardName:he()(s,Ee)}):this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_STOP_FAILED_WITH_MESSAGE",{message:o.message,boardName:he()(s,Ee)}),Ce.k$.Error);this._telemetrySrv.logSessionEvent(Ce.cN.GoogleSyncEvents.SyncStopped);let l=0;for(;l<5;){if(await(0,ye.$U)(5e3),l+=1,n.isCanceled())return;try{if(!await this._loadGoogleSyncStatusAsync(e,t)||n.isCanceled())return;let i=r.googleSyncStatus.get(t);if(i&&i===pe.wR.NotSynced)return this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_STOPPED",{boardName:he()(s,Ee)}),Ce.k$.Success),void this._setGoogleSyncBusy(e,t,!1)}catch(e){this._$log.error("Planyway get sync status error:"),this._$log.error(e)}}this._setGoogleSyncBusy(e,t,!1),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_STOP_LONGER_THEN_USUAL",{boardName:he()(s,Ee)}),Ce.k$.Warning)}catch(e){this._$log.error("Planyway stop Google Sync error:"),this._$log.error(e),this._telemetrySrv.logError("Planyway stop Google Sync error",e,{class:this.constructor.name,method:this.stopGoogleSyncAsync.name}),this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_STOP_FAILED",{boardName:he()(s,Ee)}),Ce.k$.Error)}}},{kind:"get",key:"_userSettings",value:function _userSettings(){return this._settingsSrv.user}},{kind:"get",key:"_trelloUserSettings",value:function _trelloUserSettings(){return{local:this._userSettings.local.settings.provider[Ce.lP.Trello],global:this._userSettings.global.settings.provider[Ce.lP.Trello]}}},{kind:"get",key:"_currentCollectionId",value:function _currentCollectionId(){return this._collectionSrv.currentCollectionId}},{kind:"get",key:"_currentCollection",value:function _currentCollection(){return this._collectionSrv.currentCollection}},{kind:"field",key:"_handleBoardEvent",value(){var e=this;return function(t){var r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{event:a,silent:s}=i;if(s)return;if(K()(r=e._trelloBoardsListeners[a]).call(r,(e=>e(t,i))),"cleared"===a)return e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Members}),e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Calendars}),e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Lists}),void e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Labels});const n=t.accountId;if(e._provider.getCurrentCollectionConnectedCalendar(n,t.id).isSelected){switch(a){case"added":case"updated":case"deleted":e.isCurrentCollectionAccountReady(n)&&e._$rootScope.$broadcast(Ce.FK.CollectionAccountReady,{accountId:n})}switch(a){case"updated":t.name!==i.oldValue.name&&e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Calendars}),(0,ye.cO)(t.members,i.oldValue.members)||e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Members}),(0,ye.cO)(t.lists,i.oldValue.lists)||e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Lists}),(0,ye.cO)(t.labels,i.oldValue.labels)||e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Labels});break;case"deleted":e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Members}),e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Calendars}),e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Lists}),e._$rootScope.$broadcast(Ce.FK.TimelineResourcesReloaded,{resourcesType:Ce.y.Labels})}}}}},{kind:"method",key:"_setIntegrationBusy",value:function _setIntegrationBusy(e){this._$rootScope.$evalAsync((()=>this._isIntegrationBusy=e))}},{kind:"method",key:"_resetAccountCache",value:function _resetAccountCache(e){var t;null===(t=this._cache.get(e))||void 0===t||t.destroy();const r={restPromises:new(I()),organizations:new(D()),boards:new fe.v("id"),boardStars:new(D()),lists:new(D()),labels:new(D()),members:new(D()),membersByUserName:new(D()),customFields:new(D()),isGoogleSyncBusy:R()(ue.LO).call(ue.LO),googleSyncStatus:R()(ue.LO).call(ue.LO),googleSyncOptions:R()(ue.LO).call(ue.LO),boardMigrationProgressSignalRSubscribed:!1,destroy:()=>{var e;r.boardMigrationProgressSignalRSubscribed&&(null===(e=r.boardMigrationProgressSignalRSubscription)||void 0===e||e.destroy(),r.boardMigrationProgressSignalRSubscription=null,r.boardMigrationProgressSignalRSubscribed=!1);r.boards.clear();for(let e in this._trelloBoardsListeners)r.boards.removeEventListener(e,this._handleBoardEvent)}};this._cache.set(e,r);for(let e in this._trelloBoardsListeners)r.boards.addEventListener(e,this._handleBoardEvent)}},{kind:"method",key:"_addTrelloAccountAsync",value:async function _addTrelloAccountAsync(e){try{this._appCommonSrv.setSchedulerBusy(!0),this._initializedCollectionId=null,this._initializedAccounts.delete(e),this._provider.invalidAccountIds.delete(e),this._resetAccountCache(e),await this._initTrelloConnectAsync(e),this._initGoogleSyncAsync(e),this._planywayNotificationsSrv.initializeAsync(),this._initializedCollectionId=this._currentCollectionId,this._trelloCardsSrv.addTrelloAccountAsync(e)}finally{this._appCommonSrv.setSchedulerBusy(!1)}}},{kind:"method",key:"_removeTrelloAccount",value:function _removeTrelloAccount(e){var t;this._initializedAccounts.delete(e),null===(t=this._cache.get(e))||void 0===t||t.destroy(),this._cache.delete(e),this._planywayNotificationsSrv.initializeAsync(),this._trelloCardsSrv.removeTrelloAccount(e)}},{kind:"method",key:"_initTrelloConnectAsync",value:async function _initTrelloConnectAsync(e,t){if(t=t||this._appCommonSrv.getCancellationToken(`initTrelloConnect_${e}`),!this._currentCollectionId)return;if(this._initializedAccounts.has(e))return;let r=this._planywayIntegrationSrv.getConnectedAccountById(e);if(!r)return;const i=this._cache.get(e);try{var a,s,n,o;this._setIntegrationBusy(!0);let l=await this._getTrelloMemberDataAsync(e);if(t.isCanceled())return;this._initializedAccounts.add(e),this._setIntegrationBusy(!1),i.member=this.fromTrelloMember(e,l),r.accountName=i.member.fullName,r.accountEmail=i.member.email,i.organizations=new(D());let d=z()(a=R()(s=l.organizations).call(s,(t=>this._fromTrelloOrganization(e,t)))).call(a,((e,t)=>(0,ye.A5)(e.name,t.name)));for(let e of d)i.organizations.set(e.id,e);for(let e of l.boardStars)i.boardStars.set(e.idBoard,e);let c=z()(n=R()(o=l.boards).call(o,(t=>this.fromTrelloBoard(e,t)))).call(n,((e,t)=>(0,ye.A5)(e.name,t.name)));for(let e of c)i.boards.add(e)}catch(t){this._initializedAccounts.add(e),this._setIntegrationBusy(!1),this._$log.error("Trello load data error:"),this._$log.error(t),this._telemetrySrv.logError("Trello load data error",t,{class:this.constructor.name,method:this._initTrelloConnectAsync.name}),this._planywayIntegrationSrv.getPrimaryAccount().accountId===e?await this._planywayIntegrationSrv.signOutAsync():(this._notificationSrv.showNotification(this._$translate.instant("NOTIFICATIONS.LOAD_TRELLO_DATA_ERROR"),Ce.k$.Error),this._platformSrv.isOffline()||this._provider.invalidAccountIds.add(e))}}},{kind:"method",key:"_getTrelloMemberDataAsync",value:function _getTrelloMemberDataAsync(e){return this.restAsync(e,Ce.Tu.Get,"/member/me","Get Trello member me",{fields:be,organizations:"all",organization_fields:Te,boards:"open",board_fields:Se,boardStars:!0})}},{kind:"method",key:"_addOrUpdateBoard",value:function _addOrUpdateBoard(e,t,r){const i=this._cache.get(e);let a=this.fromTrelloBoard(e,t,r);var s;r.defaultListId&&(de()(s=a.lists).call(s,(e=>e.id===r.defaultListId))?a.defaultListId=r.defaultListId:r.defaultListId=void 0);if(r.customFilters){var n;let e=J()(n=r.customFilters).call(n,(e=>{var t,r;if(e.targetType===Ce.go.CustomField){let i=$()(t=a.customFields).call(t,(t=>t.id===e.targetId));if(!i)return!1;switch(i.type){case pe.vK.List:return!!$()(r=i.options).call(r,(t=>t.id===e.value));case pe.vK.Checkbox:return!0}}}));a.customFilters=e,r.customFilters=e}for(let e of a.lists)i.lists.set(e.id,e);for(let e of a.labels)i.labels.set(e.id,e);for(let e of a.members)i.members.set(e.id,e),i.membersByUserName.set(e.userName,e);for(let e of a.customFields)i.customFields.set(e.id,e);let o=i.boards.get(t.id);o?a.isReadOnly===o.isReadOnly&&a.permissionLevel===o.permissionLevel&&a.invitationLevel===o.invitationLevel&&a.isCommentsPublic===o.isCommentsPublic&&a.starred===o.starred&&a.starredPosition===o.starredPosition&&a.name===o.name&&a.boardColor===o.boardColor&&(0,ye.h0)(a.boardImageUrls,o.boardImageUrls)&&(0,ye.cO)(a.premiumFeatures,o.premiumFeatures)&&(0,ye.kt)(a.memberships,o.memberships)&&a.organizationId===o.organizationId&&(0,ye.cO)(a.lists,o.lists)&&(0,ye.cO)(a.labels,o.labels)&&(0,ye.cO)(a.members,o.members)&&(0,ye.cO)(a.customFields,o.customFields)&&a.cardDataCustomFieldId===o.cardDataCustomFieldId&&a.color===o.color&&a.dueLinkType===o.dueLinkType&&a.dueLinkTypeAllDay===o.dueLinkTypeAllDay&&a.defaultCardIsAllDay===o.defaultCardIsAllDay&&a.defaultCardDuration===o.defaultCardDuration&&a.defaultListId===o.defaultListId&&a.defaultCardPosition===o.defaultCardPosition&&a.defaultLimitArchivedCards===o.defaultLimitArchivedCards&&(0,ye.cO)(a.customFilters,o.customFilters)||i.boards.update(a):i.boards.add(a)}},{kind:"method",key:"_getBoardImageUrls",value:function _getBoardImageUrls(e){if(e){var t;if(!e.backgroundImageScaled)return{[Ce.yX.Small]:e.backgroundImage,[Ce.yX.Medium]:e.backgroundImage};z()(t=e.backgroundImageScaled).call(t,((e,t)=>e.width-t.width));let r=Math.floor((e.backgroundImageScaled.length-1)/2);return{[Ce.yX.Small]:e.backgroundImageScaled[0].url,[Ce.yX.Medium]:e.backgroundImageScaled[r].url}}return{}}},{kind:"method",key:"_fromTrelloOrganization",value:function _fromTrelloOrganization(e,t){var r;const i=this.getTrelloMember(e).id;let a=new(D())(R()(r=t.memberships).call(r,(e=>{let{id:t,idMember:r,memberType:i}=e;return[r,{membershipId:t,memberType:i}]})));function canCreateBoards(e){var t;switch(e){case"admin":return(null===(t=a.get(i))||void 0===t?void 0:t.memberType)===Ce.IM.Admin;case"org":return!0;default:return!1}}let s=canCreateBoards(t.prefs.boardVisibilityRestrict.public),n=canCreateBoards(t.prefs.boardVisibilityRestrict.private),o=canCreateBoards(t.prefs.boardVisibilityRestrict.org);return{id:t.id,accountId:e,name:t.displayName,logoUrlSmall:t.logoHash&&`${ve.$}/${t.logoHash}/30.png`,logoUrlNormal:t.logoHash&&`${ve.$}/${t.logoHash}/50.png`,memberships:a,boardsLimitReached:"disabled"===t.limits.orgs.freeBoardsPerOrg.status,boardsCreationRestricted:!s&&!n&&!o,canCreatePublicBoards:s,canCreatePrivateBoards:n,canCreateOrganizationBoards:o,canInviteGuests:"any"===t.prefs.boardInviteRestrict}}},{kind:"method",key:"_fromTrelloList",value:function _fromTrelloList(e){return{id:e.id,boardId:e.idBoard,name:e.name,position:e.pos}}},{kind:"method",key:"_fromTrelloLabel",value:function _fromTrelloLabel(e){return{id:e.id,boardId:e.idBoard,color:e.color,name:e.name}}},{kind:"method",key:"_restAsync",value:async function _restAsync(e,t,r){let i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this._telemetrySrv.logRequest(r,e,t,_objectSpread(_objectSpread({},a.query),a.body),a.telemetrySkipOnSuccess),n=200;try{return await this._platformSrv.restAsync(e,t,_objectSpread(_objectSpread({},a),{},{useTrelloAuth:!0}))}catch(e){throw e.status||this._platformSrv.switchToOffline(),n=e.status,i=e.response,e}finally{this._telemetrySrv.logRequestEnd(s,n,i)}}},{kind:"method",key:"_setGoogleSyncBusy",value:function _setGoogleSyncBusy(e,t,r){if(!this._initializedAccounts.has(e))return;const i=this._cache.get(e);this._$rootScope.$evalAsync((()=>i.isGoogleSyncBusy.set(t,r)))}},{kind:"method",key:"_getGoogleSyncErrorMessage",value:function _getGoogleSyncErrorMessage(e,t){let r=this._cache.get(e).googleSyncStatus.get(t);switch(r){case pe.wR.NotSynced:case pe.wR.Ok:return;default:let i,a=this.getTrelloBoardById(e,t).name;return i=r?Ie[r]||"NOTIFICATIONS.PLANYWAY_SYNC_UNKNOWN_ERROR":"NOTIFICATIONS.PLANYWAY_SYNC_STATUS_LOADING_ERROR",this._$translate.instant(i,{boardName:he()(a,Ee)})}}},{kind:"method",key:"_initGoogleSyncAsync",value:async function _initGoogleSyncAsync(e,t){if(!this._initializedAccounts.has(e))return;const r=this._cache.get(e);t=t||this._appCommonSrv.getCancellationToken(`initGoogleSync_${e}`);const{trelloMemberId:i,trelloToken:a}=this._planywayIntegrationSrv.getConnectedAccountById(e);let s=this._provider.getCurrentCollectionConnectedCalendarIds(e);if(0!==s.length)try{for(let t of s)this._setGoogleSyncBusy(e,t,!0);let n=await this._restAsync(Ce.Tu.Post,`${ve.nS}/trello/${i}/control`,"Get Google Sync statuses",{token:a,body:{action:"checkBoards",data:{trelloBoardIds:s}}});if(t.isCanceled())return;if(!n.success){let e=new Error(n.message);throw e.code=n.code,e.details=n.details,e}for(let t of n.data){let{trelloBoardId:i,syncStatus:a}=t,s=(0,k.Z)(t,ge);if(this._setGoogleSyncBusy(e,i,!1),r.googleSyncStatus.set(i,a),a===pe.wR.NotSynced)r.googleSyncOptions.delete(i);else r.googleSyncOptions.set(i,s);let n=this._trelloUserSettings.local.googleSyncStatuses[i];if(this._trelloUserSettings.local.googleSyncStatuses[i]=a,this._userSettings.local.save(),a!==n){let t=this._getGoogleSyncErrorMessage(e,i);t&&this._notificationSrv.showNotification(t,Ce.k$.Error)}}}catch(t){for(let t of s)this._setGoogleSyncBusy(e,t,!1);this._$log.error("Planyway init Google sync error:"),this._$log.error(t),this._telemetrySrv.logError("Planyway init Google sync error",t,{class:this.constructor.name,method:this._initGoogleSyncAsync.name})}}},{kind:"method",key:"_loadGoogleSyncStatusAsync",value:async function _loadGoogleSyncStatusAsync(e,t,r){if(!this._initializedAccounts.has(e))return;const i=this._cache.get(e);r=r||this._appCommonSrv.getCancellationToken(`loadGoogleSyncStatus_${e}_${t}`);const{trelloMemberId:a,trelloToken:s}=this._planywayIntegrationSrv.getConnectedAccountById(e);let n=this.getTrelloBoardById(e,t).name,o=await this._restAsync(Ce.Tu.Post,`${ve.nS}/trello/${a}/control`,"Get Google Sync status",{token:s,body:{action:"check",data:{trelloBoardId:t}}});if(r.isCanceled())return!1;if(!o.success)return this._notificationSrv.showNotification(we[o.code]?this._$translate.instant(we[o.code],{boardName:he()(n,Ee)}):this._$translate.instant("NOTIFICATIONS.PLANYWAY_SYNC_STATUS_LOADING_ERROR_WITH_MESSAGE",{message:o.message,boardName:he()(n,Ee)}),Ce.k$.Error),!0;let l=o.data,{syncStatus:d}=l,c=(0,k.Z)(l,_e);if(i.googleSyncStatus.set(t,d),d===pe.wR.NotSynced)i.googleSyncOptions.delete(t);else i.googleSyncOptions.set(t,c);return!0}}]}}))}}]);