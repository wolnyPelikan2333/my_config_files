"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[3943],{35757:(e,t,s)=>{var i;s.d(t,{DY:()=>o,OL:()=>a,S9:()=>i,iW:()=>r,sY:()=>n}),function(e){e.List="list",e.Detail="detail"}(i||(i={}));const a=["tabs","sessions"],n={ERROR_STASH:"Oops, we couldn't save that session at this time.",ERROR_RESTORE:"Oops, we couldn't restore that session at this time.",ERROR_NO_OTHER_TABS:"No tabs to stash.",ERROR_DELETE:"Oops, there was a problem deleting that session.",ERROR_ALL_DELETE:"Oops, there was a problem deleting all sessions.",SUCCESSFUL_STASH_PARTIAL:" saved to a new session.",SUCCESSFUL_RESTORE_PARTIAL:" session restored.",SUCCESSFUL_ALL_DELETE:"All session deleted.",DELETE_PARTIAL:" session deleted."},o="chrome://newtab/",r="https://get.momentumdash.help/hc/en-us/articles/14474141114391"},25113:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(28149),a=s(1724);class n{constructor({key:e,tabs:t,index:s,color:n="grey",title:o="",collapsed:r=!1}){this.type=a.LL.Group,this.key=e,this.index=s,this.tabs=t.map((e=>new i.O(e))).sort(((e,t)=>e.index-t.index)),this.color=n,this.title=o,this.collapsed=r}}},9128:(e,t,s)=>{s.d(t,{z:()=>n});var i=s(74957),a=s(1724);class n{constructor({id:e,name:t,windows:s,activeWindowKey:i,browser:n,dateCreated:o}){this.windows=[],this.id=e,this.name=t,this.windows=s.map((e=>new a.Rz(e))),this.activeWindowKey=i,this.browser=n,this.dateCreated=o}get totalTabCount(){return this.windows.map((e=>e.tabCount)).reduce(((e,t)=>e+t))}get displayName(){return this.name||i.Z.getFriendlyDateTime(new Date(this.dateCreated))}get sessionDescriptionTabs(){const e=this.totalTabCount;return`${e} tab${e>1?"s":""}`}get sessionDescriptionWindows(){return`${this.windows.length} window${this.windows.length>1?"s":""}`}}},28149:(e,t,s)=>{s.d(t,{H:()=>n,O:()=>a});var i=s(1724);class a{constructor({key:e,title:t,url:s,pinned:a,index:n}){this.type=i.LL.Tab,this.key=e,this.title=t,this.url=s,this.pinned=a,this.index=n}}const n=e=>!("object"!=typeof e||!e)&&(Object.entries({key:"number",title:"string",url:"string",pinned:"boolean",index:"number"}).every((([t,s])=>t in e&&typeof e[t]===s))&&e.type===i.LL.Tab)},1724:(e,t,s)=>{s.d(t,{LL:()=>i,Nw:()=>o,Rz:()=>r,ZQ:()=>d});var i,a=s(25113),n=s(28149);!function(e){e.Tab="Tab",e.Group="Group"}(i||(i={}));const o=["app","devtools"];class r{constructor({key:e,activeTabKey:t,state:s,type:i,left:o,top:r,width:d,height:w,browserSessionKey:h,tabsAndGroups:c}){this.tabsAndGroups=[],this.key=e,this.activeTabKey=t,this.state=s,this.type=i,this.left=o,this.top=r,this.width=d,this.height=w,h&&(this.browserSessionKey=h),this.tabsAndGroups=c.map((e=>"tabs"in e?new a.Z(e):new n.O(e))).sort(((e,t)=>e.index-t.index))}get tabCount(){let e=0;return this.tabsAndGroups.forEach((t=>{e+=t instanceof n.O?1:t.tabs.length})),e}}const d=e=>!("object"!=typeof e||!e)&&Object.entries({key:"number",state:"string",type:"string",left:"number",top:"number",width:"number",height:"number"}).every((([t,s])=>t in e&&typeof e[t]===s))},94787:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(9128),a=s(1724),n=s(74957),o=s(28149),r=s(25113),d=s(77140),w=s(35757);class h{constructor(e){this.dataService=e}get(e){this.dataService.get(e)}create(e){return this.dataService.create(e.id,e)}update(e,t,s={}){return this.dataService.update(e,t,s)}delete(e){return this.dataService.delete(e)}async ensurePermissions(){return!!await d.H.permissions.contains({permissions:w.OL})||new Promise((e=>{m.cmd("modal.open","PERMISSION_REQUEST",{widgetName:"Tab Stash",permissionExplanation:"To save your tabs for later",permissions:{permissions:w.OL},resolve:e})}))}renameIdToKey({id:e,...t}){return{...t,key:e}}async closeWindowsAndSetSessionIds(e){for(const t of e.windows){await d.H.windows.remove(t.key);const e=await d.H.sessions.getLastClosedSessionId().catch((e=>{console.error(e)}));e&&(t.browserSessionKey=e)}return e}async restoreSession(e){const t=e.windows.filter((t=>t.key!==e.activeWindowKey)),s=e.windows.filter((t=>t.key===e.activeWindowKey)),i=await d.H.tabs.query({currentWindow:!0}),a=i.find((e=>e.active));if(!a||!a.id)throw new Error("Could not find active tab id from current window");let n=a.windowId;for(const o of[...t,...s]){const t=await this.restoreWindow(o,e.browser);o.key===e.activeWindowKey&&1===i.length&&t.id&&(a.pinned&&await d.H.tabs.update(a.id,{pinned:!1}),await d.H.tabs.moveToWindow(a.id,t.id),n=t.id,a.pinned&&await d.H.tabs.update(a.id,{pinned:!0}))}await this.focusTabAndWindow(a.id,n)}async getSessionFromWindows(){const e=await d.H.tabs.query({currentWindow:!0}),t=e.find((e=>e.active));let s=-1;t&&1!==e.length&&t.id&&(await this.pullTabInNewWindow(t),s=t.windowId);const o={id:n.Z.uuidv4(),name:"",windows:[],activeWindowKey:s,browser:this.getCurrentBrowserOrigin(),dateCreated:(new Date).toISOString()},r=await d.H.windows.getAll();for(let e of r)if(!(e.focused||e.type&&a.Nw.includes(e.type))){if(e=this.renameIdToKey(e),!(0,a.ZQ)(e))throw new Error(`window returned by browser (${o.browser}) does not satisfy IWindow type`);await this.setTabsDataForWindow(e,o.browser),o.windows.push(e)}return new i.z(o)}async openPartialSession(e){e instanceof a.Rz?await this.fallbackRestoreWindow(e,this.getCurrentBrowserOrigin()):e instanceof r.Z?await this.createGroup(e):e instanceof o.O&&await d.H.tabs.create({url:e.url,pinned:e.pinned})}async createGroup(e){const t=[];for(const s of e.tabs){const e=await d.H.tabs.create({url:s.url,pinned:s.pinned});e.id&&t.push(e.id)}void 0!==chrome.tabs.group&&await d.H.tabs.group({tabIds:t})}async pullTabInNewWindow(e){const t=e.id;if(!t)throw new Error("Could not read tab id when pulling out tab from window");const s=await d.H.windows.get(e.windowId),i={left:s.left,top:s.top,width:s.width,height:s.height};let a;if("normal"===s.state&&(a=await d.H.windows.create({tabId:t,...i})),a||(a=await d.H.windows.create({tabId:t})),!a)throw new Error("Could not create window when pulling out tab from window");e.pinned&&await d.H.tabs.update(t,{pinned:!0})}async setTabsDataForWindow(e,t){var s,i;const n=(await d.H.tabs.query({windowId:e.key})).map((e=>{if(Object.assign(e,{type:a.LL.Tab}),e=this.renameIdToKey(e),!(0,o.H)(e))throw new Error(`tab returned by browser (${t}) does not satisfy ITab type`);return[e.url,t+"://newtab/"].includes(window.location.href)&&(e.url=w.DY),e})),r=[];e.activeTabKey=(null===(s=n.find((e=>e.active)))||void 0===s?void 0:s.id)||-1;for(let e=0;e<n.length;e++){const t=n[e];if(t)if(~t.groupId&&void 0!==t.groupId){const s={key:t.groupId,index:0,type:a.LL.Group,tabs:n.filter((e=>e.groupId===t.groupId))};s.index=Number(null===(i=s.tabs[0])||void 0===i?void 0:i.index),e+=s.tabs.length-1,r.push(s)}else r.push(t)}e.tabsAndGroups=r}async restoreWindow(e,t){const s=e.browserSessionKey;let i;return s&&(i=await d.H.sessions.restoreWindow(s)),i||(i=await this.fallbackRestoreWindow(e,t)),i}async fallbackRestoreWindow(e,t){var s,i,n,w,h;let c;const l={},{tabsAndGroups:u,activeTabKey:p,key:b,browserSessionKey:y,...g}=e,m=u.map((e=>e instanceof o.O?[e]:e.tabs)).flat();if(Object.assign(l,g),l.type&&a.Nw.includes(l.type)&&(l.type="normal"),l.url=this.getUrlArrayForWindowCreateFromTabs(m,t),["maximized","minimized","fullscreen"].includes(e.state)&&["width","height","left","top"].forEach((e=>delete l[e])),c=await d.H.windows.create(l),c||(["left","top"].forEach((e=>delete l[e])),c=await d.H.windows.create(l)),c||(["width","height"].forEach((e=>delete l[e])),c=await d.H.windows.create(l)),!c)throw new Error("Could not create window");if(void 0!==chrome.tabs.group)for(const e of u){if(!(e instanceof r.Z))continue;const t=e.index,i=t+e.tabs.length,a={tabIds:null===(s=c.tabs)||void 0===s?void 0:s.slice(t,i).map((e=>e.id)),createProperties:{windowId:c.id}};await d.H.tabs.group(a)}for(let e=0;e<m.length;e++){const t=m[e];if(null==t?void 0:t.pinned){const t=null===(n=null===(i=c.tabs)||void 0===i?void 0:i[e])||void 0===n?void 0:n.id;if(!t)continue;await d.H.tabs.update(t,{pinned:!0})}}const f=m.find((e=>e.key===p));if(f){const e=m.indexOf(f),t=null===(h=null===(w=c.tabs)||void 0===w?void 0:w[e])||void 0===h?void 0:h.id;t&&await d.H.tabs.update(t,{active:!0})}return c}getUrlArrayForWindowCreateFromTabs(e,t){const s=e=>e.startsWith(t+"-extension://")||e.startsWith(t+"://"),i=e.map((e=>e.url===w.DY&&n.Z.isFirefox()?"/dashboard.html":s(e.url)?e.url.replace(t,this.getCurrentBrowserOrigin()):e.url)).filter((e=>!(s(e)&&n.Z.isFirefox()||e.startsWith("about:"))));return 0===i.length&&i.push("/dashboard.html"),i}getCurrentBrowserOrigin(){return window.location.href.split("-")[0]||"chrome"}async focusTabAndWindow(e,t){e&&await d.H.tabs.update(e,{active:!0}),t&&await d.H.windows.update(t,{focused:!0})}}var c=s(34145);const l=()=>({tabStashService:new h(new c.U("tabs"))})},63943:(e,t,s)=>{s.r(t),s.d(t,{default:()=>w,makeTabsStore:()=>r,useTabsStore:()=>d});var i=s(28692),a=s(94787),n=s(9128),o=s(20144);const r=(e=(0,a.A)().tabStashService)=>(0,i.Q_)("tabs",{state:()=>({data:{},loading:!1,loaded:!1,activeItemId:""}),getters:{getItems:e=>Object.values(e.data).map((e=>new n.z(e))).sort(((e,t)=>Date.parse(t.dateCreated)-Date.parse(e.dateCreated))),getItemById:e=>t=>{const s=e.data[t];return s?new n.z(s):null}},actions:{refresh(){this.loading=!0,e.get({success:e=>{e.forEach((e=>o.ZP.set(this.data,e.id,e))),this.loaded=!0,this.loading=!1}})},async stashSession(){if(!await e.ensurePermissions())return;const t=await e.getSessionFromWindows();return 0===t.windows.length||(await this.create(t),await e.closeWindowsAndSetSessionIds(t),await this.update(t.id,{windows:t.windows})),t},async restoreSession(t){if(await e.ensurePermissions())return await e.restoreSession(t),await this.delete(t.id),!0},async create(t){o.ZP.set(this.data,t.id,t),await e.create(t)},async delete(t){o.ZP.delete(this.data,t),await e.delete(t)},async update(t,s){const i=this.data[t];if(!i)throw new Error(`No data found for ${t}`);const a={...i,...s};o.ZP.set(this.data,t,a);const n=Object.keys(s).join(",");return await e.update(t,a,{queryParams:{update_mask:n}}),a}}}),d=r(),w=d},34145:(e,t,s)=>{s.d(t,{U:()=>n});var i=s(42935);const a=s(24960).Z;class n{constructor(e,{queryParams:t={},path:s="",mode:i="sync"}={}){this.type=e,this.queryParams=t,this.path=s,this.mode=i}get({path:e=this.path||this.type,mode:t=this.mode,success:s,failure:i,queryParams:n={}}){var o;e+=this.buildQueryString((null===(o=this.queryParams)||void 0===o?void 0:o.get)||{},n);const r=[this.type,{path:e,env:this.getEnv(),mode:t}];"server"===t?a.sendMessage({handler:"get",args:r}).then(s).catch(i):a.sendRecurringCrossTabMessage({msgId:this.type+":refreshed",handler:"get",args:r,success:s,failure:i})}create(e,t,{path:s=this.path||this.type,mode:i=this.mode}={}){const n=[this.type,e,t];return n.push({path:s,mode:i,env:this.getEnv()}),a.sendMessage({handler:"create",args:n})}update(e,t,{path:s=this.path||this.type,mode:i=this.mode,queryParams:n={}}={}){var o;const r=this.buildQueryString((null===(o=this.queryParams)||void 0===o?void 0:o.update)||{},n),d=[this.type,e,t];return d.push({path:s,mode:i,env:this.getEnv(),queryString:r}),a.sendMessage({handler:"update",args:d})}delete(e,{path:t=this.path||this.type,mode:s=this.mode}={}){const i=[this.type,e];return i.push({path:t,mode:s,env:this.getEnv()}),a.sendMessage({handler:"delete",args:i})}getEnv(){return{token:localStorage.getItem("token"),clientUuid:localStorage.getItem("client_uuid"),apiUrl:m.globals.urlRootApi,version:m.globals.version,tabId:i.Z}}buildQueryString(...e){const t=new URLSearchParams(Object.assign({},...e)).toString();return t?"?"+t:""}}}}]);